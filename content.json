{"meta":{"title":"Wkkã®ç¬”è®°","subtitle":"å¥½è®°æ€§ä¸å¦‚çƒ‚é”®ç›˜","description":"Anything in life worth doing is worth overdoing. Moderation is for cowards. ","author":"weikunkun","url":"https://winniekun.github.io","root":"/"},"pages":[{"title":"About Me","date":"2021-05-19T09:47:58.000Z","updated":"2021-10-03T14:03:18.251Z","comments":true,"path":"about/index.html","permalink":"https://winniekun.github.io/about/index.html","excerpt":"","text":"NPE ğŸ˜ˆ"},{"title":"Categories","date":"2021-05-19T09:47:47.000Z","updated":"2021-05-19T10:27:14.252Z","comments":true,"path":"categories/index.html","permalink":"https://winniekun.github.io/categories/index.html","excerpt":"","text":""},{"title":"Tags","date":"2021-05-19T09:47:52.000Z","updated":"2021-05-19T10:27:30.150Z","comments":true,"path":"tags/index.html","permalink":"https://winniekun.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"åˆ†å¸ƒå¼é”çš„é˜è¿°ä»¥åŠå®ç°","slug":"åˆ†å¸ƒå¼/distributed-lock-manager","date":"2021-09-22T08:10:46.000Z","updated":"2021-09-22T14:46:23.802Z","comments":true,"path":"distributed-lock-manager/","link":"","permalink":"https://winniekun.github.io/distributed-lock-manager/","excerpt":"","text":"åˆ†å¸ƒå¼é”é˜è¿°åœ¨ææ˜ç™½åˆ†å¸ƒå¼é”ä¹‹å‰ï¼Œå…ˆæ˜ç™½å…¶ç”±æ¥ã€‚ è°ˆåˆ°åˆ†å¸ƒå¼é”è‡ªç„¶ä¹Ÿå°±èƒ½è”æƒ³åˆ°åˆ†å¸ƒå¼åº”ç”¨ã€‚ åœ¨å°†åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼åº”ç”¨ä¹‹å‰ï¼Œæ˜¯å•æœºç³»ç»Ÿï¼Œåœ¨å•æœºç³»ç»Ÿä¸­çš„å¹¶å‘åœºæ™¯ä¸ºå•è¿›ç¨‹å¤šçº¿ç¨‹æ¨¡å¼ é‡‡ç”¨åŠ é”æˆ–è€…éé˜»å¡åŒæ­¥æˆ–è€…æ— é”åŒæ­¥å¯ä»¥ç®€å•çš„å®ç°åŒæ­¥æ“ä½œ å°†åº”ç”¨æ‹†åˆ†ä¸ºåˆ†å¸ƒå¼åº”ç”¨ä¹‹åï¼Œå¹¶å‘åœºæ™¯å˜æˆäº†å¤šè¿›ç¨‹+å¤šçº¿ç¨‹çš„æ¨¡å¼ ä¸šç•Œå¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯å€ŸåŠ©äºä¸€ä¸ªç¬¬ä¸‰æ–¹ç»„ä»¶å¹¶==åˆ©ç”¨å®ƒè‡ªèº«çš„æ’ä»–æ€§æ¥è¾¾åˆ°å¤šè¿›ç¨‹çš„äº’æ–¥==ã€‚å¦‚ï¼š åŸºäºDBçš„å”¯ä¸€ç´¢å¼• åŸºäºZKçš„ä¸´æ—¶èŠ‚ç‚¹ åŸºäºRedisçš„NX EXå‚æ•° EX second ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value ã€‚ PX millisecond ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value ã€‚ NX ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value ã€‚ XX ï¼šåªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ ä¸€ä¸ªè‰¯å¥½çš„åˆ†å¸ƒå¼é”ï¼Œè¦è§£å†³å¦‚ä¸‹çš„å‡ ä¸ªæ ¸å¿ƒçš„é—®é¢˜ï¼š å¯ç”¨é—®é¢˜ï¼š æ— è®ºä½•æ—¶éƒ½è¦ä¿è¯é”æœåŠ¡çš„å¯ç”¨æ€§ï¼ˆè¿™æ˜¯ç³»ç»Ÿæ­£å¸¸æ‰§è¡Œé”æ“ä½œçš„åŸºç¡€ï¼‰ã€‚ æ­»é”é—®é¢˜ï¼š å®¢æˆ·ç«¯ä¸€å®šå¯ä»¥è·å–é”ï¼Œå³ä½¿å…¶ä»–å®¢æˆ·ç«¯è·å–é”ä¹‹åï¼Œåœ¨é‡Šæ”¾é”ä¹‹å‰å®•æœºäº†ã€‚ è„‘è£‚é—®é¢˜ï¼š é›†ç¾¤åŒæ­¥æ—¶äº§ç”Ÿçš„æ•°æ®ä¸ä¸€è‡´æˆ–è€…æ•…éšœè½¬ç§»æ—¶ï¼Œå¯¼è‡´æ–°çš„è¿›ç¨‹æœ‰å¯èƒ½æ‹¿åˆ°é”ï¼Œä½†ä¹‹å‰çš„è¿›ç¨‹ä»¥ä¸ºè‡ªå·±è¿˜æœ‰é”ï¼Œé‚£ä¹ˆå°±å‡ºç°ä¸¤ä¸ªè¿›ç¨‹æ‹¿åˆ°äº†åŒä¸€ä¸ªé”çš„é—®é¢˜ã€‚ å¯é‡å…¥ï¼š ä¸€ä¸ªèŠ‚ç‚¹è·å–äº†é”ä¹‹åï¼Œè¿˜å¯ä»¥å†æ¬¡è·å–æ•´ä¸ªé”èµ„æºã€‚ MySQLå®ç°åˆ†å¸ƒå¼é”åŸºäºMySQLçš„æ–¹æ¡ˆï¼Œä¸€èˆ¬åˆ†ä¸º3ç±»ï¼šåŸºäºè¡¨è®°å½•ã€ä¹è§‚é”å’Œæ‚²è§‚é” åŸºäºè¡¨è®°å½•æœ€ç›´è§‚çš„å½¢å¼å°±æ˜¯åˆ›å»ºä¸€å¼ è¡¨ï¼Œç„¶ååœ¨è¡¨é‡Œé¢æ‰§è¡Œæ“ä½œï¼Œè·å–é”æ—¶åœ¨è®°å½•ä¸­æ–°å¢ä¸€æ¡è®°å½•ï¼Œé‡Šæ”¾é”çš„æ—¶å€™å†æŠŠè¯¥è®°å½•åˆ é™¤å³å¯ã€‚ DDLï¼š CREATE TABLE `database_lock` ( `id` BIGINT NOT NULL AUTO_INCREMENT, `resource` int NOT NULL COMMENT 'é”å®šçš„èµ„æº', `description` varchar(1024) NOT NULL DEFAULT \"\" COMMENT 'æè¿°', PRIMARY KEY (`id`), UNIQUE KEY `uiq_idx_resource` (`resource`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•°æ®åº“åˆ†å¸ƒå¼é”è¡¨'; å› ä¸ºæ·»åŠ äº†å”¯ä¸€ç´¢å¼•ï¼Œæ‰€ä»¥èƒ½å¤Ÿä¿è¯æ’ä»–æ€§ï¼ŒåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è·å–åˆ°å…±äº«èµ„æºï¼ˆæŠ¥é”™ï¼šERROR 1062 (23000): Duplicate entry â€˜1â€™ for key â€˜uiq_idx_resourceâ€™ï¼‰ã€‚ è·å–é”ï¼š INSERT INTO database_lock(resource, description) VALUES (1, 'lock'); é‡Šæ”¾é”ï¼š DELETE FROM database_lock WHERE resource = 1; æ³¨æ„äº‹é¡¹ï¼š æ²¡æœ‰æ—¶æ•ˆæ—¶é—´ï¼Œå¦‚æœå®¢æˆ·ç«¯è·å–é”ä¹‹åï¼Œå®•æœºä¹‹åï¼Œæˆ–è€…å…¶ä»–é‡Šæ”¾é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯æ— æ³•è·å–é” å¯ä»¥åšä¸€ä¸ªå®šæ—¶ä»»åŠ¡å»å®šæ—¶æ¸…ç†ã€‚ è¿™ç§é”çš„å¯é æ€§ä¾èµ–äºæ•°æ®åº“ã€‚å»ºè®®è®¾ç½®å¤‡åº“ï¼Œé¿å…å•ç‚¹ï¼Œè¿›ä¸€æ­¥æé«˜å¯é æ€§ è¿™ç§é”æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ’å…¥æ•°æ®å¤±è´¥ä¹‹åä¼šç›´æ¥æŠ¥é”™ï¼Œæƒ³è¦è·å¾—é”å°±éœ€è¦å†æ¬¡æ“ä½œã€‚å¦‚æœéœ€è¦é˜»å¡å¼çš„ï¼Œå¯ä»¥å¼„ä¸ªforå¾ªç¯ã€whileå¾ªç¯ä¹‹ç±»çš„ï¼Œç›´è‡³INSERTæˆåŠŸå†è¿”å› è¿™ç§é”ä¹Ÿæ˜¯éå¯é‡å…¥çš„ï¼Œå› ä¸ºåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—é”ï¼Œå› ä¸ºæ•°æ®åº“ä¸­å·²ç»å­˜åœ¨åŒä¸€ä»½è®°å½•äº†ã€‚æƒ³è¦å®ç°å¯é‡å…¥é”ï¼Œå¯ä»¥åœ¨æ•°æ®åº“ä¸­æ·»åŠ ä¸€äº›å­—æ®µï¼Œæ¯”å¦‚è·å¾—é”çš„ä¸»æœºä¿¡æ¯ã€çº¿ç¨‹ä¿¡æ¯ç­‰ï¼Œé‚£ä¹ˆåœ¨å†æ¬¡è·å¾—é”çš„æ—¶å€™å¯ä»¥å…ˆæŸ¥è¯¢æ•°æ®ï¼Œå¦‚æœå½“å‰çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ç­‰èƒ½è¢«æŸ¥åˆ°çš„è¯ï¼Œå¯ä»¥ç›´æ¥æŠŠé”åˆ†é…ç»™å®ƒã€‚ åŸºäºä¹è§‚é”DDLï¼š CREATE TABLE `optimistic_lock` ( `id` BIGINT NOT NULL AUTO_INCREMENT, `resource` int NOT NULL COMMENT 'é”å®šçš„èµ„æº', `version` int NOT NULL COMMENT 'ç‰ˆæœ¬ä¿¡æ¯', `created_at` datetime COMMENT 'åˆ›å»ºæ—¶é—´', `updated_at` datetime COMMENT 'æ›´æ–°æ—¶é—´', `deleted_at` datetime COMMENT 'åˆ é™¤æ—¶é—´', PRIMARY KEY (`id`), UNIQUE KEY `uiq_idx_resource` (`resource`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•°æ®åº“åˆ†å¸ƒå¼é”è¡¨'; åœ¨ä½¿ç”¨ä¹è§‚é”ä¹‹å‰è¦ç¡®ä¿è¡¨ä¸­æœ‰ç›¸åº”çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š INSERT INTO optimistic_lock(resource, version, created_at, updated_at) VALUES(20, 1, CURTIME(), CURTIME()); åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸­ï¼Œæµç¨‹å¦‚ä¸‹ï¼š è·å–èµ„æºï¼š select resource from optimistic_lock where id = 1; æ‰§è¡Œä¸šåŠ¡é€»è¾‘ æ›´æ–°èµ„æºï¼šupdate optimistic_lock set resource = resource - 1 where id = 1 ä¸è¿‡åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°è¶…å‡çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªversionæˆ–è€…æ—¶é—´æˆ³æ¥è¿›è¡Œæ§åˆ¶ï¼Œç±»ä¼¼CAS è·å–èµ„æºï¼šSELECT resource, version FROM optimistic_lock WHERE id = 1 æ‰§è¡Œä¸šåŠ¡é€»è¾‘ æ›´æ–°èµ„æºï¼šUPDATE optimistic_lock SET resource = resource -1, version = version + 1 WHERE id = 1 AND version = oldVersion è™½ç„¶æœ¬èº«å¹¶æ²¡æœ‰åˆ©ç”¨åˆ°æ•°æ®åº“è‡ªèº«çš„é”æœºåˆ¶ï¼Œä¸å½±å“è¯·æ±‚æ€§èƒ½ï¼Œä½†æ˜¯ï¼Œå¹¶å‘é‡å¤§çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´å¤§é‡çš„è¯·æ±‚å¤±è´¥ã€‚åŒæ—¶å› ä¸ºéƒ½æ˜¯ä½œç”¨åœ¨åŒä¸€æ¡è®°å½•ä¸Šï¼Œåœ¨ä¸€äº›ç‰¹æ®Šåœºæ™¯ï¼Œå¦‚å¤§ä¿ƒã€ç§’æ€ç­‰æ´»åŠ¨å¼€å±•çš„æ—¶å€™ï¼Œå¤§é‡çš„è¯·æ±‚åŒæ—¶è¯·æ±‚åŒä¸€æ¡è®°å½•çš„è¡Œé”ï¼Œä¼šå¯¹æ•°æ®åº“äº§ç”Ÿå¾ˆå¤§çš„å†™å‹åŠ›ã€‚æ‰€ä»¥ç»¼åˆæ•°æ®åº“ä¹è§‚é”çš„ä¼˜ç¼ºç‚¹ï¼Œä¹è§‚é”æ¯”è¾ƒé€‚åˆå¹¶å‘é‡ä¸é«˜ï¼Œå¹¶ä¸”å†™æ“ä½œä¸é¢‘ç¹çš„åœºæ™¯ åŸºäºæ‚²è§‚é”é™¤äº†å¯ä»¥é€šè¿‡å¢åˆ æ“ä½œæ•°æ®åº“è¡¨ä¸­çš„è®°å½•ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€ŸåŠ©æ•°æ®åº“ä¸­è‡ªå¸¦çš„é”æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚åœ¨æŸ¥è¯¢è¯­å¥åé¢å¢åŠ FOR UPDATEï¼Œæ•°æ®åº“ä¼šåœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ç»™æ•°æ®åº“è¡¨å¢åŠ æ‚²è§‚é”ï¼Œä¹Ÿç§°æ’ä»–é”ã€‚å½“æŸæ¡è®°å½•è¢«åŠ ä¸Šæ‚²è§‚é”ä¹‹åï¼Œå…¶å®ƒçº¿ç¨‹ä¹Ÿå°±æ— æ³•å†æ”¹è¡Œä¸Šå¢åŠ æ‚²è§‚é”ã€‚ æ­¥éª¤å¦‚ä¸‹ï¼š è·å–èµ„æº SELECT * FROM database_lock WHERE id = 1 FOR UPDATE æ‰§è¡Œä¸šåŠ¡é€»è¾‘ é‡Šæ”¾é” COMMIT æ³¨æ„äº‹é¡¹ï¼š é¿å…é”å‡çº§åˆ°è¡¨é”ã€‚æ‰€ä»¥éœ€è¦æ˜ç¡®èƒ½å¤Ÿèµ°åˆ°ç´¢å¼•ã€‚ åœ¨æ‚²è§‚é”ä¸­ï¼Œæ¯ä¸€æ¬¡è¡Œæ•°æ®çš„è®¿é—®éƒ½æ˜¯ç‹¬å çš„ï¼Œåªæœ‰å½“æ­£åœ¨è®¿é—®è¯¥è¡Œæ•°æ®çš„è¯·æ±‚äº‹åŠ¡æäº¤ä»¥åï¼Œå…¶ä»–è¯·æ±‚æ‰èƒ½ä¾æ¬¡è®¿é—®è¯¥æ•°æ®ï¼Œå¦åˆ™å°†é˜»å¡ç­‰å¾…é”çš„è·å–ã€‚æ‚²è§‚é”å¯ä»¥ä¸¥æ ¼ä¿è¯æ•°æ®è®¿é—®çš„å®‰å…¨ã€‚ä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜æ˜¾ï¼Œå³æ¯æ¬¡è¯·æ±‚éƒ½ä¼šé¢å¤–äº§ç”ŸåŠ é”çš„å¼€é”€ä¸”æœªè·å–åˆ°é”çš„è¯·æ±‚å°†ä¼šé˜»å¡ç­‰å¾…é”çš„è·å–ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå®¹æ˜“é€ æˆå¤§é‡è¯·æ±‚é˜»å¡ï¼Œå½±å“ç³»ç»Ÿå¯ç”¨æ€§ã€‚å¦å¤–ï¼Œæ‚²è§‚é”ä½¿ç”¨ä¸å½“è¿˜å¯èƒ½äº§ç”Ÿæ­»é”çš„æƒ…å†µã€‚ Rediså®ç°åˆ†å¸ƒå¼é”å•æœºRediså®ç°åˆ†å¸ƒå¼é”è·å–é”ï¼š SET resource_name my_random_value NX PX 30000 ä¸Šé¢çš„å‘½ä»¤å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œåˆ™å®¢æˆ·ç«¯æˆåŠŸè·å–åˆ°äº†é”ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è®¿é—®å…±äº«èµ„æºäº†ï¼›è€Œå¦‚æœä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è¯´æ˜è·å–é”å¤±è´¥ã€‚ SETå‘½ä»¤é˜è¿°ï¼š resource_name å¯ä»¥è§†ä¸ºä¸€ä¸ªå…±äº«èµ„æº my_random_value é€šè¿‡å®¢æˆ·ç«¯è‡ªå·±ç”Ÿæˆä¸€ä¸ªéšæœºç¬¦å·ï¼Œä½œä¸ºå”¯ä¸€æ ‡å¿—ç¬¦ï¼Œé¿å…é”™è¯¯è§£é”é—®é¢˜ NX è‹¥å½“å‰keyå·²ç»å­˜åœ¨ï¼Œåˆ™ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œè‹¥å½“å‰keyä¸å­˜åœ¨ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯setæ“ä½œã€‚è¿™ä¿è¯äº†åªæœ‰ç¬¬ä¸€ä¸ªè¯·æ±‚çš„å®¢æˆ·ç«¯æ‰èƒ½è·å¾—é”ï¼Œè€Œå…¶å®ƒå®¢æˆ·ç«¯åœ¨é”è¢«é‡Šæ”¾ä¹‹å‰éƒ½æ— æ³•è·å¾—é”ï¼ˆå¾ˆå¥½çš„æ’ä»–æ€§ï¼‰ã€‚ PX 3000 è¡¨ç¤ºè¿™ä¸ªé”æœ‰ä¸€ä¸ª30ç§’çš„è‡ªåŠ¨è¿‡æœŸæ—¶é—´ã€‚å½“ç„¶ï¼Œè¿™é‡Œ30ç§’åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©åˆé€‚çš„è¿‡æœŸæ—¶é—´ã€‚ é‡Šæ”¾é”ï¼š if redis.call(\"get\",KEYS[1]) == ARGV[1] then return redis.call(\"del\",KEYS[1]) else return 0 end LUAå‘½ä»¤é˜è¿°ï¼š å‰é¢çš„my_random_valueä½œä¸ºARGV[1]ä¼ å…¥ï¼Œç„¶åæŠŠresource_nameä½œä¸ºKEY[1]ä¼ è¿›æ¥ å•æœºRediså®ä¾‹å®ç°åˆ†å¸ƒå¼é”çš„ä¸€äº›æ ¸å¿ƒç‚¹ï¼š é”å¿…é¡»è¦è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼ˆé”çš„æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œé¿å…å®¢æˆ·ç«¯è·å–é”ä¹‹åå´©æºƒæˆ–è€…å‡ºç°ç½‘ç»œåˆ†å‰²ç­‰é—®é¢˜å¯¼è‡´çš„å…¶æ— æ³•å’ŒRediså®ä¾‹ç»§ç»­é€šä¿¡ï¼Œæœ€åå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯éƒ½æ— æ³•è·å–é” è·å–é”æ“ä½œè¦ä¿è¯åŸå­æ€§ ä¸Šè¿°è·å–é”çš„è¯­ä¹‰åˆ†ä¸ºä¸¤æ­¥éª¤ï¼š set ã€è®¾ç½®è¿‡æœŸæ—¶é—´ SETNX resource_name my_random_value EXPIRE resource_name 30 ä½†åˆ†ä¸ºä¸¤ä¸ªå‘½ä»¤çš„è¯ï¼Œæ— æ³•ä¿è¯åŸå­æ€§æ“ä½œï¼ˆsetä¹‹åï¼Œå®¢æˆ·ç«¯å®•æœºäº†ï¼Œåˆ™ä¼šä¸€ç›´æŒæœ‰é”ï¼‰ï¼Œä¸Šè¿°çš„è·å–é”æ“ä½œå°±æ˜¯ä¸€ä¸ªå‘½ä»¤ï¼Œä¹Ÿå°±å…·æœ‰åŸå­æ€§äº†ã€‚ my_random_valueæ˜¯å¿…é¡»çš„ é€šè¿‡my_random_valueä½œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¯ä»¥æœ‰æ•ˆçš„è§£å†³é”™è¯¯è§£é”çš„é—®é¢˜ å®¢æˆ·ç«¯Aè·å–é”ï¼Œç„¶åæ‰§è¡Œæ“ä½œ å®¢æˆ·ç«¯Aåœ¨æŸä¸ªæ“ä½œä¸Šé˜»å¡äº†å¾ˆä¹…ï¼Œé”çš„æœ‰æ•ˆæ—¶é—´è¶…è¿‡äº†ï¼Œè‡ªåŠ¨é‡Šæ”¾é” å®¢æˆ·ç«¯BæˆåŠŸè·å–é”ï¼Œæ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ å®¢æˆ·ç«¯Aä»é˜»å¡ä¸­æ¢å¤ï¼Œç„¶åé‡Šæ”¾äº†å®¢æˆ·ç«¯Bçš„é” é‡Šæ”¾é”è¦ä¿è¯åŸå­æ€§ å¯¹äºé‡Šæ”¾é”æ¥è¯´ï¼Œå…±æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼šæŸ¥è¯¢ã€åˆ¤æ–­ã€åˆ é™¤ï¼Œå’Œè·å–é”åŒç†ï¼Œä¹Ÿè¦ä¿è¯åŸå­æ€§ã€‚ä¸ºäº†å®ç°åŸå­æ€§æ“ä½œï¼Œå¯ä»¥é€šè¿‡LUAè„šæœ¬æ¥åš if redis.call(\"get\", KEY[1]) == ARGV[1] then return redis.call(\"del\", KEY[1]) else return 0; end å¦‚æœæ— æ³•ä¿è¯åŸå­æ€§çš„è¯ï¼Œä¼šå‡ºç°å¦‚ä¸‹çš„æƒ…å†µ å®¢æˆ·ç«¯AæˆåŠŸè·å–åˆ°äº†é” å®¢æˆ·ç«¯Aå¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œ å®¢æˆ·ç«¯Aæ‰§è¡Œç»“æŸï¼Œå¼€å§‹é‡Šæ”¾é”ï¼Œå…ˆæ‰§è¡ŒGETæ“ä½œè·å–é”ï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒå®¢æˆ·ç«¯è‡ªèº«çš„éšæœºå€¼æ¯”è¾ƒï¼Œç¬¦åˆé¢„æœŸ å®¢æˆ·ç«¯Aå› ä¸ºæŸäº›åŸå› ï¼Œå‘ç”Ÿäº†é˜»å¡ è¶…è¿‡äº†é”çš„ä½¿ç”¨æ—¶é—´ï¼Œå®¢æˆ·ç«¯Båœ¨é”è¢«è¶…æ—¶é‡Šæ”¾åï¼ŒæˆåŠŸè·å–é” å®¢æˆ·ç«¯Aä»é˜»å¡ä¸­æ¢å¤è¿‡æ¥ï¼Œæ‰§è¡Œæœ€åä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯DELæ“ä½œï¼Œç»“æœé”™è¯¯é‡Šæ”¾äº†å®¢æˆ·ç«¯Bè·å–çš„é”ã€‚ åˆ†å¸ƒå¼é”RedLockä»¥ä¸Šé—®é¢˜ï¼Œåœ¨å®ç°åˆ†å¸ƒå¼é”æ—¶ï¼Œç¨åŠ æ³¨æ„å°±èƒ½å¤Ÿå¾ˆå¥½çš„çš„è§£å†³ï¼Œä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µå¾ˆéš¾è§£å†³ï¼Œå…¶æ˜¯ç”±failoveré—®é¢˜å¯¼è‡´çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š failoverå¼•èµ·çš„é—®é¢˜ å®¢æˆ·ç«¯1ä»Masterä¸­è·å–é” Masterå®•æœºäº†ï¼Œå¹¶ä¸”Masterçš„æ•°æ®è¿˜åŒæ­¥åˆ°Slaveä¸Š Slaveå‡çº§ä¸ºMaster å®¢æˆ·ç«¯2ä»æ–°çš„Masterä¸­è·å–åˆ°äº†å¯¹åº”åŒä¸€ä¸ªèµ„æºçš„é” è¿™æ ·å°±å¯¼è‡´äº†å®¢æˆ·ç«¯Aå’Œå®¢æˆ·ç«¯BåŒæ—¶è·å–äº†åŒä¸€ä¸ªèµ„æºçš„é”ï¼Œè¿™æ ·å°±è¿èƒŒäº†åˆ†å¸ƒå¼é”çš„è¯­ä¹‰äº†ï¼Œé”çš„å®‰å…¨æ€§è¢«æ‰“ç ´äº†ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œantirezè®¾è®¡äº†Redlockç®—æ³•ã€‚ è·å–é”æ­¥éª¤ï¼š è·å–ç³»ç»Ÿå½“å‰çš„æ—¶é—´ï¼ˆæ¯«ç§’çº§åˆ«ï¼‰ æŒ‰ç…§é¡ºåºä¾æ¬¡å‘Nä¸ªRediså®ä¾‹æ‰§è¡Œè·å–é”æ“ä½œ æ•´ä½“æµç¨‹å’ŒåŸºäºå•ä¸ªRediså®ä¾‹è·å–é”ç›¸åŒï¼ŒåŒ…å«æœ‰random_valueå’Œè¿‡æœŸæ—¶é—´ï¼ˆPX 3000 ä¹Ÿç§°ä¸ºæœ‰æ•ˆæ—¶é—´ï¼‰ åŒæ—¶ä¸ºäº†ä¿è¯æŸä¸ªRediså®ä¾‹å®•æœºæ—¶ï¼ŒRedLockèƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œå¯¹äºæ¯æ¬¡è·å–é”æ“ä½œï¼Œè¿˜è¦æœ‰ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”è¦è¿œå°äºæ•´ä¸ªé”çš„æœ‰æ•ˆæ—¶é—´ã€‚å®¢æˆ·ç«¯åœ¨å½“å‰Rediså®ä¾‹è·å–é”å¤±è´¥ï¼ˆå¯èƒ½æ˜¯å®•æœºã€å¯èƒ½æ—¶ç½‘ç»œè¶…æ—¶ï¼‰çš„è¯ï¼Œéœ€è¦ç«‹å³å°è¯•åœ¨åç»­çš„Redisçš„å®ä¾‹ä¸Šè·å–é”ã€‚ è®¡ç®—å®¢æˆ·ç«¯è·å–é”çš„è¿‡ç¨‹ä¸­ï¼Œå…±æ¶ˆè€—äº†å¤šå°‘æ—¶é—´ã€‚è®¡ç®—æ–¹å¼ä¸ºï¼šè®¿é—®Nä¸ªRediså®ä¾‹ä¹‹åçš„æ—¶é—´ - ç¬¬ä¸€æ­¥å¼€å§‹æ—¶çš„æ—¶é—´ã€‚åŒæ—¶ä¿è¯ æˆåŠŸè·å–äº† $N/2 + 1$ä¸ªRediså®ä¾‹ä¸Šè·å–åˆ°äº†é”ã€‚é‚£ä¹ˆè®¤ä¸ºè·å–é”æˆåŠŸï¼Œ å¦åˆ™è§†ä¸ºå¤±è´¥ã€‚ è·å–é”æˆåŠŸï¼Œå¯¹åº”çš„é”çš„æœ‰æ•ˆæ—¶é—´è¦é‡æ–°è®¡ç®—ã€‚å®ƒç­‰äºæœ€å¼€å§‹è®¾ç½®çš„æœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ¶ˆè€—çš„æ—¶é—´ã€‚ è·å–é”å¤±è´¥ï¼Œè¦æ±‚å®¢æˆ·ç«¯è¦å¯¹æ‰€æœ‰çš„Rediså®ä¾‹è¿›è¡Œé‡Šæ”¾é”æ“ä½œï¼ˆLuaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰ã€‚ é‡Šæ”¾é”çš„æ­¥éª¤ å®¢æˆ·ç«¯è¦å¯¹æ‰€æœ‰çš„Rediså®ä¾‹è¿›è¡Œé‡Šæ”¾é”æ“ä½œï¼ˆLuaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰ï¼Œä¸ç®¡è¿™äº›èŠ‚ç‚¹å½“æ—¶åœ¨è·å–é”çš„æ—¶å€™æˆåŠŸä¸å¦ã€‚ ZooKeeperå®ç°åˆ†å¸ƒå¼é” å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªznodeèŠ‚ç‚¹ï¼Œæ¯”å¦‚/lockï¼Œé‚£ä¹ˆå°±æ„å‘³ç€å®¢æˆ·ç«¯è·å–é”æˆåŠŸäº†ã€‚å…¶ä»–å®¢æˆ·ç«¯è·å–é”å¤±è´¥ï¼ˆznodeå·²ç»å­˜åœ¨ï¼‰ æŒæœ‰é”çš„å®¢æˆ·ç«¯ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šåˆ é™¤znodeï¼Œè¿™æ ·å…¶ä»–çš„å®¢æˆ·ç«¯å°±æ¥ä¸‹æ¥å°±èƒ½è·å–é”äº† znodeåº”è¯¥è¢«åˆ›å»ºæˆephemeralï¼ˆä¸´æ—¶çš„ï¼‰çš„ã€‚è¿™æ˜¯znodeçš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒä¿è¯å¦‚æœåˆ›å»ºznodeçš„é‚£ä¸ªå®¢æˆ·ç«¯å´©æºƒäº†ï¼Œé‚£ä¹ˆç›¸åº”çš„znodeä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚è¿™ä¿è¯äº†é”ä¸€å®šä¼šè¢«é‡Šæ”¾ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒZooKeeperæ˜¯å¦‚ä½•æ£€æµ‹åˆ°å®¢æˆ·ç«¯æ˜¯å¦å´©æºƒå‘¢ï¼Ÿå®é™…ä¸Šæ¯ä¸ªå®¢æˆ·ç«¯å’ŒZooKeeperçš„æŸä¸ªæœåŠ¡å™¨éƒ½ç»´æŠ¤ä¸€ä¸ª Sessionï¼Œè¿™ä¸ªSessioné€šè¿‡å¿ƒè·³æ£€æµ‹æ¥ç»´æŒï¼Œå¦‚æœZooKeeperé•¿æ—¶é—´è·å–ä¸åˆ°å®¢æˆ·ç«¯çš„å¿ƒè·³ï¼ˆSessionçš„è¿‡æœŸæ—¶é—´ï¼‰ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºSessionè¿‡æœŸäº†ï¼ŒåŒæ—¶ä¼šè¯¥Sessionå¯¹åº”çš„ephemeralçš„znodeéƒ½ä¼šè‡ªåŠ¨åˆ é™¤ã€‚ è®¾æƒ³å¦‚ä¸‹çš„æ‰§è¡Œåºåˆ—ï¼š å®¢æˆ·ç«¯1åˆ›å»ºäº†znodeèŠ‚ç‚¹/lockï¼Œè·å¾—äº†é”ã€‚ å®¢æˆ·ç«¯1è¿›å…¥äº†é•¿æ—¶é—´çš„GC pauseã€‚ å®¢æˆ·ç«¯1è¿æ¥åˆ°ZooKeeperçš„Sessionè¿‡æœŸäº†ã€‚znodeèŠ‚ç‚¹/lockè¢«è‡ªåŠ¨åˆ é™¤ã€‚ å®¢æˆ·ç«¯2åˆ›å»ºäº†znodeèŠ‚ç‚¹/lockï¼Œä»è€Œè·å¾—äº†é”ã€‚ å®¢æˆ·ç«¯1ä»GC pauseä¸­æ¢å¤è¿‡æ¥ï¼Œå®ƒä»ç„¶è®¤ä¸ºè‡ªå·±æŒæœ‰é”ã€‚ æœ€åï¼Œå®¢æˆ·ç«¯1å’Œå®¢æˆ·ç«¯2éƒ½è®¤ä¸ºè‡ªå·±æŒæœ‰äº†é”ï¼Œå†²çªäº†ã€‚è¿™ä¸Martinåœ¨æ–‡ç« ä¸­æè¿°çš„ç”±äºGC pauseå¯¼è‡´çš„åˆ†å¸ƒå¼é”å¤±æ•ˆçš„æƒ…å†µç±»ä¼¼ã€‚ çœ‹èµ·æ¥ï¼Œç”¨ZooKeeperå®ç°çš„åˆ†å¸ƒå¼é”ä¹Ÿä¸ä¸€å®šå°±æ˜¯å®‰å…¨çš„ï¼Œè¯¥æœ‰çš„é—®é¢˜å®ƒè¿˜æ˜¯æœ‰ã€‚ä½†æ˜¯ï¼ŒZooKeeperä½œä¸ºä¸€ä¸ªä¸“é—¨ä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›æ–¹æ¡ˆçš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€äº›éå¸¸å¥½çš„ç‰¹æ€§ï¼Œæ˜¯Redisä¹‹ç±»çš„æ–¹æ¡ˆæ‰€æ²¡æœ‰çš„ã€‚åƒå‰é¢æåˆ°çš„ephemeralç±»å‹çš„znodeè‡ªåŠ¨åˆ é™¤çš„åŠŸèƒ½å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ è¿˜æœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ç‰¹æ€§æ˜¯ZooKeeperçš„watchæœºåˆ¶ã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚å½“å®¢æˆ·ç«¯è¯•å›¾åˆ›å»º/lockçš„æ—¶å€™ï¼Œå‘ç°å®ƒå·²ç»å­˜åœ¨äº†ï¼Œè¿™æ—¶å€™åˆ›å»ºå¤±è´¥ï¼Œä½†å®¢æˆ·ç«¯ä¸ä¸€å®šå°±æ­¤å¯¹å¤–å®£å‘Šè·å–é”å¤±è´¥ã€‚å®¢æˆ·ç«¯å¯ä»¥è¿›å…¥ä¸€ç§ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å½“/lockèŠ‚ç‚¹è¢«åˆ é™¤çš„æ—¶å€™ï¼ŒZooKeeperé€šè¿‡watchæœºåˆ¶é€šçŸ¥å®ƒï¼Œè¿™æ ·å®ƒå°±å¯ä»¥ç»§ç»­å®Œæˆåˆ›å»ºæ“ä½œï¼ˆè·å–é”ï¼‰ã€‚è¿™å¯ä»¥è®©åˆ†å¸ƒå¼é”åœ¨å®¢æˆ·ç«¯ç”¨èµ·æ¥å°±åƒä¸€ä¸ªæœ¬åœ°çš„é”ä¸€æ ·ï¼šåŠ é”å¤±è´¥å°±é˜»å¡ä½ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ã€‚è¿™æ ·çš„ç‰¹æ€§Redlockå°±æ— æ³•å®ç°ã€‚ åŸºäºZooKeeperçš„é”å’ŒåŸºäºRedisçš„é”ç›¸æ¯”åœ¨å®ç°ç‰¹æ€§ä¸Šæœ‰ä¸¤ä¸ªä¸åŒï¼š åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒæœ‰é”ä»»æ„é•¿çš„æ—¶é—´ï¼Œè¿™å¯ä»¥ç¡®ä¿å®ƒåšå®Œæ‰€æœ‰éœ€è¦çš„èµ„æºè®¿é—®æ“ä½œä¹‹åå†é‡Šæ”¾é”ã€‚è¿™é¿å…äº†åŸºäºRedisçš„é”å¯¹äºæœ‰æ•ˆæ—¶é—´(lock validity time)åˆ°åº•è®¾ç½®å¤šé•¿çš„ä¸¤éš¾é—®é¢˜ã€‚å®é™…ä¸Šï¼ŒåŸºäºZooKeeperçš„é”æ˜¯ä¾é Sessionï¼ˆå¿ƒè·³ï¼‰æ¥ç»´æŒé”çš„æŒæœ‰çŠ¶æ€çš„ï¼Œè€ŒRedisä¸æ”¯æŒSesionã€‚ åŸºäºZooKeeperçš„é”æ”¯æŒåœ¨è·å–é”å¤±è´¥ä¹‹åç­‰å¾…é”é‡æ–°é‡Šæ”¾çš„äº‹ä»¶ã€‚è¿™è®©å®¢æˆ·ç«¯å¯¹é”çš„ä½¿ç”¨æ›´åŠ çµæ´»ã€‚ æ€»ç»“æ‘˜è‡ªå¼ é“è•¾çš„åšå®¢ æŒ‰ç…§é”çš„ä¸¤ç§ç”¨é€”ï¼Œå¦‚æœä»…æ˜¯ä¸ºäº†æ•ˆç‡(efficiency)ï¼Œé‚£ä¹ˆä½ å¯ä»¥è‡ªå·±é€‰æ‹©ä½ å–œæ¬¢çš„ä¸€ç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚å½“ç„¶ï¼Œä½ éœ€è¦æ¸…æ¥šåœ°çŸ¥é“å®ƒåœ¨å®‰å…¨æ€§ä¸Šæœ‰å“ªäº›ä¸è¶³ï¼Œä»¥åŠå®ƒä¼šå¸¦æ¥ä»€ä¹ˆåæœã€‚è€Œå¦‚æœä½ æ˜¯ä¸ºäº†æ­£ç¡®æ€§(correctness)ï¼Œé‚£ä¹ˆè¯·æ…ä¹‹åˆæ…ã€‚æˆ‘ä»¬åœ¨åˆ†å¸ƒå¼é”çš„æ­£ç¡®æ€§ä¸Šèµ°å¾—æœ€è¿œçš„åœ°æ–¹ï¼Œè¦æ•°å¯¹äºZooKeeperåˆ†å¸ƒå¼é”ã€å•è°ƒé€’å¢çš„epoch numberä»¥åŠå¯¹åˆ†å¸ƒå¼èµ„æºè¿›è¡Œæ ‡è®°çš„åˆ†æäº†ã€‚è¯·ä»”ç»†å®¡æŸ¥ç›¸å…³çš„è®ºè¯ã€‚ References åŸºäºæ•°æ®åº“å®ç°çš„åˆ†å¸ƒå¼é” åŸºäºRedisçš„åˆ†å¸ƒå¼é”åˆ°åº•å®‰å…¨å— åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¦‚ä½•å›ç­”é”çš„å®ç°åŸç†","categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://winniekun.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"}],"tags":[{"name":"é”","slug":"é”","permalink":"https://winniekun.github.io/tags/%E9%94%81/"}]},{"title":"é›¶æ‹·è´æŠ€æœ¯çš„ç†è§£","slug":"æ“ä½œç³»ç»Ÿ/zero-copy","date":"2021-09-14T07:41:13.000Z","updated":"2021-09-14T11:32:28.465Z","comments":true,"path":"zero-copy/","link":"","permalink":"https://winniekun.github.io/zero-copy/","excerpt":"","text":"é›¶æ‹·è´çš„å¥½å¤„ å‡å°‘æˆ–é¿å…ä¸å¿…è¦çš„CPUæ•°æ®æ‹·è´ï¼Œä»è€Œé‡Šæ”¾CPUå»æ‰§è¡Œå…¶ä»–ä»»åŠ¡ é›¶æ‹·è´æœºåˆ¶èƒ½å‡å°‘ç”¨æˆ·ç©ºé—´å’Œæ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ å‡å°‘å†…å­˜çš„å ç”¨ DMAæŠ€æœ¯ DMA åœ¨æ²¡æœ‰DMAæŠ€æœ¯ä¹‹å‰ï¼ŒI/Oçš„è¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š CPU å‘å‡ºå¯¹åº”çš„æŒ‡ä»¤ç»™ç£ç›˜æ§åˆ¶å™¨ï¼Œç„¶åè¿”å›ï¼› ç£ç›˜æ§åˆ¶å™¨æ”¶åˆ°æŒ‡ä»¤åï¼Œäºæ˜¯å°±å¼€å§‹å‡†å¤‡æ•°æ®ï¼Œä¼šæŠŠæ•°æ®æ”¾å…¥åˆ°ç£ç›˜æ§åˆ¶å™¨çš„å†…éƒ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åäº§ç”Ÿä¸€ä¸ªä¸­æ–­ï¼› CPU æ”¶åˆ°ä¸­æ–­ä¿¡å·åï¼Œåœä¸‹æ‰‹å¤´çš„å·¥ä½œï¼Œæ¥ç€æŠŠç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºçš„æ•°æ®ä¸€æ¬¡ä¸€ä¸ªå­—èŠ‚åœ°è¯»è¿›è‡ªå·±çš„å¯„å­˜å™¨ï¼Œç„¶åå†æŠŠå¯„å­˜å™¨é‡Œçš„æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œè€Œåœ¨æ•°æ®ä¼ è¾“çš„æœŸé—´ CPU æ˜¯æ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡çš„ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªæ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ï¼Œéƒ½è¦éœ€è¦ CPU äº²è‡ªå‚ä¸æ¬è¿æ•°æ®çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ï¼ŒCPU æ˜¯ä¸èƒ½åšå…¶ä»–äº‹æƒ…çš„ã€‚ ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œä¸­é—´å±‚çš„æ€è·¯å°±åˆå‡ºæ¥äº†ã€‚åæœŸå¼•å…¥DMAæŠ€æœ¯ï¼Œåœ¨è¿›è¡ŒI/Oå¤„ç†çš„æ—¶å€™ï¼ˆè®¾å¤‡å’Œå†…å­˜è¿›è¡Œæ•°æ®ä¼ è¾“çš„æ—¶å€™ï¼‰ï¼Œæ•°æ®æ¬è¿çš„å·¥ä½œå…¨éƒ¨äº¤ç»™ DMA æ§åˆ¶å™¨ï¼Œè€Œ CPU ä¸å†å‚ä¸ä»»ä½•ä¸æ•°æ®æ¬è¿ç›¸å…³çš„äº‹æƒ…ï¼Œè¿™æ · CPU å°±å¯ä»¥å»å¤„ç†åˆ«çš„äº‹åŠ¡ã€‚ DMA å…·ä½“è¿‡ç¨‹ï¼š ç”¨æˆ·è¿›ç¨‹è°ƒç”¨ read æ–¹æ³•ï¼Œå‘æ“ä½œç³»ç»Ÿå‘å‡º I/O è¯·æ±‚ï¼Œè¯·æ±‚è¯»å–æ•°æ®åˆ°è‡ªå·±çš„å†…å­˜ç¼“å†²åŒºä¸­ï¼Œè¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼› æ“ä½œç³»ç»Ÿæ”¶åˆ°è¯·æ±‚åï¼Œè¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ DMAï¼Œç„¶åè®© CPU æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼› DMA è¿›ä¸€æ­¥å°† I/O è¯·æ±‚å‘é€ç»™ç£ç›˜ï¼› ç£ç›˜æ”¶åˆ° DMA çš„ I/O è¯·æ±‚ï¼ŒæŠŠæ•°æ®ä»ç£ç›˜è¯»å–åˆ°ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºä¸­ï¼Œå½“ç£ç›˜æ§åˆ¶å™¨çš„ç¼“å†²åŒºè¢«è¯»æ»¡åï¼Œå‘ DMA å‘èµ·ä¸­æ–­ä¿¡å·ï¼Œå‘ŠçŸ¥è‡ªå·±ç¼“å†²åŒºå·²æ»¡ï¼› DMA æ”¶åˆ°ç£ç›˜çš„ä¿¡å·ï¼Œå°†ç£ç›˜æ§åˆ¶å™¨ç¼“å†²åŒºä¸­çš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ä¸å ç”¨ CPUï¼ŒCPU å¯ä»¥æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼› å½“ DMA è¯»å–äº†è¶³å¤Ÿå¤šçš„æ•°æ®ï¼Œå°±ä¼šå‘é€ä¸­æ–­ä¿¡å·ç»™ CPUï¼› CPU æ”¶åˆ° DMA çš„ä¿¡å·ï¼ŒçŸ¥é“æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œäºæ˜¯å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›ï¼› ä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“ æ–‡ä»¶ä¼ è¾“ é¦–å…ˆï¼ŒæœŸé—´å…±å‘ç”Ÿäº† 4 æ¬¡ç”¨æˆ·æ€ä¸å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºå‘ç”Ÿäº†ä¸¤æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œä¸€æ¬¡æ˜¯ read() ï¼Œä¸€æ¬¡æ˜¯ write()ï¼Œæ¯æ¬¡ç³»ç»Ÿè°ƒç”¨éƒ½å¾—å…ˆä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç­‰å†…æ ¸å®Œæˆä»»åŠ¡åï¼Œå†ä»å†…æ ¸æ€åˆ‡æ¢å›ç”¨æˆ·æ€ã€‚ ä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°æˆæœ¬å¹¶ä¸å°ï¼Œä¸€æ¬¡åˆ‡æ¢éœ€è¦è€—æ—¶å‡ åçº³ç§’åˆ°å‡ å¾®ç§’ï¼Œè™½ç„¶æ—¶é—´çœ‹ä¸Šå»å¾ˆçŸ­ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¿™ç±»æ—¶é—´å®¹æ˜“è¢«ç´¯ç§¯å’Œæ”¾å¤§ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½ã€‚ å…¶æ¬¡ï¼Œè¿˜å‘ç”Ÿäº† 4 æ¬¡æ•°æ®æ‹·è´ï¼Œå…¶ä¸­ä¸¤æ¬¡æ˜¯ DMA çš„æ‹·è´ï¼Œå¦å¤–ä¸¤æ¬¡åˆ™æ˜¯é€šè¿‡ CPU æ‹·è´çš„ï¼Œä¸‹é¢è¯´ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š ç¬¬ä¸€æ¬¡æ‹·è´ï¼ŒæŠŠç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªæ‹·è´çš„è¿‡ç¨‹æ˜¯é€šè¿‡ DMA æ¬è¿çš„ã€‚ ç¬¬äºŒæ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œäºæ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºå°±å¯ä»¥ä½¿ç”¨è¿™éƒ¨åˆ†æ•°æ®äº†ï¼Œè¿™ä¸ªæ‹·è´åˆ°è¿‡ç¨‹æ˜¯ç”± CPU å®Œæˆçš„ã€‚ ç¬¬ä¸‰æ¬¡æ‹·è´ï¼ŒæŠŠåˆšæ‰æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œå†æ‹·è´åˆ°å†…æ ¸çš„ socket çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¾ç„¶è¿˜æ˜¯ç”± CPU æ¬è¿çš„ã€‚ ç¬¬å››æ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸çš„ socket ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œæ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆæ˜¯ç”± DMA æ¬è¿çš„ã€‚ ä¼˜åŒ–æ€è·¯å‡å°‘ä¸Šä¸‹æ–‡çš„åˆ‡æ¢é¦–å…ˆï¼Œ å¯¹äºI/Oçš„å¤„ç†ï¼Œç”¨æˆ·æ€æ˜¯æ— æƒé™çš„ï¼Œåªèƒ½åˆ‡æ¢åˆ°å†…æ ¸æ€è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥å‡å°‘ä¸Šä¸‹æ–‡çš„åˆ‡æ¢çš„ä¸€ä¸ªæ€è·¯å°±æ˜¯ï¼šå‡å°‘ç³»ç»Ÿè°ƒç”¨ å‡å°‘æ‹·è´çš„æ¬¡æ•°é€šè¿‡å¯¹ä¸Šè¿°çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ä¼ ç»Ÿçš„æ–‡ä»¶ä¼ è¾“ï¼Œæ¶‰åŠåˆ°äº†å››æ¬¡çš„copyè¿‡ç¨‹ã€‚åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“å…¶å®æ•°æ®æ˜¯å®Œå…¨ä¸å¿…copyåˆ°ç”¨æˆ·ç©ºé—´çš„ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä¸€èˆ¬ä¸ä¼šå¯¹æ•°æ®è¿›è¡ŒåŠ å·¥ã€‚ é›¶æ‹·è´mmap + writeåœ¨å‰é¢æˆ‘ä»¬çŸ¥é“ï¼Œread() ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œäºæ˜¯ä¸ºäº†å‡å°‘è¿™ä¸€æ­¥å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ mmap() æ›¿æ¢ read() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ mmap + write ç¤ºæ„å›¾ æµç¨‹ï¼š åº”ç”¨è¿›ç¨‹é€šè¿‡mmapåï¼ŒDMAå°†ç£ç›˜æ–‡ä»¶æ”¾å…¥å†…æ ¸ç¼“å†²åŒºï¼Œç„¶åç”¨æˆ·ç¨‹åºå’Œå†…æ ¸å…±äº«è¯¥ç¼“å†²åŒº ç„¶åç”¨æˆ·ç¨‹åºè°ƒç”¨writeï¼Œå°†æ•°æ®å†™å…¥socketç¼“å†²åŒºï¼Œï¼ˆå†…éƒ¨è€Œè¨€ï¼Œæ˜¯cpuå†…æ ¸ç¼“å†²åŒºçš„å†…å®¹copyåˆ°socketç¼“å†²åŒºï¼‰ ç„¶åDMAå°†socketç¼“å†²åŒºæ”¾å…¥åˆ°ç½‘å¡ç¼“å†²åŒºä¸­ æ‹·è´æ¬¡æ•° ä» 4 -&gt; 3 ä¸Šä¸‹æ–‡åˆ‡æ¢è¿˜æ˜¯å‘ç”Ÿäº†4æ¬¡ sendfile é€šè¿‡å‡å°‘ç³»ç»Ÿè°ƒç”¨ï¼Œå®ç°é›¶copyæŠ€æœ¯ sendfile sendfileå¯ä»¥æ›¿ä»£readå’Œwriteä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œé¿å…ä¸¤æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å…¶æ¬¡ï¼Œè¯¥ç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥ç›´æ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºé‡Œï¼Œä¸å†æ‹·è´åˆ°ç”¨æˆ·æ€ï¼Œè¿™æ ·å°±åªæœ‰ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå’Œ 3 æ¬¡æ•°æ®æ‹·è´ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ ä½†æ˜¯è¿™è¿˜ä¸æ˜¯çœŸæ­£çš„é›¶æ‹·è´æŠ€æœ¯ï¼Œå¦‚æœç½‘å¡æ”¯æŒ SG-DMAï¼ˆThe Scatter-Gather Direct Memory Accessï¼‰æŠ€æœ¯ï¼ˆå’Œæ™®é€šçš„ DMA æœ‰æ‰€ä¸åŒï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å‡å°‘é€šè¿‡ CPU æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ‹·è´åˆ° socket ç¼“å†²åŒºçš„è¿‡ç¨‹ï¼ˆåªè¿›è¡Œäº† 2 æ¬¡æ•°æ®æ‹·è´ï¼‰ã€‚ ç½‘å¡DMA ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡ DMA å°†ç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºé‡Œï¼› ç¬¬äºŒæ­¥ï¼Œç¼“å†²åŒºæè¿°ç¬¦å’Œæ•°æ®é•¿åº¦ä¼ åˆ° socket ç¼“å†²åŒºï¼Œè¿™æ ·ç½‘å¡çš„ SG-DMA æ§åˆ¶å™¨å°±å¯ä»¥ç›´æ¥å°†å†…æ ¸ç¼“å­˜ä¸­çš„æ•°æ®æ‹·è´åˆ°ç½‘å¡çš„ç¼“å†²åŒºé‡Œï¼Œæ­¤è¿‡ç¨‹ä¸éœ€è¦å°†æ•°æ®ä»æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ° socket ç¼“å†²åŒºä¸­ï¼Œè¿™æ ·å°±å‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼› è¿™å°±æ˜¯æ‰€è°“çš„é›¶æ‹·è´ï¼ˆ*Zero-copy*ï¼‰æŠ€æœ¯ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰åœ¨å†…å­˜å±‚é¢å»æ‹·è´æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å…¨ç¨‹æ²¡æœ‰é€šè¿‡ CPU æ¥æ¬è¿æ•°æ®ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é€šè¿‡ DMA æ¥è¿›è¡Œä¼ è¾“çš„ é›¶æ‹·è´æŠ€æœ¯çš„æ–‡ä»¶ä¼ è¾“æ–¹å¼ç›¸æ¯”ä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“çš„æ–¹å¼ï¼Œå‡å°‘äº† 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œåªéœ€è¦ 2 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ•°æ®æ‹·è´æ¬¡æ•°ï¼Œå°±å¯ä»¥å®Œæˆæ–‡ä»¶çš„ä¼ è¾“ï¼Œè€Œä¸” 2 æ¬¡çš„æ•°æ®æ‹·è´è¿‡ç¨‹ï¼Œéƒ½ä¸éœ€è¦é€šè¿‡ CPUï¼Œ2 æ¬¡éƒ½æ˜¯ç”± DMA æ¥æ¬è¿ã€‚ æ‰€ä»¥ï¼Œæ€»ä½“æ¥çœ‹ï¼Œé›¶æ‹·è´æŠ€æœ¯å¯ä»¥æŠŠæ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½æé«˜è‡³å°‘ä¸€å€ä»¥ä¸Šã€‚ æ€»ç»“ ä½¿ç”¨mmap + write ï¼ˆ4æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸Šæ¬¡æ–‡ä»¶æ‹·è´ï¼‰ å‡å°‘ä¸€æ¬¡æ–‡ä»¶copy ä½¿ç”¨sendfileï¼ˆ2åƒä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¸‰æ¬¡æ–‡ä»¶æ‹·è´ï¼‰ å‡å°‘äº†2æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ å‡å°‘ä¸€æ¬¡æ–‡ä»¶copy ç½‘å¡æ”¯æŒSG-DMAï¼ˆ2æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ ä¸¤æ¬¡æ–‡ä»¶æ‹·è´ï¼ˆä¸éœ€è¦CPUè¿›è¡Œæ“ä½œï¼‰ï¼‰ å‡å°‘äº†2æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ å‡å°‘äº†2æ¬¡æ–‡ä»¶æ‹·è´ ä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯çš„é¡¹ç›®kafkaä½¿ç”¨é›¶æ‹·è´æŠ€æœ¯ï¼Œæ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ä»Kafkaæ¶ˆè´¹æ•°æ®ï¼ŒKafkaä»ç£ç›˜è¯»æ•°æ®ç„¶åå‘é€åˆ°ç½‘ç»œä¸Šå»ï¼Œæ•°æ®ä¸€å…±å‘ç”Ÿäº†å››æ¬¡ä¼ è¾“çš„è¿‡ç¨‹ã€‚å…¶ä¸­ä¸¤æ¬¡æ˜¯ DMA çš„ä¼ è¾“ï¼Œå¦å¤–ä¸¤æ¬¡ï¼Œåˆ™æ˜¯é€šè¿‡ CPU æ§åˆ¶çš„ä¼ è¾“ã€‚é€šè¿‡é›¶æ‹·è´æŠ€æœ¯ï¼Œé¿å…äº†æ–‡ä»¶çš„å¤šä½™çš„copyæ¬¡æ•°ï¼Œä»¥åŠCPUçš„å‚ä¸ï¼Œè¿›è€Œèƒ½å¤Ÿæ›´å¥½çš„æå‡æ•´ä½“çš„æ€§èƒ½ï¼Œä¼˜åŒ–CPUçš„ä½¿ç”¨ã€‚ Java transferTopublic static void copyFileByChannel(File source, File dest) throws IOException { try (FileChannel sourceChannel = new FileInputStream(source) .getChannel(); FileChannel targetChannel = new FileOutputStream(dest).getChannel()) { for (long count = sourceChannel.size(); count &gt; 0; ) { long transferred = sourceChannel.transferTo( sourceChannel.position(), count, targetChannel); sourceChannel.position(sourceChannel.position() + transferred); count -= transferred; } } } references åŸæ¥ 8 å¼ å›¾ï¼Œå°±å¯ä»¥ææ‡‚ã€Œé›¶æ‹·è´ã€äº†","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://winniekun.github.io/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"tags":[{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"https://winniekun.github.io/tags/%E5%9F%BA%E7%A1%80/"}]},{"title":"Dubboå’ŒSpringã€SpringBootçš„ç»“åˆç®€å•Demo","slug":"rpc/dubbo-demo","date":"2021-09-05T11:45:28.000Z","updated":"2021-09-07T16:50:20.349Z","comments":true,"path":"dubbo-demo/","link":"","permalink":"https://winniekun.github.io/dubbo-demo/","excerpt":"","text":"åºdubboå’ŒSpringã€SpringBootçš„é›†åˆ ç¯å¢ƒ Spring ï¼ˆè¯´ç™½äº†å°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹çš„é€šä¿¡ï¼Œç„¶åå°†dubboäº¤ç”±springæ¥ç®¡ç†ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è¿›è¡Œé…ç½®ï¼Œç„¶åæŒ‰ç…§æ–‡æ¡£ç¡¬ç¼–ç ï¼‰ &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring.version&gt;5.3.4&lt;/spring.version&gt; &lt;dubbo.version&gt;2.7.8&lt;/dubbo.version&gt; &lt;curator.version&gt;4.2.0&lt;/curator.version&gt; &lt;zk.version&gt;3.5.8&lt;/zk.version&gt; &lt;/properties&gt; SpringBoot &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wkk.dubbo&lt;/groupId&gt; &lt;artifactId&gt;provider&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;provider&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.7.13&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.wkk.dubbo&lt;/groupId&gt; &lt;artifactId&gt;api&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; å’ŒSpringçš„ç»“åˆ(æœªé…ç½®ZK) dubboå’Œspringçš„ç»“åˆ pom.xml: &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;com.wkk&lt;/groupId&gt; &lt;artifactId&gt;spring-dubbo-demo&lt;/artifactId&gt; &lt;packaging&gt;pom&lt;/packaging&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;modules&gt; &lt;module&gt;dubbo-provider&lt;/module&gt; &lt;module&gt;dubbo-consumer&lt;/module&gt; &lt;module&gt;dubbo-api&lt;/module&gt; &lt;/modules&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;spring.version&gt;5.3.4&lt;/spring.version&gt; &lt;dubbo.version&gt;2.7.8&lt;/dubbo.version&gt; &lt;curator.version&gt;4.2.0&lt;/curator.version&gt; &lt;zk.version&gt;3.5.8&lt;/zk.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-beans&lt;/artifactId&gt; &lt;version&gt;${spring.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-core&lt;/artifactId&gt; &lt;version&gt;${spring.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-context&lt;/artifactId&gt; &lt;version&gt;${spring.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo&lt;/artifactId&gt; &lt;version&gt;${dubbo.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;${zk.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-framework&lt;/artifactId&gt; &lt;version&gt;${curator.version}&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt; &lt;version&gt;${curator.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; API å…¬å…±æ¥å£ï¼Œç„¶åprovideræä¾›å¯¹è¯¥æ¥å£çš„å®ç°ï¼Œconsumerå¯¹å…¶å‘èµ·è°ƒç”¨ image-20210905233104405 package com.wkk.api; /** * @author weikunkun * @since 2021/9/5 */ public interface HelloApi { String hello(String name); } PROVIDER è´Ÿè´£å¯¹apiçš„å®ç° dubbo-provider é…ç½®&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. --&gt; &lt;beans xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dubbo=\"http://dubbo.apache.org/schema/dubbo\" xmlns=\"http://www.springframework.org/schema/beans\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"&gt; &lt;dubbo:application name=\"demo-provider\"/&gt; &lt;dubbo:protocol name=\"dubbo\" port=\"20880\"/&gt; &lt;!-- å£°æ˜å¯¹å¤–æš´éœ²çš„æ¥å£ --&gt; &lt;dubbo:service registry=\"N/A\" interface=\"com.wkk.api.HelloApi\" ref=\"quickStartServiceApi\"/&gt; &lt;!--é…ç½®beanå®ä¾‹--&gt; &lt;bean id=\"quickStartServiceApi\" class=\"com.wkk.provider.api.HelloApiImpl\"/&gt; &lt;/beans&gt; ä¾èµ–&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;spring-dubbo-demo&lt;/artifactId&gt; &lt;groupId&gt;com.wkk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;dubbo-provider&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.wkk&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; ç›¸å…³å®ç°ï¼šAPIå®ç°ï¼š package com.wkk.provider.api; import com.wkk.api.HelloApi; /** * @author weikunkun * @since 2021/9/5 */ public class HelloApiImpl implements HelloApi { public String hello(String name) { return \"this is dubbot quick starter, name = \" + name; } } å¯åŠ¨ç±»ï¼š package com.wkk.provider; import org.springframework.context.support.ClassPathXmlApplicationContext; import java.io.IOException; /** * @author weikunkun * @since 2021/9/5 */ public class ProviderClient { public static void main(String[] args) throws IOException { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"dubbo-provider.xml\"); context.start(); System.in.read(); } } CONSUMER è´Ÿè´£è°ƒç”¨å¯¹åº”çš„æ¥å£ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå…·ä½“çš„è°ƒç”¨ç›´æ¥åœ¨consumerä¸­çš„å¯åŠ¨ç±»è¿›è¡Œæ“ä½œ dubbo-consumer é…ç½®&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!-- Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. --&gt; &lt;beans xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dubbo=\"http://dubbo.apache.org/schema/dubbo\" xmlns=\"http://www.springframework.org/schema/beans\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"&gt; &lt;!-- æ¶ˆè´¹æ–¹åº”ç”¨åï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³»ï¼Œä¸æ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸è¦ä¸æä¾›æ–¹ä¸€æ · --&gt; &lt;dubbo:application name=\"consumer-of-helloworld-app\" /&gt; &lt;!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œå¯ä»¥å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService --&gt; &lt;dubbo:reference id=\"demoService\" interface=\"com.wkk.api.HelloApi\" url=\"dubbo://xxxx:20880\"/&gt; &lt;/beans&gt; ä¾èµ–&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;parent&gt; &lt;artifactId&gt;spring-dubbo-demo&lt;/artifactId&gt; &lt;groupId&gt;com.wkk&lt;/groupId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/parent&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;artifactId&gt;dubbo-consumer&lt;/artifactId&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.wkk&lt;/groupId&gt; &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/project&gt; ç›¸å…³å®ç°å¯åŠ¨ç±» package com.wkk.consumer; import com.wkk.api.HelloApi; import org.springframework.context.support.ClassPathXmlApplicationContext; import java.util.Scanner; /** * @author weikunkun * @since 2021/9/5 */ public class ConsumerClient { public static void main(String[] args) { ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(\"dubbo-consumer.xml\"); HelloApi demoService = (HelloApi) context.getBean(\"demoService\"); while (true) { Scanner sc = new Scanner(System.in); String str = sc.nextLine(); System.out.println(demoService.hello(str)); } } } æœ€ç»ˆç»“æœ æˆæœå±•ç¤º å’ŒSpringBootçš„ç»“åˆ(æœªé…ç½®ZK) æ•´ä½“å’ŒSpringç»“åˆä¸€è‡´ API å…¬å…±æ¥å£ï¼Œç„¶åprovideræä¾›å¯¹è¯¥æ¥å£çš„å®ç°ï¼Œconsumerå¯¹å…¶å‘èµ·è°ƒç”¨ api æ¥å£çš„è®¾è®¡ package com.wkk.dubbo.api; /** * @author weikunkun * @since 2021/9/6 */ public interface HelloApi { String hello(String name); } PROVIDERé…ç½®dubbo: application: name: demo-provider registry: address: N/A protocol: name: dubbo port: 20880 ä¾èµ–&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wkk.dubbo&lt;/groupId&gt; &lt;artifactId&gt;provider&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;provider&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.7.13&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.wkk.dubbo&lt;/groupId&gt; &lt;artifactId&gt;api&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; ç›¸å…³å®ç°package com.wkk.dubbo.provider.impl; import com.wkk.dubbo.api.HelloApi; import org.apache.dubbo.config.annotation.DubboService; import org.apache.dubbo.rpc.RpcContext; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.stereotype.Component; /** * @author weikunkun * @since 2021/9/6 */ @Component @DubboService(version = \"1.0.0\") public class HelloApiImpl implements HelloApi { private static final Logger logger = LoggerFactory.getLogger(HelloApiImpl.class); @Override public String hello(String name) { try { Thread.sleep(200); // logger.info(\"Hello \" + name + \", request from consumer: \" + RpcContext.getServerContext().getRemoteAddress()); return \"Hello \" + name + \", response from provider: \" + RpcContext.getServerContext().getLocalAddress(); } catch (InterruptedException e) { e.printStackTrace(); } return null; } } CONSUMERé…ç½®spring: application: name: dubbo-consumer ä¾èµ–&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.5.4&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.wkk.consumer&lt;/groupId&gt; &lt;artifactId&gt;consumer&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;consumer&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;11&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt; &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.7.13&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.wkk.dubbo&lt;/groupId&gt; &lt;artifactId&gt;api&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; &lt;/project&gt; ç›¸å…³å®ç°DemoServiceComponentï¼š ç”¨äºè°ƒç”¨providerä¸­å¯¹åº”çš„å®ç°æ–¹æ³• package com.wkk.consumer.consumer.comp; import com.wkk.dubbo.api.HelloApi; import org.apache.dubbo.config.annotation.DubboReference; import org.springframework.stereotype.Component; /** * @author weikunkun * @since 2021/9/7 */ @Component public class DemoServiceComponent implements HelloApi { @DubboReference(version = \"1.0.0\", url = \"dubbo://xxxx:20880\") private HelloApi helloApi; @Override public String hello(String name) { return helloApi.hello(name); } } ConsumerApplicationï¼š å¯åŠ¨ç±»ï¼Œé€šè¿‡Scanneråšäº†äº¤äº’ package com.wkk.consumer.consumer; import com.wkk.dubbo.api.HelloApi; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.context.ConfigurableApplicationContext; import java.util.Scanner; @SpringBootApplication public class ConsumerApplication { public static void main(String[] args) { ConfigurableApplicationContext context = SpringApplication.run(ConsumerApplication.class, args); HelloApi demoService = (HelloApi) context.getBean(\"demoServiceComponent\"); Scanner sc = new Scanner(System.in); while (true) { String s = sc.nextLine(); System.out.println(demoService.hello(s)); } } } æœ€ç»ˆç»“æœ æˆæœå±•ç¤º æºç é“¾æ¥æºç ","categories":[{"name":"dubbo","slug":"dubbo","permalink":"https://winniekun.github.io/categories/dubbo/"}],"tags":[{"name":"rpc","slug":"rpc","permalink":"https://winniekun.github.io/tags/rpc/"}]},{"title":"Kafkaåœ¨Linuxä¸Šçš„é…ç½®","slug":"é…ç½®/kafka-config","date":"2021-08-22T13:24:40.000Z","updated":"2021-08-22T14:35:22.469Z","comments":true,"path":"kafka-config/","link":"","permalink":"https://winniekun.github.io/kafka-config/","excerpt":"","text":"åºKafkaç®€ä»‹Kafkaæ˜¯ç”±Apacheè½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„ä¸€ä¸ªå¼€æºæµå¤„ç†å¹³å°ï¼Œç”±Scalaå’ŒJavaç¼–å†™ã€‚è¯¥é¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸ºå¤„ç†å®æ—¶æ•°æ®æä¾›ä¸€ä¸ªç»Ÿä¸€ã€é«˜ååã€ä½å»¶è¿Ÿçš„å¹³å°ã€‚å…¶æŒä¹…åŒ–å±‚æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œæŒ‰ç…§åˆ†å¸ƒå¼äº‹åŠ¡æ—¥å¿—æ¶æ„çš„å¤§è§„æ¨¡å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—â€ï¼Œ[3]è¿™ä½¿å®ƒä½œä¸ºä¼ä¸šçº§åŸºç¡€è®¾æ–½æ¥å¤„ç†æµå¼æ•°æ®éå¸¸æœ‰ä»·å€¼ã€‚æ­¤å¤–ï¼ŒKafkaå¯ä»¥é€šè¿‡Kafka Connectè¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆç”¨äºæ•°æ®è¾“å…¥/è¾“å‡ºï¼‰ï¼Œå¹¶æä¾›äº†Kafka Streamsâ€”â€”ä¸€ä¸ªJavaæµå¼å¤„ç†åº“)ã€‚ Kafkaæ¶æ„Kafkaå­˜å‚¨çš„æ¶ˆæ¯æ¥è‡ªä»»æ„å¤šè¢«ç§°ä¸ºâ€œç”Ÿäº§è€…â€ï¼ˆProducerï¼‰çš„è¿›ç¨‹ã€‚æ•°æ®ä»è€Œå¯ä»¥è¢«åˆ†é…åˆ°ä¸åŒçš„â€œåˆ†åŒºâ€ï¼ˆPartitionï¼‰ã€ä¸åŒçš„â€œTopicâ€ä¸‹ã€‚åœ¨ä¸€ä¸ªåˆ†åŒºå†…ï¼Œè¿™äº›æ¶ˆæ¯è¢«ç´¢å¼•å¹¶è¿åŒæ—¶é—´æˆ³å­˜å‚¨åœ¨ä¸€èµ·ã€‚å…¶å®ƒè¢«ç§°ä¸ºâ€œæ¶ˆè´¹è€…â€ï¼ˆConsumerï¼‰çš„è¿›ç¨‹å¯ä»¥ä»åˆ†åŒºæŸ¥è¯¢æ¶ˆæ¯ã€‚Kafkaè¿è¡Œåœ¨ä¸€ä¸ªç”±ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ç»„æˆçš„é›†ç¾¤ä¸Šï¼Œå¹¶ä¸”åˆ†åŒºå¯ä»¥è·¨é›†ç¾¤ç»“ç‚¹åˆ†å¸ƒã€‚ Kafkaé«˜æ•ˆåœ°å¤„ç†å®æ—¶æµå¼æ•°æ®ï¼Œå¯ä»¥å®ç°ä¸Stormã€HBaseå’ŒSparkçš„é›†æˆã€‚ä½œä¸ºèšç±»éƒ¨ç½²åˆ°å¤šå°æœåŠ¡å™¨ä¸Šï¼ŒKafkaå¤„ç†å®ƒæ‰€æœ‰çš„å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ç³»ç»Ÿä½¿ç”¨äº†å››ä¸ªAPIï¼Œå³ç”Ÿäº§è€…APIã€æ¶ˆè´¹è€…APIã€Stream APIå’ŒConnector APIã€‚å®ƒèƒ½å¤Ÿä¼ é€’å¤§è§„æ¨¡æµå¼æ¶ˆæ¯ï¼Œè‡ªå¸¦å®¹é”™åŠŸèƒ½ï¼Œå·²ç»å–ä»£äº†ä¸€äº›ä¼ ç»Ÿæ¶ˆæ¯ç³»ç»Ÿï¼Œå¦‚JMSã€AMQPç­‰ã€‚ Kafkaæ¶æ„çš„ä¸»è¦æœ¯è¯­åŒ…æ‹¬Topicã€Recordå’ŒBrokerã€‚Topicç”±Recordç»„æˆï¼ŒRecordæŒæœ‰ä¸åŒçš„ä¿¡æ¯ï¼Œè€ŒBrokeråˆ™è´Ÿè´£å¤åˆ¶æ¶ˆæ¯ã€‚Kafkaæœ‰å››ä¸ªä¸»è¦APIï¼š ç”Ÿäº§è€…APIï¼šæ”¯æŒåº”ç”¨ç¨‹åºå‘å¸ƒRecordæµã€‚ æ¶ˆè´¹è€…APIï¼šæ”¯æŒåº”ç”¨ç¨‹åºè®¢é˜…Topicå’Œå¤„ç†Recordæµã€‚ Stream APIï¼šå°†è¾“å…¥æµè½¬æ¢ä¸ºè¾“å‡ºæµï¼Œå¹¶äº§ç”Ÿç»“æœã€‚ Connector APIï¼šæ‰§è¡Œå¯é‡ç”¨çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…APIï¼Œå¯å°†Topicé“¾æ¥åˆ°ç°æœ‰åº”ç”¨ç¨‹åºã€‚ ç¯å¢ƒä¾èµ– JDK11 kafka_2.13-2.8.0.tgz åŸºç¡€ä½¿ç”¨å‡è®¾Kafkaç¯å¢ƒå’ŒZookeeperç¯å¢ƒéƒ½æ²¡æœ‰ 1. ä¸‹è½½å¹¶è§£å‹&gt; tar -xzf kafka_2.13-2.8.0.tgz &gt; mv kafka_2.13-2.8.0.tgz /usr/local/kafka &gt; cd /usr/local/kafka 2. å¯åŠ¨æœåŠ¡ kafkaçš„å¯åŠ¨ä¾èµ–äºJavaç¯å¢ƒï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨Kakfaä¹‹å‰ï¼Œè®°å¾—é…ç½®Java8+çš„ç¯å¢ƒ &gt; bin/zookeeper-server-start.sh config/zookeeper.properties æ‰“å¼€å¦ä¸€ä¸ªå‘½ä»¤ç»ˆç«¯å¯åŠ¨kafkaæœåŠ¡ï¼š ## ç”¨äºåå°å¯åŠ¨ &gt; bin/kafka-server-start.sh config/server.properties &amp; ä¸€æ—¦æ‰€æœ‰æœåŠ¡æˆåŠŸå¯åŠ¨ï¼Œé‚£Kafkaå·²ç»å¯ä»¥ä½¿ç”¨äº†ã€‚ 3. åˆ›å»ºä¸€ä¸ªä¸»é¢˜åˆ›å»ºä¸€ä¸ªåä¸ºâ€œtestâ€çš„Topicï¼Œåªæœ‰ä¸€ä¸ªåˆ†åŒºå’Œä¸€ä¸ªå¤‡ä»½ï¼š &gt; bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test åˆ›å»ºå¥½ä¹‹åï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å·²åˆ›å»ºçš„topicä¿¡æ¯ï¼š &gt; bin/kafka-topics.sh --describe --topic test --bootstrap-server localhost:9092 Topic:quickstart-events PartitionCount:1 ReplicationFactor:1 Configs: Topic: quickstart-events Partition: 0 Leader: 0 Replicas: 0 Isr: 0 4. å‘é€æ¶ˆæ¯Kafkaæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œçš„å·¥å…·ï¼Œå¯ä»¥ä»è¾“å…¥æ–‡ä»¶æˆ–è€…å‘½ä»¤è¡Œä¸­è¯»å–æ¶ˆæ¯å¹¶å‘é€ç»™Kafkaé›†ç¾¤ã€‚æ¯ä¸€è¡Œæ˜¯ä¸€æ¡æ¶ˆæ¯ã€‚ è¿è¡Œ producerï¼ˆç”Ÿäº§è€…ï¼‰,ç„¶ååœ¨æ§åˆ¶å°è¾“å…¥å‡ æ¡æ¶ˆæ¯åˆ°æœåŠ¡å™¨ã€‚ &gt; bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test hello world what's your name 5. æ¶ˆè´¹æ¶ˆæ¯Kafkaä¹Ÿæä¾›äº†ä¸€ä¸ªæ¶ˆè´¹æ¶ˆæ¯çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå°†å­˜å‚¨çš„ä¿¡æ¯è¾“å‡ºå‡ºæ¥ï¼Œæ–°æ‰“å¼€ä¸€ä¸ªå‘½ä»¤æ§åˆ¶å°ï¼Œè¾“å…¥ï¼š &gt; bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning hello world what's your name æ³¨æ„ï¼Œè‹¥æ˜¯åœ¨æœåŠ¡å™¨å¼€å¯kafkaæœåŠ¡ï¼Œç„¶åæœ¬åœ°æ¶ˆè´¹ç”Ÿäº§çš„æ¶ˆæ¯ï¼Œéœ€è¦åœ¨kafkaä¸­çš„ config/service.properties ä¸­ä¿®æ”¹é…ç½®ï¼ˆæ³¨æ„å¼€å¯æœåŠ¡å™¨å¯¹åº”çš„ç«¯å£ï¼‰ advertised.listeners=PLAINTEXT://your ip : your port 6. ä½¿ç”¨ Kafka Connect æ¥ å¯¼å…¥/å¯¼å‡º æ•°æ®å¯èƒ½ç°æœ‰çš„ç³»ç»Ÿä¸­æ‹¥æœ‰å¤§é‡çš„æ•°æ®ï¼Œå¦‚å…³ç³»å‹æ•°æ®åº“æˆ–ä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼Œä»¥åŠè®¸å¤šå·²ç»ä½¿ç”¨è¿™äº›ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚Kafka Connectå…è®¸ä½ ä¸æ–­åœ°ä»å¤–éƒ¨ç³»ç»Ÿæå–æ•°æ®åˆ°Kafkaï¼Œåä¹‹äº¦ç„¶ã€‚ç”¨Kafkaæ•´åˆç°æœ‰çš„ç³»ç»Ÿæ˜¯éå¸¸å®¹æ˜“çš„ã€‚ä¸ºäº†ä½¿è¿™ä¸ªè¿‡ç¨‹æ›´åŠ å®¹æ˜“ï¼Œæœ‰æ•°ç™¾ä¸ªè¿™æ ·çš„è¿æ¥å™¨ç°æˆå¯ç”¨ã€‚ 7. ä½¿ç”¨Kafka Streamæ¥å¤„ç†æ•°æ®ä¸€æ—¦æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨åœ¨Kafkaä¸­ï¼Œå°±å¯ä»¥ç”¨Kafka Streamså®¢æˆ·ç«¯åº“æ¥å¤„ç†è¿™äº›æ•°æ®ï¼Œè¯¥åº“é€‚ç”¨äºJava/Scalaã€‚å®ƒå…è®¸ä½ å®ç°è‡ªå·±çš„å®æ—¶åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡ï¼Œå…¶ä¸­è¾“å…¥å’Œ/æˆ–è¾“å‡ºæ•°æ®å­˜å‚¨åœ¨Kafkaä¸»é¢˜ä¸­ã€‚Kafka Streamså°†åœ¨å®¢æˆ·ç«¯ç¼–å†™å’Œéƒ¨ç½²æ ‡å‡†Javaå’ŒScalaåº”ç”¨ç¨‹åºçš„ç®€å•æ€§ä¸KafkaæœåŠ¡å™¨ç«¯é›†ç¾¤æŠ€æœ¯çš„ä¼˜åŠ¿ç›¸ç»“åˆï¼Œä½¿è¿™äº›åº”ç”¨ç¨‹åºå…·æœ‰å¯æ‰©å±•æ€§ã€å¼¹æ€§ã€å®¹é”™æ€§å’Œåˆ†å¸ƒå¼ã€‚è¯¥åº“æ”¯æŒç²¾ç¡®çš„ä¸€æ¬¡æ€§å¤„ç†ã€æœ‰çŠ¶æ€æ“ä½œå’Œèšåˆã€çª—å£åŒ–ã€è¿æ¥ã€åŸºäºäº‹ä»¶æ—¶é—´çš„å¤„ç†ç­‰ç­‰ã€‚ ä¸€ä¸ªåˆæ­¥çš„ä½“éªŒï¼Œå®ç°ä¸€ä¸ªæµè¡Œçš„WordCountç®—æ³•çš„ï¼š KStream&lt;String, String&gt; textLines = builder.stream(\"quickstart-events\"); KTable&lt;String, Long&gt; wordCounts = textLines .flatMapValues(line -&gt; Arrays.asList(line.toLowerCase().split(\" \"))) .groupBy((keyIgnored, word) -&gt; word) .count(); wordCounts.toStream().to(\"output-topic\", Produced.with(Serdes.String(), Serdes.Long())); ä»¥ç³»ç»ŸæœåŠ¡æ–¹å¼å¯åŠ¨kafkaåˆ›å»º /usr/lib/systemd/system/zookeeper.service å¹¶å†™å…¥ [Unit] Requires=network.target After=network.target [Service] Type=simple Environment=\"PATH=/opt/jdk-11.0.12/bin:/opt/jdk-11.0.12/jre/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\" LimitNOFILE=1048576 ExecStart=/usr/local/kafka/bin/zookeeper-server-start.sh /usr/local/kafka/config/zookeeper.properties ExecStop=/usr/local/kafka/bin/zookeeper-server-stop.sh Restart=Always [Install] WantedBy=multi-user.target åˆ›å»º /usr/lib/systemd/system/kafka.service å¹¶å†™å…¥ [Unit] Requires=zookeeper.service After=zookeeper.service [Service] Type=simple Environment=\"PATH=/opt/jdk-11.0.12/bin:/opt/jdk-11.0.12/jre/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\" LimitNOFILE=1048576 ExecStart=/usr/local/kafka/bin/kafka-server-start.sh /usr/local/kafka/config/server.properties ExecStop=/usr/local/kafka/bin/kafka-server-stop.sh Restart=Always [Install] WantedBy=multi-user.target æ³¨æ„ï¼šç¤ºä¾‹çš„kafkaå®‰è£…åœ°å€åœ¨ /usr/local/kafka å› ä¸ºç³»ç»ŸæœåŠ¡ä¸ä¼šç›´æ¥è¯»å–æˆ‘ä»¬é…ç½®åœ¨/etc/profileæˆ–è€…bash_profileä¸­çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥Environmentä¸€å®šè¦è®°å¾—é…ç½®ã€‚ ## æŸ¥çœ‹å½“å‰ç¯å¢ƒå˜é‡ export $PATH å¯åŠ¨æœåŠ¡é‡è½½ç³»ç»ŸæœåŠ¡å¹¶å¯åŠ¨ systemctl daemon-reload systemctl enable zookeeper &amp;&amp; systemctl enable kafka systemctl start zookeeper &amp;&amp; systemctl start kafka systemctl status zookeeper &amp;&amp; systemctl status kafka zookeeper kafka references ç»´åŸºç™¾ç§‘â€”-kafka Kafkaæ•™ç¨‹","categories":[{"name":"kafka","slug":"kafka","permalink":"https://winniekun.github.io/categories/kafka/"}],"tags":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/tags/%E9%85%8D%E7%BD%AE/"}]},{"title":"è™šæ‹Ÿå†…å­˜æ¦‚è§ˆ","slug":"æ“ä½œç³»ç»Ÿ/virtual-memory","date":"2021-07-27T06:57:30.000Z","updated":"2021-08-09T10:11:43.891Z","comments":true,"path":"virtual-memory/","link":"","permalink":"https://winniekun.github.io/virtual-memory/","excerpt":"","text":"åº â€œAny problem in computer science can be solved by another layer of indirection. â€”â€”ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…» ç‰©ç†å¯»å€æ—©æœŸï¼ŒCPUåœ¨å¤„ç†æŸä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œå¤„ç†çš„æµç¨‹å¦‚ä¸‹ã€‚ å¯¹äºç‰©ç†å¯»å€è€Œè¨€ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥å°†ç¨‹åºå…¨éƒ¨è£…å…¥åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œæ¥ä¸‹æ¥è¿è¡ŒæœŸé—´ï¼ŒCPUåœ¨å¤„ç†æ—¶ï¼Œç›´æ¥è¿›è¡Œç‰©ç†å¯»å€ã€‚ç„¶åæ‰§è¡Œç›¸å…³çš„è¯»å†™å‘½ä»¤ã€‚ å¯¹äºç‰©ç†å†…å­˜è€Œè¨€ï¼Œæ˜¯ä¸åšä»»ä½•è®¿é—®é™åˆ¶çš„ï¼Œæ‰€ä»¥ç›´æ¥æ“ä½œè¿›è¡Œç‰©ç†å¯»å€ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š è¯»å†™å†…å­˜çš„å®‰å…¨æ€§é—®é¢˜ ä¸åŒçš„è¿›ç¨‹è¢«åˆ†é…åˆ°ä¸åŒçš„ç‰©ç†å†…å­˜ä¸­ï¼Œè¿è¡ŒæœŸé—´å¯¼è‡´è¿›ç¨‹Aé”™è¯¯ä¿®æ”¹äº†è¿›ç¨‹Bå ç”¨çš„ç‰©ç†å†…å­˜ï¼Œå¯¼è‡´è¿›ç¨‹Bå‡ºç°é—®é¢˜ å±å®³æ“ä½œç³»ç»Ÿè‡ªèº«çš„å®‰å…¨ã€‚æ¶æ„çš„è¿›ç¨‹ç›´æ¥ä¿®æ”¹æ“ä½œç³»ç»Ÿæ‰€å ç”¨çš„ç‰©ç†ç©ºé—´ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒ å†…å­˜çš„åˆ©ç”¨ç‡ä¸é«˜ ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œä¸åŒçš„è¿›ç¨‹æ˜¯å…±äº«CPUå’Œç‰©ç†å†…å­˜èµ„æºçš„ï¼Œå¦‚æœæœ‰å¾ˆå¤šçš„è¿›ç¨‹éœ€è¦å¾ˆå¤§çš„å†…å­˜ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´è¿™äº›è¿›ç¨‹æ‰€éœ€çš„å†…å­˜å¤§å° &gt; å®é™…çš„ç‰©ç†å†…å­˜ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æœ‰äº›æœ‰äº›è¿›ç¨‹æ— æ³•è¢«æ‰§è¡Œã€‚ æ‰€ä»¥ï¼Œä¸ºäº†æ›´åŠ æœ‰æ•ˆçš„ç®¡ç†å†…å­˜å¹¶ä¸”å°‘å‡ºé”™ï¼Œç°ä»£çš„æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç§å¯¹ä¸»å­˜çš„æŠ½è±¡æ¦‚å¿µâ€”-è™šæ‹Ÿå†…å­˜ã€‚è™šæ‹Ÿå†…å­˜æ˜¯ç¡¬ä»¶å¼‚å¸¸ã€ç¡¬ä»¶åœ°å€ç¿»è¯‘ã€ä¸»å­˜ã€ç£ç›˜å’Œå†…æ ¸è½¯ä»¶çš„å®Œç¾äº¤äº’ è™šæ‹Ÿå†…å­˜æ¦‚å¿µ è™šæ‹Ÿå†…å­˜æ˜¯è®¡ç®—æœºç³»ç»Ÿå†…å­˜ç®¡ç†çš„ä¸€ç§æŠ€æœ¯ã€‚å®ƒä½¿å¾—åº”ç”¨ç¨‹åºè®¤ä¸ºå®ƒæ‹¥æœ‰è¿ç»­å¯ç”¨çš„å†…å­˜ï¼ˆä¸€ä¸ªè¿ç»­å®Œæ•´çš„åœ°å€ç©ºé—´ï¼‰ï¼Œè€Œå®é™…ä¸Šï¼Œå®ƒé€šå¸¸æ˜¯è¢«åˆ†éš”æˆå¤šä¸ªç‰©ç†å†…å­˜ç¢ç‰‡ï¼Œè¿˜æœ‰éƒ¨åˆ†æš‚æ—¶å­˜å‚¨åœ¨å¤–éƒ¨ç£ç›˜å­˜å‚¨å™¨ä¸Šï¼Œåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ç°ä»£æ‰€æœ‰ç”¨äºä¸€èˆ¬åº”ç”¨çš„æ“ä½œç³»ç»Ÿéƒ½å¯¹æ™®é€šçš„åº”ç”¨ç¨‹åºä½¿ç”¨è™šæ‹Ÿå†…å­˜æŠ€æœ¯ï¼Œè€ä¸€äº›çš„æ“ä½œç³»ç»Ÿï¼Œå¦‚DOSå’Œ1980å¹´ä»£çš„Windowsï¼Œæˆ–è€…é‚£äº›1960å¹´ä»£çš„å¤§å‹æœºï¼Œä¸€èˆ¬éƒ½æ²¡æœ‰è™šæ‹Ÿå†…å­˜çš„åŠŸèƒ½â€”â€”ç»´åŸºç™¾ç§‘ å¼•å…¥åºä¸­æ‰€å¼•ç”¨çš„è¯Any problem in computer science can be solved by another layer of indirection. åŒç†è™šæ‹Ÿå†…å­˜ä¸ºè¿›ç¨‹&lt;---&gt;ç‰©ç†å†…å­˜çš„ä¸­é—´å±‚ï¼Œå®ƒä¸ºè¿›ç¨‹éšè—äº†ç‰©ç†å†…å­˜çš„æ¦‚å¿µï¼ŒåŒæ—¶ä¸ºå…¶æä¾›äº†æ›´åŠ ç®€æ´æ˜“ç”¨çš„æ¥å£ï¼Œä¾›å…¶è°ƒç”¨ã€‚åŒæ—¶è¿˜æä¾›äº†ä¸€äº›æ›´åŠ å¤æ‚çš„åŠŸèƒ½ã€‚ èƒ½åŠ›ä¸€ï¼šé«˜é€Ÿç¼“å­˜æˆ‘ä»¬å¯ä»¥å°†è™šæ‹Ÿå†…å­˜çœ‹ä½œæ˜¯ç£ç›˜ä¸Šçš„ä¸€ç‰‡ç©ºé—´ï¼Œå½“è¿™ç‰‡ç©ºé—´ä¸­çš„ä¸€éƒ¨åˆ†è®¿é—®æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œè¯¥éƒ¨åˆ†æ•°æ®ä¼šä»¥é¡µä¸ºå•ä½è¢«ç¼“å­˜åˆ°ä¸»å­˜ä¸­ä»¥åŠ é€Ÿ CPU è®¿é—®æ•°æ®çš„æ€§èƒ½ï¼Œè™šæ‹Ÿå†…å­˜åˆ©ç”¨ç©ºé—´è¾ƒå¤§çš„ç£ç›˜å­˜å‚¨ä½œä¸ºã€å†…å­˜ã€å¹¶ä½¿ç”¨ä¸»å­˜å‚¨ç¼“å­˜è¿›è¡ŒåŠ é€Ÿï¼Œè®©è¿›ç¨‹è®¤ä¸ºæ“ä½œç³»ç»Ÿçš„å†…å­˜å¾ˆå¤§è€Œä¸”å¾ˆå¿«ï¼Œç„¶è€ŒåŒºåŸŸå¾ˆå¤§çš„ç£ç›˜å¹¶ä¸å¿«ï¼Œè€Œå¾ˆå¿«çš„å†…å­˜ä¹Ÿå¹¶ä¸å¤§ã€‚ è™šæ‹Ÿå†…å­˜ä½œä¸ºç¼“å­˜ åœ¨è™šæ‹Ÿå†…å­˜ä¸­çš„è™šæ‹Ÿé¡µå…±åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š æœªåˆ†é… æ²¡æœ‰è¢«è¿›ç¨‹ç”³è¯·ä½¿ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çš„è™šæ‹Ÿå†…å­˜ï¼Œ ä¸å ç”¨è™šæ‹Ÿå†…å­˜ç£ç›˜çš„ä»»ä½•ç©ºé—´ æœªç¼“å­˜ ä»…ä»…åŠ è½½åˆ°ç£ç›˜ä¸­çš„é¡µ å·²ç¼“å­˜ å·²ç»åŠ è½½åˆ°å†…å­˜ä¸­çš„å†…å­˜é¡µï¼ˆé¡µæ¡†ï¼‰ èƒ½åŠ›äºŒï¼šå†…å­˜ç®¡ç† ç®€åŒ–é“¾æ¥å’ŒåŠ è½½ ç®€åŒ–å†…å­˜å…±äº« å°†ä¸åŒçš„è¿›ç¨‹ä¸­çš„é¡µè¡¨ä¸­æŸäº›é¡µè¡¨é¡¹æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†åœ°å€ï¼Œå³å¯å®ç°å†…å­˜çš„å…±äº«ã€‚ ç®€åŒ–å†…å­˜åˆ†é… ç‹¬ç«‹çš„è™šæ‹Ÿå†…å­˜ç©ºé—´ä¹Ÿä¼šç®€åŒ–å†…å­˜çš„åˆ†é…è¿‡ç¨‹ï¼Œå½“ç”¨æˆ·ç¨‹åºå‘æ“ä½œç³»ç»Ÿç”³è¯·å †å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥åˆ†é…å‡ ä¸ªè¿ç»­çš„è™šæ‹Ÿé¡µï¼Œä½†æ˜¯è¿™äº›è™šæ‹Ÿé¡µå¯ä»¥å¯¹åº”åˆ°ç‰©ç†å†…å­˜ä¸­ä¸è¿ç»­çš„é¡µä¸­ã€‚ èƒ½åŠ›ä¸‰ï¼šå†…å­˜ä¿æŠ¤ç°ä»£æ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·è¿›ç¨‹ä¸åº”è¯¥è¢«å…è®¸ä¿®æ”¹å®ƒçš„åªè¯»ä»£ç æ®µï¼Œè€Œä¸”ä¹Ÿä¸åº”è¯¥å…è®¸å®ƒè¯»å–æˆ–ä¿®æ”¹ä»»ä½•å†…æ ¸ä¸­çš„ä»£ç å’Œæ•°æ®ç»“æ„ï¼Œå¹¶ä¸”ä¹Ÿä¸å…è®¸å…¶è¯»å–æˆ–è€…ä¿®æ”¹å…¶ä»–è¿›ç¨‹çš„ç§æœ‰å†…å­˜ï¼Œä»¥åŠä¿®æ”¹å’Œå…¶ä»–è¿›ç¨‹å…±äº«çš„è™šæ‹Ÿé¡µé¢ã€‚å¦‚æœä¸å¯¹è¿›ç¨‹çš„å†…å­˜è®¿é—®è¿›è¡Œé™åˆ¶ï¼Œæ”»å‡»è€…å°±èƒ½å¤Ÿè®¿é—®å’Œä¿®æ”¹å…¶ä»–è¿›ç¨‹çš„ç§æœ‰å†…å­˜ï¼Œè¿›è€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚ é€šè¿‡è™šæ‹Ÿå†…å­˜ï¼Œæˆ‘ä»¬ä¸ºè¿›ç¨‹æä¾›äº†ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼ŒåŒæ—¶è¿™ä¹Ÿè®©æˆ‘ä»¬èƒ½å¤Ÿå¿«é€Ÿçš„åŒºåˆ†ä¸åŒè¿›ç¨‹çš„ç§æœ‰å†…å­˜ã€‚åŒæ—¶æˆ‘ä»¬é€šè¿‡è™šæ‹Ÿå†…å­˜åˆ°å®é™…çš„ç‰©ç†å†…å­˜çš„è½¬åŒ–éœ€è¦ä½¿ç”¨åœ°å€ç¿»è¯‘æœºåˆ¶ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š è™šæ‹Ÿå¯»å€æ–¹å¼ é€šè¿‡MMUï¼Œæ¯æ¬¡éƒ½ä¼šè¯»å–é¡µè¡¨ä¸­çš„ä¸€ä¸ªé¡µè¡¨æ¡ç›®(PTE)ï¼Œé€šè¿‡åœ¨è¿™äº›é¡µè¡¨æ¡ç›®(PTE)ä¸­æ·»åŠ ä¸€äº›æ ‡å¿—ä½ï¼Œå°±èƒ½å¤Ÿå®ç°å¯¹ä¸€ä¸ªè™šæ‹Ÿé¡µçš„è®¿é—®æ§åˆ¶æƒé™ã€‚è­¬å¦‚ï¼š å¸¦æ ‡å¿—ä½çš„é¡µè¡¨ åº”ç”¨ç¨‹åºå¦‚ä½•å¦‚ä½•ä½¿ç”¨å’Œç®¡ç†è™šæ‹Ÿå†…å­˜ [ ] TODO æ€»ç»“è™šæ‹Ÿå†…å­˜çš„æ€æƒ³ï¼Œæ•´ä½“æ¥çœ‹å°±æ˜¯ï¼šé€šè¿‡ç»“åˆç£ç›˜å’Œå†…å­˜å„è‡ªçš„ä¼˜åŠ¿ï¼Œåˆ©ç”¨ä¸­é—´å±‚å¯¹èµ„æºè¿›è¡Œæ›´åˆç†åœ°è°ƒåº¦ï¼Œå……åˆ†æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚å¹¶æä¾›å’Œè°ä»¥åŠç»Ÿä¸€çš„æŠ½è±¡ã€‚ä¸ªäººç›®å‰æ¥è§¦åˆ°çš„æœ€ç›´è§‚çš„ä½“ç°å°±æ˜¯ JDKä¸­é›†åˆç±»çš„è®¾è®¡ä¸å®ç°ã€‚å…¶ä¹Ÿå¯ä»¥ç®—æ˜¯æ•°æ®å’Œæ•°æ®ç»“æ„ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œç»“åˆå…¶ä»–çš„æŠ€æœ¯è­¬å¦‚æ³›å‹ï¼Œä¸ºä¸Šå±‚çš„æ•°æ®æä¾›äº†æ¥å£çš„åŒæ—¶ï¼Œéšè—äº†å†…éƒ¨æ•°æ®ç»“æ„çš„å®ç°ä»¥åŠç»´æŠ¤ã€‚ æœ€åå†æ€»ç»“ä¸‹ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿå†…å­˜ï¼š è™šæ‹Ÿå†…å­˜å¯ä»¥ç»“åˆç£ç›˜å’Œç‰©ç†å†…å­˜çš„ä¼˜åŠ¿ä¸ºè¿›ç¨‹æä¾›çœ‹èµ·æ¥é€Ÿåº¦è¶³å¤Ÿå¿«å¹¶ä¸”å®¹é‡è¶³å¤Ÿå¤§çš„å­˜å‚¨ï¼› è™šæ‹Ÿå†…å­˜å¯ä»¥ä¸ºè¿›ç¨‹æä¾›ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å¹¶å¼•å…¥å¤šå±‚çš„é¡µè¡¨ç»“æ„å°†è™šæ‹Ÿå†…å­˜ç¿»è¯‘æˆç‰©ç†å†…å­˜ï¼Œè¿›ç¨‹ä¹‹é—´å¯ä»¥å…±äº«ç‰©ç†å†…å­˜å‡å°‘å¼€é”€ï¼Œä¹Ÿèƒ½ç®€åŒ–ç¨‹åºçš„é“¾æ¥ã€è£…è½½ä»¥åŠå†…å­˜åˆ†é…è¿‡ç¨‹ï¼› è™šæ‹Ÿå†…å­˜å¯ä»¥æ§åˆ¶è¿›ç¨‹å¯¹ç‰©ç†å†…å­˜çš„è®¿é—®ï¼Œéš”ç¦»ä¸åŒè¿›ç¨‹çš„è®¿é—®æƒé™ï¼Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼› references csapp ç¬¬ä¹ç«  æ“ä½œç³»ç»Ÿå¯¼è®º å†…å­˜è™šæ‹ŸåŒ–éƒ¨åˆ† ä¸ºä»€ä¹ˆLinuxéœ€è¦è™šæ‹Ÿå†…å­˜ å¦‚ä½•ç†è§£è™šæ‹Ÿå†…å­˜","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://winniekun.github.io/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"tags":[{"name":"å†…å­˜ç®¡ç†","slug":"å†…å­˜ç®¡ç†","permalink":"https://winniekun.github.io/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"}]},{"title":"ConcurrentHashMapæºç åˆ†æ","slug":"æºç /JDK/map/concurrenthashmap-analysis","date":"2021-07-19T10:40:55.000Z","updated":"2021-07-19T13:56:53.865Z","comments":true,"path":"concurrenthashmap-analysis/","link":"","permalink":"https://winniekun.github.io/concurrenthashmap-analysis/","excerpt":"","text":"åºConcurrentHashMapï¼Œå¯ä»¥ç†è§£æˆæ˜¯HashMapçš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼ŒåŒæ ·çš„ï¼Œå†…éƒ¨ä½¿ç”¨ä¹Ÿæ˜¯ï¼ˆæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼‰çš„ç»“æ„æ¥å­˜å‚¨å…ƒç´ ã€‚åŒæ—¶ç›¸æ¯”äºåŒæ ·æä¾›çº¿ç¨‹å®‰å…¨çš„HashTableï¼Œæ•ˆç‡ç­‰å„æ–¹é¢éƒ½æœ‰æ‰€æå‡ æ¦‚è¿° ConcurrentHashMap é˜…è¯»å¥—è·¯æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘ï¼Œ é¦–å…ˆåŸºç¡€çš„æ•°æ®æ„é€ , ç„¶åäº†è§£å…¶æ„é€ æ–¹æ³•ï¼Œ ä¹‹åäº†è§£å¸¸ç”¨çš„API(CRUD)æ“ä½œå³å¯ã€‚ [x] å¢ [x] åˆ  [x] æ”¹ [x] æŸ¥ ç±»çš„å±æ€§// å’Œhashmapç±»ä¼¼ transient volatile Node&lt;K,V&gt;[] table; // ç”¨äºå¹¶å‘æƒ…å†µä¸‹çš„æ‰©å®¹æ§åˆ¶ private transient volatile Node&lt;K,V&gt;[] nextTable; // å¹¶å‘å®‰å…¨æ§åˆ¶ private transient volatile long baseCount; private transient volatile int sizeCtl; private transient volatile int transferIndex; private transient volatile int cellsBusy; private transient volatile CounterCell[] counterCells; // views private transient KeySetView&lt;K,V&gt; keySet; private transient ValuesView&lt;K,V&gt; values; private transient EntrySetView&lt;K,V&gt; entrySet; private static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; /** * The default initial table capacity. Must be a power of 2 * (i.e., at least 1) and at most MAXIMUM_CAPACITY. */ private static final int DEFAULT_CAPACITY = 16; /** * The largest possible (non-power of two) array size. * Needed by toArray and related methods. */ static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; /** * The default concurrency level for this table. Unused but * defined for compatibility with previous versions of this class. */ private static final int DEFAULT_CONCURRENCY_LEVEL = 16; /** * The load factor for this table. Overrides of this value in * constructors affect only the initial table capacity. The * actual floating point value isn't normally used -- it is * simpler to use expressions such as {@code n - (n &gt;&gt;&gt; 2)} for * the associated resizing threshold. */ private static final float LOAD_FACTOR = 0.75f; /** * The bin count threshold for using a tree rather than list for a * bin. Bins are converted to trees when adding an element to a * bin with at least this many nodes. The value must be greater * than 2, and should be at least 8 to mesh with assumptions in * tree removal about conversion back to plain bins upon * shrinkage. */ static final int TREEIFY_THRESHOLD = 8; /** * The bin count threshold for untreeifying a (split) bin during a * resize operation. Should be less than TREEIFY_THRESHOLD, and at * most 6 to mesh with shrinkage detection under removal. */ static final int UNTREEIFY_THRESHOLD = 6; /** * The smallest table capacity for which bins may be treeified. * (Otherwise the table is resized if too many nodes in a bin.) * The value should be at least 4 * TREEIFY_THRESHOLD to avoid * conflicts between resizing and treeification thresholds. */ static final int MIN_TREEIFY_CAPACITY = 64; /** * Minimum number of rebinnings per transfer step. Ranges are * subdivided to allow multiple resizer threads. This value * serves as a lower bound to avoid resizers encountering * excessive memory contention. The value should be at least * DEFAULT_CAPACITY. */ private static final int MIN_TRANSFER_STRIDE = 16; /** * The number of bits used for generation stamp in sizeCtl. * Must be at least 6 for 32bit arrays. */ private static int RESIZE_STAMP_BITS = 16; /** * The maximum number of threads that can help resize. * Must fit in 32 - RESIZE_STAMP_BITS bits. */ private static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1; /** * The bit shift for recording size stamp in sizeCtl. */ private static final int RESIZE_STAMP_SHIFT = 32 - RESIZE_STAMP_BITS; /* * Encodings for Node hash fields. See above for explanation. */ static final int MOVED = -1; // hash for forwarding nodes static final int TREEBIN = -2; // hash for roots of trees static final int RESERVED = -3; // hash for transient reservations static final int HASH_BITS = 0x7fffffff; // usable bits of normal node hash /** Number of CPUS, to place bounds on some sizings */ static final int NCPU = Runtime.getRuntime().availableProcessors(); æ„é€ æ–¹æ³•public ConcurrentHashMap() { } public ConcurrentHashMap(int initialCapacity) { if (initialCapacity &lt; 0) throw new IllegalArgumentException(); int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1)); this.sizeCtl = cap; } public ConcurrentHashMap(Map&lt;? extends K, ? extends V&gt; m) { this.sizeCtl = DEFAULT_CAPACITY; putAll(m); } public ConcurrentHashMap(int initialCapacity, float loadFactor) { this(initialCapacity, loadFactor, 1); } public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) { if (!(loadFactor &gt; 0.0f) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (initialCapacity &lt; concurrencyLevel) // Use at least as many bins initialCapacity = concurrencyLevel; // as estimated threads long size = (long)(1.0 + (long)initialCapacity / loadFactor); int cap = (size &gt;= (long)MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : tableSizeFor((int)size); this.sizeCtl = cap; } æ„é€ æ–¹æ³•ä¸HashMapå¯¹æ¯”å¯ä»¥å‘ç°ï¼Œæ²¡æœ‰äº†HashMapä¸­çš„thresholdå’ŒloadFactorï¼Œè€Œæ˜¯æ”¹ç”¨äº†sizeCtlæ¥æ§åˆ¶ï¼Œè€Œä¸”åªå­˜å‚¨äº†å®¹é‡åœ¨é‡Œé¢ï¼Œé‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆç”¨çš„å‘¢ï¼Ÿå®˜æ–¹ç»™å‡ºçš„è§£é‡Šå¦‚ä¸‹ï¼š Table initialization and resizing control. When negative, the table is being initialized or resized: -1 for initialization, else -(1 + the number of active resizing threads). Otherwise, when table is null, holds the initial table size to use upon creation, or 0 for default. After initialization, holds the next element count value upon which to resize the table. -1 æœ‰çº¿ç¨‹æ­£åœ¨åˆå§‹åŒ– -(1 + n) æœ‰nä¸ªçº¿ç¨‹æ­£åœ¨ä¸€èµ·æ‰©å®¹ 0 é»˜è®¤å€¼ï¼Œ åç»­åœ¨çœŸæ­£åˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨é»˜è®¤å®¹é‡ &gt;0 åˆå§‹åŒ–æˆ–æ‰©å®¹å®Œæˆåä¸‹ä¸€æ¬¡çš„æ‰©å®¹é—¨æ§› å¢public V put(K key, V value) { return putVal(key, value, false); } /** Implementation for put and putIfAbsent */ final V putVal(K key, V value, boolean onlyIfAbsent) { // keyå’Œvalueéƒ½ä¸èƒ½ä¸ºnull if (key == null || value == null) throw new NullPointerException(); // è®¡ç®—hashå€¼ int hash = spread(key.hashCode()); // è¦æ’å…¥çš„å…ƒç´ æ‰€åœ¨æ¡¶çš„å…ƒç´ ä¸ªæ•° int binCount = 0; // æ­»å¾ªç¯ï¼Œç»“åˆCASä½¿ç”¨ï¼ˆå¦‚æœCASå¤±è´¥ï¼Œåˆ™ä¼šé‡æ–°å–æ•´ä¸ªæ¡¶è¿›è¡Œä¸‹é¢çš„æµç¨‹ï¼‰ for (Node&lt;K,V&gt;[] tab = table;;) { Node&lt;K,V&gt; f; int n, i, fh; if (tab == null || (n = tab.length) == 0) // å¦‚æœæ¡¶æœªåˆå§‹åŒ–æˆ–è€…æ¡¶ä¸ªæ•°ä¸º0ï¼Œåˆ™åˆå§‹åŒ–æ¡¶ tab = initTable(); else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) { // å¦‚æœè¦æ’å…¥çš„å…ƒç´ æ‰€åœ¨çš„æ¡¶è¿˜æ²¡æœ‰å…ƒç´ ï¼Œåˆ™æŠŠè¿™ä¸ªå…ƒç´ æ’å…¥åˆ°è¿™ä¸ªæ¡¶ä¸­ if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) // å¦‚æœä½¿ç”¨CASæ’å…¥å…ƒç´ æ—¶ï¼Œå‘ç°å·²ç»æœ‰å…ƒç´ äº†ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œé‡æ–°æ“ä½œ // å¦‚æœä½¿ç”¨CASæ’å…¥å…ƒç´ æˆåŠŸï¼Œåˆ™breakè·³å‡ºå¾ªç¯ï¼Œæµç¨‹ç»“æŸ break; // no lock when adding to empty bin } else if ((fh = f.hash) == MOVED) // å¦‚æœè¦æ’å…¥çš„å…ƒç´ æ‰€åœ¨çš„æ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„hashæ˜¯MOVEDï¼Œåˆ™å½“å‰çº¿ç¨‹å¸®å¿™ä¸€èµ·è¿ç§»å…ƒç´  tab = helpTransfer(tab, f); else { // å¦‚æœè¿™ä¸ªæ¡¶ä¸ä¸ºç©ºä¸”ä¸åœ¨è¿ç§»å…ƒç´ ï¼Œåˆ™é”ä½è¿™ä¸ªæ¡¶ï¼ˆåˆ†æ®µé”ï¼‰ // å¹¶æŸ¥æ‰¾è¦æ’å…¥çš„å…ƒç´ æ˜¯å¦åœ¨è¿™ä¸ªæ¡¶ä¸­ // å­˜åœ¨ï¼Œåˆ™æ›¿æ¢å€¼ï¼ˆonlyIfAbsent=falseï¼‰ // ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥åˆ°é“¾è¡¨ç»“å°¾æˆ–æ’å…¥æ ‘ä¸­ V oldVal = null; synchronized (f) { // å†æ¬¡æ£€æµ‹ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æœ‰å˜åŒ–ï¼Œå¦‚æœæœ‰å˜åŒ–åˆ™è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼Œä»å¤´æ¥è¿‡ if (tabAt(tab, i) == f) { // å¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ çš„hashå€¼å¤§äºç­‰äº0ï¼ˆè¯´æ˜ä¸æ˜¯åœ¨è¿ç§»ï¼Œä¹Ÿä¸æ˜¯æ ‘ï¼‰ // é‚£å°±æ˜¯æ¡¶ä¸­çš„å…ƒç´ ä½¿ç”¨çš„æ˜¯é“¾è¡¨æ–¹å¼å­˜å‚¨ if (fh &gt;= 0) { // æ¡¶ä¸­å…ƒç´ ä¸ªæ•°èµ‹å€¼ä¸º1 binCount = 1; // éå†æ•´ä¸ªæ¡¶ï¼Œæ¯æ¬¡ç»“æŸbinCount + 1 for (Node&lt;K,V&gt; e = f;; ++binCount) { K ek; // åœ¨é“¾è¡¨ä¸­æ‰¾åˆ°äº†æ”¹å…ƒç´ ï¼Œè¦†ç›– å¹¶é€€å‡º if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) { oldVal = e.val; if (!onlyIfAbsent) e.val = value; break; } // å¦‚æœæ²¡æœ‰æ‰¾åˆ° åˆ™ ç›´æ¥åœ¨å°¾éƒ¨æ’å…¥æ”¹å…ƒç´  Node&lt;K,V&gt; pred = e; if ((e = e.next) == null) { pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; } } } // æ ‘ä¸Šæ‰¾ç‚¹ else if (f instanceof TreeBin) { Node&lt;K,V&gt; p; binCount = 2; if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) { oldVal = p.val; if (!onlyIfAbsent) p.val = value; } } } } // å¦‚æœbinCountä¸ä¸º0ï¼Œè¯´æ˜æˆåŠŸæ’å…¥äº†å…ƒç´ æˆ–è€…å¯»æ‰¾åˆ°äº†å…ƒç´  if (binCount != 0) { // å¦‚æœé“¾è¡¨å…ƒç´ ä¸ªæ•°è¾¾åˆ°äº†8ï¼Œåˆ™å°è¯•æ ‘åŒ– // å› ä¸ºä¸Šé¢æŠŠå…ƒç´ æ’å…¥åˆ°æ ‘ä¸­æ—¶ï¼ŒbinCountåªèµ‹å€¼äº†2ï¼Œå¹¶æ²¡æœ‰è®¡ç®—æ•´ä¸ªæ ‘ä¸­å…ƒç´ çš„ä¸ªæ•° // æ‰€ä»¥ä¸ä¼šé‡å¤æ ‘åŒ– if (binCount &gt;= TREEIFY_THRESHOLD) treeifyBin(tab, i); if (oldVal != null) return oldVal; break; } } } // æˆåŠŸæ’å…¥å…ƒç´ ï¼Œå…ƒç´ ä¸ªæ•°åŠ 1ï¼ˆæ˜¯å¦è¦æ‰©å®¹åœ¨è¿™ä¸ªé‡Œé¢ï¼‰ addCount(1L, binCount); return null; } æµç¨‹å’Œhashmapç±»ä¼¼ï¼š å¦‚æœhashæ¡¶æœªåˆå§‹åŒ–ï¼Œåˆ™å…ˆåˆå§‹åŒ– å¦‚æœå½“å‰ä½ç½®æ— å…ƒç´ ï¼Œåˆ™é€šè¿‡casçš„æ–¹å¼æ”¾å…¥å…ƒç´  å¦‚æœå½“å‰ä½ç½®å­˜åœ¨å…ƒç´  æ˜¯è½¬ç§»èŠ‚ç‚¹ï¼ˆæ­£åœ¨æ‰©å®¹ï¼‰ï¼Œåˆ™å°†å½“å‰çº¿ç¨‹ä¸€èµ·åŠ å…¥åˆ°æ‰©å®¹ä¸­ ä¸æ˜¯è½¬ç§»èŠ‚ç‚¹ï¼Œé”è¿™ä¸ªæ¡¶ å¦‚æœä¸ºé“¾è¡¨èŠ‚ç‚¹ï¼Œè¿›è¡Œåœ¨é“¾è¡¨ä¸ŠæŸ¥æ‰¾è¯¥å…ƒç´ ï¼Œæ‰¾åˆ°ï¼Ÿè¦†ç›–ï¼šæ‰§è¡Œæ’å…¥æ“ä½œ å¦‚æœä¸ºæ ‘èŠ‚ç‚¹ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾è¯¥å…ƒç´ ï¼Œæ‰¾åˆ°ï¼Ÿè¦†ç›–ï¼šæ‰§è¡Œæ’å…¥æ“ä½œ å­˜åœ¨è¯¥å…ƒç´ æ—¶ï¼Œè¿”å›æ—§value ä¸å­˜åœ¨ï¼Œæ•´ä¸ªmapçš„å…ƒç´ + 1ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ å› ä¸ºæ˜¯çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œæ‰€ä»¥ä»”ç»†çœ‹ä¸‹åœ¨æ•´ä¸ªputé˜¶æ®µï¼Œé‡‡ç”¨äº†å“ªäº›æ‰‹æ®µä¿è¯çº¿ç¨‹å®‰å…¨ã€‚è¿™ä¸ªæ‰æ˜¯æˆ‘ä»¬çœ‹CHMæºç çš„å…³é”® æ•°ç»„åˆå§‹åŒ–æ—¶çš„çº¿ç¨‹å®‰å…¨æªæ–½private final Node&lt;K,V&gt;[] initTable() { Node&lt;K,V&gt;[] tab; int sc; while ((tab = table) == null || tab.length == 0) { // å°äº 0 ä»£è¡¨æœ‰çº¿ç¨‹æ­£åœ¨åˆå§‹åŒ–ï¼Œé‡Šæ”¾å½“å‰ CPU çš„è°ƒåº¦æƒï¼Œé‡æ–°å‘èµ·é”çš„ç«äº‰ if ((sc = sizeCtl) &lt; 0) Thread.yield(); // lost initialization race; just spin // CAS èµ‹å€¼ä¿è¯å½“å‰åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨åˆå§‹åŒ–ï¼Œ // -1 ä»£è¡¨å½“å‰åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åˆå§‹åŒ– // ä¿è¯äº†æ•°ç»„çš„åˆå§‹åŒ–çš„å®‰å…¨æ€§ else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { try { // å¾ˆæœ‰å¯èƒ½æ‰§è¡Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œtable å·²ç»ä¸ä¸ºç©ºäº†ï¼Œè¿™é‡Œæ˜¯åŒé‡ check // å¦‚æœæŠŠsizeCtlåŸå­æ›´æ–°ä¸º-1æˆåŠŸï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥åˆå§‹åŒ– // å¦‚æœåŸå­æ›´æ–°å¤±è´¥åˆ™è¯´æ˜æœ‰å…¶å®ƒçº¿ç¨‹å…ˆä¸€æ­¥è¿›å…¥åˆå§‹åŒ–äº†ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ // å¦‚æœä¸‹ä¸€æ¬¡å¾ªç¯æ—¶è¿˜æ²¡åˆå§‹åŒ–å®Œæ¯•ï¼Œåˆ™sizeCtl&lt;0è¿›å…¥ä¸Šé¢ifçš„é€»è¾‘è®©å‡ºCPU // å¦‚æœä¸‹ä¸€æ¬¡å¾ªç¯æ›´æ–°å®Œæ¯•äº†ï¼Œåˆ™table.length!=0ï¼Œé€€å‡ºå¾ªç¯ if ((tab = table) == null || tab.length == 0) { // è¿›è¡Œåˆå§‹åŒ– int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; @SuppressWarnings(\"unchecked\") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = tab = nt; sc = n - (n &gt;&gt;&gt; 2); } } finally { sizeCtl = sc; } break; } } return tab; } å°æ€»ç»“ æ•°ç»„åˆå§‹åŒ–æ—¶ï¼š ä½¿ç”¨CASé”æ§åˆ¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–æ¡¶æ•°ç»„å¹¶ä¸”ä¸€å®šèƒ½åˆå§‹åŒ–æˆåŠŸï¼› ç„¶åé€šè¿‡ CAS è®¾ç½® sizeCtl å˜é‡çš„å€¼ï¼Œæ¥ä¿è¯åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼ŒCAS æˆåŠŸä¹‹åï¼Œè¿˜ä¼šå†æ¬¡åˆ¤æ–­å½“å‰æ•°ç»„ æ˜¯å¦å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œå¦‚æœå·²ç»åˆå§‹åŒ–å®Œæˆï¼Œå°±ä¸ä¼šç»§ç»­å†æ‰§è¡Œåˆå§‹åŒ– æ‰©å®¹é—¨æ§›å†™æ­»çš„æ˜¯æ¡¶æ•°ç»„å¤§å°çš„0.75å€ï¼Œæ¡¶æ•°ç»„å¤§å°å³mapçš„å®¹é‡ï¼Œä¹Ÿå°±æ˜¯æœ€å¤šå­˜å‚¨å¤šå°‘ä¸ªå…ƒç´ ã€‚ é€šè¿‡è‡ªæ—‹ + cas + double check ä¿éšœäº†æ•°ç»„åˆå§‹åŒ–æ—¶çš„çº¿ç¨‹å®‰å…¨ã€‚ Javaçº¿ç¨‹ä¸­çš„ä¸€äº›æ–¹æ³•çš„åŒºåˆ«ï¼ˆsleepã€yieldã€waitã€joinï¼‰åªæœ‰runnableåˆ°runningæ—¶æ‰ä¼šå ç”¨cpuæ—¶é—´ç‰‡ï¼Œå…¶ä»–éƒ½ä¼šå‡ºè®©cpuæ—¶é—´ç‰‡ã€‚çº¿ç¨‹çš„èµ„æºæœ‰ä¸å°‘ï¼Œæ•´ä½“æ¥çœ‹å¯åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç±» CPUèµ„æº é”èµ„æº åˆ†æä»¥ä¸Šå››ä¸ªæ–¹æ³•æ—¶ï¼ŒæŸ¥çœ‹è¿™ä¸¤ä¸ªå…±äº«èµ„æºæ˜¯å¦é‡Šæ”¾ï¼ŒåŒºåˆ†æ›´åŠ æ˜æ˜¾ sleepï¼šThreadç±»çš„æ–¹æ³•ï¼Œå¿…é¡»å¸¦ä¸€ä¸ªæ—¶é—´å‚æ•°ã€‚ä¼šè®©å½“å‰çº¿ç¨‹ä¼‘çœ è¿›å…¥é˜»å¡çŠ¶æ€å¹¶é‡Šæ”¾CPUï¼ˆé˜¿é‡Œé¢è¯•é¢˜ Sleepé‡Šæ”¾CPUï¼Œwait ä¹Ÿä¼šé‡Šæ”¾cpuï¼Œå› ä¸ºcpuèµ„æºå¤ªå®è´µäº†ï¼Œåªæœ‰åœ¨çº¿ç¨‹runningçš„æ—¶å€™ï¼Œæ‰ä¼šè·å–cpuç‰‡æ®µï¼‰ï¼Œæä¾›å…¶ä»–çº¿ç¨‹è¿è¡Œçš„æœºä¼šä¸”ä¸è€ƒè™‘ä¼˜å…ˆçº§ï¼Œä½†å¦‚æœæœ‰åŒæ­¥é”åˆ™sleepä¸ä¼šé‡Šæ”¾é”å³å…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—åŒæ­¥é” å¯é€šè¿‡è°ƒç”¨interrupt()æ–¹æ³•æ¥å”¤é†’ä¼‘çœ çº¿ç¨‹ã€‚ yieldï¼šè®©å‡ºCPUè°ƒåº¦ï¼ŒThreadç±»çš„æ–¹æ³•ï¼Œç±»ä¼¼sleepåªæ˜¯ä¸èƒ½ç”±ç”¨æˆ·æŒ‡å®šæš‚åœå¤šé•¿æ—¶é—´ ï¼Œå¹¶ä¸”yield()æ–¹æ³•åªèƒ½è®©åŒä¼˜å…ˆçº§çš„çº¿ç¨‹æœ‰æ‰§è¡Œçš„æœºä¼šã€‚ yield()åªæ˜¯ä½¿å½“å‰çº¿ç¨‹é‡æ–°å›åˆ°å¯æ‰§è¡ŒçŠ¶æ€ï¼Œæ‰€ä»¥æ‰§è¡Œyield()çš„çº¿ç¨‹æœ‰å¯èƒ½åœ¨è¿›å…¥åˆ°å¯æ‰§è¡ŒçŠ¶æ€åé©¬ä¸Šåˆè¢«æ‰§è¡Œã€‚è°ƒç”¨yieldæ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œå‘Šè¯‰çº¿ç¨‹è°ƒåº¦å™¨æˆ‘çš„å·¥ä½œå·²ç»åšçš„å·®ä¸å¤šäº†ï¼Œå¯ä»¥è®©åˆ«çš„ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä½¿ç”¨CPUäº†ï¼Œæ²¡æœ‰ä»»ä½•æœºåˆ¶ä¿è¯é‡‡çº³ã€‚ waitï¼šObjectç±»çš„æ–¹æ³•(notify()ã€notifyAll() ä¹Ÿæ˜¯Objectå¯¹è±¡)ï¼Œå¿…é¡»æ”¾åœ¨å¾ªç¯ä½“å’ŒåŒæ­¥ä»£ç å—ä¸­ï¼Œæ‰§è¡Œè¯¥æ–¹æ³•çš„çº¿ç¨‹ä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥çº¿ç¨‹ç­‰å¾…æ± ä¸­ç­‰å¾…è¢«å†æ¬¡å”¤é†’(notifyéšæœºå”¤é†’ï¼ŒnotifyAllå…¨éƒ¨å”¤é†’ï¼Œçº¿ç¨‹ç»“æŸè‡ªåŠ¨å”¤é†’)å³æ”¾å…¥é”æ± ä¸­ç«äº‰åŒæ­¥é” joinï¼šä¸€ç§ç‰¹æ®Šçš„waitï¼Œå½“å‰è¿è¡Œçº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„joinæ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ç›´åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸç­‰å¾…è¯¥çº¿ç¨‹ç»ˆæ­¢ã€‚ æ³¨æ„è¯¥æ–¹æ³•ä¹Ÿéœ€è¦æ•æ‰å¼‚å¸¸ã€‚ç­‰å¾…è°ƒç”¨joinæ–¹æ³•çš„çº¿ç¨‹ç»“æŸï¼Œå†ç»§ç»­æ‰§è¡Œã€‚å¦‚ï¼št.join();//ä¸»è¦ç”¨äºç­‰å¾…tçº¿ç¨‹è¿è¡Œç»“æŸï¼Œè‹¥æ— æ­¤å¥ï¼Œmainåˆ™ä¼šæ‰§è¡Œå®Œæ¯•ï¼Œå¯¼è‡´ç»“æœä¸å¯é¢„æµ‹ã€‚ åœ¨æ¡¶ä½ç½®æ”¾å…¥å…ƒç´ æ—¶çš„çº¿ç¨‹å®‰å…¨æªæ–½ï¼ˆ4ä¸ªæªæ–½ï¼‰else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) { if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin } static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) { return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v); } é€šè¿‡è‡ªæ—‹æ­»å¾ªç¯ä¿è¯ä¸€å®šå¯ä»¥æ–°å¢æˆåŠŸ 1âƒ£ï¸ åœ¨æ–°å¢ä¹‹å‰ï¼Œé€šè¿‡==for (Node[] tab = table;;)==è¿™æ ·çš„æ­»å¾ªç¯æ¥ä¿è¯æ–°å¢ä¸€å®šå¯ä»¥æˆåŠŸï¼Œä¸€æ—¦æ–°å¢æˆåŠŸï¼Œå°±å¯ä»¥é€€å‡ºå½“å‰æ­»å¾ªç¯ï¼Œæ–°å¢å¤±è´¥çš„è¯ï¼Œä¼šé‡å¤æ–°å¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ–°å¢æˆåŠŸä¸ºæ­¢ã€‚ å½“å‰hashæ¡¶æ˜¯å¦æœ‰å…ƒç´ ï¼š æ— å…ƒç´  cas æ–°å¢ 2âƒ£ï¸ Java è¿™é‡Œçš„å†™æ³•éå¸¸ä¸¥è°¨ï¼Œæ²¡æœ‰åœ¨åˆ¤æ–­æ§½ç‚¹ä¸ºç©ºçš„æƒ…å†µä¸‹ç›´æ¥èµ‹å€¼ï¼Œå› ä¸ºåœ¨åˆ¤æ–­æ§½ç‚¹ä¸ºç©ºå’Œèµ‹ å€¼çš„ç¬é—´ï¼Œå¾ˆæœ‰å¯èƒ½æ§½ç‚¹å·²ç»è¢«å…¶ä»–çº¿ç¨‹èµ‹å€¼äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ CAS ç®—æ³•ï¼Œèƒ½å¤Ÿä¿è¯æ§½ç‚¹ä¸ºç©º çš„æƒ…å†µä¸‹èµ‹å€¼æˆåŠŸï¼Œå¦‚æœæ°å¥½æ§½ç‚¹å·²ç»è¢«å…¶ä»–çº¿ç¨‹èµ‹å€¼ï¼Œå½“å‰ CAS æ“ä½œå¤±è´¥ï¼Œä¼šå†æ¬¡æ‰§è¡Œ for è‡ªæ—‹ï¼Œå†èµ°æ§½ç‚¹æœ‰å€¼çš„ put æµç¨‹ï¼Œè¿™é‡Œå°±æ˜¯è‡ªæ—‹ + CAS çš„ç»“åˆã€‚ æœ‰å…ƒç´  é”ä½å½“å‰ç‚¹ ï¼ˆsynchronizedï¼‰3âƒ£ï¸ put æ—¶ï¼Œå¦‚æœå½“å‰æ§½ç‚¹æœ‰å€¼ï¼Œå°±æ˜¯ key çš„ hash å†²çªçš„æƒ…å†µï¼Œæ­¤æ—¶æ§½ç‚¹ä¸Šå¯èƒ½æ˜¯é“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼Œ æˆ‘ä»¬é€šè¿‡é”ä½æ§½ç‚¹ï¼Œæ¥ä¿è¯åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹æ§½ç‚¹è¿›è¡Œä¿®æ”¹ çº¢é»‘æ ‘æ—‹è½¬æ—¶ï¼Œ é”ä½çº¢é»‘æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œä¿è¯åŒä¸€æ—¶åˆ»ï¼Œå½“å‰çº¢é»‘æ ‘åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ—‹è½¬ 4âƒ£ï¸ æ‰©å®¹æ—¶çš„çº¿ç¨‹å®‰å…¨æªæ–½ConcurrentHashMap çš„æ‰©å®¹æ—¶æœºå’Œ HashMap ç›¸åŒï¼Œéƒ½æ˜¯åœ¨ put æ–¹æ³•çš„æœ€åä¸€æ­¥æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰© å®¹ï¼Œå¦‚æœéœ€è¦åˆ™è¿›è¡Œæ‰©å®¹ï¼Œä½†ä¸¤è€…æ‰©å®¹çš„è¿‡ç¨‹å®Œå…¨ä¸åŒï¼ŒConcurrentHashMap æ‰©å®¹çš„æ–¹æ³•å«åš transferï¼Œä» put æ–¹æ³•çš„ addCount æ–¹æ³•è¿›å»ï¼Œå°±èƒ½æ‰¾åˆ° transfer æ–¹æ³• private final void addCount(long x, int check) { CounterCell[] as; long b, s; // è¿™é‡Œä½¿ç”¨çš„æ€æƒ³è·ŸLongAdderç±»æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼ˆåé¢ä¼šè®²ï¼‰ // æŠŠæ•°ç»„çš„å¤§å°å­˜å‚¨æ ¹æ®ä¸åŒçš„çº¿ç¨‹å­˜å‚¨åˆ°ä¸åŒçš„æ®µä¸Šï¼ˆä¹Ÿæ˜¯åˆ†æ®µé”çš„æ€æƒ³ï¼‰ // å¹¶ä¸”æœ‰ä¸€ä¸ªbaseCountï¼Œä¼˜å…ˆæ›´æ–°baseCountï¼Œå¦‚æœå¤±è´¥äº†å†æ›´æ–°ä¸åŒçº¿ç¨‹å¯¹åº”çš„æ®µ // è¿™æ ·å¯ä»¥ä¿è¯å°½é‡å°çš„å‡å°‘å†²çª // å…ˆå°è¯•æŠŠæ•°é‡åŠ åˆ°baseCountä¸Šï¼Œå¦‚æœå¤±è´¥å†åŠ åˆ°åˆ†æ®µçš„CounterCellä¸Š if ((as = counterCells) != null || !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x)) { CounterCell a; long v; int m; boolean uncontended = true; if (as == null || (m = as.length - 1) &lt; 0 || (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null || !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) { fullAddCount(x, uncontended); return; } if (check &lt;= 1) return; s = sumCount(); } if (check &gt;= 0) { Node&lt;K,V&gt;[] tab, nt; int n, sc; while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp; (n = tab.length) &lt; MAXIMUM_CAPACITY) { int rs = resizeStamp(n); if (sc &lt; 0) { if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); } else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); s = sumCount(); } } } // çœŸæ­£è§¦å‘æ‰©å®¹çš„æ–¹å¼ // æ‰©å®¹ä¸»è¦åˆ† 2 æ­¥ï¼Œ // 1. ç¬¬ä¸€æ–°å»ºæ–°çš„ç©ºæ•°ç»„ï¼Œ // 2. ç¬¬äºŒç§»åŠ¨æ‹·è´æ¯ä¸ªå…ƒç´ åˆ°æ–°æ•°ç»„ä¸­å» // tab:åŸæ•°ç»„ï¼ŒnextTab:æ–°æ•°ç»„ private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) { // è€æ•°ç»„çš„é•¿åº¦ int n = tab.length, stride; if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) stride = MIN_TRANSFER_STRIDE; // subdivide range // å¦‚æœæ–°æ•°ç»„ä¸ºç©ºï¼Œåˆå§‹åŒ–ï¼Œå¤§å°ä¸ºåŸæ•°ç»„çš„ä¸¤å€ï¼Œn &lt;&lt; 1 if (nextTab == null) { // initiating try { @SuppressWarnings(\"unchecked\") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; } catch (Throwable ex) { // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; } nextTable = nextTab; transferIndex = n; } // æ–°çš„tableé•¿åº¦ int nextn = nextTab.length; // ä»£è¡¨è½¬ç§»èŠ‚ç‚¹ï¼Œå¦‚æœåŸæ•°ç»„ä¸Šæ˜¯è½¬ç§»èŠ‚ç‚¹ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹æ­£åœ¨è¢«æ‰©å®¹ (nodeçš„hashå€¼ä¸º-1) ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); boolean advance = true; boolean finishing = false; // to ensure sweep before committing nextTab // æ— é™è‡ªæ—‹ï¼Œi çš„å€¼ä¼šä»åŸæ•°ç»„çš„æœ€å¤§å€¼å¼€å§‹ï¼Œæ…¢æ…¢é€’å‡åˆ° 0 for (int i = 0, bound = 0;;) { Node&lt;K,V&gt; f; int fh; while (advance) { int nextIndex, nextBound; // ç»“æŸå¾ªç¯çš„æ ‡å¿— if (--i &gt;= bound || finishing) advance = false; // å·²ç»æ‹·è´å®Œæˆ else if ((nextIndex = transferIndex) &lt;= 0) { i = -1; advance = false; } // æ¯æ¬¡å‡å°‘ i çš„å€¼ else if (U.compareAndSwapInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) { bound = nextBound; i = nextIndex - 1; advance = false; } } // if ä»»æ„æ¡ä»¶æ»¡è¶³è¯´æ˜æ‹·è´ç»“æŸäº† if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) { int sc; // æ‹·è´ç»“æŸï¼Œç›´æ¥èµ‹å€¼ï¼Œå› ä¸ºæ¯æ¬¡æ‹·è´å®Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½åœ¨åŸæ•°ç»„ä¸Šæ”¾è½¬ç§»èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ‹· è´å®Œæˆçš„èŠ‚ç‚¹çš„æ•°æ®ä¸€å®šä¸ä¼šå†å‘ç”Ÿå˜åŒ–ã€‚ // åŸæ•°ç»„å‘ç°æ˜¯è½¬ç§»èŠ‚ç‚¹ï¼Œæ˜¯ä¸ä¼šæ“ä½œçš„ï¼Œä¼šä¸€ç›´ç­‰å¾…è½¬ç§»èŠ‚ç‚¹æ¶ˆå¤±ä¹‹ååœ¨è¿›è¡Œæ“ä½œã€‚ // ä¹Ÿå°±æ˜¯è¯´æ•°ç»„èŠ‚ç‚¹ä¸€æ—¦è¢«æ ‡è®°ä¸ºè½¬ç§»èŠ‚ç‚¹ï¼Œæ˜¯ä¸ä¼šå†å‘ç”Ÿä»»ä½•å˜åŠ¨çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»» ä½•çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ // æ‰€ä»¥æ­¤å¤„ç›´æ¥èµ‹å€¼ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ if (finishing) { nextTable = null; table = nextTab; sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); return; } if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) { if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) return; finishing = advance = true; i = n; // recheck before commit } } else if ((f = tabAt(tab, i)) == null) advance = casTabAt(tab, i, null, fwd); else if ((fh = f.hash) == MOVED) advance = true; // already processed else { // è¿›è¡ŒèŠ‚ç‚¹çš„æ‹·è´ synchronized (f) { if (tabAt(tab, i) == f) { Node&lt;K,V&gt; ln, hn; if (fh &gt;= 0) { int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) { int b = p.hash &amp; n; if (b != runBit) { runBit = b; lastRun = p; } } if (runBit == 0) { ln = lastRun; hn = null; } else { hn = lastRun; ln = null; } // æ¡¶å†…åªæœ‰çš„å•ä¸ªæ•°æ®ï¼Œ ç›´æ¥æ‹·è´ï¼Œä¸ºé“¾è¡¨ï¼Œå¾ªç¯å¤šæ¬¡å½¢æˆé“¾è¡¨æ‹·è´ for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) { int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); } // åœ¨æ–°æ•°ç»„ä½ç½®ä¸Šæ”¾ç½®æ‹·è´çš„å€¼ setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); // åœ¨è€æ•°ç»„ä½ç½®ä¸Šæ”¾ä¸Š ForwardingNode èŠ‚ç‚¹ // put æ—¶ï¼Œå‘ç°æ˜¯ ForwardingNode èŠ‚ç‚¹ï¼Œå°±ä¸ä¼šå†åŠ¨è¿™ä¸ªèŠ‚ç‚¹çš„æ•° setTabAt(tab, i, fwd); advance = true; } // çº¢é»‘æ ‘çš„æ‹·è´ else if (f instanceof TreeBin) { TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) { int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) { if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; } else { if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; } } ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; setTabAt(nextTab, i, ln); setTabAt(nextTab, i + n, hn); setTabAt(tab, i, fwd); advance = true; } } } } } } å°ç»“transferæ–¹æ³•çš„ä¸»è¦æ€è·¯ï¼š é¦–å…ˆéœ€è¦æŠŠè€æ•°ç»„çš„å€¼å…¨éƒ¨æ‹·è´åˆ°æ‰©å®¹ä¹‹åçš„æ–°æ•°ç»„ä¸Šï¼Œå…ˆä»æ•°ç»„çš„é˜Ÿå°¾å¼€å§‹æ‹·è´ æ‹·è´æ•°ç»„çš„æ§½ç‚¹æ—¶ï¼Œå…ˆæŠŠåŸæ•°ç»„æ§½ç‚¹é”ä½ï¼Œä¿è¯åŸæ•°ç»„æ§½ç‚¹ä¸èƒ½æ“ä½œï¼ŒæˆåŠŸæ‹·è´åˆ°æ–°æ•°ç»„æ—¶ï¼Œ æŠŠåŸæ•°ç»„æ§½ç‚¹èµ‹å€¼ä¸ºè½¬ç§»èŠ‚ç‚¹ è¿™æ—¶å¦‚æœæœ‰æ–°æ•°æ®æ­£å¥½éœ€è¦ put åˆ°æ­¤æ§½ç‚¹æ—¶ï¼Œå‘ç°æ§½ç‚¹ä¸ºè½¬ç§»èŠ‚ç‚¹ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œæ‰€ä»¥åœ¨ æ‰©å®¹å®Œæˆä¹‹å‰ï¼Œè¯¥æ§½ç‚¹å¯¹åº”çš„æ•°æ®æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„ ä»æ•°ç»„çš„å°¾éƒ¨æ‹·è´åˆ°å¤´éƒ¨ï¼Œæ¯æ‹·è´æˆåŠŸä¸€æ¬¡ï¼Œå°±æŠŠåŸæ•°ç»„ä¸­çš„èŠ‚ç‚¹è®¾ç½®æˆè½¬ç§»èŠ‚ç‚¹; ç›´åˆ°æ‰€æœ‰æ•°ç»„æ•°æ®éƒ½æ‹·è´åˆ°æ–°æ•°ç»„æ—¶ï¼Œç›´æ¥æŠŠæ–°æ•°ç»„æ•´ä¸ªèµ‹å€¼ç»™æ•°ç»„å®¹å™¨ï¼Œæ‹·è´å®Œæˆã€‚ é€šè¿‡åœ¨åŸæ•°ç»„ä¸Šè®¾ç½®è½¬ç§»èŠ‚ç‚¹ï¼Œput æ—¶ç¢°åˆ°è½¬ç§»èŠ‚ç‚¹æ—¶ä¼šç­‰å¾…æ‰©å®¹æˆ åŠŸä¹‹åæ‰èƒ½ put çš„ç­–ç•¥ï¼Œæ¥ä¿è¯äº†æ•´ä¸ªæ‰©å®¹è¿‡ç¨‹ä¸­è‚¯å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ•°ç»„çš„æ§½ç‚¹ä¸€æ—¦è¢«è®¾ ç½®æˆè½¬ç§»èŠ‚ç‚¹ï¼Œåœ¨æ²¡æœ‰æ‰©å®¹å®Œæˆä¹‹å‰ï¼Œæ˜¯æ— æ³•è¿›è¡Œæ“ä½œçš„ã€‚ ï¼ˆ1ï¼‰æ–°æ¡¶æ•°ç»„å¤§å°æ˜¯æ—§æ¡¶æ•°ç»„çš„ä¸¤å€ï¼› ï¼ˆ2ï¼‰è¿ç§»å…ƒç´ å…ˆä»é åçš„æ¡¶å¼€å§‹ï¼› ï¼ˆ3ï¼‰è¿ç§»å®Œæˆçš„æ¡¶åœ¨é‡Œé¢æ”¾ç½®ä¸€ForwardingNodeç±»å‹çš„å…ƒç´ ï¼Œæ ‡è®°è¯¥æ¡¶è¿ç§»å®Œæˆï¼› ï¼ˆ4ï¼‰è¿ç§»æ—¶æ ¹æ®hash&amp;næ˜¯å¦ç­‰äº0æŠŠæ¡¶ä¸­å…ƒç´ åˆ†åŒ–æˆä¸¤ä¸ªé“¾è¡¨æˆ–æ ‘ï¼› ï¼ˆ5ï¼‰ä½ä½é“¾è¡¨ï¼ˆæ ‘ï¼‰å­˜å‚¨åœ¨åŸæ¥çš„ä½ç½®ï¼› ï¼ˆ6ï¼‰é«˜ä»¬é“¾è¡¨ï¼ˆæ ‘ï¼‰å­˜å‚¨åœ¨åŸæ¥çš„ä½ç½®åŠ nçš„ä½ç½®ï¼› ï¼ˆ7ï¼‰è¿ç§»å…ƒç´ æ—¶ä¼šé”ä½å½“å‰æ¡¶ï¼Œä¹Ÿæ˜¯åˆ†æ®µé”çš„æ€æƒ³ï¼› æ”¹æŸ¥åˆ æ€»ç»“ï¼ˆ1ï¼‰ConcurrentHashMapæ˜¯HashMapçš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ï¼› ï¼ˆ2ï¼‰ConcurrentHashMapé‡‡ç”¨ï¼ˆæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼‰çš„ç»“æ„å­˜å‚¨å…ƒç´ ï¼› ï¼ˆ3ï¼‰ConcurrentHashMapç›¸æ¯”äºåŒæ ·çº¿ç¨‹å®‰å…¨çš„HashTableï¼Œæ•ˆç‡è¦é«˜å¾ˆå¤šï¼› ï¼ˆ4ï¼‰ConcurrentHashMapé‡‡ç”¨çš„é”æœ‰ synchronizedï¼ŒCASï¼Œè‡ªæ—‹é”ï¼Œåˆ†æ®µé”ï¼Œvolatileç­‰ï¼› ï¼ˆ5ï¼‰ConcurrentHashMapä¸­æ²¡æœ‰thresholdå’ŒloadFactorè¿™ä¸¤ä¸ªå­—æ®µï¼Œè€Œæ˜¯é‡‡ç”¨sizeCtlæ¥æ§åˆ¶ï¼› ï¼ˆ6ï¼‰sizeCtl = -1ï¼Œè¡¨ç¤ºæ­£åœ¨è¿›è¡Œåˆå§‹åŒ–ï¼› ï¼ˆ7ï¼‰sizeCtl = 0ï¼Œé»˜è®¤å€¼ï¼Œè¡¨ç¤ºåç»­åœ¨çœŸæ­£åˆå§‹åŒ–çš„æ—¶å€™ä½¿ç”¨é»˜è®¤å®¹é‡ï¼› ï¼ˆ8ï¼‰sizeCtl &gt; 0ï¼Œåœ¨åˆå§‹åŒ–ä¹‹å‰å­˜å‚¨çš„æ˜¯ä¼ å…¥çš„å®¹é‡ï¼Œåœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹åå­˜å‚¨çš„æ˜¯ä¸‹ä¸€æ¬¡çš„æ‰©å®¹é—¨æ§›ï¼› ï¼ˆ9ï¼‰sizeCtl = (resizeStamp &lt;&lt; 16) + (1 + nThreads)ï¼Œè¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ‰©å®¹ï¼Œé«˜ä½å­˜å‚¨æ‰©å®¹é‚®æˆ³ï¼Œä½ä½å­˜å‚¨æ‰©å®¹çº¿ç¨‹æ•°åŠ 1ï¼› ï¼ˆ10ï¼‰æ›´æ–°æ“ä½œæ—¶å¦‚æœæ­£åœ¨è¿›è¡Œæ‰©å®¹ï¼Œå½“å‰çº¿ç¨‹ååŠ©æ‰©å®¹ï¼› ï¼ˆ11ï¼‰æ›´æ–°æ“ä½œä¼šé‡‡ç”¨synchronizedé”ä½å½“å‰æ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯åˆ†æ®µé”çš„æ€æƒ³ï¼› ï¼ˆ12ï¼‰æ•´ä¸ªæ‰©å®¹è¿‡ç¨‹éƒ½æ˜¯é€šè¿‡CASæ§åˆ¶sizeCtlè¿™ä¸ªå­—æ®µæ¥è¿›è¡Œçš„ï¼Œè¿™å¾ˆå…³é”®ï¼› ï¼ˆ13ï¼‰è¿ç§»å®Œå…ƒç´ çš„æ¡¶ä¼šæ”¾ç½®ä¸€ä¸ªForwardingNodeèŠ‚ç‚¹ï¼Œä»¥æ ‡è¯†è¯¥æ¡¶è¿ç§»å®Œæ¯•ï¼› ï¼ˆ14ï¼‰å…ƒç´ ä¸ªæ•°çš„å­˜å‚¨ä¹Ÿæ˜¯é‡‡ç”¨çš„åˆ†æ®µæ€æƒ³ï¼Œç±»ä¼¼äºLongAdderçš„å®ç°ï¼› ï¼ˆ15ï¼‰å…ƒç´ ä¸ªæ•°çš„æ›´æ–°ä¼šæŠŠä¸åŒçš„çº¿ç¨‹hashåˆ°ä¸åŒçš„æ®µä¸Šï¼Œå‡å°‘èµ„æºäº‰ç”¨ï¼› ï¼ˆ16ï¼‰å…ƒç´ ä¸ªæ•°çš„æ›´æ–°å¦‚æœè¿˜æ˜¯å‡ºç°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°ä¸€ä¸ªæ®µï¼Œåˆ™ä¼šæ‰©å®¹æ®µï¼ˆCounterCellï¼‰ï¼› ï¼ˆ17ï¼‰è·å–å…ƒç´ ä¸ªæ•°æ˜¯æŠŠæ‰€æœ‰çš„æ®µï¼ˆåŒ…æ‹¬baseCountå’ŒCounterCellï¼‰ç›¸åŠ èµ·æ¥å¾—åˆ°çš„ï¼› ï¼ˆ18ï¼‰æŸ¥è¯¢æ“ä½œæ˜¯ä¸ä¼šåŠ é”çš„ï¼Œæ‰€ä»¥ConcurrentHashMapä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼› ï¼ˆ19ï¼‰ConcurrentHashMapä¸­ä¸èƒ½å­˜å‚¨keyæˆ–valueä¸ºnullçš„å…ƒç´ ï¼› ä¸€äº›æ€æƒ³ cas + è‡ªé€‰ ä¹è§‚é”çš„æ€æƒ³ï¼Œå‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´ åˆ†æ®µé”æ€æƒ³ï¼Œå‡å°‘åŒä¸€æ—¶é—´ ç«äº‰é”å¸¦æ¥çš„ä½æ•ˆé—®é¢˜ CounterCellï¼Œåˆ†æ®µå­˜å‚¨å…ƒç´ ï¼Œå‡å°‘å¤šçº¿ç¨‹åŒæ—¶æ›´æ–°ä¸€ä¸ªå­—æ®µå¸¦æ¥çš„ä½æ•ˆ å¤šçº¿ç¨‹ååŒè¿›è¡Œæ‰©å®¹","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"jdk","slug":"jdk","permalink":"https://winniekun.github.io/tags/jdk/"}]},{"title":"kafka-consumer-note","slug":"ä¸­é—´ä»¶/kafka-consumer-note","date":"2021-07-02T08:32:01.000Z","updated":"2021-08-28T05:45:49.455Z","comments":true,"path":"kafka-consumer-note/","link":"","permalink":"https://winniekun.github.io/kafka-consumer-note/","excerpt":"","text":"Mathjax$m_i = a ^ {21}$","categories":[{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://winniekun.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://winniekun.github.io/tags/kafka/"}]},{"title":"ThreadLocalæºç è§£è¯»","slug":"æºç /JDK/lang/threadlocal-analysis","date":"2021-05-27T13:21:59.000Z","updated":"2021-09-08T13:19:53.637Z","comments":true,"path":"threadlocal-analysis/","link":"","permalink":"https://winniekun.github.io/threadlocal-analysis/","excerpt":"","text":"åºå¤šçº¿ç¨‹å…±äº«å¯å˜æ•°æ®æ—¶ï¼Œæ¶‰åŠåˆ°çº¿ç¨‹è§åŒæ­¥çš„é—®é¢˜ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ—¶å€™ï¼Œéƒ½è¦ç”¨åˆ°å…±äº«æ•°æ®ï¼Œæ‰€ä»¥å°±éœ€è¦çº¿ç¨‹å°é—­å‡ºåœºäº†ã€‚æ•°æ®éƒ½è¢«å°é—­åœ¨å„è‡ªçš„çº¿ç¨‹ä¹‹ä¸­ï¼Œå°±ä¸éœ€è¦è¿›è¡ŒåŒæ­¥ï¼Œè¿™ç§é€šè¿‡å°†æ•°æ®å°é—­åœ¨çº¿ç¨‹å†…è€Œé¿å…ä½¿ç”¨åŒæ­¥çš„æŠ€æœ¯ç§°ä¹‹ä¸ºçº¿ç¨‹å°é—­ã€‚ é€‚ç”¨åœºæ™¯ çº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Œå„çº¿ç¨‹çš„ ThreadLocal äº’ä¸å½±å“ æ–¹ä¾¿åŒä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸä¸€å¯¹è±¡ï¼Œé¿å…ä¸å¿…è¦çš„å‚æ•°ä¼ é€’ å…¨é“¾è·¯è¿½è¸ªä¸­çš„ traceId æˆ–è€…æµç¨‹å¼•æ“ä¸­ä¸Šä¸‹æ–‡çš„ä¼ é€’ä¸€èˆ¬é‡‡ç”¨ ThreadLocal Spring äº‹åŠ¡ç®¡ç†å™¨é‡‡ç”¨äº† ThreadLocal Spring MVC çš„ RequestContextHolder çš„å®ç°ä½¿ç”¨äº† ThreadLocal Demopublic class ThreadLocalDemo { public static final ThreadLocal&lt;String&gt; THREAD_LOCAL = new ThreadLocal&lt;&gt;(); public static final ThreadLocal&lt;String&gt; THREAD_LOCAL_NEXT = new ThreadLocal&lt;&gt;(); @Test public void demo() { new ThreadLocalDemo().threadLocalTest(); } public void threadLocalTest() { THREAD_LOCAL.set(\"wkk\"); THREAD_LOCAL_NEXT.set(\"cjsq\"); String v = THREAD_LOCAL.get(); String v2 = THREAD_LOCAL_NEXT.get(); System.out.println(\"å­çº¿ç¨‹ æ‰§è¡Œå‰ï¼Œ \" + Thread.currentThread().getName() + \"çº¿ç¨‹å–åˆ°çš„å€¼ï¼š\" + v + \" \" + v2); Thread child = new Thread(new Runnable() { @Override public void run() { String v = THREAD_LOCAL.get(); String v2 = THREAD_LOCAL_NEXT.get(); System.out.println(Thread.currentThread().getName() + \"çº¿ç¨‹å–åˆ°çš„å€¼ï¼š\" + v + v2); // è®¾ç½® threadLocal THREAD_LOCAL.set(\"hhh\"); THREAD_LOCAL_NEXT.set(\"cjpl\"); v = THREAD_LOCAL.get(); v2 = THREAD_LOCAL_NEXT.get(); System.out.println(\"é‡æ–°è®¾ç½®ä¹‹åï¼Œ\" + Thread.currentThread().getName() + \"çº¿ç¨‹å–åˆ°çš„å€¼ä¸ºï¼š\" + v + \" \" + v2); System.out.println(Thread.currentThread().getName() + \"çº¿ç¨‹æ‰§è¡Œç»“æŸ\"); } }, \"å­çº¿ç¨‹\"); child.start(); try { child.join(); } catch (InterruptedException e) { e.printStackTrace(); } v = THREAD_LOCAL.get(); v2 = THREAD_LOCAL_NEXT.get(); System.out.println(\"å­çº¿ç¨‹çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œ\" + Thread.currentThread().getName() + \"çº¿ç¨‹å–åˆ°çš„å€¼ï¼š\" + v + \" \" + v2); } } è¾“å‡º å­çº¿ç¨‹ æ‰§è¡Œå‰ï¼Œ mainçº¿ç¨‹å–åˆ°çš„å€¼ï¼šwkk cjsq å­çº¿ç¨‹çº¿ç¨‹å–åˆ°çš„å€¼ï¼šnullnull é‡æ–°è®¾ç½®ä¹‹åï¼Œå­çº¿ç¨‹çº¿ç¨‹å–åˆ°çš„å€¼ä¸ºï¼šhhh cjpl å­çº¿ç¨‹çº¿ç¨‹æ‰§è¡Œç»“æŸ å­çº¿ç¨‹çº¿ç¨‹æ‰§è¡Œä¹‹åï¼Œmainçº¿ç¨‹å–åˆ°çš„å€¼ï¼šwkk cjsq æºç è§£è¯»é‡è¦å±æ€§// Threadç±» ThreadLocal.ThreadLocalMap threadLocals = null; // å½“å‰threadlocalçš„hashcode // ç”¨äºç”¨äºè®¡ç®—è¯¥ThreadLocalåœ¨çº¿ç¨‹çš„threadlocalsï¼ˆmapï¼‰ä¸­çš„ç´¢å¼•ä½ç½® private final int threadLocalHashCode = nextHashCode(); // hashè¡¨çš„é˜ˆå€¼ï¼Œé»„é‡‘åˆ†å‰²æ¯” private static final int HASH_INCREMENT = 0x61c88647; // ä¿è¯äº†åœ¨ä¸€å°æœºå™¨ä¸­æ¯ä¸ª ThreadLocal çš„ threadLocalHashCode æ˜¯å”¯ä¸€çš„ private static AtomicInteger nextHashCode = new AtomicInteger(); // ç”¨äºå½“å‰threadlocalçš„hashcode private static int nextHashCode() { return nextHashCode.getAndAdd(HASH_INCREMENT); } // åˆå§‹è¯çš„æ“ä½œ protected T initialValue() { return null; } // lambdaçš„åˆå§‹åŒ–å®ç° public static &lt;S&gt; ThreadLocal&lt;S&gt; withInitial(Supplier&lt;? extends S&gt; supplier) { return new SuppliedThreadLocal&lt;&gt;(supplier); } HashCodeæ•£åˆ—æˆæœéªŒè¯å¯ä»¥é€šè¿‡å’ŒStringçš„hashcodeåšä¸ªå¯¹æ¯”ï¼Œç„¶åéªŒè¯å…¶ä½¿ç”¨è¿™ç§æ–¹å¼çš„hashç»“æœå¦‚ä½• private static AtomicInteger nextHashCode = new AtomicInteger(); private static final int HASH_INCREMENT = 0x61c88647; private static final int SIZE = 32; private static int nextHashCode() { return nextHashCode.getAndAdd(HASH_INCREMENT); } @Test public void test_idx() { int hashCode = 0; Set&lt;Integer&gt; setThreadLocal = new HashSet&lt;&gt;(); Set&lt;Integer&gt; setNormal = new HashSet&lt;&gt;(); for (int i = 0; i &lt; SIZE; i++) { hashCode = nextHashCode(); int threadLocalHashCode = hashCode &amp; (SIZE - 1); int normalHashCode = String.valueOf(i).hashCode() &amp; (SIZE - 1); setThreadLocal.add(threadLocalHashCode); setNormal.add(normalHashCode); System.out.println(i + \" ThreadLocalçš„æ•£åˆ—ï¼š\" + threadLocalHashCode + \" æ™®é€šæ•£åˆ—ï¼š\" + normalHashCode); } double threadLocalRate = setThreadLocal.size() / (double)SIZE * 100; double normalRate = setNormal.size() / (double)SIZE * 100; System.out.println(\"ThreadLocalçš„æ•£åˆ—ï¼š\" + threadLocalRate + \"% \" + \" æ™®é€šæ•£åˆ—ï¼š\" + normalRate + \"% \"); } // ThreadLocalçš„æ•£åˆ—ï¼š100.0% æ™®é€šæ•£åˆ—ï¼š68.75% å½¢è±¡ç†è§£ ThreadLocalå½¢è±¡ç†è§£ å¦‚æœç±»æ¯”ä¸ºHashMapçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†threadlocalç±»æ¯”ä¸ºkeyï¼Œç„¶åè¢«å°é—­çš„æ•°æ®ç±»æ¯”ä¸ºvalueã€‚ä¸è¿‡ç¨å¾®ä¸åŒçš„æ˜¯ï¼Œhashmapä¸­å°†keyå’Œvalueåšæ˜ å°„çš„æ“ä½œæ˜¯map.put(key, value)ï¼Œè€Œthreadlocalsä¸­ï¼Œå°†threadlocalå’Œè¢«å°é—­çš„æ•°æ®åšæ˜ å°„çš„æ“ä½œæ˜¯threadlocal.set(xxx)ã€‚ æ€è·¯è½¬æ¢emmmmæ€ä¹ˆè¯´å‘¢ï¼Œå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨æ™®é€šmapçš„æ—¶å€™ï¼Œæ“ä½œçš„æ˜¯ä¸€ä¸ªmapï¼Œè·å–keyçš„valueæ—¶ï¼Œç›´æ¥é€šè¿‡map.get()å³å¯ã€‚ ä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨threadlocalæ—¶ï¼Œå…¶æœ¬èº«æ˜¯ä¸€ä¸ªkeyï¼Œæ€ä¹ˆè·å–å¯¹åº”çš„valueå‘¢ï¼Ÿ å…ˆè·å–mapï¼ˆæ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„mapï¼Œæ‰€ä»¥æ ¹æ®å½“å‰çº¿ç¨‹è·å–mapï¼‰ ç„¶åé€šè¿‡map.get(key)è·å–value è¿”å›value ThreadLocalMapstatic class ThreadLocalMap { /** * The entries in this hash map extend WeakReference, using * its main ref field as the key (which is always a * ThreadLocal object). Note that null keys (i.e. entry.get() * == null) mean that the key is no longer referenced, so the * entry can be expunged from table. Such entries are referred to * as \"stale entries\" in the code that follows. */ static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; { /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) { super(k); value = v; } } // ä¸‹é¢çš„æˆå‘˜å˜é‡å’ŒhashmapåŒç† // åˆå§‹åŒ–å®¹é‡ private static final int INITIAL_CAPACITY = 16; // å­˜å‚¨ThreadLocalçš„é”®å€¼å¯¹ï¼Œé•¿åº¦ä¸º2çš„å¹‚æ¬¡ private Entry[] table; /** * The number of entries in the table. */ private int size = 0; /** * The next size value at which to resize. */ private int threshold; // Default to 0 } ThreadLocalMapå°±æ˜¯ä¸€ä¸ªmapï¼Œå’Œhashmapç±»ä¼¼ï¼Œä¸è¿‡æœ‰äº›æœºåˆ¶ä¸åŒã€‚ hashå†²çªè§£å†³æ–¹å¼ ThreadLocalMapå¤„ç†hashå†²çªçš„æ–¹å¼ä¸ºçº¿å‹æ¢æµ‹ HashMapä½¿ç”¨çš„æ˜¯æ‹‰é“¾æ³• ThreadLocalå†…å­˜æ³„æ¼æ ¹æ®æ³¨é‡Šå’Œä»£ç ï¼Œäº†è§£åˆ°äº†ThreadLocalMapå†…éƒ¨çš„æ¯ä¸ªentryä¸­ï¼Œkeyè®¾ç½®ä¸ºå¼±å¼•ç”¨çš„åŸå› ï¼Œä¸è¿‡valueè¿˜æ˜¯æ­£å¸¸çš„å¼•ç”¨ã€‚è¿™ä¹Ÿå°±å¯¼è‡´äº†å¦‚æœThreadLocalæ²¡æœ‰å¤–éƒ¨çš„å¼ºå¼•ç”¨æ—¶ï¼Œåªè¦å‘ç”ŸGCï¼Œå°±ä¼šè¢«å›æ”¶ã€‚è¿™æ ·ThreadMapä¸­çš„keyå°±å˜æˆäº†nullï¼Œä½†æ˜¯valueè¢«Entryå¼•ç”¨ï¼ŒEntryè¢«ThreadLocalMapå¼•ç”¨ï¼ŒThreadLocalMapè¢«Threadå¼•ç”¨ï¼Œè¿™ä¹Ÿå°±è¯´æ˜äº†åªè¦ï¼Œçº¿ç¨‹ä¸ç»ˆæ­¢ï¼Œvalueçš„å€¼ä¸€ç›´æ— æ³•è¢«å›æ”¶ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°å†…å­˜æ³„æ¼çš„ç°è±¡ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåœ¨éœ€è¦ä½¿ç”¨threadlocalä¹‹åï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨removeæ‰ã€‚é˜²æ­¢ ThreadLocalMap ä¸­ Entry ä¸€ç›´ä¿æŒå¯¹ value çš„å¼ºå¼•ç”¨ï¼Œå¯¼è‡´ value ä¸èƒ½è¢«å›æ”¶ removepublic void remove() { ThreadLocalMap m = getMap(Thread.currentThread()); if (m != null) m.remove(this); } // æ ¹æ®å½“å‰çº¿ç¨‹è·å–å…¶map ThreadLocalMap getMap(Thread t) { return t.threadLocals; } // å› ä¸ºä½¿ç”¨çš„çº¿å‹æ¢æµ‹æ³• // æ‰€ä»¥è¦é‡‡ç”¨çº¿å‹æ¢æµ‹æ³•æ‰¾åˆ°å¯¹åº”çš„ä½ç½® private void remove(ThreadLocal&lt;?&gt; key) { Entry[] tab = table; int len = tab.length; // æ ¹æ®threadlocalè·å–å…¶hashcodeå€¼ int i = key.threadLocalHashCode &amp; (len-1); for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { if (e.get() == key) { e.clear(); expungeStaleEntry(i); return; } } } private static int nextIndex(int i, int len) { return ((i + 1 &lt; len) ? i + 1 : 0); } private int expungeStaleEntry(int staleSlot) { Entry[] tab = table; int len = tab.length; // expunge entry at staleSlot tab[staleSlot].value = null; tab[staleSlot] = null; size--; // Rehash until we encounter null Entry e; int i; for (i = nextIndex(staleSlot, len); (e = tab[i]) != null; i = nextIndex(i, len)) { ThreadLocal&lt;?&gt; k = e.get(); if (k == null) { e.value = null; tab[i] = null; size--; } else { int h = k.threadLocalHashCode &amp; (len - 1); if (h != i) { tab[i] = null; // Unlike Knuth 6.4 Algorithm R, we must scan until // null because multiple entries could have been stale. while (tab[h] != null) h = nextIndex(h, len); tab[h] = e; } } } return i; } é€šè¿‡å½“å‰çº¿ç¨‹è·å–è¯¥çº¿ç¨‹çš„map ç„¶åè°ƒç”¨map.removeæ–¹æ³• åç»­çš„ä»£ç åˆ†æä¸åŠ¨äº†ã€‚ã€‚ã€‚ set/** * Sets the current thread's copy of this thread-local variable * to the specified value. Most subclasses will have no need to * override this method, relying solely on the {@link #initialValue} * method to set the values of thread-locals. * * @param value the value to be stored in the current thread's copy of * this thread-local. */ public void set(T value) { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); } ThreadLocalMap getMap(Thread t) { return t.threadLocals; } setæ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠæˆ‘ä»¬æƒ³è¦å­˜å‚¨çš„valueç»™ä¿å­˜æ–¹æ³•ï¼Œåªè¦æµç¨‹æ˜¯ï¼š å…ˆè·å–å½“äº²çš„çº¿ç¨‹ æ ¹æ®å½“å‰çº¿ç¨‹è·å–è¯¥çº¿ç¨‹çš„map åˆ¤æ–­mapæ˜¯å¦ä¸ºç©º ä¸ºç©º åˆ›å»ºmap ä¸ä¸ºç©º åœ¨mapä¸­æ”¾å…¥å…ƒç´  set(ThreadLcoal&lt;?&gt; key, Object value)// åœ¨mapä¸­å­˜å‚¨é”®å€¼å¯¹&lt;key, value&gt; private void set(ThreadLocal&lt;?&gt; key, Object value) { Entry[] tab = table; int len = tab.length; int i = key.threadLocalHashCode &amp; (len-1); // éå†ä¸€æ®µè¿ç»­çš„å…ƒç´ ï¼Œä»¥æŸ¥æ‰¾åŒ¹é…çš„ ThreadLocal å¯¹è±¡ for (Entry e = tab[i]; e != null; e = tab[i = nextIndex(i, len)]) { // / è·å–è¯¥å“ˆå¸Œå€¼å¤„çš„ThreadLocalå¯¹è±¡ ThreadLocal&lt;?&gt; k = e.get(); // é”®å€¼ThreadLocalåŒ¹é…ï¼Œç›´æ¥æ›´æ”¹mapä¸­çš„value if (k == key) { e.value = value; return; } // è‹¥ key æ˜¯ nullï¼Œè¯´æ˜ ThreadLocal è¢«æ¸…ç†äº†ï¼Œç›´æ¥æ›¿æ¢æ‰ if (k == null) { replaceStaleEntry(key, value, i); return; } } // ç›´åˆ°é‡è§äº†ç©ºæ§½ä¹Ÿæ²¡æ‰¾åˆ°åŒ¹é…çš„ThreadLocalå¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨æ­¤ç©ºæ§½å¤„å®‰æ’ThreadLocalå¯¹è±¡å’Œç¼“å­˜çš„value tab[i] = new Entry(key, value); int sz = ++size; if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold) rehash(); } é€šè¿‡è¿™ä¸¤ç§setæ–¹å¼ï¼Œå°±æ›´åŠ è¯æ˜äº†æ€è·¯çš„è½¬æ¢ï¼Œæˆ‘ä»¬åœ¨setæ—¶ï¼Œéƒ½éœ€è¦å…ˆè·å–å½“å‰çº¿ç¨‹è·å–mapï¼Œç„¶åå†å¯¹æ•´ä¸ªmapéå†ç„¶åæ”¾å…¥valueã€æˆ–è€…ç›´æ¥æ”¾å…¥keyã€value getpublic T get() { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) { ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) { @SuppressWarnings(\"unchecked\") T result = (T)e.value; return result; } } return setInitialValue(); } // æ ¹æ®threadlocalè·å–entry private Entry getEntry(ThreadLocal&lt;?&gt; key) { // è®¡ç®—hashcodeï¼Œç„¶åè·å–å¯¹åº”çš„ç´¢å¼•ä½ç½® int i = key.threadLocalHashCode &amp; (table.length - 1); // æ ¹æ®ç´¢å¼•ä½ç½®è·å–å¯¹åº”çš„entry Entry e = table[i]; if (e != null &amp;&amp; e.get() == key) return e; else return getEntryAfterMiss(key, i, e); } private T setInitialValue() { T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value; } å…ˆè·å–å½“å‰çº¿ç¨‹ è·å–å½“å‰çº¿ç¨‹çš„map map != null é€šè¿‡keyç›´æ¥è·å–å¯¹åº”entry è¿”å›entry.value map == null åˆå§‹åŒ–map æ€»ç»“threadlocalæœ¬è´¨å±äºæŸç§mapçš„ä¸€ä¸ªkeyå€¼ï¼Œåªä¸è¿‡è¯¥å€¼é€šè¿‡æ³›å‹å®ç°ï¼Œæ”¯æŒå„ç§ç±»å‹ã€‚å’ŒåŸºç¡€çš„mapä¸åŒçš„æ˜¯ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡key.set(value)å®ç°key-valueçš„æ˜ å°„ã€‚è€Œè¿™ç§ç‰¹æ®Šçš„mapæ˜¯å±äºThreadçº§åˆ«çš„æˆå‘˜å˜é‡ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´è¯¥å˜é‡äº’ä¸å½±å“ï¼Œæ‰€ä»¥è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„çº¿ç¨‹æœ¬åœ°å­˜å‚¨åœ°æ–¹ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥keyæ˜¯è™šå¼•ç”¨ï¼Œéœ€è¦æ³¨æ„å†…å­˜æ³„éœ²çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨è¿‡threadlocalä¹‹åï¼Œè®°å¾—åŠæ—¶removeã€‚å†…éƒ¨çš„threadlocalmapå’Œhashmapçš„å®ç°æœºåˆ¶ç±»ä¼¼ï¼Œä¸è¿‡åŒºåˆ«å°±æ˜¯å¯¹äºhashå†²çªçš„è§£å†³æ–¹å¼ä¸ºçº¿å‹æ¢æµ‹ å†…å­˜æ³„éœ²é—®é¢˜ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼å†…å­˜æ³„æ¼æŒ‡çš„æ˜¯ï¼Œå½“æŸä¸€ä¸ªå¯¹è±¡ä¸å†æœ‰ç”¨çš„æ—¶å€™ï¼Œå ç”¨çš„å†…å­˜å´ä¸èƒ½è¢«å›æ”¶ï¼Œè¿™å°±å«ä½œå†…å­˜æ³„æ¼ã€‚ å› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ä¸å†æœ‰ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„åƒåœ¾å›æ”¶å™¨ GCï¼Œå°±åº”è¯¥æŠŠè¿™éƒ¨åˆ†å†…å­˜ç»™æ¸…ç†æ‰ã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥è®©è¿™éƒ¨åˆ†å†…å­˜åç»­é‡æ–°åˆ†é…åˆ°å…¶ä»–çš„åœ°æ–¹å»ä½¿ç”¨ï¼›å¦åˆ™ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰ç”¨ï¼Œä½†ä¸€ç›´ä¸èƒ½è¢«å›æ”¶ï¼Œè¿™æ ·çš„åƒåœ¾å¯¹è±¡å¦‚æœç§¯ç´¯çš„è¶Šæ¥è¶Šå¤šï¼Œåˆ™ä¼šå¯¼è‡´æˆ‘ä»¬å¯ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå°‘ï¼Œæœ€åå‘ç”Ÿå†…å­˜ä¸å¤Ÿç”¨çš„ OOM é”™è¯¯ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼Œåœ¨ ThreadLocal ä¸­è¿™æ ·çš„å†…å­˜æ³„æ¼æ˜¯å¦‚ä½•å‘ç”Ÿçš„ã€‚ Key çš„æ³„æ¼åˆ†æäº† ThreadLocal çš„å†…éƒ¨ç»“æ„ä¹‹åï¼ŒçŸ¥é“äº†æ¯ä¸€ä¸ª Thread éƒ½æœ‰ä¸€ä¸ª ThreadLocal.ThreadLocalMap è¿™æ ·çš„ç±»å‹å˜é‡ï¼Œè¯¥å˜é‡çš„åå­—å«ä½œ threadLocalsã€‚çº¿ç¨‹åœ¨è®¿é—®äº† ThreadLocal ä¹‹åï¼Œéƒ½ä¼šåœ¨å®ƒçš„ ThreadLocalMap é‡Œé¢çš„ Entry ä¸­å»ç»´æŠ¤è¯¥ ThreadLocal å˜é‡ä¸å…·ä½“å®ä¾‹çš„æ˜ å°„ã€‚ æˆ‘ä»¬å¯èƒ½ä¼šåœ¨ä¸šåŠ¡ä»£ç ä¸­æ‰§è¡Œäº† ThreadLocal instance = null æ“ä½œï¼Œæƒ³æ¸…ç†æ‰è¿™ä¸ª ThreadLocal å®ä¾‹ï¼Œä½†æ˜¯å‡è®¾æˆ‘ä»¬åœ¨ ThreadLocalMap çš„ Entry ä¸­å¼ºå¼•ç”¨äº† ThreadLocal å®ä¾‹ï¼Œé‚£ä¹ˆï¼Œè™½ç„¶åœ¨ä¸šåŠ¡ä»£ç ä¸­æŠŠ ThreadLocal å®ä¾‹ç½®ä¸ºäº† nullï¼Œä½†æ˜¯åœ¨ Thread ç±»ä¸­ä¾ç„¶æœ‰è¿™ä¸ªå¼•ç”¨é“¾çš„å­˜åœ¨ã€‚ GC åœ¨åƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šè¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œå®ƒä¼šå‘ç°è¿™ä¸ª ThreadLocal å¯¹è±¡ä¾ç„¶æ˜¯å¯è¾¾çš„ï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸ª ThreadLocal å¯¹è±¡ä¸ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™æ ·çš„è¯å°±é€ æˆäº†å†…å­˜æ³„æ¼çš„æƒ…å†µã€‚ references Javaå¹¶å‘ç¼–ç¨‹ é¢è¯•å®˜ç³»ç»Ÿç²¾è®²Javaæºç åŠå¤§å‚çœŸé¢˜ Javaå¹¶å‘ç¼–ç¨‹78è®² ã€ç»†è°ˆJavaå¹¶å‘ã€‘è°ˆè°ˆThreadLocal ä¸€æ–‡ææ‡‚ ThreadLocal åŸç† ä¸ºä½•æ¯æ¬¡ç”¨å®Œ ThreadLocal éƒ½è¦è°ƒç”¨ remove()ï¼Ÿâ€”â€”å†…å­˜æ³„æ¼","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"lang","slug":"lang","permalink":"https://winniekun.github.io/tags/lang/"}]},{"title":"æ­»ç£•åŒæŒ‡é’ˆ","slug":"LeetCode/stick-to-two-pointer","date":"2021-05-27T09:10:30.000Z","updated":"2021-05-27T09:10:30.816Z","comments":true,"path":"stick-to-two-pointer/","link":"","permalink":"https://winniekun.github.io/stick-to-two-pointer/","excerpt":"","text":"åºåŒæŒ‡é’ˆï¼Œä¸€ä¸ªçœ‹äº†è„‘å­é‡Œå°±æœ‰ç”»é¢çš„ç®—æ³•æŠ€å·§ï¼Œä¸»è¦æ–¹å¼æœ‰ï¼š å¿«æ…¢æŒ‡é’ˆ è­¬å¦‚é“¾è¡¨ç¯ç³»åˆ—é—®é¢˜ è·å–é“¾è¡¨çš„ç¬¬Kä¸ªèŠ‚ç‚¹ åº”è¯¥ä¹Ÿå±äºå¿«æ…¢æŒ‡é’ˆå§ åªä¸è¿‡æ˜¯ä¸€ä¸ªæŒ‡é’ˆå…ˆç§»åŠ¨ä¸€å®šæ­¥é•¿ï¼Œç„¶åå¦ä¸€ä¸ªä¸¤ä¸ªæŒ‡é’ˆå†ä»¥åŒæ ·çš„é€Ÿåº¦ç§»åŠ¨ å¤´å°¾æŒ‡é’ˆ é€‚ç”¨äºæ•°ç»„å’Œå­—ç¬¦ä¸² æ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œç”¨äºä¼˜åŒ–éå†çš„æ—¶é—´å¤æ‚åº¦ æ»‘åŠ¨çª—å£ æ™®é€šæŒ‡é’ˆ26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹class Solution { public int removeDuplicates(int[] nums) { int i = 0; int N = nums.length; for (int j = 1; j &lt; N; j++) { if (nums[i] != nums[j]) { nums[++i] = nums[j]; } } return i + 1; } } // é€šæ³• class Solution { public int removeDuplicates(int[] nums) { return process(nums, 1); } int process(int[] nums, int k) { int idx = 0; for (int x : nums) { if (idx &lt; k || nums[idx - k] != x) nums[idx++] = x; } return idx; } } 80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ IIpublic int removeDuplicates(int[] nums) { return process(nums, 2); } private int process(int[] nums, int k) { int idx = 0; for (int x : nums) { if (idx &lt; k || nums[idx - k] != x) { nums[idx++] = x; } } return idx; } 283. ç§»åŠ¨é›¶88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„å½’å¹¶æ’åºçš„ä¸­çš„ä¸€ä¸ªæ­¥éª¤ å¿«æ…¢æŒ‡é’ˆç¯ç³»åˆ— 141. ç¯å½¢é“¾è¡¨public boolean hasCycle(ListNode head) { if (head == null) { return false; } ListNode fast = head; ListNode slow = head; while (fast != null &amp;&amp; fast.next != null) { fast = fast.next.next; slow = slow.next; if (fast == slow) { return true; } } return false; } 142. ç¯å½¢é“¾è¡¨ IIå¤´å°¾æŒ‡é’ˆå¯ä»¥ç†è§£ä¸ºå¯¹æ•´ä¸ªæ•°ç»„çš„æš´åŠ›æœç´¢çš„ä¼˜åŒ–ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ˜¯å¾—åˆ°æ‰€æœ‰çš„åŒºé—´kçš„å­æ•°ç»„ï¼Œç„¶åä¸€æ¬¡è®¡ç®—ç»“æœã€‚åŒæŒ‡é’ˆä¹‹åï¼Œå¯ä»¥åœ¨éå†çš„è¿‡ç¨‹å°±çš„å‡ºç»“æœï¼Œé¿å…çš„é‡å¤çš„éå†ï¼Œå¹¶ä¸”ä¼˜åŒ–çš„äº†éå†çš„æ—¶é—´å¤æ‚åº¦ 11. ç››æœ€å¤šæ°´çš„å®¹å™¨public int maxArea(int[] height) { // åŒæŒ‡é’ˆ(å¤´å°¾æŒ‡é’ˆ) int N = height.length; int left = 0; int right = N - 1; int area = 0; while (left &lt; right) { int hight = Math.min(height[left], height[right]); int innerArea = hight * (right - left); area = Math.max(area, innerArea); if (height[left] &lt; height[right]) { left++; } else { right--; } } return area; } 15. ä¸‰æ•°ä¹‹å’Œpublic List&lt;List&lt;Integer&gt;&gt; threeSum(int[] nums) { // æ€è·¯ // æ ¸å¿ƒæ€è·¯ï¼šåŒæŒ‡é’ˆ å¤´å°¾æŒ‡é’ˆ Arrays.sort(nums); List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); int N = nums.length; for (int i = 0; i &lt; N - 2; i++) { int rst = -nums[i]; int left = i + 1; int right = N - 1; if (i &gt; 0 &amp;&amp; nums[i] == nums[i - 1]) { continue; } while (left &lt; right) { int cur = nums[left] + nums[right]; if (cur == rst) { res.add(new ArrayList&lt;&gt;(Arrays.asList(nums[i], nums[left], nums[right]))); // å¤„ç†ååºé‡å¤çš„å…ƒç´  while (left &lt; right &amp;&amp; nums[left + 1] == nums[left]) { left++; } while (left &lt; right &amp;&amp; nums[right] == nums[right - 1]) { right--; } left++; right--; } else if (cur &gt; rst) { right--; } else { left++; } } } return res; } 16. æœ€æ¥è¿‘çš„ä¸‰æ•°ä¹‹å’Œå’Œä¸Šè¿°ç±»ä¼¼ï¼Œä¸è¿‡ä¸ç”¨è€ƒè™‘å…ƒç´ é‡å¤é—®é¢˜ï¼Œä½†æ˜¯éœ€è¦è€ƒè™‘æœ€è¿‘ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªå˜é‡ï¼Œç”¨äºæ£€æµ‹å½“å‰ç»“æœæ˜¯å¦æ¯”ä¹‹å‰æ›´å¥½ã€‚ public int threeSumClosest(int[] nums, int target) { int N = nums.length; Arrays.sort(nums); // å¦‚ä½•åˆ¤æ–­æœ€è¿‘ï¼Ÿ // min(closest, curDistance) int closest = Integer.MAX_VALUE; int res = nums[0] + nums[nums.length - 1] + nums[1]; for (int i = 0; i &lt; N - 2; i++) { int low = i + 1; int height = N - 1; while (low &lt; height) { int innerCur = nums[i] + nums[low] + nums[height]; if (innerCur &lt; target) { low++; } else if (innerCur &gt; target) { height--; } else { return target; } if (Math.abs(innerCur - target) &lt; closest) { closest = Math.abs(innerCur - target); res = innerCur; } } } return res; } 18. å››æ•°ä¹‹å’ŒåŒæ ·çš„æ€è·¯ï¼Œä¸è¿‡å¯ä»¥åšä¸€äº›ç»†èŠ‚å¤„ç†ï¼Œæå‰é€€å‡ºå¾ªç¯ã€‚ public List&lt;List&lt;Integer&gt;&gt; fourSum(int[] nums, int target) { List&lt;List&lt;Integer&gt;&gt; quadruplets = new ArrayList&lt;&gt;(); if (nums == null || nums.length &lt; 4) { return quadruplets; } Arrays.sort(nums); int length = nums.length; for (int i = 0; i &lt; length - 3; i++) { // é‡å¤ if (i &gt; 0 &amp;&amp; nums[i] == nums[i - 1]) { continue; } // ä¸ç¬¦åˆæ¡ä»¶ if (nums[i] + nums[i + 1] + nums[i + 2] + nums[i + 3] &gt; target) { break; } // ç»“æœå° if (nums[i] + nums[length - 3] + nums[length - 2] + nums[length - 1] &lt; target) { continue; } for (int j = i + 1; j &lt; length - 2; j++) { // é‡å¤ if (j &gt; i + 1 &amp;&amp; nums[j] == nums[j - 1]) { continue; } // ä¸ç¬¦åˆæ¡ä»¶ if (nums[i] + nums[j] + nums[j + 1] + nums[j + 2] &gt; target) { break; } // å¤ªå° if (nums[i] + nums[j] + nums[length - 2] + nums[length - 1] &lt; target) { continue; } int left = j + 1, right = length - 1; while (left &lt; right) { int sum = nums[i] + nums[j] + nums[left] + nums[right]; if (sum == target) { quadruplets.add(Arrays.asList(nums[i], nums[j], nums[left], nums[right])); while (left &lt; right &amp;&amp; nums[left] == nums[left + 1]) { left++; } left++; while (left &lt; right &amp;&amp; nums[right] == nums[right - 1]) { right--; } right--; } else if (sum &lt; target) { left++; } else { right--; } } } } return quadruplets; } 259. è¾ƒå°çš„ä¸‰æ•°ä¹‹å’Œpublic int threeSumSmaller(int[] nums, int target) { Arrays.sort(nums); int N = nums.length; int count = 0; for (int i = 0; i &lt; N - 2; i++) { int left = i + 1; int right = N - 1; while (left &lt; right) { int innerCur = nums[i] + nums[left] + nums[right]; if (innerCur &lt; target) { int innerCount = right - left; count += innerCount; left++; } else { right--; } } } return count; } 30. ä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²æ»‘åŠ¨çª—å£209. é•¿åº¦æœ€å°çš„å­æ•°ç»„public int minSubArrayLen(int target, int[] nums) { int N = nums.length; int left = 0; int right = 0; int ans = Integer.MAX_VALUE; int sum = 0; while (right &lt; N) { sum += nums[right]; while (left &lt;= right &amp;&amp; sum &gt;= target) { ans = Math.min(ans, right - left + 1); sum -= nums[left]; left++; } right++; } return ans == Integer.MAX_VALUE ? 0 : ans; } 713. ä¹˜ç§¯å°äºKçš„å­æ•°ç»„åŒæŒ‡é’ˆï¼ˆæ»‘åŠ¨çª—å£ï¼‰ï¼šleft å’Œ rightæŒ‡é’ˆå¼€å§‹æ—¶å‡æŒ‡å‘ numsæ•°ç»„çš„å¼€å¤´ã€‚ rightæŒ‡é’ˆéå† numsæ•°ç»„ï¼Œæ¯éå†ä¸€ä¸ªå…ƒç´ å°±æ›´æ–°ä¸€æ¬¡ä¹˜ç§¯ï¼Œå³ product = product * nums[right]ï¼š è‹¥å½“å‰æ›´æ–°åçš„ product &lt; kï¼Œåˆ™ç›´æ¥ç»Ÿè®¡å½“å‰çª—å£ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼ˆè¿™æ°å¥½å°±æ˜¯å½“å‰å­æ•°ç»„ä¸­ç¬¦åˆæ¡ä»¶çš„å…¨éƒ¨å­é›†ä¸ªæ•°ï¼‰ æˆ‘ä»¬æ¯æ¬¡éƒ½ç»Ÿè®¡ä»¥nums[right]ä¸ºç»“å°¾ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„ä¸ªæ•° è‹¥æ›´æ–°åçš„ product &gt;= kï¼Œåˆ™æ­¤æ—¶éœ€è¦ç¼©å°çª—å£çš„å¤§å°ï¼Œå³ä»¤å½“å‰ product é™¤ä»¥å½“å‰ left æŒ‡é’ˆæŒ‡å‘çš„å…ƒç´ å€¼ï¼Œç„¶åä»¤ leftæŒ‡é’ˆå³ç§»ä¸€ä½ï¼Œç›´åˆ°å½“å‰çš„ produc &lt; k ä¸ºæ­¢ï¼Œç„¶åç»Ÿè®¡å½“å‰çª—å£ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œå³ä¸ºæ­¤æ—¶ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„çš„ä¸ªæ•°ï¼Œç»§ç»­ä»¤ right æŒ‡é’ˆå³ç§»ã€‚ å¦‚æ­¤åå¤ï¼Œç›´åˆ° right æŒ‡é’ˆæŒ‡å‘ nums æ•°ç»„çš„æœ«å°¾ä¸ºæ­¢ã€‚ public int numSubarrayProductLessThanK(int[] nums, int k) { // æ»‘åŠ¨çª—å£ int N = nums.length; int left = 0; int sum = 1; int count = 0; for (int right = 0; right &lt; N; right++) { sum *= nums[right]; while (left &lt;= right &amp;&amp; sum &gt;= k) { sum /= nums[left]; left++; } count += right - left + 1; } return count; }","categories":[{"name":"leetcode","slug":"leetcode","permalink":"https://winniekun.github.io/categories/leetcode/"}],"tags":[{"name":"åŒæŒ‡é’ˆ","slug":"åŒæŒ‡é’ˆ","permalink":"https://winniekun.github.io/tags/%E5%8F%8C%E6%8C%87%E9%92%88/"}]},{"title":"PriorityQueueæºç è§£è¯»","slug":"æºç /JDK/queue/PriorityQueue-analysis","date":"2021-05-22T12:00:56.000Z","updated":"2021-05-23T12:10:46.393Z","comments":true,"path":"PriorityQueue-analysis/","link":"","permalink":"https://winniekun.github.io/PriorityQueue-analysis/","excerpt":"PriorityQueueæºç è§£è¯»","text":"PriorityQueueæºç è§£è¯» ä¼˜å…ˆé˜Ÿåˆ—, é¡¾åæ€ä¹‰å°±æ˜¯æŒ‰ç…§å…ƒç´ çš„ä¼˜å…ˆçº§è¿›è¡Œå¼¹å‡ºç­‰æ“ä½œ, é‚£ä¹ˆåœ¨JDKä¸­ä½¿ç”¨ä½•ç§æ•°æ®ç»“æ„æ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—å˜, Letâ€™s Go ä¾èµ– PriorityQueue emmm, æ„Ÿè§‰ä»ä¾èµ–ä¸Šæ¥çœ‹, å’Œå…¶ä»–çš„é›†åˆç±»ä¸€æ ·, å®ç°å…¶å¯¹åº”çš„æ¥å£(Marker Interfaceçš„ä½œç”¨?) åŸºç¡€åœ¨é˜…è¯»åŸºç¡€çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å †ï¼Œå…¶æ•°æ®ç»“æ„æ˜¯å•¥ï¼Œæœ‰å“ªäº›å­˜å‚¨æ–¹å¼ã€‚ å †çš„åº•å±‚æ•°æ®ç»“æ„ä¸ºå®Œå…¨äºŒå‰æ ‘ å­˜å‚¨æ–¹å¼ï¼ˆæ—¢ç„¶æ˜¯äºŒå‰æ ‘ï¼Œé‚£ä¹ˆå…¶å­˜å‚¨æ–¹å¼ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§ï¼‰ é¡ºåºå­˜å‚¨ç»“æ„ æ ¹èŠ‚ç‚¹ä¸‹æ ‡ä¸º0 è‹¥èŠ‚ç‚¹pçš„ä¸‹æ ‡ä¸º$i$ï¼Œåˆ™å·¦å­©å­$2\\cdot i$ å³å­©å­ä¸º$2 \\cdot i + 1$ è‹¥èŠ‚ç‚¹pçš„ä¸‹æ ‡ä¸º$i$ï¼Œåˆ™çˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡ä¸º$\\lfloor i/2\\rfloor$ é“¾å¼å­˜å‚¨ç»“æ„ æ ‘çš„å­˜å‚¨ç»“æ„ ç”±ä¸Šè¿°çš„é¡ºåºå­˜å‚¨ç»“æ„å¯çŸ¥ï¼Œå †æ˜¯ç”¨ç‰©ç†ä¸Šçš„çº¿æ€§è¡¨ç¤ºé€»è¾‘ä¸Šçš„éçº¿æ€§çš„æ•°æ®ç»“æ„ å…·ä½“çš„å…³äºå †çš„æ“ä½œï¼Œå¦‚åˆšå¼€å§‹çš„å»ºå †ï¼Œä»¥åŠæ’å…¥å…ƒç´ ï¼Œåˆ é™¤å †é¡¶å…ƒç´ ï¼Œè¿­ä»£ç­‰æ“ä½œï¼Œå¯è‡ªè¡Œç™¾åº¦ã€‚ å±æ€§// é»˜è®¤åˆå§‹åŒ–å®¹é‡ private static final int DEFAULT_INITIAL_CAPACITY = 11; // åº•å±‚ä½¿ç”¨Object[]æ•°ç»„å®ç°, å’ŒArrayListè¿™äº›ä¸€æ · transient Object[] queue; // non-private to simplify nested class access // æ ‡è®°å…ƒç´ ä¸ªæ•° private int size = 0; // æ¯”è¾ƒå™¨, è¯´æ˜å…¶å®ä¾‹å‡æ˜¯å¯æ¯”è¾ƒçš„ private final Comparator&lt;? super E&gt; comparator; // è¯´æ˜å…·æœ‰fast fail æœºåˆ¶ transient int modCount = 0; // non-private to simplify nested class access å› ä¸ºåº•å±‚ä½¿ç”¨çš„æ˜¯æ•°ç»„ï¼ŒåŒæ—¶å…¶æœ¬èº«æ˜¯æ”¯æŒåŠ¨æ€æ’å…¥å’Œåˆ é™¤çš„ï¼Œæ‰€ä»¥åŒç†ï¼Œå’ŒArrayListåŒç†ï¼Œæ‰©å®¹åº”è¯¥æ˜¯å…¶æ ¸å¿ƒçš„åœ°æ–¹ã€‚åŒæ—¶ä¹Ÿè¦å…³æ³¨å…¶æ˜¯å¦ç”Ÿæˆæ–°çš„æ•°ç»„å¯¹è±¡ã€‚ åƒArrayListã€HashMapä¸­éƒ½æœ‰ä¸€ä¸ªå±æ€§å« modCountï¼Œæ¯æ¬¡å¯¹é›†åˆçš„ä¿®æ”¹è¿™ä¸ªå€¼éƒ½ä¼šåŠ 1ï¼Œåœ¨éå†å‰è®°å½•è¿™ä¸ªå€¼åˆ° expectedModCountä¸­ï¼Œéå†ä¸­æ£€æŸ¥ä¸¤è€…æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœå‡ºç°ä¸ä¸€è‡´å°±è¯´æ˜æœ‰ä¿®æ”¹ï¼Œåˆ™æŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ã€‚ æ„é€ å‡½æ•°PriorityQueue()public PriorityQueue() { this(DEFAULT_INITIAL_CAPACITY, null); } PriorityQueue(int initialCapacity)public PriorityQueue(int initialCapacity) { this(initialCapacity, null); } PriorityQueue(Comparator&lt;? super E&gt; comparator)public PriorityQueue(Comparator&lt;? super E&gt; comparator) { this(DEFAULT_INITIAL_CAPACITY, comparator); } PriorityQueue(int initialCapacity, Comparator&lt;? super E&gt; comparator)public PriorityQueue(int initialCapacity, Comparator&lt;? super E&gt; comparator) { // Note: This restriction of at least one is not actually needed, // but continues for 1.5 compatibility if (initialCapacity &lt; 1) throw new IllegalArgumentException(); this.queue = new Object[initialCapacity]; this.comparator = comparator; } è¿˜æœ‰å‡ ä¸ªæ„é€ å‡½æ•°ä¸»è¦æ˜¯ç”¨äºå°†åŸå„ç§ç±»å‹çš„æ•°æ®æ”¾å…¥PriorityQueueä¸­ å¢(å…¥é˜Ÿ)åœ¨é˜…è¯»è¿™äº›æ–¹æ³•çš„æ—¶å€™, æƒ³èµ·æ¥è‡ªå·±æ‰‹æ’•ç®—æ³•çš„æ—¶å€™, ç»å¸¸ä¼šè®°æ··List, Stack, Queue, Mapè¿™äº›çš„æ·»åŠ åˆ é™¤æ“ä½œçš„APIâ€¦ ä¸‹é¢ç½—åˆ—çš„æ˜¯ä¸ªäººè§‰å¾—ä¸é”™çš„ä»£è¡¨æ•°æ®ç»“æ„ç‰¹æ€§çš„æ·»åŠ /åˆ é™¤æ“ä½œçš„API æ•°æ®ç»“æ„ æ·»åŠ  åˆ é™¤ List/Set add() remove() Stack push() pop() Queue offer() poll() Map put() remove() ç”¨äºå…¥é˜Ÿçš„æ“ä½œæœ‰addå’Œofferã€‚ public boolean add(E e) { return offer(e); } public boolean offer(E e) { // ä¸æ”¯æŒnullå…ƒç´  if (e == null) throw new NullPointerException(); modCount++; int i = size; // å…ƒç´ æ•°é‡è¶…è¿‡æ•°ç»„æ•°é‡ï¼Œå¼•å‘æ‰©å®¹æœºåˆ¶ if (i &gt;= queue.length) // æ‰©å®¹æœºåˆ¶å…ˆæŒ‰ä¸‹ä¸è¡¨ grow(i + 1); // å…ƒç´ æ•°é‡+1 size = i + 1; // å¦‚æœè¿˜æ²¡æœ‰å…ƒç´  // ç›´æ¥æ’å…¥åˆ°æ•°ç»„ç¬¬ä¸€ä¸ªä½ç½® if (i == 0) queue[0] = e; else // å¦åˆ™ æ’å…¥åˆ°å †çš„æœ€åä¸€ä¸ªå…ƒç´  // ç„¶åå†è°ƒæ•´å † siftUp(i, e); return true; } å®è§‚ä¸Šæ¥çœ‹, offer()æ–¹æ³•ä¼šå…ˆæ£€æµ‹æ˜¯å¦éœ€è¦æ‰©å®¹, ä¹‹åå†æ’å…¥å…ƒç´ , æœ€åè¿›è¡Œè°ƒæ•´, æœ€åè°ƒç”¨siftUpè¿›è¡Œè°ƒæ•´ã€‚ siftUpå‡è®¾åœ¨æ•°ç»„queueçš„kä½ç½®æ’å…¥å…ƒç´ keyï¼ˆå°æ ¹å †ï¼‰ ä¸æ–­çš„æ¯”è¾ƒkeyå’Œkçš„çˆ¶èŠ‚ç‚¹e ï¼ˆ$queue\\lfloor(k-1/2\\rfloor)$ï¼‰çš„å…³ç³» è‹¥$key &lt; e$ ï¼Œåˆ™queue[k] = e, åŒæ—¶kåˆ°è¾¾eçš„ä½ç½®ï¼ˆparentï¼‰ è‹¥$key \\geq e$ æˆ–è€… $k$å·²ç»åˆ°è¾¾è·ŸèŠ‚ç‚¹ï¼Œåˆ™ç»“æŸå¾ªç¯ $queue[k]==e$ private void siftUp(int k, E x) { // åˆ¤æ–­æ¯”è¾ƒç­–ç•¥ // 1. Xè‡ªèº«å®ç°äº†Comparableæ¥å£ï¼Œåˆ™é€šè¿‡comparableè¿›è¡Œæ¯”è¾ƒ // 2. Xè‡ªèº«æœªå®ç°Comparableæ¥å£ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„å¤–éƒ¨æ¯”è¾ƒå™¨compartoræ¯”è¾ƒ if (comparator != null) siftUpUsingComparator(k, x); else siftUpComparable(k, x); } @SuppressWarnings(\"unchecked\") private void siftUpComparable(int k, E x) { Comparable&lt;? super E&gt; key = (Comparable&lt;? super E&gt;) x; while (k &gt; 0) { int parent = (k - 1) &gt;&gt;&gt; 1; Object e = queue[parent]; if (key.compareTo((E) e) &gt;= 0) break; queue[k] = e; k = parent; } queue[k] = key; } @SuppressWarnings(\"unchecked\") private void siftUpUsingComparator(int k, E x) { while (k &gt; 0) { int parent = (k - 1) &gt;&gt;&gt; 1; Object e = queue[parent]; if (comparator.compare(x, (E) e) &gt;= 0) break; queue[k] = e; k = parent; } queue[k] = x; } ç»“è®º ä¸å…è®¸nullå…ƒç´  æ’å…¥å…ƒç´ å‰ï¼Œå…ˆæ£€æµ‹æ•°ç»„é•¿åº¦æ˜¯å¦å¤Ÿç”¨ï¼Œä¸å¤Ÿè¿›è¡Œæ‰©å®¹ï¼ˆæ‰©å®¹æœºåˆ¶åç»­è¯¦ç»†é˜è¿°ï¼‰ åœ¨å°¾éƒ¨æ’å…¥å…ƒç´ ï¼Œä¹‹åä¸æ–­è°ƒæ•´ é€šè¿‡è°ƒæ•´çš„è¿‡ç¨‹ï¼Œå¯ä»¥çŸ¥é“PrioriryQueueé»˜è®¤æ˜¯å°æ ¹å † åˆ (å‡ºé˜Ÿ)å‡ºé˜Ÿæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œpoll()å’Œremove()ï¼Œå®é™…ä¸Šremoveè°ƒç”¨çš„è¿˜æ˜¯pollã€‚removeä¸å­˜åœ¨çš„å…ƒç´ æ—¶ä¼šæŠ¥é”™ã€‚ public E remove() { E x = poll(); if (x != null) return x; else throw new NoSuchElementException(); } public E poll() { if (size == 0) return null; int s = --size; modCount++; E result = (E) queue[0]; // è·å–å½“å‰æœ€åä¸€ä¸ªå…ƒç´  // å¹¶å°†æœ€åä¸€ä¸ªä½ç½®ç½®ç©º E x = (E) queue[s]; queue[s] = null; // å¦‚æœå¼¹å‡ºå…ƒç´ åè¿˜æœ‰å…ƒç´  if (s != 0) //å°†é˜Ÿåˆ—æœ«å…ƒç´ ç§»åˆ°é˜Ÿåˆ—é¦– // å†åšè‡ªä¸Šè€Œä¸‹çš„å †åŒ– siftDown(0, x); return result; } siftDownè‡ªé¡¶å‘ä¸‹ï¼Œé€‰æ‹©å°çš„èŠ‚ç‚¹ï¼Œä¸æ–­çš„æ¯”è¾ƒã€äº¤æ¢ï¼Œç›´åˆ°ï¼š ä¸‹æ ‡è¶Šç•Œ èŠ‚ç‚¹çš„å€¼åŒæ—¶å°äºç­‰äºå·¦å­©å­å’Œå³å­©å­ å‡è®¾æ•°ç»„queueæœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ä¸ºkeyï¼ˆå°æ ¹å †ï¼‰ï¼Œä¸‹æ ‡kä»0å¼€å§‹ï¼Œå½“kå­˜åœ¨å·¦å­©å­æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å¾ªç¯ï¼š è‹¥kæœ‰å³å­©å­ï¼Œåˆ™æ¯”è¾ƒå·¦å³å­©å­çš„å€¼ï¼Œç„¶åé€‰å‡ºå°çš„å­©å­child æ¯”è¾ƒkeyå’Œc=queue[child]çš„å¤§å° è‹¥$key \\leq c$ ç»“æŸå¾ªç¯ è‹¥$key &gt; c$, åˆ™$queue[k] = c, k = child$ï¼Œ ç»§ç»­å¾ªç¯ $queue[k] = key$ private void siftDown(int k, E x) { // å’Œ siftUpä¸€æ ·çš„æ€è·¯ if (comparator != null) siftDownUsingComparator(k, x); else siftDownComparable(k, x); } @SuppressWarnings(\"unchecked\") private void siftDownComparable(int k, E x) { // å› ä¸ºåˆ é™¤æ˜¯ä»å †é¡¶å¼€å§‹åˆ é™¤ï¼Œæ‰€ä»¥å’ŒsiftUpç›¸å Comparable&lt;? super E&gt; key = (Comparable&lt;? super E&gt;)x; int half = size &gt;&gt;&gt; 1; // loop while a non-leaf while (k &lt; half) { int child = (k &lt;&lt; 1) + 1; // assume left child is least Object c = queue[child]; int right = child + 1; if (right &lt; size &amp;&amp; ((Comparable&lt;? super E&gt;) c).compareTo((E) queue[right]) &gt; 0) c = queue[child = right]; if (key.compareTo((E) c) &lt;= 0) break; queue[k] = c; k = child; } queue[k] = key; } @SuppressWarnings(\"unchecked\") private void siftDownUsingComparator(int k, E x) { int half = size &gt;&gt;&gt; 1; while (k &lt; half) { int child = (k &lt;&lt; 1) + 1; Object c = queue[child]; int right = child + 1; if (right &lt; size &amp;&amp; comparator.compare((E) c, (E) queue[right]) &gt; 0) c = queue[child = right]; if (comparator.compare(x, (E) c) &lt;= 0) break; queue[k] = c; k = child; } queue[k] = x; } å°†é˜Ÿåˆ—é¦–å…ƒç´ å¼¹å‡º å°†é˜Ÿåˆ—æœ«å…ƒç´ ç§»åˆ°é˜Ÿåˆ—é¦– è‡ªä¸Šè€Œä¸‹å †åŒ–ï¼Œä¸€ç›´å¾€ä¸‹ä¸æœ€å°çš„å­èŠ‚ç‚¹æ¯”è¾ƒ å¦‚æœæ¯”æœ€å°çš„å­èŠ‚ç‚¹å¤§ï¼Œå°±äº¤æ¢ä½ç½®ï¼Œå†ç»§ç»­ä¸æœ€å°çš„å­èŠ‚ç‚¹æ¯”è¾ƒ å¦‚æœæ¯”æœ€å°çš„å­èŠ‚ç‚¹å°ï¼Œå°±ä¸ç”¨äº¤æ¢ä½ç½®äº†ï¼Œå †åŒ–ç»“æŸ è·å–é˜Ÿå¤´å…ƒç´ public E peek() { return (size == 0) ? null : (E) queue[0]; } è·å–ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚ æ‰©å®¹ç­–ç•¥private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; private void grow(int minCapacity) { int oldCapacity = queue.length; // Double size if small; else grow by 50% int newCapacity = oldCapacity + ((oldCapacity &lt; 64) ? (oldCapacity + 2) : (oldCapacity &gt;&gt; 1)); // overflow-conscious code // æ£€æŸ¥æ˜¯å¦æº¢å‡º if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); queue = Arrays.copyOf(queue, newCapacity); } private static int hugeCapacity(int minCapacity) { if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } åŸæ•°ç»„ç©ºé—´å¤§å°&lt;64æ—¶ï¼Œé»˜è®¤æ‰©å®¹ä¸ºåŸå…ˆçš„ä¸¤å€å†åŠ 2ä¸ªã€‚ã€‚ã€‚ åŸæ•°ç»„ç©ºé—´å¤§å°&gt;64æ—¶ï¼Œæ‰©å®¹ä¸ºåŸå…ˆçš„1.5å€ æœ€å¤§å®¹é‡ç©ºé—´ä¸ºInteger.MAX_VALUE æ€»ç»“ PriorityQueueå†…éƒ¨çš„æ•°æ®ç»“æ„æ˜¯å †ï¼Œå †ä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯å®Œå…¨äºŒå‰æ ‘ï¼Œç„¶åä½¿ç”¨çš„æ˜¯é¡ºåºå­˜å‚¨ç»“æ„ï¼ˆæ•°ç»„ï¼‰ PriorityQueueé»˜è®¤æ˜¯å°æ ¹å † å †ä¿è¯å †é¡¶å…ƒç´ ä¸ºå½“å‰çš„æœ€å€¼ï¼Œç„¶åä¸¥æ ¼éµå®ˆå­—èŠ‚ç‚¹çš„å€¼å¤§äºï¼ˆå°äºï¼‰çˆ¶èŠ‚ç‚¹çš„å€¼ å †çš„åˆ é™¤æ“ä½œä»å †é¡¶è¿›è¡Œåˆ é™¤ï¼Œç„¶åä¼šå°†æœ€åçš„ä¸€ä¸ªå…ƒç´ ç§»è‡³å †é¡¶ï¼Œæ­¤æ—¶å †çš„ç»“æ„è¢«ç ´åï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡ŒsiftDown å †çš„æ’å…¥æ“ä½œä»å †å°¾è¿›è¡Œæ’å…¥ï¼Œæ­¤æ—¶å †çš„ç»“æ„è¢«ç ´åï¼Œæ‰€ä»¥éœ€è¦æ‰§è¡ŒsiftUp","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"Queue","slug":"Queue","permalink":"https://winniekun.github.io/tags/Queue/"}]},{"title":"httpsæ€»ç»“","slug":"ç½‘ç»œ/https-conclution","date":"2021-05-21T14:32:09.000Z","updated":"2021-10-14T13:12:47.807Z","comments":true,"path":"https-conclution/","link":"","permalink":"https://winniekun.github.io/https-conclution/","excerpt":"","text":"åºå¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µçš„æ—¶å€™ï¼Œå¿…ç„¶å…ˆé˜è¿°å…¶ç›¸å…³æ–¹é¢å·²æœ‰çš„å®ç°æœ‰å“ªäº›ç¼ºç‚¹ï¼Œæ–°çš„æ¦‚å¿µè§£å†³äº†å“ªäº›ç¼ºç‚¹ã€‚æ‰€ä»¥ï½è®©æˆ‘ä»¬çœ‹çœ‹HTTPæœ‰å“ªäº›å´ç¼ºç‚¹ ç¼ºç‚¹ï¼š æ˜æ–‡ä¼ è¾“ï¼Œä¼ è¾“ä¿¡æ¯å®¹æ˜“è¢«çªƒå¬ â€”- çªƒå¬é£é™© ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œå› æ­¤å¯èƒ½ä¼šé­é‡ä¼ªè£… â€”- å†’å……é£é™© æ— æ³•éªŒè¯æŠ¥é—®çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥é€šä¿¡çš„ä¿¡æ¯å¯èƒ½å·²é­ç¯¡æ”¹ â€”- ç¯¡æ”¹é£é™© è­¬å¦‚å¼ºè¡Œæ¤å…¥çš„å¹¿å‘Šä¿¡æ¯ è€ŒHTTPSçš„å‡ºç°å°±æ­£å¥½è§£å†³äº†ä¸Šè¿°çš„ä¸‰ä¸ªé—®é¢˜ã€‚å¯¹äºçªƒå¬é£é™©ä½¿ç”¨åŠ å¯†æªæ–½è§£å†³ï¼Œå¯¹äºå†’å……é£é™©ä½¿ç”¨è¯ä¹¦è®¤è¯è§£å†³ï¼Œå¯¹äºç¯¡æ”¹é£é™©ä½¿ç”¨å®Œæ•´æ€§ä¿æŠ¤è§£å†³ï¼ˆä¿¡æ¯æ‘˜è¦ç®—æ³•ï¼‰ HTTPSæ¦‚è¿° https HTTPSå…¶å®å°±æ˜¯http secureçš„æ„æ€ã€‚HTTPæ˜¯åº”ç”¨å±‚åè®®ï¼Œä½äºHTTPåè®®ä¹‹ä¸‹æ˜¯ä¼ è¾“åè®®TCPã€‚TCPè´Ÿè´£ä¼ è¾“ï¼ŒHTTPåˆ™å®šä¹‰äº†æ•°æ®å¦‚ä½•è¿›è¡ŒåŒ…è£…ã€‚æ‰€ä»¥HTTPä¼ è¾“ç»™TCPä»€ä¹ˆæ ·çš„æ•°æ®åŒ…ï¼Œå…¶éƒ½ä¼šåŸæ ·çš„å‘é€ä¸ªé€šè®¯æ–¹ï¼ˆä»…ä»…å°†æ•°æ®åŒ…åˆ†ä¸ºäº†å¤šä¸ªæŠ¥æŠ¥é—®æ®µï¼‰ã€‚ HTTP â€”&gt; TCP ï¼ˆæ˜æ–‡ä¼ è¾“ï¼‰ è€ŒHTTPSç›¸å¯¹äºHTTPæœ‰å“ªäº›ä¸åŒå‘¢ï¼Ÿå…¶å®å°±æ˜¯åœ¨HTTPå’ŒTCPä¸­é—´åŠ å¤šäº†ä¸€å±‚åŠ å¯†å±‚TLS/SSLã€‚ é€šä¿—çš„è®²ï¼ŒTLSã€SSLå…¶å®æ˜¯ç±»ä¼¼çš„ä¸œè¥¿ï¼ŒSSLæ˜¯ä¸ªåŠ å¯†å¥—ä»¶ï¼Œè´Ÿè´£å¯¹HTTPçš„æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚TLSæ˜¯SSLçš„å‡çº§ç‰ˆã€‚ç°åœ¨æåˆ°HTTPSï¼ŒåŠ å¯†å¥—ä»¶åŸºæœ¬æŒ‡çš„æ˜¯TLSã€‚ åŸå…ˆæ˜¯åº”ç”¨å±‚å°†æ•°æ®ç›´æ¥ç»™åˆ°TCPè¿›è¡Œä¼ è¾“ï¼Œç°åœ¨æ”¹æˆåº”ç”¨å±‚å°†æ•°æ®ç»™åˆ°TLS/SSLï¼Œå°†æ•°æ®åŠ å¯†åï¼Œå†ç»™åˆ°TCPè¿›è¡Œä¼ è¾“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º httpså’Œhttpä¼ è¾“è¿‡ç¨‹ æ‰€ä»¥HTTPSæœ¬èº«å¹¶ä¸æ˜¯åº”ç”¨å±‚çš„ä¸€ä¸ªæ–°çš„åè®®ï¼Œåªæ˜¯HTTPåœ¨å’ŒTCPè¿›è¡Œäº¤æ¥çš„ä¸­é—´ï¼Œåˆæ–°å¢äº†ä¸€å±‚SSL/TLSåè®®ã€‚æ‰€ä»¥HTTPSå¯ä»¥ç†è§£ä¸ºæŠ«ç€SSL/TLSåè®®å¤–å£³çš„HTTPè€Œå·²ã€‚ HTTPSçš„åŠ å¯†â€”-æ··åˆåŠ å¯†é¦–å…ˆéœ€è¦äº†è§£å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†çš„åŒºåˆ«ã€‚æˆ‘ä»¬çŸ¥é“å®é™…å¯¹é€šä¿¡åŠ å¯†çš„æ˜¯SSL/TLSå±‚ã€‚SSL/TLSé‡‡ç”¨æ˜¯æ··åˆåŠ å¯†çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„æ··åˆã€‚ä½¿ç”¨éå¯¹ç§°åŠ å¯†ä¼ è¾“å®‰å…¨ä¼ è¾“å¯¹ç§°åŠ å¯†çš„å¯†é’¥ï¼Œä¹‹åä½¿ç”¨å¯¹ç§°åŠ å¯†çš„å¯†é’¥è¿›è¡Œé€šä¿¡ä»è€Œæé«˜æ•´ä½“çš„é€šè®¯æ•ˆç‡ã€‚ æ¥ä¸‹æ¥ç»“åˆWireSharkæŠ“åŒ…è¯¦ç»†é˜è¿°TLSçš„åŠ å¯†æµç¨‹ï¼ŒTLS æ˜¯å»ºç«‹åœ¨ TCP åŸºç¡€ä¸Šçš„ï¼Œå› æ­¤å¿…å®šéœ€è¦å…ˆä¸‰æ¬¡ TCP æ¡æ‰‹å»ºç«‹ TCP è¿æ¥ï¼Œç„¶åå†æ˜¯å»ºç«‹ TLSã€‚ Client Hello Client Hello æŠ¥æ–‡ï¼šå®¢æˆ·ç«¯å¯¹åŠ å¯†ç®—æ³•çš„æ”¯æŒåº¦ä¸åŒï¼Œå› æ­¤éœ€è¦å‘æœåŠ¡ç«¯å‘é€å®¢æˆ·ç«¯æ”¯æŒçš„ åŠ å¯†å¥—ä»¶ï¼ˆCipher Suiteï¼‰ ï¼ŒåŒæ—¶è¿˜è¦ç”Ÿæˆä¸€ä¸ª éšæœºæ•° åŒæ—¶ä¿å­˜åœ¨å®¢æˆ·ç«¯å’Œå‘é€ç»™æœåŠ¡ Server Hello ServerCertificate æŠ¥æ–‡ï¼šæœåŠ¡ç«¯æ”¶åˆ° Client Hello ä¹‹åï¼Œå‘å®¢æˆ·ç«¯å‘é€ CA è®¤è¯çš„æ•°å­—è¯ä¹¦ï¼Œç”¨æ¥é‰´åˆ«æœåŠ¡ç«¯èº«ä»½ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜è¦ç”Ÿæˆä¸€ä¸ª éšæœºæ•° åŒæ—¶ä¿å­˜åœ¨æœåŠ¡ç«¯å’Œå‘é€ç»™å®¢æˆ·ç«¯ Server Hello Done æŠ¥æ–‡ï¼šè¡¨ç¤ºæœåŠ¡ç«¯å®£å‘Šç¬¬ä¸€é˜¶æ®µçš„å®¢æˆ·ç«¯æœåŠ¡ç«¯æ¡æ‰‹åå•†ç»“æŸ å¯é€‰ï¼šCertificate Request æŠ¥æ–‡ï¼šå¿…è¦æƒ…å†µä¸‹ï¼Œè¦æ±‚å®¢æˆ·ç«¯å‘é€è¯ä¹¦éªŒè¯èº«ä»½ å¯é€‰ï¼šServer Key Exchange æŠ¥æ–‡ï¼šå¦‚æœ CA è®¤è¯çš„æ•°å­—è¯ä¹¦æä¾›çš„ä¿¡æ¯ä¸å¤Ÿï¼ŒæœåŠ¡ç«¯è¿˜å¯å‘é€æä¾›è¡¥å……ä¿¡æ¯ Client Finish Client Key Exchange æŠ¥æ–‡ï¼šå®¢æˆ·ç«¯æ”¶åˆ° CA æ•°å­—è¯ä¹¦å¹¶é€šè¿‡éªŒè¯ï¼Œç„¶åé€šè¿‡ CA å…¬é’¥è§£å¯†è·å–åˆ° æœåŠ¡ç«¯å…¬é’¥ã€‚Client Key Exchange æŠ¥æ–‡åŒ…æ‹¬æœ‰ä¸€ä¸ªéšæœºæ•°ï¼Œè¿™ä¸ªéšæœºæ•°è¢«ç§°ä¸º Pre-master key/secretï¼›ä¸€ä¸ªè¡¨ç¤ºéšåçš„ä¿¡æ¯ä½¿ç”¨åŒæ–¹åå•†å¥½çš„åŠ å¯†æ–¹æ³•å’Œå¯†é’¥å‘é€çš„ é€šçŸ¥ ï¼›è¿˜æœ‰ä¸€ä¸ªé€šè¿‡åå•†å¥½çš„ HASH ç®—æ³•å¯¹å‰é¢æ‰€æœ‰ä¿¡æ¯å†…å®¹çš„ HASH è®¡ç®—å€¼ï¼Œç”¨æ¥æä¾›æœåŠ¡ç«¯æ ¡éªŒã€‚è¿™äº›ä¿¡æ¯éƒ½é€šè¿‡æœåŠ¡ç«¯å…¬é’¥åŠ å¯†ä¼ é€ç»™æœåŠ¡ç«¯ ExchangeCipherSpec æŠ¥æ–‡ï¼šè¯¥æŠ¥æ–‡é€šçŸ¥æœåŠ¡ç«¯ï¼Œæ­¤åçš„é€šä¿¡éƒ½å°†ä½¿ç”¨åå•†å¥½çš„åŠ å¯†ç®—æ³•è®¡ç®—å¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†é€šä¿¡ï¼ˆä¹Ÿå°±æ˜¯ä½¿ç”¨ä¸¤ä¸ªéšæœºæ•°ä»¥åŠç¬¬ä¸‰ä¸ª Pre-master key/secret éšæœºæ•°ä¸€èµ·ç®—å‡ºä¸€ä¸ªå¯¹ç§°å¯†é’¥ session key/secretï¼‰ Finished æŠ¥æ–‡ï¼šè¯¥æŠ¥æ–‡åŒ…æ‹¬è¿æ¥è‡³æ­¤çš„æ‰€æœ‰æŠ¥æ–‡çš„æ ¡éªŒå€¼ï¼Œä½¿ç”¨å·²ç»ç”Ÿæˆçš„å¯¹ç§°åŠ å¯†å¯†é’¥åŠ å¯† å¯é€‰ï¼šClientCertificate æŠ¥æ–‡ï¼šå¦‚æœæœåŠ¡ç«¯è¯·æ±‚ï¼Œå®¢æˆ·ç«¯éœ€è¦å‘é€ CA æ•°å­—è¯ä¹¦ å¯é€‰ï¼šCertificateVerify æŠ¥æ–‡ï¼šæœåŠ¡ç«¯å¦‚æœè¦æ±‚ CA æ•°å­—è¯ä¹¦ï¼Œé‚£ä¹ˆéœ€è¦é€šè¿‡ HASH ç®—æ³•è®¡ç®—ä¸€ä¸ªæœåŠ¡ç«¯å‘é€æ¥çš„ä¿¡æ¯æ‘˜è¦ Server Finish æœåŠ¡ç«¯å…ˆç§é’¥å¾—å‡ºPre-master keyï¼Œ åŒæ ·ä½¿ç”¨è¿™ä¸‰ä¸ªéšæœºæ•°å¾—å‡ºå¯¹ç§°åŠ å¯†å¯†é’¥ã€‚æœåŠ¡ç«¯æœ€åå¯¹å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ Finished æŠ¥æ–‡ä½¿ç”¨æœåŠ¡ç«¯å¯¹ç§°å¯†é’¥è¿›è¡Œè§£å¯†æ ¡éªŒã€‚ ClientCipherSpec æŠ¥æ–‡ï¼šæŠ¥æ–‡é€šçŸ¥æœåŠ¡ç«¯ï¼Œæ­¤åçš„é€šä¿¡éƒ½å°†ä½¿ç”¨åå•†å¥½çš„åŠ å¯†ç®—æ³•è®¡ç®—å¯¹ç§°å¯†é’¥ session key/secret è¿›è¡ŒåŠ å¯†é€šä¿¡ Finished æŠ¥æ–‡ï¼šæ ‡å¿— TLS è¿æ¥å»ºç«‹æˆåŠŸ TLS æ¡æ‰‹æˆåŠŸæ­¤åé€šè¿‡å¯¹ç§°å¯†é’¥ session key/secret åŠ å¯†é€šä¿¡ æ¡æ‰‹ï¼šè¯ä¹¦ä¸‹å‘ï¼Œå¯†é’¥åå•†ï¼ˆè¿™ä¸ªé˜¶æ®µéƒ½æ˜¯æ˜æ–‡çš„ï¼‰ æ•°æ®ä¼ è¾“ï¼šè¿™ä¸ªé˜¶æ®µæ‰æ˜¯åŠ å¯†çš„ï¼Œç”¨çš„å°±æ˜¯æ¡æ‰‹é˜¶æ®µåå•†å‡ºæ¥çš„å¯¹ç§°å¯†é’¥ è¿›è¡Œæ•´ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º image-20210521215733187 ä½¿ç”¨wiresharkå®æˆ˜è¯æ˜æœ¬åœ°åœ°å€å’ŒLeetCode-CNçš„äº¤äº’ wiresharkæŠ“åŒ…æ˜¾ç¤º å…·ä½“çš„æµç¨‹å¦‚TLS 1.2 çš„å®˜æ–¹æ–‡æ¡£ï¼ŒRFC-5246ï¼Œå…¶ä¸­çš„section-7.3æ‰€ç¤º image-20211014162146281 æ¥ä¸‹æ¥ï¼Œæ ¹æ®wiresharkè¿›è¡Œå®é™…çš„éªŒè¯ ClientHelloé˜¶æ®µ å®¢æˆ·ç«¯æƒ³æœåŠ¡ç«¯å‘é€httpsè¯·æ±‚é“¾æ¥ï¼ŒåŒæ—¶å°†è‡ªèº«æ”¯æŒçš„TLSç‰ˆæœ¬ï¼Œä¸€ä¸ªéšæœºä¸²Randomï¼Œå¯†ç å¥—ä»¶ï¼ˆéå¯¹ç§°åŠ å¯†ç®—æ³•ã€å¯¹ç§°åŠ å¯†ç®—æ³•ã€æ‘˜è¦ç®—æ³•ï¼‰å‘é€ç»™æœåŠ¡ç«¯ï¼ŒåŒæ—¶è¿”å›çš„å†…å®¹è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ä¿¡æ¯ï¼Œå¦‚compression_methodsï¼ˆå‹ç¼©çš„ç®—æ³•ï¼‰ã€extensionsï¼ˆæ‰©å±•å­—æ®µï¼‰ ServerHelloé˜¶æ®µ æœåŠ¡ç«¯æ ¹æ®å®¢æˆ·ç«¯è·å‘é€çš„æ•°æ®ï¼Œé€‰æ‹©ä¸€å¥—å¯†ç å¥—ä»¶ï¼Œä»¥åŠè‡ªèº«çš„è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ é€‰æ‹©çš„å¯†ç å¥—ä»¶é˜è¿°ï¼š TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 ECDHE_RSAï¼š å¯†é’¥äº¤æ¢æ—¶é‡‡ç”¨çš„RSAéå¯¹ç§°åŠ å¯†ç®—æ³• AES_128_GCMï¼šæ¡æ‰‹é€šè®¯åä½¿ç”¨AESå¯¹ç§°ç®—æ³•ï¼Œå¯†é’¥é•¿åº¦ä¸º128 SHA256ï¼šæ‘˜è¦ç®—æ³•ä½¿ç”¨çš„æ˜¯SHA256 Server Certificateé˜¶æ®µ æœåŠ¡ç«¯å‘å®Œä¸Šé¢çš„ ServerHello åç«‹å³å‘è¿™ä¸ªåŒ… æ•´ä¸ªè¯ä¹¦å†…å®¹å±•å¼€æ¥çœ‹å¦‚ä¸‹ï¼š å…¶ä¸­subjectå±•å¼€æ•´ç†å¦‚ä¸‹ï¼š CountryName: CN printableString: Shanghai printableString: IT uTF8String: é¢†æ‰£ç½‘ç»œï¼ˆä¸Šæµ·ï¼‰æœ‰é™å…¬å¸ printableString: leetcode-cn.com è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„å†…å®¹ subjectPublicKeyInfoï¼ˆè¯ä¹¦çš„å…¬é’¥ä¿¡æ¯ï¼‰ï¼š æ•´ä½“æ¥çœ‹ï¼Œè¯ä¹¦å…±åˆ†ä¸ºå¦‚ä¸‹çš„å†…å®¹ï¼š æ‰§è¡Œäº†å®¢æˆ·ç«¯ + æœåŠ¡ç«¯çš„ä¸¤ä¸ªhelloé˜¶æ®µï¼Œç„¶ååœ¨å‘é€ä¸€ä¸ªCertificateåŒ…ï¼Œç”¨äºä¼ é€’è¯ä¹¦ï¼Œå¾…å®¢æˆ·ç«¯æ ¡éªŒ Server Hello Done é˜¶æ®µ æ ‡è¯†ç€ serverHello è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹ç»“æŸäº† Client ClientKeyExchange é˜¶æ®µ ç´§æ¥ç€ ServerHelloDone å‘é€ï¼Œç”¨äºåå•†å‡º premaster_secretï¼ŒåŒä¹‹å‰çš„ ServerKeyExchange é…åˆä½¿ç”¨çš„ã€‚ ç”Ÿæˆæœ€ç»ˆé€šä¿¡çš„å¯¹ç§°åŠ å¯†ç§˜é’¥master_secret è¿™ä¸€æ­¥ä¸æ˜¯æŠ“åŒ…çš„ä¿¡æ¯ï¼Œè€Œæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ­¤æ—¶éƒ½åœ¨è‡ªå·±ç«¯å†…æ‰€åšçš„äº‹æƒ…ï¼Œéå¸¸å…³é”®ã€‚ å°±æ˜¯è®¡ç®—å‡ºæœ€ç»ˆå¯¹ç§°åŠ å¯†ç”¨çš„ç§˜é’¥ master_secretï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªèŠ±é‡Œèƒ¡å“¨çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆä¸”å”¯ä¸€çš„ä¸€ä¸ªç›®çš„ï¼Œå¹¶ä¸”ä¸¤ç«¯ç®—å‡ºæ¥çš„ç»“æœè‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚ HTTPS çš„ç›®çš„ï¼Œä¸å°±æ˜¯åŒæ–¹åå•†å‡ºä¸€ä¸ªå…±åŒçš„å¯¹ç§°åŠ å¯†ç§˜é’¥ä¹ˆï¼Œæ€•è¢«ä¸­é—´äººæ‹¦æˆªåˆ°ï¼Œæ‰€ä»¥åšçš„è¯ä¹¦å‘€ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•å‘€ï¼Œç§˜é’¥åå•†ç®—æ³•ç­‰å¤æ‚çš„è§„å®šã€‚ é‚£ master_secret æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„å‘¢ï¼Ÿ è¿˜è®°ä¸è®°å¾—ä¹‹å‰æˆ‘ä»¬å¾—åˆ°äº†ä¸‰ä¸ªéšæœºæ•°ï¼š éšæœºæ•° 1ï¼ˆå®¢æˆ·ç«¯éšæœºæ•°ï¼‰ï¼šåœ¨ ClientHello æ¶ˆæ¯é‡Œï¼Œç”±å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼Œæ˜¯ï¼š f52870c0be8c82f46f6ae0c5ad1be08a550bda92416bafebe54b9923b0795150 éšæœºæ•° 2ï¼ˆæœåŠ¡ç«¯éšæœºæ•°ï¼‰ï¼šåœ¨ ServerHello æ¶ˆæ¯é‡Œï¼Œç”±æœåŠ¡ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼Œæ˜¯ï¼š d763c799e2dea5f59fb9dc12a476598d9fc486e0f43d57148bd15f137793f77a éšæœºæ•° 3ï¼ˆpre_master)ï¼šé€šè¿‡ç§˜é’¥äº¤æ¢ç®—æ³• ECDHE è®¡ç®—å‡ºçš„ï¼Œæˆ‘ä»¬å«å®ƒ pre_masterã€‚ æœ€ç»ˆçš„å¯¹ç§°åŠ å¯†ç§˜é’¥ master_secretï¼Œå°±æ˜¯æ ¹æ®è¿™ä¸‰ä¸ªéšæœºæ•°å…±åŒè®¡ç®—å‡ºæ¥çš„ã€‚ ä¸€æ—¦åŒæ–¹åå•†å‡ºæ¥äº†è¿™ä¸ªç›¸åŒçš„å¯¹ç§°ç§˜é’¥ï¼Œé‚£å°±å¯ä»¥å¼€å§‹æ„‰å¿«åœ°å®‰å…¨é€šä¿¡äº†ï¼ŒTLS å±‚çš„å·¥ä½œä¹Ÿå°±åœ†æ»¡å®Œæˆã€‚ æ‰€ä»¥å¯æƒ³è€ŒçŸ¥ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œï¼Œå°±éƒ½æ˜¯æ”¶å°¾å·¥ä½œäº†ï¼Œå› ä¸ºç§˜é’¥å·²ç»åå•†å¥½äº†ã€‚å°±å¯ä»¥å¼€å¿ƒçš„ç”¨åå•†çš„å¯†é’¥è¿›è¡ŒåŠ å¯†é€šè®¯äº†ï¼Œå•¦å•¦å•¦ Client ChangeCipherSpecé˜¶æ®µ ç§˜é’¥æ”¹å˜é€šçŸ¥ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å·²ç»ç”Ÿæˆäº† master_secretï¼Œä¹‹åçš„æ¶ˆæ¯å°†éƒ½é€šè¿‡ master secret æ¥åŠ å¯† Encrypted Handshake Message é˜¶æ®µ ç”¨äºæ•°æ®éªŒè¯ Server ChangeCipherSpecé˜¶æ®µ ä¹Ÿæ˜¯ç§˜é’¥æ”¹å˜é€šçŸ¥ï¼Œæ­¤æ—¶æœåŠ¡ç«¯ä¹Ÿå·²ç»ç”Ÿæˆäº† master_secret äº†ï¼Œåé¢çš„é€šä¿¡éƒ½ç”¨æ­¤å€¼åŠ å¯†ã€‚ Server Finishé˜¶æ®µ åŒ Client Finishï¼ŒæœåŠ¡å™¨ç«¯å‘é€æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼ŒåŒæ—¶ä¼šå¸¦ä¸Šå‰é¢æ‰€å‘å†…å®¹çš„ç­¾ååˆ°å®¢æˆ·ç«¯ï¼Œä¿è¯å‰é¢é€šä¿¡æ•°æ®çš„æ­£ç¡®æ€§ã€‚ HTTPSçš„è®¤è¯â€”-æ•°å­—è¯ä¹¦äº†è§£äº†HTTPSåŠ å¯†é€šä¿¡çš„æµç¨‹åï¼Œå¯¹äºæ•°æ®è£¸å¥”çš„ç–‘è™‘åº”è¯¥åŸºæœ¬æ‰“æ¶ˆäº†ã€‚ç„¶è€Œï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚ä½•ç¡®ä¿è¯ä¹¦æ—¶å¯ä¿¡çš„ï¼Ÿ è¯ä¹¦ä¸å¯ä¿¡å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼š è¯ä¹¦æ˜¯ä¼ªé€ çš„ï¼šå‹æ ¹ä¸æ˜¯CAé¢å‘çš„ è¯ä¹¦è¢«ç¯¡æ”¹è¿‡ï¼šæ¯”å¦‚å°†XXç½‘ç«™çš„å…¬é’¥ç»™æ›¿æ¢äº† æ•°å­—è¯ä¹¦æ˜¯ç”±æƒå¨çš„CAï¼ˆCertificate Authorityï¼‰æœºæ„ç»™æœåŠ¡ç«¯è¿›è¡Œé¢å‘ï¼ŒCAæœºæ„é€šè¿‡æœåŠ¡ç«¯æä¾›çš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆè¯ä¹¦ï¼Œè¯ä¹¦å†…å®¹åŒ…å«äº†æŒæœ‰äººçš„ç›¸å…³ä¿¡æ¯ï¼ŒæœåŠ¡å™¨çš„å…¬é’¥ï¼Œç­¾ç½²è€…ç­¾åä¿¡æ¯ï¼ˆæ•°å­—ç­¾åï¼‰ç­‰ï¼Œæœ€é‡è¦çš„æ˜¯å…¬é’¥åœ¨æ•°å­—è¯ä¹¦ä¸­ã€‚ æ•°å­—ç­¾åå’Œæ‘˜è¦ç®—æ³•çš„å…³ç³» æ˜æ–‡ â€”&gt; hashè¿ç®— â€”&gt; æ‘˜è¦ â€”&gt; ç§é’¥åŠ å¯† â€”&gt; æ•°å­—ç­¾å æ•°å­—è¯ä¹¦æ˜¯å¦‚ä½•ä¿è¯å…¬é’¥æ¥è‡ªè¯·æ±‚çš„æœåŠ¡å™¨ï¼Ÿ æ•°å­—è¯ä¹¦ä¸Šç”±æŒæœ‰äººçš„ç›¸å…³ä¿¡æ¯ï¼Œé€šè¿‡è¿™ç‚¹å¯ä»¥ç¡®å®šå…¶ä¸æ˜¯ä¸€ä¸ªä¸­é—´äºº è¯ä¹¦åŒ…å«çš„å†…å®¹ï¼š ä¸€ä¸ªè¯ä¹¦ä¸­å«æœ‰ä¸‰ä¸ªéƒ¨åˆ†:è¯ä¹¦å†…å®¹ï¼Œæ•£åˆ—ç®—æ³•ï¼ŒåŠ å¯†å¯†æ–‡ï¼Œè¯ä¹¦å†…å®¹ä¼šè¢«æ•£åˆ—ç®—æ³•hashè®¡ç®—å‡ºæ‘˜è¦ï¼Œç„¶åä½¿ç”¨CAæœºæ„æä¾›çš„ç§é’¥è¿›è¡ŒRSAåŠ å¯†å¾—åˆ°æ•°ç»„ç­¾åï¼ˆåŠ å¯†å¯†æ–‡ï¼‰ã€‚ Support/typora-user-images/image-20210521221149447.png è¯ä¹¦ä¼ªé€ æµè§ˆå™¨å†…ç½®çš„CAçš„æ ¹è¯ä¹¦åŒ…å«äº†CAçš„å…¬é’¥ è¯ä¹¦é¢å‘çš„æœºæ„æ˜¯ä¼ªé€ çš„ï¼šæµè§ˆå™¨ä¸è®¤è¯†ï¼Œç›´æ¥è®¤ä¸ºæ˜¯å±é™©è¯ä¹¦ è¯ä¹¦é¢å‘çš„æœºæ„æ˜¯ç¡®å®å­˜åœ¨çš„ï¼Œäºæ˜¯æ ¹æ®CAåï¼Œæ‰¾åˆ°å¯¹åº”å†…ç½®çš„CAæ ¹è¯ä¹¦ã€CAçš„å…¬é’¥ã€‚ ç”¨CAçš„å…¬é’¥ï¼Œå¯¹ä¼ªé€ çš„è¯ä¹¦çš„æ‘˜è¦è¿›è¡Œè§£å¯†ï¼Œå‘ç°è§£ä¸äº†ã€‚è®¤ä¸ºæ˜¯å±é™©è¯ä¹¦ è¯ä¹¦ç¯¡æ”¹ æ ¹æ®è¯ä¹¦çš„åŠ å¯†å¯†æ–‡ï¼ˆæ•°å­—ç­¾åï¼‰ä½¿ç”¨CAçš„å…¬é’¥å¾—åˆ°è¯ä¹¦æ‘˜è¦A æ ¹æ®è¯ä¹¦å†…å®¹ä½¿ç”¨æ‘˜è¦ç®—æ³•å¾—åˆ°è¯ä¹¦æ‘˜è¦B å¯¹æ¯”æ‘˜è¦Aå’Œæ‘˜è¦Bæ˜¯å¦ç›¸åŒ HTTPSçš„å®Œæ•´æ€§ä¿æŠ¤â€”-æ‘˜è¦ç®—æ³• [ ] TODO æ€»ç»“references å›¾è§£HTTP è¶£è°ˆåè®®â€”-æå®¢æ—¶é—´ Why does the SSL/TLS handshake have a client and server random","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://winniekun.github.io/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"åº”ç”¨å±‚","slug":"åº”ç”¨å±‚","permalink":"https://winniekun.github.io/tags/%E5%BA%94%E7%94%A8%E5%B1%82/"}]},{"title":"Spring IoCè§£è¯»","slug":"spring/spring-ioc-analysis","date":"2021-05-21T01:24:20.000Z","updated":"2021-07-24T07:46:15.133Z","comments":true,"path":"spring-ioc-analysis/","link":"","permalink":"https://winniekun.github.io/spring-ioc-analysis/","excerpt":"","text":"åºIoCIoCæ§åˆ¶åè½¬ï¼Œæ„æ€å°±æ˜¯å°†åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒä»æˆ‘ä»¬è‡ªå·±ç¡¬ç¼–ç æ¥newä¸€ä¸ªå¯¹è±¡åè½¬åˆ°äº†ç¬¬ä¸‰æ–¹èº«ä¸Šã€‚IoCçš„ä¸»è¦å®ç°æ–¹å¼æ˜¯ä¾èµ–æ³¨å…¥ï¼ŒSpringä¸­çš„ä¾èµ–æ³¨å…¥æ–¹å¼æœ‰ï¼šæ„é€ æ–¹æ³•æ³¨å…¥ã€settteræ³¨å…¥ã€æ¥å£æ³¨å…¥ã€‚ æ§åˆ¶åè½¬æ˜¯ä¸€ç§æ€æƒ³ ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ IoCæ˜¯ä¸€ç§å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£è€¦å„ä¸šåŠ¡å¯¹è±¡é—´ä¾èµ–å…³ç³»çš„å¯¹è±¡ç»‘å®šæ–¹å¼ IoC Service Providerè™½ç„¶ä¸šåŠ¡å¯¹è±¡å¯ä»¥é€šè¿‡IoCæ–¹å¼å£°æ˜ç›¸åº”çš„ä¾èµ–ï¼Œä½†æ˜¯æœ€ç»ˆä»ç„¶éœ€è¦é€šè¿‡æŸä¸ªè§’è‰²æˆ–è€…æœåŠ¡å°†è¿™äº›ä¾èµ–çš„å¯¹è±¡ç»‘å®šåˆ°ä¸€èµ·ã€‚è€ŒIoC Service Providerå°±å¯¹åº”IoCåœºæ™¯ä¸­çš„è¿™ä¸€è§’è‰²ã€‚IoC Service Provideråœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªæŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡ä»£ä»»ä½•å°†IoCåœºæ™¯ä¸­çš„ä¸šåŠ¡å¯¹è±¡ç»‘å®šåˆ°ä¸€èµ·çš„å®ç°æ–¹å¼ã€‚å®ƒå¯ä»¥æ˜¯ä¸€æ®µä»£ç ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„ç›¸å…³çš„ç±»ï¼Œç”šè‡³å¯ä»¥æ˜¯æ¯”è¾ƒé€šç”¨çš„IoCæ¡†æ¶æˆ– è€…IoCå®¹å™¨å®ç°ã€‚ èŒè´£ ä¸šåŠ¡å¯¹è±¡çš„æ„å»ºç®¡ç† IoCä¸­ï¼Œä¸šåŠ¡å¯¹è±¡æ— éœ€å…³å¿ƒæ‰€ä¾èµ–æ³¨å…¥çš„å¯¹è±¡å¦‚ä½•æ„å»ºå¦‚ä½•å–å¾—ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†çš„å·¥ä½œè¿˜æ˜¯éœ€è¦æœ‰äººæ¥åšçš„ã€‚æ‰€ä»¥IoC Service Provideréœ€è¦å°†å¯¹è±¡çš„æ„å»ºé€»è¾‘ä»å®¢æˆ·ç«¯å¯¹è±¡é‚£é‡ŒæŠ½ç¦»å‡ºæ¥ï¼Œä¸€é¢è¿™éƒ¨åˆ†é€»è¾‘æ±¡æŸ“ä¸šåŠ¡å¯¹è±¡çš„å®ç°ã€‚ å®¢æˆ·ç«¯ï¼šä»£ä½¿ç”¨æŸä¸ªå¯¹è±¡æˆ–è€…æŸç§æœåŠ¡çš„å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡Aéœ€è¦å¼•ç”¨å¯¹è±¡Bï¼Œé‚£ä¹ˆAå°±æ˜¯Bçš„å®¢æˆ·ç«¯å¯¹è±¡ï¼Œè€Œä¸ç®¡A å¤„äºServiceå±‚è¿˜æ˜¯æ•°æ®è®¿é—®å±‚ã€‚ ä¸šåŠ¡å¯¹è±¡ä¹‹é—´çš„ä¾èµ–ç»‘å®š æœ€è‰°å·¨ä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œè¿™ æ˜¯å®ƒçš„æœ€ç»ˆä½¿å‘½ä¹‹æ‰€åœ¨ã€‚å¦‚æœä¸èƒ½å®Œæˆè¿™ä¸ªèŒè´£ï¼Œé‚£ä¹ˆï¼Œæ— è®ºä¸šåŠ¡å¯¹è±¡å¦‚ä½•çš„â€œå‘¼å–Šâ€ï¼Œä¹Ÿä¸ ä¼šå¾—åˆ°ä¾èµ–å¯¹è±¡çš„ä»»ä½•å“åº”(æœ€å¸¸è§çš„å€’æ˜¯ä¼šæ”¶åˆ°ä¸€ä¸ªNullPointerException)ã€‚IoC Service Provideré€šè¿‡ç»“åˆä¹‹å‰æ„å»ºå’Œç®¡ç†çš„æ‰€æœ‰ä¸šåŠ¡å¯¹è±¡ï¼Œä»¥åŠå„ä¸ªä¸šåŠ¡å¯¹è±¡é—´å¯ä»¥è¯†åˆ«çš„ä¾èµ–å…³ç³»ï¼Œå°†è¿™äº›å¯¹è±¡æ‰€ä¾èµ–çš„å¯¹è±¡æ³¨å…¥ç»‘å®šï¼Œä»è€Œä¿è¯æ¯ä¸ªä¸šåŠ¡å¯¹è±¡åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å¤„äºå°±ç»ªçŠ¶ æ€ã€‚ Spring IoCå®¹å™¨ image-20210520140010820 Springçš„IoCå®¹å™¨å°±æ˜¯ä¸€ä¸ªIoC Providerï¼Œä½†æ˜¯å…¶ç›¸æ¯”äºIoC Providerçš„åŠŸèƒ½æ›´åŠ çš„ä¸°å¯Œï¼Œé™¤äº†ä¸šåŠ¡å¯¹è±¡çš„æ„å»ºã€ä¾èµ–å…³ç³»çš„ç»‘å®šè¿™ç§IoC Providerçš„åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æ–°å¢äº†ä¸šåŠ¡å¯¹è±¡å£°æ˜å‘¨æœŸçš„ç®¡ç†ï¼ŒAOPæ”¯æŒç­‰ã€‚åŒæ—¶Springæä¾›äº†ä¸¤ç§å®¹å™¨ç±»å‹:BeanFactoryå’ŒApplicationContextã€‚ BeanFactory åŸºç¡€ç±»å‹IoCå®¹å™¨ï¼Œæä¾›å®Œæ•´çš„IoCæœåŠ¡æ”¯æŒã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®ŠæŒ‡å®šï¼Œ==é»˜è®¤é‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–ç­–ç•¥(lazy-load)==ã€‚åªæœ‰å½“å®¢æˆ·ç«¯å¯¹è±¡éœ€è¦è®¿é—®å®¹å™¨ä¸­çš„æŸä¸ªå—ç®¡å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰å¯¹è¯¥å—ç®¡å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ä»¥åŠä¾èµ–æ³¨å…¥æ“ä½œã€‚æ‰€ä»¥ï¼Œç›¸å¯¹æ¥è¯´ï¼Œå®¹å™¨å¯åŠ¨åˆæœŸé€Ÿåº¦è¾ƒå¿«ï¼Œæ‰€éœ€è¦çš„èµ„æºæœ‰é™ã€‚å¯¹äºèµ„æºæœ‰é™ï¼Œå¹¶ä¸”åŠŸèƒ½è¦æ±‚ä¸æ˜¯å¾ˆä¸¥æ ¼çš„åœºæ™¯ï¼ŒBeanFactoryæ˜¯æ¯”è¾ƒåˆé€‚çš„ IoCå®¹å™¨é€‰æ‹©ã€‚ ApplicationContext åœ¨BeanFactoryçš„åŸºç¡€ä¸Šæ„å»ºï¼Œæ˜¯ç›¸å¯¹æ¯”è¾ƒé«˜ çº§çš„å®¹å™¨å®ç°ï¼Œé™¤äº†æ‹¥æœ‰BeanFactoryçš„æ‰€æœ‰æ”¯æŒï¼ŒApplicationContextè¿˜æä¾›äº†å…¶ä»–é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚äº‹ä»¶å‘å¸ƒã€å›½é™…åŒ–ä¿¡æ¯æ”¯æŒç­‰ã€‚ApplicationContextæ‰€ç®¡ç† çš„å¯¹è±¡ï¼Œåœ¨è¯¥ç±»å‹å®¹å™¨å¯åŠ¨ä¹‹åï¼Œ==é»˜è®¤å…¨éƒ¨åˆå§‹åŒ–å¹¶ç»‘å®šå®Œæˆ==ã€‚æ‰€ä»¥ï¼Œç›¸å¯¹äºBeanFactoryæ¥ è¯´ï¼ŒApplicationContextè¦æ±‚æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼ŒåŒæ—¶ï¼Œå› ä¸ºåœ¨å¯åŠ¨æ—¶å°±å®Œæˆæ‰€æœ‰åˆå§‹åŒ–ï¼Œå®¹å™¨å¯åŠ¨æ—¶é—´è¾ƒä¹‹BeanFactoryä¹Ÿä¼šé•¿ä¸€äº›ã€‚åœ¨é‚£äº›ç³»ç»Ÿèµ„æºå……è¶³ï¼Œå¹¶ä¸”è¦æ±‚æ›´å¤šåŠŸèƒ½çš„åœºæ™¯ä¸­ï¼Œ ApplicationContextç±»å‹çš„å®¹å™¨æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚ ç®€å•çš„å¼ä¾‹Spring IoCå®¹å™¨çš„ä¸€äº›ç‰¹æ€§ç®€ä»‹autowireè‡ªåŠ¨æ³¨å…¥ï¼Œé€šè¿‡autowireï¼Œæˆ‘ä»¬å¯ä»¥ç•¥å»å¾ˆå¤šäººå·¥æ˜¾ç¤ºçš„é…ç½®beançš„æ“ä½œï¼Œè¢«ä¾èµ–çš„å‘ç°å’Œæ³¨å…¥éƒ½äº¤ç»™äº†Springï¼ŒåŒæ—¶å…¶æœ‰å‡ ä¸ªç±»å‹å¯é€‰æ‹©ï¼Œæ¯”å¦‚byNameã€byTypeç­‰ã€‚ FactoryBeanBeanFactoryå’ŒFactoryBeanå‚»å‚»åˆ†ä¸æ¸…ï¼Ÿè™½ç„¶ä¸¤è€…ç±»ä¼¼ï¼Œä½†æ˜¯åŠŸèƒ½ä¸åŒã€‚FactoryBeanæ˜¯ä¸€ç§å·¥å‚Beanï¼Œå’Œæ™®é€šçš„Beanä¸ä¸€æ ·ï¼ŒFactoryBeanæ˜¯å¯ä»¥ç”Ÿäº§Beançš„Beanã€‚ depends-onå½“ä¸€ä¸ª bean ç›´æ¥ä¾èµ–å¦ä¸€ä¸ª beanï¼Œå¯ä»¥ä½¿ç”¨ &lt;ref/&gt; æ ‡ç­¾è¿›è¡Œé…ç½®ã€‚ä¸è¿‡å¦‚æŸä¸ª bean å¹¶ä¸ç›´æ¥ä¾èµ–äºå…¶ä»– beanï¼Œä½†åˆéœ€è¦å…¶ä»– bean å…ˆå®ä¾‹åŒ–å¥½ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ depends-on ç‰¹æ€§äº†ã€‚depends-on ç‰¹æ€§æ¯”è¾ƒç®€å•ï¼Œå°±ä¸æ¼”ç¤ºäº†ã€‚ä»…è´´ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹ï¼š è¿™é‡Œæœ‰ä¸¤ä¸ªç®€å•çš„ç±»ï¼Œå…¶ä¸­ Hello éœ€è¦ World åœ¨å…¶ä¹‹å‰å®Œæˆå®ä¾‹åŒ–ã€‚ç›¸å…³é…ç½®å¦‚ä¸‹ï¼š &lt;bean id=\"hello\" class=\"xyz.coolblog.depnedson.Hello\" depends-on=\"world\"/&gt; &lt;bean id=\"world\" class=\"xyz.coolblog.depnedson.World\" /&gt; BeanPostProcessorBeanPostProcessor æ˜¯ bean å®ä¾‹åŒ–æ—¶çš„åç½®å¤„ç†å™¨ï¼ŒåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶æºç å¦‚ä¸‹ï¼š public interface BeanPostProcessor { // bean åˆå§‹åŒ–å‰çš„å›è°ƒæ–¹æ³• Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException; // bean åˆå§‹åŒ–åçš„å›è°ƒæ–¹æ³• Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException; } BeanPostProcessoræ˜¯Springæ¡†æ¶çš„ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¯ä»¥é€šè¿‡BeanPostProcessoræ¥å£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ’æ‰‹Beançš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ¯”å¦‚AOPå°±æ˜¯åœ¨beanå®ä¾‹å°†åˆ‡é¢é€»è¾‘ç»‡å…¥beanå®ä¾‹ä¸­ï¼ŒAOPä¹Ÿæ˜¯æ­£æ˜¯é€šè¿‡BeanPostProcessorå’ŒIoCå®¹å™¨å»ºç«‹äº†è”ç³» ç¤ºä¾‹@Slf4j public class LoggerBeanPostProcessor implements BeanPostProcessor { @Override public Object postProcessBeforeInitialization(Object bean, String beanName) { log.info(\"Before \" + beanName + \" Initialization\"); return bean; } @Override public Object postProcessAfterInitialization(Object bean, String beanName) { log.info(\"After \" + beanName + \" Initialization\"); return bean; } } é…ç½®å¦‚ä¸‹&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\"&gt; &lt;bean class=\"com.titizz.simulation.toyspring.learninng.LoggerBeanPostProcessor\"/&gt; &lt;bean id=\"car\" class=\"com.titizz.simulation.toyspring.Car\"&gt; &lt;/bean&gt; &lt;/beans&gt; æµ‹è¯•å¦‚ä¸‹@Test public void testBeanPostProcessor() { String xmlPath = \"test-spring.xml\"; ApplicationContext applicationContext = new ClassPathXmlApplicationContext(xmlPath); } image-20210502181644978 æ ¸å¿ƒæ¥å£Resourceä»¥ Resource æ¥å£ä¸ºæ ¸å¿ƒå‘æ•£å‡ºçš„å‡ ä¸ªç±»ï¼Œéƒ½æ˜¯ç”¨äºè§£å†³ IoC å®¹å™¨ä¸­çš„å†…å®¹ä»å“ªé‡Œæ¥çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ é…ç½®æ–‡ä»¶ä»å“ªé‡Œè¯»å–ã€é…ç½®æ–‡ä»¶å¦‚ä½•è¯»å– çš„é—®é¢˜ã€‚ ç±»å è¯´æ˜ Resource æ¥å£ï¼Œæ ‡è¯†ä¸€ä¸ªå¤–éƒ¨èµ„æºã€‚é€šè¿‡ getInputStream() æ–¹æ³• è·å–èµ„æºçš„è¾“å…¥æµ ã€‚ UrlResource å®ç° Resource æ¥å£çš„èµ„æºç±»ï¼Œé€šè¿‡ URL è·å–èµ„æºã€‚ ResourceLoader èµ„æºåŠ è½½ç±»ã€‚é€šè¿‡ getResource(String) æ–¹æ³•è·å–ä¸€ä¸ª Resouce å¯¹è±¡ï¼Œæ˜¯ è·å– Resouce çš„ä¸»è¦é€”å¾„ ã€‚ BeanDefinitionåŠŸèƒ½ï¼šç”¨äºè§£å†³Beançš„å®šä¹‰é—®é¢˜ï¼ŒåŒ…æ‹¬Beançš„åå­—ï¼Œç±»å‹ä»¥åŠå®ƒçš„å±æ€§èµ‹äºˆäº†ä»€ä¹ˆå€¼æˆ–è€…å¼•ç”¨ã€‚è¯´ç™½äº†ä¹Ÿå°±æ˜¯è§£å†³äº†åœ¨IoCå®¹å™¨ä¸­å®šä¹‰ä¸€ä¸ªBeanï¼Œä½¿å¾—IoCå®¹å™¨å¯ä»¥æ ¹æ®è¿™ä¸ªå®šä¹‰æ¥ç”Ÿæˆå®ä¾‹ã€‚ ç±»å è¯´æ˜ BeanDefinition è¯¥ç±»ä¿å­˜äº† Bean å®šä¹‰ã€‚åŒ…æ‹¬ Bean çš„ åå­— String beanClassNameã€ç±»å‹ Class beanClassã€å±æ€§ PropertyValues propertyValuesã€‚æ ¹æ®å…¶ ç±»å‹ å¯ä»¥ç”Ÿæˆä¸€ä¸ªç±»å®ä¾‹ï¼Œç„¶åå¯ä»¥æŠŠ å±æ€§ æ³¨å…¥è¿›å»ã€‚propertyValues é‡Œé¢åŒ…å«äº†ä¸€ä¸ªä¸ª PropertyValue æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®éƒ½æ˜¯é”®å€¼å¯¹ String - Objectï¼Œåˆ†åˆ«å¯¹åº”è¦ç”Ÿæˆå®ä¾‹çš„å±æ€§çš„åå­—ä¸ç±»å‹ã€‚åœ¨ Spring çš„ XML ä¸­çš„ property ä¸­ï¼Œé”®æ˜¯ key ï¼Œå€¼æ˜¯ value æˆ–è€… refã€‚å¯¹äº value åªè¦ç›´æ¥æ³¨å…¥å±æ€§å°±è¡Œäº†ï¼Œä½†æ˜¯ ref è¦å…ˆè¿›è¡Œè§£æã€‚Object å¦‚æœæ˜¯ BeanReference ç±»å‹ï¼Œåˆ™è¯´æ˜å…¶æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå…¶ä¸­ä¿å­˜äº†å¼•ç”¨çš„åå­—ï¼Œéœ€è¦ç”¨å…ˆè¿›è¡Œè§£æï¼Œè½¬åŒ–ä¸ºå¯¹åº”çš„å®é™… Objectã€‚ BeanDefinitionReader è§£æ BeanDefinition çš„æ¥å£ã€‚é€šè¿‡ loadBeanDefinitions(String) æ¥ä»ä¸€ä¸ªåœ°å€åŠ è½½ç±»å®šä¹‰ã€‚ AbstractBeanDefinitionReader å®ç° BeanDefinitionReader æ¥å£çš„æŠ½è±¡ç±»ï¼ˆæœªå…·ä½“å®ç° loadBeanDefinitionsï¼Œè€Œæ˜¯è§„èŒƒäº† BeanDefinitionReader çš„åŸºæœ¬ç»“æ„ï¼‰ã€‚å†…ç½®ä¸€ä¸ª HashMap rigistryï¼Œç”¨äºä¿å­˜ String - beanDefinition çš„é”®å€¼å¯¹ã€‚å†…ç½®ä¸€ä¸ª ResourceLoader resourceLoaderï¼Œç”¨äºä¿å­˜ç±»åŠ è½½å™¨ã€‚ç”¨æ„åœ¨äºï¼Œä½¿ç”¨æ—¶ï¼Œåªéœ€è¦å‘å…¶ loadBeanDefinitions() ä¼ å…¥ä¸€ä¸ªèµ„æºåœ°å€ï¼Œå°±å¯ä»¥è‡ªåŠ¨è°ƒç”¨å…¶ç±»åŠ è½½å™¨ï¼Œå¹¶æŠŠè§£æåˆ°çš„ BeanDefinition ä¿å­˜åˆ° registry ä¸­å»ã€‚ XmlBeanDefinitionReader å…·ä½“å®ç°äº† loadBeanDefinitions() æ–¹æ³•ï¼Œä» XML æ–‡ä»¶ä¸­è¯»å–ç±»å®šä¹‰ã€‚ BeanFactory â“ä»¥ BeanFactory æ¥å£ä¸ºæ ¸å¿ƒå‘æ•£å‡ºçš„å‡ ä¸ªç±»ï¼Œéƒ½æ˜¯ç”¨äºè§£å†³ IoC å®¹å™¨åœ¨ å·²ç»è·å– Bean çš„å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è£…é…ã€è·å– Bean å®ä¾‹ çš„é—®é¢˜ã€‚ ç±»å è¯´æ˜ BeanFactory æ¥å£ï¼Œæ ‡è¯†ä¸€ä¸ª IoC å®¹å™¨ã€‚é€šè¿‡ getBean(String) æ–¹æ³•æ¥ è·å–ä¸€ä¸ªå¯¹è±¡ AbstractBeanFactory BeanFactory çš„ä¸€ç§æŠ½è±¡ç±»å®ç°ï¼Œè§„èŒƒäº† IoC å®¹å™¨çš„åŸºæœ¬ç»“æ„ï¼Œä½†æ˜¯æŠŠç”Ÿæˆ Bean çš„å…·ä½“å®ç°æ–¹å¼ç•™ç»™å­ç±»å®ç°ã€‚IoC å®¹å™¨çš„ç»“æ„ï¼šAbstractBeanFactory ç»´æŠ¤ä¸€ä¸ª beanDefinitionMap å“ˆå¸Œè¡¨ç”¨äºä¿å­˜ç±»çš„å®šä¹‰ä¿¡æ¯ï¼ˆBeanDefinitionï¼‰ã€‚è·å– Bean æ—¶ï¼Œå¦‚æœ Bean å·²ç»å­˜åœ¨äºå®¹å™¨ä¸­ï¼Œåˆ™è¿”å›ä¹‹ï¼Œå¦åˆ™åˆ™è°ƒç”¨ doCreateBean æ–¹æ³•è£…é…ä¸€ä¸ª Beanã€‚ï¼ˆæ‰€è°“å­˜åœ¨äºå®¹å™¨ä¸­ï¼Œæ˜¯æŒ‡å®¹å™¨å¯ä»¥é€šè¿‡ beanDefinitionMap è·å– BeanDefinition è¿›è€Œé€šè¿‡å…¶ getBean() æ–¹æ³•è·å– Beanã€‚ï¼‰ AutowireCapableBeanFactory å¯ä»¥å®ç°è‡ªåŠ¨è£…é…çš„ BeanFactoryã€‚åœ¨è¿™ä¸ªå·¥å‚ä¸­ï¼Œå®ç°äº† doCreateBean æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ†ä¸‰æ­¥ï¼š1ï¼Œé€šè¿‡ BeanDefinition ä¸­ä¿å­˜çš„ç±»ä¿¡æ¯å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼›2ï¼ŒæŠŠå¯¹è±¡ä¿å­˜åœ¨ BeanDefinition ä¸­ï¼Œä»¥å¤‡ä¸‹æ¬¡è·å–ï¼›3ï¼Œä¸ºå…¶è£…é…å±æ€§ã€‚è£…é…å±æ€§æ—¶ï¼Œé€šè¿‡ BeanDefinition ä¸­ç»´æŠ¤çš„ PropertyValues é›†åˆç±»ï¼ŒæŠŠ String - Value é”®å€¼å¯¹æ³¨å…¥åˆ° Bean çš„å±æ€§ä¸­å»ã€‚å¦‚æœ Value çš„ç±»å‹æ˜¯ BeanReference åˆ™è¯´æ˜å…¶æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆå¯¹åº”äº XML ä¸­çš„ refï¼‰ï¼Œé€šè¿‡ getBean å¯¹å…¶è¿›è¡Œè·å–ï¼Œç„¶åæ³¨å…¥åˆ°å±æ€§ä¸­ã€‚ ApplicationContextä»¥ ApplicationContext æ¥å£ä¸ºæ ¸å¿ƒå‘æ•£å‡ºçš„å‡ ä¸ªç±»ï¼Œä¸»è¦æ˜¯å¯¹å‰é¢ Resouce ã€ BeanFactoryã€BeanDefinition è¿›è¡Œäº†åŠŸèƒ½çš„å°è£…ï¼Œè§£å†³ æ ¹æ®åœ°å€è·å– IoC å®¹å™¨å¹¶ä½¿ç”¨ çš„é—®é¢˜ã€‚ ç±»å è¯´æ˜ ApplicationContext æ ‡è®°æ¥å£ï¼Œç»§æ‰¿äº† BeanFactoryã€‚é€šå¸¸ï¼Œè¦å®ç°ä¸€ä¸ª IoC å®¹å™¨æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡ ResourceLoader è·å–ä¸€ä¸ª Resourceï¼Œå…¶ä¸­åŒ…æ‹¬äº†å®¹å™¨çš„é…ç½®ã€Bean çš„å®šä¹‰ä¿¡æ¯ã€‚æ¥ç€ï¼Œä½¿ç”¨ BeanDefinitionReader è¯»å–è¯¥ Resource ä¸­çš„ BeanDefinition ä¿¡æ¯ã€‚æœ€åï¼ŒæŠŠ BeanDefinition ä¿å­˜åœ¨ BeanFactory ä¸­ï¼Œå®¹å™¨é…ç½®å®Œæ¯•å¯ä»¥ä½¿ç”¨ã€‚æ³¨æ„åˆ° BeanFactory åªå®ç°äº† Bean çš„ è£…é…ã€è·å–ï¼Œå¹¶æœªè¯´æ˜ Bean çš„ æ¥æº ä¹Ÿå°±æ˜¯ BeanDefinition æ˜¯å¦‚ä½• åŠ è½½ çš„ã€‚è¯¥æ¥å£æŠŠ BeanFactory å’Œ BeanDefinitionReader ç»“åˆåœ¨äº†ä¸€èµ·ã€‚ AbstractApplicationContext ApplicationContext çš„æŠ½è±¡å®ç°ï¼Œå†…éƒ¨åŒ…å«ä¸€ä¸ª BeanFactory ç±»ã€‚ä¸»è¦æ–¹æ³•æœ‰ getBean() å’Œ refresh() æ–¹æ³•ã€‚getBean() ç›´æ¥è°ƒç”¨äº†å†…ç½® BeanFactory çš„ getBean() æ–¹æ³•ï¼Œrefresh() åˆ™ç”¨äºå®ç° BeanFactory çš„åˆ·æ–°ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ BeanFactory è¯¥ä½¿ç”¨å“ªä¸ªèµ„æºï¼ˆResourceï¼‰åŠ è½½ç±»å®šä¹‰ï¼ˆBeanDefinitionï¼‰ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•ç•™ç»™å­ç±»å®ç°ï¼Œç”¨ä»¥å®ç° ä»ä¸åŒæ¥æºçš„ä¸åŒç±»å‹çš„èµ„æºåŠ è½½ç±»å®šä¹‰ çš„æ•ˆæœã€‚ ClassPathXmlApplicationContext ä»ç±»è·¯å¾„åŠ è½½èµ„æºçš„å…·ä½“å®ç°ç±»ã€‚å†…éƒ¨é€šè¿‡ XmlBeanDefinitionReader è§£æ UrlResourceLoader è¯»å–åˆ°çš„ Resourceï¼Œè·å– BeanDefinition ä¿¡æ¯ï¼Œç„¶åå°†å…¶ä¿å­˜åˆ°å†…ç½®çš„ BeanFactory ä¸­ã€‚ å¯¹ ApplicatinoContext çš„åˆ†å±‚æ›´ä¸ºç»†è‡´ã€‚AbstractApplicationContext ä¸­ä¸ºäº†å®ç° ä¸åŒæ¥æº çš„ ä¸åŒç±»å‹ çš„èµ„æºåŠ è½½ç±»å®šä¹‰ï¼ŒæŠŠè¿™ä¸¤æ­¥åˆ†å±‚å®ç°ã€‚ä»¥â€œä»ç±»è·¯å¾„è¯»å– XML å®šä¹‰â€ä¸ºä¾‹ï¼Œé¦–å…ˆä½¿ç”¨ AbstractXmlApplicationContext æ¥å®ç° ä¸åŒç±»å‹ çš„èµ„æºè§£æï¼Œæ¥ç€ï¼Œé€šè¿‡ ClassPathXmlApplicationContext æ¥å®ç° ä¸åŒæ¥æº çš„èµ„æºè§£æã€‚ æˆ˜ç•¥è§‚æœ› å®¹å™¨å¯åŠ¨é˜¶æ®µä½¿ç”¨Resourceç›¸å…³æ¥å£æ ‡è¯†æˆ‘ä»¬é…ç½®æ–‡ä»¶ä»å“ªé‡Œè·å–ï¼Œç„¶åä½¿ç”¨BeanDefinitionReaderå¯¹æ ‡è¯†çš„æ–‡ä»¶è¿›è¡Œè§£æï¼Œå°†åˆ†æåçš„ä¿¡æ¯ç¼–ç»„ä¸ºç›¸åº”çš„BeanDefinitionã€‚æœ€åå°†ä¿å­˜äº†æ¯ä¸ªBeanå®šä¹‰ä¿¡æ¯çš„BeanDefinitionï¼Œæ³¨å†Œåˆ°ç›¸åº”çš„BeanDefinitionRegistryï¼Œè¿™æ ·å®¹å™¨çš„å¯åŠ¨å°±å®Œæˆäº†ã€‚ å¯åŠ¨é˜¶æ®µä»»åŠ¡ Beanå®ä¾‹åŒ–é˜¶æ®µé€šè¿‡å®¹å™¨çš„å¯åŠ¨é˜¶æ®µï¼Œç°åœ¨æ‰€æœ‰çš„Beanå®šä¹‰çš„ä¿¡æ¯ï¼Œéƒ½é€šè¿‡BeanDefinitonçš„æ–¹å¼æ³¨å†Œåˆ°äº†BeanDefinitionRegistryä¸­ï¼Œå½“æŸä¸ªè¯·æ±‚æ–¹é€šè¿‡å®¹å™¨çš„getBeanæ–¹æ³•æ˜ç¡®çš„è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ–è€…å› ä¸ºä¾èµ–å…³ç³»å®¹å™¨éœ€è¦éšå¼çš„è°ƒç”¨getBeanæ–¹æ³•ï¼Œå°±ä¼šå‡ºå‘ç¬¬äºŒé˜¶æ®µçš„æ´»åŠ¨ã€‚ beançš„å®ä¾‹åŒ–è¿‡ç¨‹ Springå®¹å™¨å°†å¯¹å…¶æ‰€ç®¡ç†çš„å¯¹è±¡å…¨éƒ¨ç»™äºˆç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè¿™äº›è¢«ç®¡ç†çš„å¯¹è±¡å®Œå…¨æ‘†è„±äº†åŸ æ¥é‚£ç§â€œnewå®Œåè¢«ä½¿ç”¨ï¼Œè„±ç¦»ä½œç”¨åŸŸåå³è¢«å›æ”¶â€çš„å‘½è¿ è¯¦ç»†é˜è¿°æœ€ç®€å•çš„IoCå®¹å™¨public class BeanFactory { // è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªmap private Map&lt;String, Object&gt; beanMap = new HashMap&lt;&gt;(); public void registerBean(String name, Object bean) { beanMap.put(name, bean); } public Object getBean(String name) { return beanMap.get(name); } } public class SimpleBeanContainerTest { @Test public void testGetBean() throws Exception { // éœ€è¦æˆ‘ä»¬å»æ‰‹åŠ¨newä¾èµ–å¯¹è±¡ï¼Œç„¶åæ”¾å…¥ BeanFactory beanFactory = new BeanFactory(); beanFactory.registerBean(\"helloService\", new HelloService()); HelloService helloService = (HelloService) beanFactory.getBean(\"helloService\"); assertThat(helloService).isNotNull(); assertThat(helloService.sayHello()).isEqualTo(\"hello\"); } class HelloService { public String sayHello() { System.out.println(\"hello\"); return \"hello\"; } } } BeanFactoryPostProcesså’ŒBeanPostProcessorBeanFactoryPostProcesså’ŒBeanPostProcessoræ˜¯springæ¡†æ¶ä¸­å…·æœ‰é‡é‡çº§åœ°ä½çš„ä¸¤ä¸ªæ¥å£ï¼Œç†è§£äº†è¿™ä¸¤ä¸ªæ¥å£çš„ä½œç”¨ï¼ŒåŸºæœ¬å°±ç†è§£springçš„æ ¸å¿ƒåŸç†äº† BeanFactoryPostProcessoræ˜¯springæä¾›çš„å®¹å™¨æ‹“å±•æœºåˆ¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨beanå®ä¾‹åŒ–ä¹‹å‰ä¿®æ”¹beançš„å®šä¹‰ä¿¡æ¯ï¼ˆBeanDedinitionï¼‰ï¼Œå…¶é‡è¦çš„å®ç°ç±»PropertyPlaceholderConfigurerå’ŒCustomEditorConfigurer PropertyPlaceholderConfigurerçš„ä½œç”¨æ˜¯ç”¨propertiesæ–‡ä»¶çš„é…ç½®å€¼æ›¿æ¢xmlæ–‡ä»¶ä¸­çš„å ä½ç¬¦ CustomEditorConfigurerçš„ä½œç”¨æ˜¯å®ç°ç±»å‹è½¬æ¢ã€‚ BeanPostProcessorä¹Ÿæ˜¯springæä¾›çš„å®¹å™¨æ‹“å±•æœºåˆ¶ï¼Œä¸åŒäºBeanFactoryPostProcessorï¼ŒBeanPostProcesssoråœ¨Beanå®ä¾‹åŒ–ä¹‹åä¿®æ”¹Beanæˆ–æ›¿æ¢Beanã€‚ä¹Ÿæ˜¯å®ç°AOPçš„å…³é”®ã€‚ ç­‰ç­‰ç­‰ã€‚ã€‚ã€‚ æ•´ä½“æµç¨‹å›¾ æ•´ä½“æµç¨‹å›¾ BeanDefinitionReaderè¯»å–Beançš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†è¯»å–åˆ°çš„ä¿¡æ¯ä½¿ç”¨BeanDefinitionè¡¨ç¤ºï¼ŒåŒæ—¶æ³¨å†Œåˆ°BeanDefinitionRegistryä¸­ã€‚ é€šè¿‡å®ç°äº†BeanFactoryPostProcessorçš„ç±»ï¼Œè‡ªå®šä¹‰ä¿®æ”¹BeanDefinitionä¸­çš„ä¿¡æ¯ Beançš„å®ä¾‹åŒ– é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œç­–ç•¥åŒ–Beançš„å®ä¾‹ï¼Œå…±åŒ…å«ä¸¤ç§æ–¹å¼ï¼šcglibã€åå°„ è·å–Beançš„å®ä¾‹ä¹‹åï¼Œæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯ï¼Œå¡«å……Beançš„å±æ€§ã€ä¾èµ– æ£€æµ‹å„ç§æ£€æµ‹å„ç§Awareæ¥å£ï¼Œå¹¶æ”¾å…¥Beanä¸­ è°ƒç”¨BeanPostProcessoræ¥å£çš„å‰ç½®å¤„ç†æ–¹æ³•ï¼Œå¤„ç†ç¬¦åˆè¦æ±‚çš„Beanå®ä¾‹ å¦‚æœå®ç°äº†InitializingBeanæ¥å£ï¼Œåˆ™å¤„ç†å¯¹åº”çš„afterPropertiesSet()æ–¹æ³• å¦‚æœå®šä¹‰init-methodæ–¹æ³•ï¼Œå¤„ç†å¯¹åº”çš„åˆå§‹åŒ–æ–¹æ³• è°ƒç”¨BeanPostProcessoræ¥å£çš„åç½®å¤„ç†æ–¹æ³•ï¼Œå¤„ç†ç¬¦åˆè¦æ±‚çš„Beanå®ä¾‹ ä½¿ç”¨ åˆ¤æ–­Beançš„Scopeï¼Œå¦‚æœæ˜¯prototypeï¼Œä¸å†ç®¡ç† å¦‚æœæ˜¯å•ä¾‹ï¼Œå¦‚æœå®ç°äº†DisposableBeanæ¥å£ï¼Œåˆ™æ‰§è¡Œå¯¹åº”çš„destroyæ–¹æ³• å¦‚æœå®šä¹‰äº†destory-methodï¼Œåˆ™æ‰§è¡Œè‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³• ç»“æŸæ•´ç†çš„è¿˜æ˜¯å¾ˆä¹±ï¼Œè™½ç„¶çœ‹çš„æ—¶å€™æ˜¯éƒ½çœ‹äº†ã€‚ã€‚ã€‚ åé¢æ…¢æ…¢ä¼˜åŒ–å§ï¼ˆæ¶‰åŠåˆ°ä»¥å==æ°¸è¿œä¸ä¼šï¼‰ğŸ˜‘ references springæ­ç§˜ tiny-spring mini-spring tiny-springåˆ†æ Spring IoCå®¹å™¨åˆ†æ Spring IOC å®¹å™¨æºç åˆ†æç³»åˆ—","categories":[{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/categories/spring/"}],"tags":[{"name":"ioc","slug":"ioc","permalink":"https://winniekun.github.io/tags/ioc/"}]},{"title":"å½’å¹¶æ’åº","slug":"ç®—æ³•/æ’åº/å½’å¹¶æ’åº","date":"2021-04-30T13:35:01.000Z","updated":"2021-06-17T04:51:19.309Z","comments":true,"path":"å½’å¹¶æ’åº/","link":"","permalink":"https://winniekun.github.io/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/","excerpt":"","text":"å½’å¹¶æ’åºæ­¥éª¤ å…ˆé€‰æ‹©åˆ†ç•Œç‚¹ å…ˆé€’å½’æ’åº å½’å¹¶ åˆäºŒä¸ºä¸€ Support/typora-user-images/image-20210419120203122.png private static void mergeSort(int[] array, int l, int r) { if (l &gt;= r) { return; } int mid = (l + r) / 2; mergeSort(array, l, mid); mergeSort(array, mid+1, r); // æ•´åˆ int[] tmp = new int[r - l + 1]; // ä¸´æ—¶æ•°ç»„, ç”¨äºä¸´æ—¶å­˜å‚¨ [l,r]åŒºé—´å†…æ’å¥½åºçš„æ•°æ® int i = l, j = mid + 1, k = 0; // ä¸¤ä¸ªæŒ‡é’ˆ // è¿›è¡Œå½’å¹¶ while (i &lt;= mid &amp;&amp; j &lt;= r) { if (array[i] &lt;= array[j]) tmp[k++] = array[i++]; else tmp[k++] = array[j++]; } while (i &lt;= mid) tmp[k++] = array[i++]; while (j &lt;= r) tmp[k++] = array[j++]; // è¿›è¡Œèµ‹å€¼ for (i = l, j = 0; i &lt;= r; i++, j++) array[i] = tmp[j]; }","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[{"name":"å½’å¹¶æ’åº","slug":"å½’å¹¶æ’åº","permalink":"https://winniekun.github.io/tags/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"}]},{"title":"æ­»ç£•æ•°å­¦åŸºç¡€","slug":"LeetCode/stick-to-math","date":"2021-04-20T11:56:11.000Z","updated":"2021-05-16T16:42:07.999Z","comments":true,"path":"stick-to-math/","link":"","permalink":"https://winniekun.github.io/stick-to-math/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—åäºŒï¼š æ•°å­¦åŸºç¡€ è¯´å®è¯ï¼Œå…¶å®éƒ½æ˜¯åˆ·é¢˜éƒ½æ˜¯æ•°å­¦çš„å®ç°ï¼Œä¸è¿‡æ„Ÿè§‰æœ‰äº›é¢˜ç›®æ›´åŠ åå‘æ•°å­¦åº”ç”¨ï¼Œè­¬å¦‚è“„æ°´æ± ï¼Œç­‰æ¦‚ç‡æŠ½æ ·â€¦ã€‚","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—åäºŒï¼š æ•°å­¦åŸºç¡€ è¯´å®è¯ï¼Œå…¶å®éƒ½æ˜¯åˆ·é¢˜éƒ½æ˜¯æ•°å­¦çš„å®ç°ï¼Œä¸è¿‡æ„Ÿè§‰æœ‰äº›é¢˜ç›®æ›´åŠ åå‘æ•°å­¦åº”ç”¨ï¼Œè­¬å¦‚è“„æ°´æ± ï¼Œç­‰æ¦‚ç‡æŠ½æ ·â€¦ã€‚ é¢˜ç›®470 ç”¨rand7()å®ç°Rand10()ä»æœ€åŸºç¡€çš„è®²èµ·å¦‚ä½•åšåˆ°å‡åŒ€çš„ç”Ÿæˆéšæœºæ•° ä»ä¸Šè¿°çš„æ–‡ç« å¯ä»¥å¾—å‡ºï¼š å·²çŸ¥: $randN()$å¯ä»¥==ç­‰æ¦‚ç‡==ç”Ÿæˆ$[1, N]$èŒƒå›´çš„æ•°å­—é‚£ä¹ˆ: $(randN()-1) \\times Y + randY()$å¯ä»¥==ç­‰æ¦‚ç‡==ç”Ÿæˆ$[1, Y \\times N]$ èŒƒå›´çš„æ•°å­— å³ï¼šå®ç°äº†$randNY()$ ä»¥$[(rand9() - 1) \\times 7 + rand7()]$ä¸ºä¾‹å­ rand9()-1\\rand7 1 2 3 4 5 6 7 0 1 2 3 4 5 6 7 1 8 9 10 11 12 13 14 2 15 16 17 18 19 20 21 3 22 23 24 25 26 27 28 4 29 30 31 32 33 34 35 5 36 37 38 39 40 41 42 6 43 44 45 46 47 48 49 7 50 51 52 53 54 55 56 8 57 58 59 60 61 62 63 æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œæ•°å­¦è¯æ˜ä¸ä¼š é‚£ä¹ˆæƒ³åˆ°é€šè¿‡rand4()æ¥å®ç°rand2()å‘¢ï¼Ÿè¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œå·²çŸ¥rand4()ä¼šå‡åŒ€äº§ç”Ÿ[1,4]çš„éšæœºæ•°ï¼Œé€šè¿‡å–ä½™ï¼Œå†åŠ 1å°±å¯ä»¥äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œç»“æœä¹Ÿæ˜¯ç­‰æ¦‚ç‡çš„ã€‚ rand4() % 2 + 1 = ? 1 % 2 + 1 = 2 2 % 2 + 1 = 1 3 % 2 + 1 = 2 4 % 2 + 1 = 1 äº‹å®ä¸Šï¼Œåªè¦rand_N()ä¸­Næ˜¯2çš„å€æ•°ï¼Œå°±éƒ½å¯ä»¥ç”¨æ¥å®ç°rand2()ï¼Œåä¹‹ï¼Œè‹¥Nä¸æ˜¯2çš„å€æ•°ï¼Œåˆ™äº§ç”Ÿçš„ç»“æœä¸æ˜¯ç­‰æ¦‚ç‡çš„ã€‚æ¯”å¦‚ï¼š rand6() % 2 + 1 = ? 1 % 2 + 1 = 2 2 % 2 + 1 = 1 3 % 2 + 1 = 2 4 % 2 + 1 = 1 5 % 2 + 1 = 2 6 % 2 + 1 = 1 rand5() % 2 + 1 = ? 1 % 2 + 1 = 2 2 % 2 + 1 = 1 3 % 2 + 1 = 2 4 % 2 + 1 = 1 5 % 2 + 1 = 2 é€šç”¨ä¸€äº›çš„ å¦‚æœéœ€è¦å®ç°$randX()$ å…ˆå®ç°$randN()$ $N$ä¸º$X$çš„å€æ•°ï¼ˆ$N&gt;X$ï¼‰ å†é€šè¿‡ $randN() \\% X + 1$å³å¯ public int rand10() { // rand 49 while (true) { int num = (rand7() - 1) * 7 + rand7(); // rand49 if (num &lt;= 40) { // ä½¿ç”¨æ‹’ç»é‡‡æ ·ï¼Œå¾—åˆ°rand40 return num % 10 + 1; // rand10 } } } ä¼˜åŒ– class Solution extends SolBase { // ä¸Šè¿°æ‹’ç»äº†9ä¸ªæ•°å­—ï¼Œ // ä¼˜åŒ–ä¹‹åï¼Œå‡å°‘ä¸¢å¼ƒå€¼ï¼Œæé«˜å‘½ä¸­ç‡ public int rand10() { while(true) { int a = rand7(); int b = rand7(); int num = (a-1)*7 + b; // rand 49 if(num &lt;= 40) return num % 10 + 1; // æ‹’ç»é‡‡æ · a = num - 40; // rand 9 b = rand7(); num = (a-1)*7 + b; // rand 63 if(num &lt;= 60) return num % 10 + 1; a = num - 60; // rand 3 b = rand7(); num = (a-1)*7 + b; // rand 21 if(num &lt;= 20) return num % 10 + 1; } } }","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"æ•°å­¦åŸºç¡€","slug":"æ•°å­¦åŸºç¡€","permalink":"https://winniekun.github.io/tags/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/"}]},{"title":"æ­»ç£•SQL","slug":"LeetCode/stick-to-sql","date":"2021-04-20T11:56:11.000Z","updated":"2021-05-16T16:39:43.618Z","comments":true,"path":"stick-to-sql/","link":"","permalink":"https://winniekun.github.io/stick-to-sql/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—åï¼š SQL","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—åï¼š SQL ä½œä¸ºä¸€ä¸ªåç«¯å¼€å‘ç¨‹åºå‘˜ï¼ŒSQLåŠŸåº•è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼ï¼ï¼ æ‰€ä»¥è¿˜æ˜¯è¦ç»ƒä¹ ã€‚ è¿˜è®°å¾—å»å¹´è¢«å­—èŠ‚é¢è¯•çš„æ—¶å€™ï¼Œè¿SQLéƒ½å†™ä¸å‡ºæ¥ã€‚ã€‚ã€‚ LeetCode SQLé¢˜ç›®æ•´ç†åˆ·äº†LCä¸Šçš„top70ä¹‹åï¼Œæ„Ÿè§‰è€ƒå¯Ÿæœ€å¤šçš„è¿˜æ˜¯å¤šè¡¨çš„è”åˆæŸ¥æ‰¾ï¼Œæ¯•ç«Ÿå®é™…ä¸­ä¹Ÿä¸ä¼šä»…ä»…æ˜¯å•è¡¨çš„æŸ¥è¯¢ã€‚ ä¸»è¦é¢˜å‹ï¼š TOP N é—®é¢˜ æ’åé—®é¢˜ æ»‘åŠ¨çª—å£ è‡ªé“¾æ¥é—®é¢˜ é¢˜è§£TOP Né—®é¢˜176. ç¬¬äºŒé«˜çš„è–ªæ°´æ€è·¯ï¼š ä½¿ç”¨limit æ³¨æ„åˆ¤ç©ºã€å»é‡ select ifnull ((select distinct Salary from Employee order by Salary desc limit 1, 1) , null) as SecondHighestSalary; å…ˆä½¿ç”¨maxæŸ¥è¯¢æœ€é«˜çš„è–ªæ°´ maxï¼Œä¹‹åå†é€šè¿‡è‡ªæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å°äºmaxçš„max 184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥-- æ€è·¯ï¼š å¯»æ‰¾æœ€å¤§è–ªèµ„çš„æ•°æ® -- join -- 1. ç›´æ¥join group by é€‰å–æœ€å¤§çš„å³å¯ ä½†æ˜¯ æ— æ³•ä¿è¯æœ€å¤§çš„è–ªèµ„ä¸é‡å¤ å¤±è´¥ -- 2. å…ˆé€šè¿‡å‘˜å·¥ä¿¡æ¯ å¯»æ‰¾æœ€å¤§çš„è–ªèµ„+id çš„æ•°æ®Aï¼Œç„¶åå†join ä¸¤å¼ è¡¨ï¼Œå°†Aä¸­å¯¹åº”çš„æ•°æ®è¿”å› -- 1. select d.Name as Department, e.Name as Employee, e.Salary as Salary from Employee e inner join Department d on e.DepartmentId = d.Id where (e.DepartmentId, e.Salary) in (select DepartmentId, max(Salary) from Employee group by DepartmentId); 177. ç¬¬Né«˜çš„è–ªæ°´LIMIT PAGE, OFFSET è·³è¿‡ PAGE * OFFSETæ¡æ•°æ®ï¼Œæ¥ä¸‹æ¥çš„offsetæ¡æ•°æ®ï¼Œ å› ä¸ºé¢˜ç›®ä¸­æœªè¯´æ˜è–ªèµ„æ˜¯å¦ä¸é‡å¤ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨distinctå»é‡ CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT BEGIN set N:= N-1; RETURN ( # Write your MySQL query statement below. select distinct Salary from Employee order by Salary desc limit N,1 ); END 185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥select d.Name as Department, e2.Name as Employee, e2.Salary from Department d inner join ( select e.*, dense_rank() over(partition by DepartmentID Order by Salary DESC) as 'rank' from Employee e ) e2 on d.Id= e2.DepartmentID where e2.rank&lt;=3 order by Department AND Salary æ’åé—®é¢˜178.åˆ†æ•°æ’åselect Score, dense_rank() over(order by Score desc) as `Rank` from Scores; è‡ªé“¾æ¥é—®é¢˜603. è¿ç»­ç©ºä½™åº§ä½-- å‡ ä¸ªæœ‹å‹æ¥åˆ°ç”µå½±é™¢çš„å”®ç¥¨å¤„ï¼Œå‡†å¤‡é¢„çº¦è¿ç»­ç©ºä½™åº§ä½ã€‚ -- ä½ èƒ½åˆ©ç”¨è¡¨ cinema ï¼Œå¸®ä»–ä»¬å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè·å–æ‰€æœ‰ç©ºä½™åº§ä½ï¼Œå¹¶å°†å®ƒä»¬æŒ‰ç…§ seat_id æ’åºåè¿”å›å—ï¼Ÿ select distinct a.seat_id from cinema a join cinema b on abs(a.seat_id - b.seat_id) = 1 and a.free = true and b.free = true order by a.seat_id","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"SQL","slug":"SQL","permalink":"https://winniekun.github.io/tags/SQL/"}]},{"title":"æ­»ç£•å¤šçº¿ç¨‹","slug":"LeetCode/stick-to-multi-thread","date":"2021-04-14T11:56:11.000Z","updated":"2021-06-06T07:56:37.628Z","comments":true,"path":"stick-to-multi-thread/","link":"","permalink":"https://winniekun.github.io/stick-to-multi-thread/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—åä¸€ï¼š å¤šçº¿ç¨‹","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—åä¸€ï¼š å¤šçº¿ç¨‹ çœ‹é‚£ä¹ˆå¤šçš„é¢ç»ï¼Œå‘ç°å·²ç»å¼€å§‹è¯¢é—®å¤šçº¿ç¨‹çš„ç¼–ç¨‹äº†ã€‚ä¸ªäººæ„Ÿè§‰å¤šçº¿ç¨‹ç¼–ç¨‹ä¸»è¦æ˜¯ç†è§£ï¼Œæ€æƒ³ã€‚æ˜¯æœ‰å›ºå®šçš„å¥—è·¯çš„ï¼Œè­¬å¦‚ï¼šäº¤æ›¿è¾“å‡ºï¼Œæœ‰åºçš„è¾“å‡ºå“‡ã€‚æ·±æŒ–ä¸‹å»å°±æ˜¯è€ƒå¯Ÿå¯¹çº¿ç¨‹é€šè®¯çš„ä½¿ç”¨ï¼Œä»¥åŠä¸€äº›é«˜é˜¶ç”¨æ³•ã€‚å’Œå“²å­¦å®¶å°±é¤é—®é¢˜ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€è¯»å†™è€…é—®é¢˜å·®ä¸å¤šã€‚ æ‰€ä»¥ï½ï½ï½ æˆ‘æ¥å¼€å§‹ç†Ÿæ‚‰å¹¶å‘æ“ä½œäº†ï¼Œæ¯•ç«Ÿå…‰çœ‹ä¸ç»ƒå‡æŠŠå¼ LeetCode å¤šçº¿ç¨‹é¢˜ç›®æ•´ç†1114. æŒ‰åºæ‰“å°","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://winniekun.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"}]},{"title":"ä¸€è¡Œä¸€è¡Œæºç åˆ†ææ¸…æ¥šAbstractQueuedSynchronizer","slug":"Javaè¿›é˜¶/å¹¶å‘/ä¸€è¡Œä¸€è¡Œæºç åˆ†ææ¸…æ¥šAbstractQueuedSynchronizer","date":"2021-03-30T12:14:20.000Z","updated":"2021-04-05T12:19:21.814Z","comments":true,"path":"ä¸€è¡Œä¸€è¡Œæºç åˆ†ææ¸…æ¥šAbstractQueuedSynchronizer/","link":"","permalink":"https://winniekun.github.io/%E4%B8%80%E8%A1%8C%E4%B8%80%E8%A1%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E6%B8%85%E6%A5%9AAbstractQueuedSynchronizer/","excerpt":"åœ¨åˆ†æ Java å¹¶å‘åŒ… java.util.concurrent æºç çš„æ—¶å€™ï¼Œå°‘ä¸äº†éœ€è¦äº†è§£ AbstractQueuedSynchronizerï¼ˆä»¥ä¸‹ç®€å†™AQSï¼‰è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå› ä¸ºå®ƒæ˜¯ Java å¹¶å‘åŒ…çš„åŸºç¡€å·¥å…·ç±»ï¼Œæ˜¯å®ç° ReentrantLockã€CountDownLatchã€Semaphoreã€FutureTask ç­‰ç±»çš„åŸºç¡€ã€‚ Google ä¸€ä¸‹ AbstractQueuedSynchronizerï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¾ˆå¤šå…³äº AQS çš„ä»‹ç»ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ²¡æœ‰ä»‹ç»æ¸…æ¥šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ–‡ç« æ²¡æœ‰æŠŠå…¶ä¸­çš„ä¸€äº›å…³é”®çš„ç»†èŠ‚è¯´æ¸…æ¥šã€‚ æœ¬æ–‡å°†ä» ReentrantLock çš„å…¬å¹³é”æºç å‡ºå‘ï¼Œåˆ†æä¸‹ AbstractQueuedSynchronizer è¿™ä¸ªç±»æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶æä¾›ä¸€äº›ç®€å•çš„å¸®åŠ©ã€‚","text":"åœ¨åˆ†æ Java å¹¶å‘åŒ… java.util.concurrent æºç çš„æ—¶å€™ï¼Œå°‘ä¸äº†éœ€è¦äº†è§£ AbstractQueuedSynchronizerï¼ˆä»¥ä¸‹ç®€å†™AQSï¼‰è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå› ä¸ºå®ƒæ˜¯ Java å¹¶å‘åŒ…çš„åŸºç¡€å·¥å…·ç±»ï¼Œæ˜¯å®ç° ReentrantLockã€CountDownLatchã€Semaphoreã€FutureTask ç­‰ç±»çš„åŸºç¡€ã€‚ Google ä¸€ä¸‹ AbstractQueuedSynchronizerï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¾ˆå¤šå…³äº AQS çš„ä»‹ç»ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ²¡æœ‰ä»‹ç»æ¸…æ¥šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ–‡ç« æ²¡æœ‰æŠŠå…¶ä¸­çš„ä¸€äº›å…³é”®çš„ç»†èŠ‚è¯´æ¸…æ¥šã€‚ æœ¬æ–‡å°†ä» ReentrantLock çš„å…¬å¹³é”æºç å‡ºå‘ï¼Œåˆ†æä¸‹ AbstractQueuedSynchronizer è¿™ä¸ªç±»æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶æä¾›ä¸€äº›ç®€å•çš„å¸®åŠ©ã€‚ ç”³æ˜ä»¥ä¸‹å‡ ç‚¹ï¼š æœ¬æ–‡æœ‰ç‚¹é•¿ï¼Œä½†è¿˜æ˜¯æŒºç®€å•ï¼Œä¸»è¦é¢å‘è¯»è€…å¯¹è±¡ä¸ºå¹¶å‘ç¼–ç¨‹çš„åˆå­¦è€…ï¼Œæˆ–è€…æƒ³è¦é˜…è¯» Java å¹¶å‘åŒ…æºç çš„å¼€å‘è€…ã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¯èƒ½éœ€è¦èŠ±å¥½å‡ ä¸ªå°æ—¶æ‰èƒ½å®Œå…¨çœ‹æ‡‚ï¼Œä½†æ˜¯è¿™æ—¶é—´è‚¯å®šæ˜¯å€¼å¾—çš„ã€‚ æºç ç¯å¢ƒ JDK1.7ï¼ˆ1.8æ²¡å•¥å˜åŒ–ï¼‰ï¼Œçœ‹åˆ°ä¸æ‡‚æˆ–æœ‰ç–‘æƒ‘çš„éƒ¨åˆ†ï¼Œæœ€å¥½èƒ½è‡ªå·±æ‰“å¼€æºç çœ‹çœ‹ã€‚Doug Lea å¤§ç¥çš„ä»£ç å†™å¾—çœŸå¿ƒä¸é”™ã€‚ æœ¬æ–‡ä¸åˆ†æå…±äº«æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥ç»™è¯»è€…å‡å°‘å¾ˆå¤šè´Ÿæ‹…ï¼Œç¬¬ä¸‰ç¯‡æ–‡ç« å¯¹å…±äº«æ¨¡å¼è¿›è¡Œäº†åˆ†æã€‚è€Œä¸”ä¹Ÿä¸åˆ†æ condition éƒ¨åˆ†ï¼Œæ‰€ä»¥åº”è¯¥è¯´å¾ˆå®¹æ˜“å°±å¯ä»¥çœ‹æ‡‚äº†ã€‚ æœ¬æ–‡å¤§é‡ä½¿ç”¨æˆ‘ä»¬å¹³æ—¶ç”¨å¾—æœ€å¤šçš„ ReentrantLock çš„æ¦‚å¿µï¼Œæœ¬è´¨ä¸Šæ¥è¯´æ˜¯ä¸æ­£ç¡®çš„ï¼Œè¯»è€…åº”è¯¥æ¸…æ¥šï¼ŒAQS ä¸ä»…ä»…ç”¨æ¥å®ç°å¯é‡å…¥é”ï¼Œåªæ˜¯å¸Œæœ›è¯»è€…å¯ä»¥ç”¨é”æ¥è”æƒ³ AQS çš„ä½¿ç”¨åœºæ™¯ï¼Œé™ä½é˜…è¯»å‹åŠ›ã€‚ ReentrantLock çš„å…¬å¹³é”å’Œéå…¬å¹³é”åªæœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œç¬¬äºŒç¯‡æ–‡ç« åšäº†ä»‹ç»ã€‚ è¯„è®ºåŒºæœ‰è¯»è€…åé¦ˆæœ¬æ–‡ç›´æ¥ç”¨ä»£ç è¯´ä¸å‹å¥½ï¼Œåº”è¯¥å¤šé…ç‚¹æµç¨‹å›¾ï¼Œè¿™ç¯‡æ–‡ç« ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ä½œä¸ºè¿‡æ¥äººï¼Œæˆ‘æƒ³å‘Šè¯‰å¤§å®¶ï¼Œå¯¹äº AQS æ¥è¯´ï¼Œå½¢å¼çœŸçš„ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æŠŠç»†èŠ‚è¯´æ¸…æ¥šã€‚ AQS ç»“æ„å…ˆæ¥çœ‹çœ‹ AQS æœ‰å“ªäº›å±æ€§ï¼Œææ¸…æ¥šè¿™äº›åŸºæœ¬å°±çŸ¥é“ AQS æ˜¯ä»€ä¹ˆå¥—è·¯äº†ï¼Œæ¯•ç«Ÿå¯ä»¥çŒœå˜›ï¼ // å¤´ç»“ç‚¹ï¼Œä½ ç›´æ¥æŠŠå®ƒå½“åš å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ å¯èƒ½æ˜¯æœ€å¥½ç†è§£çš„ private transient volatile Node head; // é˜»å¡çš„å°¾èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ–°çš„èŠ‚ç‚¹è¿›æ¥ï¼Œéƒ½æ’å…¥åˆ°æœ€åï¼Œä¹Ÿå°±å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ private transient volatile Node tail; // è¿™ä¸ªæ˜¯æœ€é‡è¦çš„ï¼Œä»£è¡¨å½“å‰é”çš„çŠ¶æ€ï¼Œ0ä»£è¡¨æ²¡æœ‰è¢«å ç”¨ï¼Œå¤§äº 0 ä»£è¡¨æœ‰çº¿ç¨‹æŒæœ‰å½“å‰é” // è¿™ä¸ªå€¼å¯ä»¥å¤§äº 1ï¼Œæ˜¯å› ä¸ºé”å¯ä»¥é‡å…¥ï¼Œæ¯æ¬¡é‡å…¥éƒ½åŠ ä¸Š 1 private volatile int state; // ä»£è¡¨å½“å‰æŒæœ‰ç‹¬å é”çš„çº¿ç¨‹ï¼Œä¸¾ä¸ªæœ€é‡è¦çš„ä½¿ç”¨ä¾‹å­ï¼Œå› ä¸ºé”å¯ä»¥é‡å…¥ // reentrantLock.lock()å¯ä»¥åµŒå¥—è°ƒç”¨å¤šæ¬¡ï¼Œæ‰€ä»¥æ¯æ¬¡ç”¨è¿™ä¸ªæ¥åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»æ‹¥æœ‰äº†é” // if (currentThread == getExclusiveOwnerThread()) {state++} private transient Thread exclusiveOwnerThread; //ç»§æ‰¿è‡ªAbstractOwnableSynchronizer æ€ä¹ˆæ ·ï¼Œçœ‹æ ·å­åº”è¯¥æ˜¯å¾ˆç®€å•çš„å§ï¼Œæ¯•ç«Ÿä¹Ÿå°±å››ä¸ªå±æ€§å•Šã€‚ AbstractQueuedSynchronizer çš„ç­‰å¾…é˜Ÿåˆ—ç¤ºæ„å¦‚ä¸‹æ‰€ç¤ºï¼Œæ³¨æ„äº†ï¼Œä¹‹ååˆ†æè¿‡ç¨‹ä¸­æ‰€è¯´çš„ queueï¼Œä¹Ÿå°±æ˜¯é˜»å¡é˜Ÿåˆ—ä¸åŒ…å« headï¼Œä¸åŒ…å« headï¼Œä¸åŒ…å« headã€‚ aqs-0 ç­‰å¾…é˜Ÿåˆ—ä¸­æ¯ä¸ªçº¿ç¨‹è¢«åŒ…è£…æˆä¸€ä¸ª Node å®ä¾‹ï¼Œæ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œä¸€èµ·çœ‹çœ‹æºç å§ï¼š static final class Node { // æ ‡è¯†èŠ‚ç‚¹å½“å‰åœ¨å…±äº«æ¨¡å¼ä¸‹ static final Node SHARED = new Node(); // æ ‡è¯†èŠ‚ç‚¹å½“å‰åœ¨ç‹¬å æ¨¡å¼ä¸‹ static final Node EXCLUSIVE = null; // ======== ä¸‹é¢çš„å‡ ä¸ªintå¸¸é‡æ˜¯ç»™waitStatusç”¨çš„ =========== /** waitStatus value to indicate thread has cancelled */ // ä»£ç æ­¤çº¿ç¨‹å–æ¶ˆäº†äº‰æŠ¢è¿™ä¸ªé” static final int CANCELLED = 1; /** waitStatus value to indicate successor's thread needs unparking */ // å®˜æ–¹çš„æè¿°æ˜¯ï¼Œå…¶è¡¨ç¤ºå½“å‰nodeçš„åç»§èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’ static final int SIGNAL = -1; /** waitStatus value to indicate thread is waiting on condition */ // æœ¬æ–‡ä¸åˆ†æconditionï¼Œæ‰€ä»¥ç•¥è¿‡å§ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šä»‹ç»è¿™ä¸ª static final int CONDITION = -2; /** * waitStatus value to indicate the next acquireShared should * unconditionally propagate */ // åŒæ ·çš„ä¸åˆ†æï¼Œç•¥è¿‡å§ static final int PROPAGATE = -3; // ===================================================== // å–å€¼ä¸ºä¸Šé¢çš„1ã€-1ã€-2ã€-3ï¼Œæˆ–è€…0(ä»¥åä¼šè®²åˆ°) // è¿™ä¹ˆç†è§£ï¼Œæš‚æ—¶åªéœ€è¦çŸ¥é“å¦‚æœè¿™ä¸ªå€¼ å¤§äº0 ä»£è¡¨æ­¤çº¿ç¨‹å–æ¶ˆäº†ç­‰å¾…ï¼Œ // ps: åŠå¤©æŠ¢ä¸åˆ°é”ï¼Œä¸æŠ¢äº†ï¼ŒReentrantLockæ˜¯å¯ä»¥æŒ‡å®štimeouotçš„ã€‚ã€‚ã€‚ volatile int waitStatus; // å‰é©±èŠ‚ç‚¹çš„å¼•ç”¨ volatile Node prev; // åç»§èŠ‚ç‚¹çš„å¼•ç”¨ volatile Node next; // è¿™ä¸ªå°±æ˜¯çº¿ç¨‹æœ¬å°Š volatile Thread thread; } Node çš„æ•°æ®ç»“æ„å…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯ thread + waitStatus + pre + next å››ä¸ªå±æ€§è€Œå·²ï¼Œå¤§å®¶å…ˆè¦æœ‰è¿™ä¸ªæ¦‚å¿µåœ¨å¿ƒé‡Œã€‚ ä¸Šé¢çš„æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œåé¢ä¼šå¤šæ¬¡ç”¨åˆ°ï¼Œå¿ƒé‡Œè¦æ—¶åˆ»è®°ç€å®ƒä»¬ï¼Œå¿ƒé‡Œæƒ³ç€è¿™ä¸ªç»“æ„å›¾å°±å¯ä»¥äº†ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹è¯´ ReentrantLock çš„å…¬å¹³é”ã€‚å†æ¬¡å¼ºè°ƒï¼Œæˆ‘è¯´çš„é˜»å¡é˜Ÿåˆ—ä¸åŒ…å« head èŠ‚ç‚¹ã€‚ aqs-0 é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ ReentrantLock çš„ä½¿ç”¨æ–¹å¼ã€‚ // æˆ‘ç”¨ä¸ªwebå¼€å‘ä¸­çš„serviceæ¦‚å¿µå§ public class OrderService { // ä½¿ç”¨staticï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„æ˜¯åŒä¸€æŠŠé”ï¼Œå½“ç„¶ï¼Œspring mvcä¸­serviceé»˜è®¤å°±æ˜¯å•ä¾‹ï¼Œåˆ«çº ç»“è¿™ä¸ª private static ReentrantLock reentrantLock = new ReentrantLock(true); public void createOrder() { // æ¯”å¦‚æˆ‘ä»¬åŒä¸€æ—¶é—´ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºè®¢å• reentrantLock.lock(); // é€šå¸¸ï¼Œlock ä¹‹åç´§è·Ÿç€ try è¯­å¥ try { // è¿™å—ä»£ç åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›æ¥(è·å–åˆ°é”çš„çº¿ç¨‹)ï¼Œ // å…¶ä»–çš„çº¿ç¨‹åœ¨lock()æ–¹æ³•ä¸Šé˜»å¡ï¼Œç­‰å¾…è·å–åˆ°é”ï¼Œå†è¿›æ¥ // æ‰§è¡Œä»£ç ... // æ‰§è¡Œä»£ç ... // æ‰§è¡Œä»£ç ... } finally { // é‡Šæ”¾é” reentrantLock.unlock(); } } } ReentrantLock åœ¨å†…éƒ¨ç”¨äº†å†…éƒ¨ç±» Sync æ¥ç®¡ç†é”ï¼Œæ‰€ä»¥çœŸæ­£çš„è·å–é”å’Œé‡Šæ”¾é”æ˜¯ç”± Sync çš„å®ç°ç±»æ¥æ§åˆ¶çš„ã€‚ abstract static class Sync extends AbstractQueuedSynchronizer { } Sync æœ‰ä¸¤ä¸ªå®ç°ï¼Œåˆ†åˆ«ä¸º NonfairSyncï¼ˆéå…¬å¹³é”ï¼‰å’Œ FairSyncï¼ˆå…¬å¹³é”ï¼‰ï¼Œæˆ‘ä»¬çœ‹ FairSync éƒ¨åˆ†ã€‚ public ReentrantLock(boolean fair) { sync = fair ? new FairSync() : new NonfairSync(); } çº¿ç¨‹æŠ¢é”å¾ˆå¤šäººè‚¯å®šå¼€å§‹å«Œå¼ƒä¸Šé¢åºŸè¯å¤ªå¤šäº†ï¼Œä¸‹é¢è·Ÿç€ä»£ç èµ°ï¼Œæˆ‘å°±ä¸åºŸè¯äº†ã€‚ static final class FairSync extends Sync { private static final long serialVersionUID = -3000897897090466540L; // äº‰é” final void lock() { acquire(1); } // æ¥è‡ªçˆ¶ç±»AQSï¼Œæˆ‘ç›´æ¥è´´è¿‡æ¥è¿™è¾¹ï¼Œä¸‹é¢åˆ†æçš„æ—¶å€™åŒæ ·ä¼šè¿™æ ·åšï¼Œä¸ä¼šç»™è¯»è€…å¸¦æ¥é˜…è¯»å‹åŠ› // æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœtryAcquire(arg) è¿”å›true, ä¹Ÿå°±ç»“æŸäº†ã€‚ // å¦åˆ™ï¼ŒacquireQueuedæ–¹æ³•ä¼šå°†çº¿ç¨‹å‹åˆ°é˜Ÿåˆ—ä¸­ public final void acquire(int arg) { // æ­¤æ—¶ arg == 1 // é¦–å…ˆè°ƒç”¨tryAcquire(1)ä¸€ä¸‹ï¼Œåå­—ä¸Šå°±çŸ¥é“ï¼Œè¿™ä¸ªåªæ˜¯è¯•ä¸€è¯• // å› ä¸ºæœ‰å¯èƒ½ç›´æ¥å°±æˆåŠŸäº†å‘¢ï¼Œä¹Ÿå°±ä¸éœ€è¦è¿›é˜Ÿåˆ—æ’äº†ï¼Œ // å¯¹äºå…¬å¹³é”çš„è¯­ä¹‰å°±æ˜¯ï¼šæœ¬æ¥å°±æ²¡äººæŒæœ‰é”ï¼Œæ ¹æœ¬æ²¡å¿…è¦è¿›é˜Ÿåˆ—ç­‰å¾…(åˆæ˜¯æŒ‚èµ·ï¼Œåˆæ˜¯ç­‰å¾…è¢«å”¤é†’çš„) if (!tryAcquire(arg) &amp;&amp; // tryAcquire(arg)æ²¡æœ‰æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œæ”¾åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚ acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) { selfInterrupt(); } } /** * Fair version of tryAcquire. Don't grant access unless * recursive call or no waiters or is first. */ // å°è¯•ç›´æ¥è·å–é”ï¼Œè¿”å›å€¼æ˜¯booleanï¼Œä»£è¡¨æ˜¯å¦è·å–åˆ°é” // è¿”å›trueï¼š1.æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é”ï¼›2.é‡å…¥é”ï¼Œçº¿ç¨‹æœ¬æ¥å°±æŒæœ‰é”ï¼Œä¹Ÿå°±å¯ä»¥ç†æ‰€å½“ç„¶å¯ä»¥ç›´æ¥è·å– protected final boolean tryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); // state == 0 æ­¤æ—¶æ­¤åˆ»æ²¡æœ‰çº¿ç¨‹æŒæœ‰é” if (c == 0) { // è™½ç„¶æ­¤æ—¶æ­¤åˆ»é”æ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†æ˜¯è¿™æ˜¯å…¬å¹³é”ï¼Œæ—¢ç„¶æ˜¯å…¬å¹³ï¼Œå°±å¾—è®²ç©¶å…ˆæ¥ååˆ°ï¼Œ // çœ‹çœ‹æœ‰æ²¡æœ‰åˆ«äººåœ¨é˜Ÿåˆ—ä¸­ç­‰äº†åŠå¤©äº† if (!hasQueuedPredecessors() &amp;&amp; // å¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£å°±ç”¨CASå°è¯•ä¸€ä¸‹ï¼ŒæˆåŠŸäº†å°±è·å–åˆ°é”äº†ï¼Œ // ä¸æˆåŠŸçš„è¯ï¼Œåªèƒ½è¯´æ˜ä¸€ä¸ªé—®é¢˜ï¼Œå°±åœ¨åˆšåˆšå‡ ä¹åŒä¸€æ—¶åˆ»æœ‰ä¸ªçº¿ç¨‹æŠ¢å…ˆäº† =_= // å› ä¸ºåˆšåˆšè¿˜æ²¡äººçš„ï¼Œæˆ‘åˆ¤æ–­è¿‡äº† compareAndSetState(0, acquires)) { // åˆ°è¿™é‡Œå°±æ˜¯è·å–åˆ°é”äº†ï¼Œæ ‡è®°ä¸€ä¸‹ï¼Œå‘Šè¯‰å¤§å®¶ï¼Œç°åœ¨æ˜¯æˆ‘å ç”¨äº†é” setExclusiveOwnerThread(current); return true; } } // ä¼šè¿›å…¥è¿™ä¸ªelse ifåˆ†æ”¯ï¼Œè¯´æ˜æ˜¯é‡å…¥äº†ï¼Œéœ€è¦æ“ä½œï¼šstate=state+1 // è¿™é‡Œä¸å­˜åœ¨å¹¶å‘é—®é¢˜ else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc &lt; 0) throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; } // å¦‚æœåˆ°è¿™é‡Œï¼Œè¯´æ˜å‰é¢çš„ifå’Œelse iféƒ½æ²¡æœ‰è¿”å›trueï¼Œè¯´æ˜æ²¡æœ‰è·å–åˆ°é” // å›åˆ°ä¸Šé¢ä¸€ä¸ªå¤–å±‚è°ƒç”¨æ–¹æ³•ç»§ç»­çœ‹: // if (!tryAcquire(arg) // &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) // selfInterrupt(); return false; } // å‡è®¾tryAcquire(arg) è¿”å›falseï¼Œé‚£ä¹ˆä»£ç å°†æ‰§è¡Œï¼š // acquireQueued(addWaiter(Node.EXCLUSIVE), arg)ï¼Œ // è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦æ‰§è¡Œï¼šaddWaiter(Node.EXCLUSIVE) /** * Creates and enqueues node for current thread and given mode. * * @param mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared * @return the new node */ // æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠçº¿ç¨‹åŒ…è£…æˆnodeï¼ŒåŒæ—¶è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­ // å‚æ•°modeæ­¤æ—¶æ˜¯Node.EXCLUSIVEï¼Œä»£è¡¨ç‹¬å æ¨¡å¼ private Node addWaiter(Node mode) { Node node = new Node(Thread.currentThread(), mode); // Try the fast path of enq; backup to full enq on failure // ä»¥ä¸‹å‡ è¡Œä»£ç æƒ³æŠŠå½“å‰nodeåŠ åˆ°é“¾è¡¨çš„æœ€åé¢å»ï¼Œä¹Ÿå°±æ˜¯è¿›åˆ°é˜»å¡é˜Ÿåˆ—çš„æœ€å Node pred = tail; // tail!=null =&gt; é˜Ÿåˆ—ä¸ä¸ºç©º(tail==headçš„æ—¶å€™ï¼Œå…¶å®é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä¸è¿‡ä¸ç®¡è¿™ä¸ªå§) if (pred != null) { // å°†å½“å‰çš„é˜Ÿå°¾èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸ºè‡ªå·±çš„å‰é©± node.prev = pred; // ç”¨CASæŠŠè‡ªå·±è®¾ç½®ä¸ºé˜Ÿå°¾, å¦‚æœæˆåŠŸåï¼Œtail == node äº†ï¼Œè¿™ä¸ªèŠ‚ç‚¹æˆä¸ºé˜»å¡é˜Ÿåˆ—æ–°çš„å°¾å·´ if (compareAndSetTail(pred, node)) { // è¿›åˆ°è¿™é‡Œè¯´æ˜è®¾ç½®æˆåŠŸï¼Œå½“å‰node==tail, å°†è‡ªå·±ä¸ä¹‹å‰çš„é˜Ÿå°¾ç›¸è¿ï¼Œ // ä¸Šé¢å·²ç»æœ‰ node.prev = predï¼ŒåŠ ä¸Šä¸‹é¢è¿™å¥ï¼Œä¹Ÿå°±å®ç°äº†å’Œä¹‹å‰çš„å°¾èŠ‚ç‚¹åŒå‘è¿æ¥äº† pred.next = node; // çº¿ç¨‹å…¥é˜Ÿäº†ï¼Œå¯ä»¥è¿”å›äº† return node; } } // ä»”ç»†çœ‹çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœä¼šåˆ°è¿™é‡Œï¼Œ // è¯´æ˜ pred==null(é˜Ÿåˆ—æ˜¯ç©ºçš„) æˆ–è€… CASå¤±è´¥(æœ‰çº¿ç¨‹åœ¨ç«äº‰å…¥é˜Ÿ) // è¯»è€…ä¸€å®šè¦è·Ÿä¸Šæ€è·¯ï¼Œå¦‚æœæ²¡æœ‰è·Ÿä¸Šï¼Œå»ºè®®å…ˆä¸è¦å¾€ä¸‹è¯»äº†ï¼Œå¾€å›ä»”ç»†çœ‹ï¼Œå¦åˆ™ä¼šæµªè´¹æ—¶é—´çš„ enq(node); return node; } /** * Inserts node into queue, initializing if necessary. See picture above. * @param node the node to insert * @return node's predecessor */ // é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼å…¥é˜Ÿ // ä¹‹å‰è¯´è¿‡ï¼Œåˆ°è¿™ä¸ªæ–¹æ³•åªæœ‰ä¸¤ç§å¯èƒ½ï¼šç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…æœ‰çº¿ç¨‹ç«äº‰å…¥é˜Ÿï¼Œ // è‡ªæ—‹åœ¨è¿™è¾¹çš„è¯­ä¹‰æ˜¯ï¼šCASè®¾ç½®tailè¿‡ç¨‹ä¸­ï¼Œç«äº‰ä¸€æ¬¡ç«äº‰ä¸åˆ°ï¼Œæˆ‘å°±å¤šæ¬¡ç«äº‰ï¼Œæ€»ä¼šæ’åˆ°çš„ private Node enq(final Node node) { for (;;) { Node t = tail; // ä¹‹å‰è¯´è¿‡ï¼Œé˜Ÿåˆ—ä¸ºç©ºä¹Ÿä¼šè¿›æ¥è¿™é‡Œ if (t == null) { // Must initialize // åˆå§‹åŒ–headèŠ‚ç‚¹ // ç»†å¿ƒçš„è¯»è€…ä¼šçŸ¥é“åŸæ¥ head å’Œ tail åˆå§‹åŒ–çš„æ—¶å€™éƒ½æ˜¯ null çš„ // è¿˜æ˜¯ä¸€æ­¥CASï¼Œä½ æ‡‚çš„ï¼Œç°åœ¨å¯èƒ½æ˜¯å¾ˆå¤šçº¿ç¨‹åŒæ—¶è¿›æ¥å‘¢ if (compareAndSetHead(new Node())) // ç»™åé¢ç”¨ï¼šè¿™ä¸ªæ—¶å€™headèŠ‚ç‚¹çš„waitStatus==0, çœ‹new Node()æ„é€ æ–¹æ³•å°±çŸ¥é“äº† // è¿™ä¸ªæ—¶å€™æœ‰äº†headï¼Œä½†æ˜¯tailè¿˜æ˜¯nullï¼Œè®¾ç½®ä¸€ä¸‹ï¼Œ // æŠŠtailæŒ‡å‘headï¼Œæ”¾å¿ƒï¼Œé©¬ä¸Šå°±æœ‰çº¿ç¨‹è¦æ¥äº†ï¼Œåˆ°æ—¶å€™tailå°±è¦è¢«æŠ¢äº† // æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯è®¾ç½®äº†tail=headï¼Œè¿™é‡Œå¯æ²¡returnå“¦ï¼Œæ²¡æœ‰returnï¼Œæ²¡æœ‰return // æ‰€ä»¥ï¼Œè®¾ç½®å®Œäº†ä»¥åï¼Œç»§ç»­forå¾ªç¯ï¼Œä¸‹æ¬¡å°±åˆ°ä¸‹é¢çš„elseåˆ†æ”¯äº† tail = head; } else { // ä¸‹é¢å‡ è¡Œï¼Œå’Œä¸Šä¸€ä¸ªæ–¹æ³• addWaiter æ˜¯ä¸€æ ·çš„ï¼Œ // åªæ˜¯è¿™ä¸ªå¥—åœ¨æ— é™å¾ªç¯é‡Œï¼Œåæ­£å°±æ˜¯å°†å½“å‰çº¿ç¨‹æ’åˆ°é˜Ÿå°¾ï¼Œæœ‰çº¿ç¨‹ç«äº‰çš„è¯æ’ä¸ä¸Šé‡å¤æ’ node.prev = t; if (compareAndSetTail(t, node)) { t.next = node; return t; } } } } // ç°åœ¨ï¼Œåˆå›åˆ°è¿™æ®µä»£ç äº† // if (!tryAcquire(arg) // &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) // selfInterrupt(); // ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œå‚æ•°nodeï¼Œç»è¿‡addWaiter(Node.EXCLUSIVE)ï¼Œæ­¤æ—¶å·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ— // æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœacquireQueued(addWaiter(Node.EXCLUSIVE), arg))è¿”å›trueçš„è¯ï¼Œ // æ„å‘³ç€ä¸Šé¢è¿™æ®µä»£ç å°†è¿›å…¥selfInterrupt()ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸‹é¢åº”è¯¥è¿”å›false // è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œåº”è¯¥è¯´çœŸæ­£çš„çº¿ç¨‹æŒ‚èµ·ï¼Œç„¶åè¢«å”¤é†’åå»è·å–é”ï¼Œéƒ½åœ¨è¿™ä¸ªæ–¹æ³•é‡Œäº† final boolean acquireQueued(final Node node, int arg) { boolean failed = true; try { boolean interrupted = false; for (;;) { final Node p = node.predecessor(); // p == head è¯´æ˜å½“å‰èŠ‚ç‚¹è™½ç„¶è¿›åˆ°äº†é˜»å¡é˜Ÿåˆ—ï¼Œä½†æ˜¯æ˜¯é˜»å¡é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºå®ƒçš„å‰é©±æ˜¯head // æ³¨æ„ï¼Œé˜»å¡é˜Ÿåˆ—ä¸åŒ…å«headèŠ‚ç‚¹ï¼Œheadä¸€èˆ¬æŒ‡çš„æ˜¯å æœ‰é”çš„çº¿ç¨‹ï¼Œheadåé¢çš„æ‰ç§°ä¸ºé˜»å¡é˜Ÿåˆ— // æ‰€ä»¥å½“å‰èŠ‚ç‚¹å¯ä»¥å»è¯•æŠ¢ä¸€ä¸‹é” // è¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå¯ä»¥å»è¯•è¯•ï¼š // é¦–å…ˆï¼Œå®ƒæ˜¯é˜Ÿå¤´ï¼Œè¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå…¶æ¬¡ï¼Œå½“å‰çš„headæœ‰å¯èƒ½æ˜¯åˆšåˆšåˆå§‹åŒ–çš„nodeï¼Œ // enq(node) æ–¹æ³•é‡Œé¢æœ‰æåˆ°ï¼Œheadæ˜¯å»¶æ—¶åˆå§‹åŒ–çš„ï¼Œè€Œä¸”new Node()çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä»»ä½•çº¿ç¨‹ // ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çš„headä¸å±äºä»»ä½•ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä½œä¸ºé˜Ÿå¤´ï¼Œå¯ä»¥å»è¯•ä¸€è¯•ï¼Œ // tryAcquireå·²ç»åˆ†æè¿‡äº†, å¿˜è®°äº†è¯·å¾€å‰çœ‹ä¸€ä¸‹ï¼Œå°±æ˜¯ç®€å•ç”¨CASè¯•æ“ä½œä¸€ä¸‹state if (p == head &amp;&amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC failed = false; return interrupted; } // åˆ°è¿™é‡Œï¼Œè¯´æ˜ä¸Šé¢çš„ifåˆ†æ”¯æ²¡æœ‰æˆåŠŸï¼Œè¦ä¹ˆå½“å‰nodeæœ¬æ¥å°±ä¸æ˜¯é˜Ÿå¤´ï¼Œ // è¦ä¹ˆå°±æ˜¯tryAcquire(arg)æ²¡æœ‰æŠ¢èµ¢åˆ«äººï¼Œç»§ç»­å¾€ä¸‹çœ‹ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; } } finally { // ä»€ä¹ˆæ—¶å€™ failed ä¼šä¸º true??? // tryAcquire() æ–¹æ³•æŠ›å¼‚å¸¸çš„æƒ…å†µ if (failed) cancelAcquire(node); } } /** * Checks and updates status for a node that failed to acquire. * Returns true if thread should block. This is the main signal * control in all acquire loops. Requires that pred == node.prev * * @param pred node's predecessor holding status * @param node the node * @return {@code true} if thread should block */ // åˆšåˆšè¯´è¿‡ï¼Œä¼šåˆ°è¿™é‡Œå°±æ˜¯æ²¡æœ‰æŠ¢åˆ°é”å‘—ï¼Œè¿™ä¸ªæ–¹æ³•è¯´çš„æ˜¯ï¼š\"å½“å‰çº¿ç¨‹æ²¡æœ‰æŠ¢åˆ°é”ï¼Œæ˜¯å¦éœ€è¦æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Ÿ\" // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‰é©±èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰æ˜¯ä»£è¡¨å½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹ private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { int ws = pred.waitStatus; // å‰é©±èŠ‚ç‚¹çš„ waitStatus == -1 ï¼Œè¯´æ˜å‰é©±èŠ‚ç‚¹çŠ¶æ€æ­£å¸¸ï¼Œå½“å‰çº¿ç¨‹éœ€è¦æŒ‚èµ·ï¼Œç›´æ¥å¯ä»¥è¿”å›true if (ws == Node.SIGNAL) /* * This node has already set status asking a release * to signal it, so it can safely park. */ return true; // å‰é©±èŠ‚ç‚¹ waitStatuså¤§äº0 ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå¤§äº0 è¯´æ˜å‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿã€‚ // è¿™é‡Œéœ€è¦çŸ¥é“è¿™ç‚¹ï¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—æ’é˜Ÿçš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè€Œå”¤é†’çš„æ“ä½œæ˜¯ç”±å‰é©±èŠ‚ç‚¹å®Œæˆçš„ã€‚ // æ‰€ä»¥ä¸‹é¢è¿™å—ä»£ç è¯´çš„æ˜¯å°†å½“å‰èŠ‚ç‚¹çš„prevæŒ‡å‘waitStatus&lt;=0çš„èŠ‚ç‚¹ï¼Œ // ç®€å•è¯´ï¼Œå°±æ˜¯ä¸ºäº†æ‰¾ä¸ªå¥½çˆ¹ï¼Œå› ä¸ºä½ è¿˜å¾—ä¾èµ–å®ƒæ¥å”¤é†’å‘¢ï¼Œå¦‚æœå‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿï¼Œ // æ‰¾å‰é©±èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹åšçˆ¹ï¼Œå¾€å‰éå†æ€»èƒ½æ‰¾åˆ°ä¸€ä¸ªå¥½çˆ¹çš„ if (ws &gt; 0) { /* * Predecessor was cancelled. Skip over predecessors and * indicate retry. */ do { node.prev = pred = pred.prev; } while (pred.waitStatus &gt; 0); pred.next = node; } else { /* * waitStatus must be 0 or PROPAGATE. Indicate that we * need a signal, but don't park yet. Caller will need to * retry to make sure it cannot acquire before parking. */ // ä»”ç»†æƒ³æƒ³ï¼Œå¦‚æœè¿›å…¥åˆ°è¿™ä¸ªåˆ†æ”¯æ„å‘³ç€ä»€ä¹ˆ // å‰é©±èŠ‚ç‚¹çš„waitStatusä¸ç­‰äº-1å’Œ1ï¼Œé‚£ä¹Ÿå°±æ˜¯åªå¯èƒ½æ˜¯0ï¼Œ-2ï¼Œ-3 // åœ¨æˆ‘ä»¬å‰é¢çš„æºç ä¸­ï¼Œéƒ½æ²¡æœ‰çœ‹åˆ°æœ‰è®¾ç½®waitStatusçš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ–°çš„nodeå…¥é˜Ÿæ—¶ï¼ŒwaitStatuéƒ½æ˜¯0 // æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‰é©±èŠ‚ç‚¹æ˜¯ä¹‹å‰çš„ tailï¼Œé‚£ä¹ˆå®ƒçš„ waitStatus åº”è¯¥æ˜¯ 0 // ç”¨CASå°†å‰é©±èŠ‚ç‚¹çš„waitStatusè®¾ç½®ä¸ºNode.SIGNAL(ä¹Ÿå°±æ˜¯-1) compareAndSetWaitStatus(pred, ws, Node.SIGNAL); } // è¿™ä¸ªæ–¹æ³•è¿”å› falseï¼Œé‚£ä¹ˆä¼šå†èµ°ä¸€æ¬¡ for å¾ªåºï¼Œ // ç„¶åå†æ¬¡è¿›æ¥æ­¤æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šä»ç¬¬ä¸€ä¸ªåˆ†æ”¯è¿”å› true return false; } // private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) // è¿™ä¸ªæ–¹æ³•ç»“æŸæ ¹æ®è¿”å›å€¼æˆ‘ä»¬ç®€å•åˆ†æä¸‹ï¼š // å¦‚æœè¿”å›true, è¯´æ˜å‰é©±èŠ‚ç‚¹çš„waitStatus==-1ï¼Œæ˜¯æ­£å¸¸æƒ…å†µï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹éœ€è¦è¢«æŒ‚èµ·ï¼Œç­‰å¾…ä»¥åè¢«å”¤é†’ // æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œä»¥åæ˜¯è¢«å‰é©±èŠ‚ç‚¹å”¤é†’ï¼Œå°±ç­‰ç€å‰é©±èŠ‚ç‚¹æ‹¿åˆ°é”ï¼Œç„¶åé‡Šæ”¾é”çš„æ—¶å€™å«ä½ å¥½äº† // å¦‚æœè¿”å›false, è¯´æ˜å½“å‰ä¸éœ€è¦è¢«æŒ‚èµ·ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¾€åçœ‹ // è·³å›åˆ°å‰é¢æ˜¯è¿™ä¸ªæ–¹æ³• // if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; // parkAndCheckInterrupt()) // interrupted = true; // 1. å¦‚æœshouldParkAfterFailedAcquire(p, node)è¿”å›trueï¼Œ // é‚£ä¹ˆéœ€è¦æ‰§è¡ŒparkAndCheckInterrupt(): // è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œå› ä¸ºå‰é¢è¿”å›trueï¼Œæ‰€ä»¥éœ€è¦æŒ‚èµ·çº¿ç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£æŒ‚èµ·çº¿ç¨‹çš„ // è¿™é‡Œç”¨äº†LockSupport.park(this)æ¥æŒ‚èµ·çº¿ç¨‹ï¼Œç„¶åå°±åœåœ¨è¿™é‡Œäº†ï¼Œç­‰å¾…è¢«å”¤é†’======= private final boolean parkAndCheckInterrupt() { LockSupport.park(this); return Thread.interrupted(); } // 2. æ¥ä¸‹æ¥è¯´è¯´å¦‚æœshouldParkAfterFailedAcquire(p, node)è¿”å›falseçš„æƒ…å†µ // ä»”ç»†çœ‹shouldParkAfterFailedAcquire(p, node)ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®ç¬¬ä¸€æ¬¡è¿›æ¥çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šè¿”å›trueçš„ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå‰é©±èŠ‚ç‚¹çš„waitStatus=-1æ˜¯ä¾èµ–äºåç»§èŠ‚ç‚¹è®¾ç½®çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘éƒ½è¿˜æ²¡ç»™å‰é©±è®¾ç½®-1å‘¢ï¼Œæ€ä¹ˆå¯èƒ½æ˜¯trueå‘¢ï¼Œä½†æ˜¯è¦çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¥—åœ¨å¾ªç¯é‡Œçš„ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è¿›æ¥çš„æ—¶å€™çŠ¶æ€å°±æ˜¯-1äº†ã€‚ // è§£é‡Šä¸‹ä¸ºä»€ä¹ˆshouldParkAfterFailedAcquire(p, node)è¿”å›falseçš„æ—¶å€™ä¸ç›´æ¥æŒ‚èµ·çº¿ç¨‹ï¼š // =&gt; æ˜¯ä¸ºäº†åº”å¯¹åœ¨ç»è¿‡è¿™ä¸ªæ–¹æ³•åï¼Œnodeå·²ç»æ˜¯headçš„ç›´æ¥åç»§èŠ‚ç‚¹äº†ã€‚å‰©ä¸‹çš„è¯»è€…è‡ªå·±æƒ³æƒ³å§ã€‚ } è¯´åˆ°è¿™é‡Œï¼Œä¹Ÿå°±æ˜ç™½äº†ï¼Œå¤šçœ‹å‡ é final boolean acquireQueued(final Node node, int arg) è¿™ä¸ªæ–¹æ³•å§ã€‚è‡ªå·±æ¨æ¼”ä¸‹å„ä¸ªåˆ†æ”¯æ€ä¹ˆèµ°ï¼Œå“ªç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œèµ°åˆ°å“ªé‡Œã€‚ è§£é”æ“ä½œæœ€åï¼Œå°±æ˜¯è¿˜éœ€è¦ä»‹ç»ä¸‹å”¤é†’çš„åŠ¨ä½œäº†ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœçº¿ç¨‹æ²¡è·å–åˆ°é”ï¼Œçº¿ç¨‹ä¼šè¢« LockSupport.park(this); æŒ‚èµ·åœæ­¢ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚ // å”¤é†’çš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½ å¦‚æœä¸Šé¢åŠ é”çš„éƒ½çœ‹æ‡‚äº†ï¼Œä¸‹é¢éƒ½ä¸éœ€è¦çœ‹å°±çŸ¥é“æ€ä¹ˆå›äº‹äº† public void unlock() { sync.release(1); } public final boolean release(int arg) { // å¾€åçœ‹å§ if (tryRelease(arg)) { Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; } return false; } // å›åˆ°ReentrantLockçœ‹tryReleaseæ–¹æ³• protected final boolean tryRelease(int releases) { int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); // æ˜¯å¦å®Œå…¨é‡Šæ”¾é” boolean free = false; // å…¶å®å°±æ˜¯é‡å…¥çš„é—®é¢˜ï¼Œå¦‚æœc==0ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åµŒå¥—é”äº†ï¼Œå¯ä»¥é‡Šæ”¾äº†ï¼Œå¦åˆ™è¿˜ä¸èƒ½é‡Šæ”¾æ‰ if (c == 0) { free = true; setExclusiveOwnerThread(null); } setState(c); return free; } /** * Wakes up node's successor, if one exists. * * @param node the node */ // å”¤é†’åç»§èŠ‚ç‚¹ // ä»ä¸Šé¢è°ƒç”¨å¤„çŸ¥é“ï¼Œå‚æ•°nodeæ˜¯headå¤´ç»“ç‚¹ private void unparkSuccessor(Node node) { /* * If status is negative (i.e., possibly needing signal) try * to clear in anticipation of signalling. It is OK if this * fails or if status is changed by waiting thread. */ int ws = node.waitStatus; // å¦‚æœheadèŠ‚ç‚¹å½“å‰waitStatus&lt;0, å°†å…¶ä¿®æ”¹ä¸º0 if (ws &lt; 0) compareAndSetWaitStatus(node, ws, 0); /* * Thread to unpark is held in successor, which is normally * just the next node. But if cancelled or apparently null, * traverse backwards from tail to find the actual * non-cancelled successor. */ // ä¸‹é¢çš„ä»£ç å°±æ˜¯å”¤é†’åç»§èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ‰å¯èƒ½åç»§èŠ‚ç‚¹å–æ¶ˆäº†ç­‰å¾…ï¼ˆwaitStatus==1ï¼‰ // ä»é˜Ÿå°¾å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°waitStatus&lt;=0çš„æ‰€æœ‰èŠ‚ç‚¹ä¸­æ’åœ¨æœ€å‰é¢çš„ Node s = node.next; if (s == null || s.waitStatus &gt; 0) { s = null; // ä»åå¾€å‰æ‰¾ï¼Œä»”ç»†çœ‹ä»£ç ï¼Œä¸å¿…æ‹…å¿ƒä¸­é—´æœ‰èŠ‚ç‚¹å–æ¶ˆ(waitStatus==1)çš„æƒ…å†µ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; } if (s != null) // å”¤é†’çº¿ç¨‹ LockSupport.unpark(s.thread); } å”¤é†’çº¿ç¨‹ä»¥åï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°†ä»ä»¥ä¸‹ä»£ç ä¸­ç»§ç»­å¾€å‰èµ°ï¼š private final boolean parkAndCheckInterrupt() { LockSupport.park(this); // åˆšåˆšçº¿ç¨‹è¢«æŒ‚èµ·åœ¨è¿™é‡Œäº† return Thread.interrupted(); } // åˆå›åˆ°è¿™ä¸ªæ–¹æ³•äº†ï¼šacquireQueued(final Node node, int arg)ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œnodeçš„å‰é©±æ˜¯headäº† å¥½äº†ï¼Œåé¢å°±ä¸åˆ†ææºç äº†ï¼Œå‰©ä¸‹çš„è¿˜æœ‰é—®é¢˜è‡ªå·±å»ä»”ç»†çœ‹çœ‹ä»£ç å§ã€‚ æ€»ç»“æ€»ç»“ä¸€ä¸‹å§ã€‚ åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒåŠ é”å’Œè§£é”éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªéƒ¨ä»¶çš„åè°ƒï¼š é”çŠ¶æ€ã€‚æˆ‘ä»¬è¦çŸ¥é“é”æ˜¯ä¸æ˜¯è¢«åˆ«çš„çº¿ç¨‹å æœ‰äº†ï¼Œè¿™ä¸ªå°±æ˜¯ state çš„ä½œç”¨ï¼Œå®ƒä¸º 0 çš„æ—¶å€™ä»£è¡¨æ²¡æœ‰çº¿ç¨‹å æœ‰é”ï¼Œå¯ä»¥å»äº‰æŠ¢è¿™ä¸ªé”ï¼Œç”¨ CAS å°† state è®¾ä¸º 1ï¼Œå¦‚æœ CAS æˆåŠŸï¼Œè¯´æ˜æŠ¢åˆ°äº†é”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±æŠ¢ä¸åˆ°äº†ï¼Œå¦‚æœé”é‡å…¥çš„è¯ï¼Œstateè¿›è¡Œ +1 å°±å¯ä»¥ï¼Œè§£é”å°±æ˜¯å‡ 1ï¼Œç›´åˆ° state åˆå˜ä¸º 0ï¼Œä»£è¡¨é‡Šæ”¾é”ï¼Œæ‰€ä»¥ lock() å’Œ unlock() å¿…é¡»è¦é…å¯¹å•Šã€‚ç„¶åå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©å…¶æ¥å æœ‰é”ã€‚ çº¿ç¨‹çš„é˜»å¡å’Œè§£é™¤é˜»å¡ã€‚AQS ä¸­é‡‡ç”¨äº† LockSupport.park(thread) æ¥æŒ‚èµ·çº¿ç¨‹ï¼Œç”¨ unpark æ¥å”¤é†’çº¿ç¨‹ã€‚ é˜»å¡é˜Ÿåˆ—ã€‚å› ä¸ºäº‰æŠ¢é”çš„çº¿ç¨‹å¯èƒ½å¾ˆå¤šï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°é”ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ª queue æ¥ç®¡ç†è¿™äº›çº¿ç¨‹ï¼ŒAQS ç”¨çš„æ˜¯ä¸€ä¸ª FIFO çš„é˜Ÿåˆ—ï¼Œå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ª node éƒ½æŒæœ‰åç»§èŠ‚ç‚¹çš„å¼•ç”¨ã€‚AQS é‡‡ç”¨äº† CLH é”çš„å˜ä½“æ¥å®ç°ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« å…³äºCLHçš„ä»‹ç»ï¼Œå†™å¾—ç®€å•æ˜äº†ã€‚ ç¤ºä¾‹å›¾è§£æä¸‹é¢å±äºå›é¡¾ç¯èŠ‚ï¼Œç”¨ç®€å•çš„ç¤ºä¾‹æ¥è¯´ä¸€éï¼Œå¦‚æœä¸Šé¢çš„æœ‰äº›ä¸œè¥¿æ²¡çœ‹æ‡‚ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€æ¬¡å¸®åŠ©ä½ ç†è§£çš„æœºä¼šã€‚ é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ reentrantLock.lock()ï¼Œç¿»åˆ°æœ€å‰é¢å¯ä»¥å‘ç°ï¼ŒtryAcquire(1) ç›´æ¥å°±è¿”å› true äº†ï¼Œç»“æŸã€‚åªæ˜¯è®¾ç½®äº† state=1ï¼Œè¿ head éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼Œæ›´è°ˆä¸ä¸Šä»€ä¹ˆé˜»å¡é˜Ÿåˆ—äº†ã€‚è¦æ˜¯çº¿ç¨‹ 1 è°ƒç”¨ unlock() äº†ï¼Œæ‰æœ‰çº¿ç¨‹ 2 æ¥ï¼Œé‚£ä¸–ç•Œå°±å¤ªå¤ªå¤ªå¹³äº†ï¼Œå®Œå…¨æ²¡æœ‰äº¤é›†å˜›ï¼Œé‚£æˆ‘è¿˜è¦ AQS å¹²å˜›ã€‚ å¦‚æœçº¿ç¨‹ 1 æ²¡æœ‰è°ƒç”¨ unlock() ä¹‹å‰ï¼Œçº¿ç¨‹ 2 è°ƒç”¨äº† lock(), æƒ³æƒ³ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ çº¿ç¨‹ 2 ä¼šåˆå§‹åŒ– headã€new Node()ã€‘ï¼ŒåŒæ—¶çº¿ç¨‹ 2 ä¹Ÿä¼šæ’å…¥åˆ°é˜»å¡é˜Ÿåˆ—å¹¶æŒ‚èµ· (æ³¨æ„çœ‹è¿™é‡Œæ˜¯ä¸€ä¸ª for å¾ªç¯ï¼Œè€Œä¸”è®¾ç½® head å’Œ tail çš„éƒ¨åˆ†æ˜¯ä¸ return çš„ï¼Œåªæœ‰å…¥é˜ŸæˆåŠŸæ‰ä¼šè·³å‡ºå¾ªç¯) private Node enq(final Node node) { for (;;) { Node t = tail; if (t == null) { // Must initialize if (compareAndSetHead(new Node())) tail = head; } else { node.prev = t; if (compareAndSetTail(t, node)) { t.next = node; return t; } } } } é¦–å…ˆï¼Œæ˜¯çº¿ç¨‹ 2 åˆå§‹åŒ– head èŠ‚ç‚¹ï¼Œæ­¤æ—¶ head==tail, waitStatus==0 aqs-1 ç„¶åçº¿ç¨‹ 2 å…¥é˜Ÿï¼š aqs-2 åŒæ—¶æˆ‘ä»¬ä¹Ÿè¦çœ‹æ­¤æ—¶èŠ‚ç‚¹çš„ waitStatusï¼Œæˆ‘ä»¬çŸ¥é“ head èŠ‚ç‚¹æ˜¯çº¿ç¨‹ 2 åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶çš„ waitStatus æ²¡æœ‰è®¾ç½®ï¼Œ java é»˜è®¤ä¼šè®¾ç½®ä¸º 0ï¼Œä½†æ˜¯åˆ° shouldParkAfterFailedAcquire è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ 2 ä¼šæŠŠå‰é©±èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ head çš„waitStatusè®¾ç½®ä¸º -1ã€‚ é‚£çº¿ç¨‹ 2 èŠ‚ç‚¹æ­¤æ—¶çš„ waitStatus æ˜¯å¤šå°‘å‘¢ï¼Œç”±äºæ²¡æœ‰è®¾ç½®ï¼Œæ‰€ä»¥æ˜¯ 0ï¼› å¦‚æœçº¿ç¨‹ 3 æ­¤æ—¶å†è¿›æ¥ï¼Œç›´æ¥æ’åˆ°çº¿ç¨‹ 2 çš„åé¢å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶çº¿ç¨‹ 3 çš„ waitStatus æ˜¯ 0ï¼Œåˆ° shouldParkAfterFailedAcquire æ–¹æ³•çš„æ—¶å€™æŠŠå‰é©±èŠ‚ç‚¹çº¿ç¨‹ 2 çš„ waitStatus è®¾ç½®ä¸º -1ã€‚ aqs-3 è¿™é‡Œå¯ä»¥ç®€å•è¯´ä¸‹ waitStatus ä¸­ SIGNAL(-1) çŠ¶æ€çš„æ„æ€ï¼ŒDoug Lea æ³¨é‡Šçš„æ˜¯ï¼šä»£è¡¨åç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª waitStatus å…¶å®ä»£è¡¨çš„ä¸æ˜¯è‡ªå·±çš„çŠ¶æ€ï¼Œè€Œæ˜¯åç»§èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ª node åœ¨å…¥é˜Ÿçš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€æ”¹ä¸º SIGNALï¼Œç„¶åé˜»å¡ï¼Œç­‰å¾…è¢«å‰é©±å”¤é†’ã€‚è¿™é‡Œæ¶‰åŠçš„æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼šæœ‰çº¿ç¨‹å–æ¶ˆäº†æ’é˜Ÿã€å”¤é†’æ“ä½œã€‚å…¶å®æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œè¯»è€…ä¹Ÿå¯ä»¥é¡ºç€ â€œwaitStatusä»£è¡¨åç»§èŠ‚ç‚¹çš„çŠ¶æ€â€ è¿™ç§æ€è·¯å»çœ‹ä¸€éæºç ã€‚ ï¼ˆå…¨æ–‡å®Œï¼‰","categories":[{"name":"concurrency","slug":"concurrency","permalink":"https://winniekun.github.io/categories/concurrency/"}],"tags":[]},{"title":"2020å¹´æ€»ç»“","slug":"ç¢ç¢å¿µ/2020å¹´æ€»ç»“","date":"2021-01-02T16:11:11.000Z","updated":"2021-01-02T16:40:50.580Z","comments":true,"path":"2020å¹´æ€»ç»“/","link":"","permalink":"https://winniekun.github.io/2020%E5%B9%B4%E6%80%BB%E7%BB%93/","excerpt":"å•Š","text":"å•Š 2020å¹´åˆ°åº•è¿˜æ˜¯ç»“æŸäº†ï¼Œæ„Ÿè§‰ç°åœ¨çš„è‡ªå·±ä¹Ÿä¸å–œæ¬¢åšå„ç§é˜¶æ®µæ€§æ€»ç»“äº†ï¼Œæ€»æ„Ÿè§‰æŠŠè‡ªå·±çš„ç»å†å†™å‡ºæ¥æ˜¯ä¸€ç§ç‰¹åˆ«çŸ«æƒ…çš„äº‹æƒ…ã€‚ç›¸åï¼Œæ›´æƒ³æŠŠè¿™äº›ç»å†ä»…ä¾›è‡ªå·±æ…¢æ…¢å›å‘³å’Œæ„Ÿè§¦ã€‚ä½†æ˜¯ï¼Œæ—¶é—´ä¹…äº†ï¼Œæœ‰äº›ä¸œè¥¿è®°å¾—å°±ä¸å¤Ÿå®¢è§‚äº†ï¼ˆè™½ç„¶ç°åœ¨è®°å¿†çš„ä¹Ÿä¸å¤Ÿè§‚ã€‚ã€‚ã€‚ï¼‰ æ‰€ä»¥ï¼Œä»¥åçš„æ¯ä¸€å¹´éƒ½è¿˜æ˜¯åšä¸€æ¬¡å¹´ç»ˆå°ç»“å§ã€‚ ä¸ŠåŠå¹´å› ä¸ºç–«æƒ…ï¼Œä¸ŠåŠå¹´ä¸€ç›´åœ¨å®¶é‡Œå‘†ç€ï¼Œæ¯å¤©çš„ç”Ÿæ´»å·®ä¸å¤šå¦‚ä¸‹ æ—¶é—´ å¹²å•¥ ä¸Šåˆ ç½‘è¯¾ï¼ˆæŒ‚æœºï¼Œå¹²è‡ªå·±çš„äº‹æƒ…ï¼‰ ä¸‹åˆ ç½‘è¯¾ï¼ˆæŒ‚æœºï¼Œå¹²è‡ªå·±çš„äº‹æƒ…ï¼‰ æ™šä¸Š å’ŒéŸ©è€å¸ˆè¿˜æœ‰æ²ˆæ€»æ‰“æ¸¸æˆ åœ¨ä¸Šç½‘è¯¾çš„3ä¸ªæœˆé‡Œï¼Œè‡ªå·±è™½ç„¶è¯¾æ²¡å¥½å¥½ä¸Šè¿‡ï¼Œä¸è¿‡è¿˜æ˜¯åšäº†ä¸€äº›äº‹æƒ…çš„ï¼š å‰‘æŒ‡offeråˆ·äº†3é LeetCode300å¤§å…³å®Œæˆ æ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºç»ˆäºæ˜¯çœ‹æ‡‚äº† JDKæºç ï¼ˆcollectionã€jucï¼‰å—‘äº†ä¸€é HashMapçš„è®¾è®¡æ˜¯çœŸçš„ç²¾å¦™ çº¢é»‘æ ‘çœŸçš„ä¸æ˜¯æ­£å¸¸äººå†™çš„æ¥çš„ æ“ä½œç³»ç»Ÿè¿‡äº†ä¸€é ä¸ºå•¥è¦åšè¿™äº›äº‹æƒ…å˜ï¼Œä¸»è¦è¿˜æ˜¯æƒ³æ‰¾å®ä¹ ï¼Œæ„Ÿè§‰åœ¨å­¦æ ¡é‡Œé¢å‘†è…»äº†ï¼Œæƒ³å‡ºæ¥çœ‹çœ‹ï¼ˆä»€ä¹ˆ**æƒ³æ³•ï¼‰â€¦ ç»ˆäºï¼Œåœ¨æˆ‘çš„è‰°è‹¦å¤ä¹ å’Œå‡†å¤‡ä¹‹ä¸‹ï¼Œæˆ‘å¿ƒä»ªçš„å­—èŠ‚è¿˜æ˜¯æŠŠæˆ‘æ‹’ç»äº†ï¼ˆä»Šå¹´åªé¢äº†å­—èŠ‚ä¸€å®¶å¤§å‚ï¼‰ï¼Œè¢«æ‰“å‡»åˆ°äº†ä¹‹åï¼Œä¹Ÿå°±æ²¡å†ç»§ç»­æŠ•é€’å…¶ä»–å¤§å‚ã€‚åé¢é€šè¿‡ç‰›å®¢ä¸Šçš„å†…æ¨ï¼Œæ¥åˆ°äº†è”šæ¥æ±½è½¦å®ä¹ ã€‚ ä¸‹åŠå¹´ä»9æœˆä¸­æ—¬èµ·ï¼Œå¼€å§‹æˆ‘çš„å®ä¹ ç”Ÿæ´»ï¼Œä»åˆšå¼€å§‹çš„ä¸é€‚åº”ï¼Œåˆ°åé¢çš„ä¸€è„¸æ‡µé€¼ï¼Œå†åˆ°ç°åœ¨çš„å‹‰å¼ºé€‚åº”ã€‚è®©æˆ‘è®¤è¯†åˆ°äº†è‡ªå·±æŠ€æœ¯ä¸Šçš„ä¸è¶³ï¼Œä»¥åŠäº¤æµä¸Šçš„é—®é¢˜ã€‚æ‰€ä»¥åŸºæœ¬æ¯å¤©å›æ¥éƒ½ä¼šä¸»åŠ¨å»çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€è´Ÿè´£çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¶‰åŠå“ªäº›æŠ€æœ¯æ ˆï¼Œè¿™äº›æŠ€æœ¯æ ˆæ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œå’Œæˆ‘ä¹‹å‰è‡ªå·±å†™ç€ç©å„¿çš„æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è‡ªå·±ä¹Ÿå­¦ä¼šäº†åœ¨åšä»»åŠ¡çš„æ—¶å€™ï¼Œå…ˆå»çœ‹éœ€æ±‚èƒŒæ™¯ï¼Œå†å»çœ‹å®ç°æ–¹æ¡ˆï¼Œç„¶åè„‘å­æ„å»ºå®ç°æ–¹å¼ï¼Œæœ€åå†çœ‹æ˜¯æ’¸ä»£ç ã€‚é‡åˆ°äº†è‡ªå·±è§£å†³ä¸äº†çš„ï¼Œæœ‰ç–‘æƒ‘çš„åœ°æ–¹ï¼Œä¹Ÿæ¸æ¸çš„å­¦ä¼šä¸»åŠ¨å»è¯·æ•™åŒäº‹äº†ã€‚æœ€åï¼Œåœ¨è·ç¦»å®ä¹ ç»“æŸè¿˜æœ‰ä¸¤ä¸ªæœˆä¸åˆ°çš„æ—¶é—´é‡Œï¼Œå¸Œæœ›èƒ½å¤Ÿæ‹“å®½è‡ªå·±çš„æŠ€æœ¯æ ˆï¼Œç²¾è¿›è‡ªå·±çš„æŠ€æœ¯æ·±åº¦ã€‚ä¸»åŠ¨å»å’ŒåŒäº‹äº¤æµï¼Œå­¦ä¹ ç»éªŒã€‚","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"}]},{"title":"2021å¹´ä¹¦å•ã€å¹´æ±‡æ€»ã€‘","slug":"ç¢ç¢å¿µ/2021å¹´ä¹¦å•ã€å¹´æ±‡æ€»ã€‘","date":"2021-01-01T07:01:10.000Z","updated":"2021-10-14T06:34:49.619Z","comments":true,"path":"2021å¹´ä¹¦å•ã€å¹´æ±‡æ€»ã€‘/","link":"","permalink":"https://winniekun.github.io/2021%E5%B9%B4%E4%B9%A6%E5%8D%95%E3%80%90%E5%B9%B4%E6%B1%87%E6%80%BB%E3%80%91/","excerpt":"æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ æ‘˜è‡ªé¶¸é“åœº è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚","text":"æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ æ‘˜è‡ªé¶¸é“åœº è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚ ä¹¦ç±ç›¸å…³ ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—- ITåä¼ç®—æ³•ä¸æ•°æ®ç»“æ„é¢˜ç›®æœ€ä¼˜è§£ è®¡åˆ’çš„æ˜¯å»å¹´å¹´åº•å¼€å§‹åˆ·ï¼Œç„¶åè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ– å…¬å¸å®‰æ’çš„1230çš„ä»»åŠ¡æŒºå¤æ‚çš„ï¼Œè¿˜æŒºå¤šï¼Œå°±æ²¡æœ‰å¼€å§‹æ ä¸è¿‡ç»ˆäºåœ¨31å·ï¼Œä¸‹å®šå†³å¿ƒå…ˆæŠŠä¹¦ä¹°äº†ï¼Œç„¶å1å·æ­£å¼å¼€åˆ· Linux/Unixç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œ Redisçš„è®¾è®¡ä¸å®ç° C++ Primer è½¬C++å’ŒGoäº†è¦ Go ç¨‹åºæ¶‰åŠè¯­è¨€ è®¾è®¡æ¨¡å¼çš„è‰ºæœ¯ æ„Ÿè§‰ä»£ç å†™çš„æ€ªæ€ªçš„ï¼Œä¸ç¬¦åˆæ­£å¸¸ç¼–ç ä¹ æƒ¯ æ“ä½œç³»ç»Ÿå¯¼è®º æˆ‘è¿™æ¸£æ¸£è‹±è¯­èƒ½åŠ› æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼šJVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ çœ‹æ¥æ˜¯æˆé•¿äº†ï¼Œç ”ä¸€ä¸Šçœ‹çš„æ—¶å€™ï¼Œå®Œå…¨çœ‹ä¸æ‡‚ ç°åœ¨ä¹Ÿæ˜¯å¸¸çœ‹å¸¸æ–° CSAPP YYDS æ·±å…¥ç†è§£Kafkaï¼šæ ¸å¿ƒè®¾è®¡ä¸å®è·µåŸç† åŸºç¡€ + ç»éªŒæ€»ç»“ç±»å‹ï¼ŒæŒºå¥½ UNIXç½‘ç»œç¼–ç¨‹å·1 Springæ­ç§˜ å†™çš„çœŸçš„å¥½ ä¸æ„§æ˜¯å›½å†…æŠ€æœ¯ä¹¦é‡Œé¢å°‘æœ‰çš„ä¸Š9â­çš„å›¾ä¹¦ MySQLæŠ€æœ¯å†…å¹•(InnoDBå­˜å‚¨å¼•æ“) ç²¾è¿›MySQLå¿…å¤‡ Java ç¼–ç¨‹çš„é€»è¾‘ å¾ˆæœ‰æ¡ç†ï¼Œä½†æ˜¯æœ‰äº›çŸ¥è¯†ç‚¹è‡ªå·±æœ‰äº›å…ˆå…¥ä¸ºä¸»çš„åä¹ æƒ¯ï¼Œæ‰€ä»¥æœ‰äº›åœ°æ–¹ä¸å¤ªèƒ½èµåŒ TCP&amp;IPç½‘ç»œç¼–ç¨‹ æˆ‘çš„ç¬¬äºŒæœ¬Cå…¥é—¨ä¹¦ç±~ è®ºæ–‡ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡ ä¸€ç‚¹å°±é€š åˆä¼™äºº2 ï¼Ÿï¼Ÿï¼Ÿ æ¸©æš–çš„æŠ±æŠ± æ‹†å¼¹ä¸“å®¶2 é€ä½ ä¸€æœµå°çº¢èŠ± èµ˜å©¿ ä¸Šå¤´çœ‹çš„ å“ªå’é‡ç”Ÿ å¤Ÿæœ‹å…‹ ä½ å¥½æç„•è‹± å¥½çœ‹çš„ å› ä¸ºæ˜¯ç”·é«˜æ‰€ä»¥å¾ˆå¹¸ç¦ æ†¨æ‰¹ä¸€å®¶äººå“‡ ç½—å°é»‘æˆ˜ç»© æ›´æ–°äº†ï¼Œæ³ªç›® çµç¬¼ å‰§æƒ…å¾ˆæœ‰è¶£ï¼Œæ‰¹é‡ç”Ÿäº§åˆ€å­ing è£è€€ä¹’ä¹“ ä½ æ˜¯æˆ‘çš„åŸæ± è¥å’ ç™½æ•¬äº­çœŸçš„æ˜¯é€— ç„¶åBç«™ä¸Šè¿˜å…³æ³¨äº†ä»–çš„è´¦å·","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"ä¹¦å•","slug":"ä¹¦å•","permalink":"https://winniekun.github.io/tags/%E4%B9%A6%E5%8D%95/"}]},{"title":"if-elseä»£ç ä¼˜åŒ–çš„å‡ ç§æ–¹æ¡ˆ","slug":"ä»£ç è§„èŒƒ/if-else-code-optimization","date":"2020-11-02T11:46:42.000Z","updated":"2020-11-02T12:46:17.949Z","comments":true,"path":"if-else-code-optimization/","link":"","permalink":"https://winniekun.github.io/if-else-code-optimization/","excerpt":"å‰è¨€ä»£ç ä¸­æ¶‰åŠåˆ°è¾ƒä¸ºå¤æ‚çš„é€»è¾‘æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‡ºç°å¤§é‡çš„if-elseï¼Œè™½ç„¶å®ç°äº†æ•´ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯é˜…è¯»èµ·æ¥æ¯”è¾ƒè€—æ—¶ï¼Œå¹¶ä¸”ç»´æŠ¤çš„æ—¶å€™ä¹Ÿååˆ†çš„å›°éš¾ï¼ŒåŒæ—¶åªè¦æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰è€ƒè™‘æ¸…æ¥šï¼Œä¿®æ”¹èµ·æ¥å°±éš¾å…å‡ºç°bugã€‚æœ€è¿‘åœ¨åšå…¬å¸æŸä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå°±é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œç„¶ååœ¨reviewçš„æ—¶å€™ï¼ŒåŒäº‹å’Œæˆ‘è®²äº†ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œä»¥åŠé»˜è®¤çš„è§„èŒƒä¹‹åã€‚è‡ªå·±é‡æ–°ä¿®æ”¹ä¹‹åï¼Œæ„Ÿè§‰å¾ˆèˆ’æœï¼Œåç»­è‡ªå·±é‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œæ‰€ä»¥å°±å†™äº†è¿™ç¯‡åšå®¢ã€‚","text":"å‰è¨€ä»£ç ä¸­æ¶‰åŠåˆ°è¾ƒä¸ºå¤æ‚çš„é€»è¾‘æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‡ºç°å¤§é‡çš„if-elseï¼Œè™½ç„¶å®ç°äº†æ•´ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯é˜…è¯»èµ·æ¥æ¯”è¾ƒè€—æ—¶ï¼Œå¹¶ä¸”ç»´æŠ¤çš„æ—¶å€™ä¹Ÿååˆ†çš„å›°éš¾ï¼ŒåŒæ—¶åªè¦æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰è€ƒè™‘æ¸…æ¥šï¼Œä¿®æ”¹èµ·æ¥å°±éš¾å…å‡ºç°bugã€‚æœ€è¿‘åœ¨åšå…¬å¸æŸä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå°±é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œç„¶ååœ¨reviewçš„æ—¶å€™ï¼ŒåŒäº‹å’Œæˆ‘è®²äº†ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œä»¥åŠé»˜è®¤çš„è§„èŒƒä¹‹åã€‚è‡ªå·±é‡æ–°ä¿®æ”¹ä¹‹åï¼Œæ„Ÿè§‰å¾ˆèˆ’æœï¼Œåç»­è‡ªå·±é‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œæ‰€ä»¥å°±å†™äº†è¿™ç¯‡åšå®¢ã€‚ ä¼˜åŒ–æ–¹æ¡ˆä¼˜åŒ–ä¸€ï¼šæå‰returnï¼Œå»é™¤ä¸å¿…è¦çš„elseå¦‚æœif-elseä»£ç å—åŒ…å«returnè¯­å¥ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡æå‰returnï¼ŒæŠŠå¤šä½™elseå¹²æ‰ï¼Œä½¿ä»£ç æ›´åŠ ä¼˜é›…ã€‚ ä¼˜åŒ–å‰if(condition){ // do something } else { // do other thing return; } ä¼˜åŒ–åif(!condition) { return; } // do something ä¼˜åŒ–äºŒï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—ä¼˜åŒ–å‰int price; if(condition){ price = 10; } else { price = 20; } ä¼˜åŒ–åint price = condition ? 10 : 20; ä¼˜åŒ–ä¸‰ï¼šä½¿ç”¨æšä¸¾ä¼˜åŒ–å‰int orderStatus = getXXX(xxx); String OrderStatusDes; if(orderStatus == 0) { OrderStatusDes = \"è®¢å•æœªæ”¯ä»˜\"; }else if(OrderStatus == 1) { OrderStatusDes = \"è®¢å•å·²æ”¯ä»˜\"; }else if(OrderStatus == 2) { OrderStatusDes = \"å·²å‘è´§\"; } ä¼˜åŒ–åå…ˆå®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹ public enum OrderStatusEnum { UN_PAID(0,\"è®¢å•æœªæ”¯ä»˜\"),PAIDED(1,\"è®¢å•å·²æ”¯ä»˜\"),SENDED(2,\"å·²å‘è´§\"),; private int index; private String desc; public int getIndex() { return index; } public String getDesc() { return desc; } OrderStatusEnum(int index, String desc){ this.index = index; this.desc =desc; } OrderStatusEnum ofCode(int orderStatus) { for (OrderStatusEnum temp : OrderStatusEnum.values()) { if (temp.getIndex() == orderStatus) { return temp; } } return null; } } æœ‰äº†æšä¸¾ä¹‹åï¼Œä»¥ä¸Šif-elseé€»è¾‘åˆ†æ”¯ï¼Œå¯ä»¥ä¼˜åŒ–ä¸ºä¸€è¡Œä»£ç  String OrderStatusDes = OrderStatusEnum.ofCode(orderStatus).getDesc(); ä¼˜åŒ–å››ï¼šåˆå¹¶æ¡ä»¶è¡¨è¾¾å¼å¦‚æœæœ‰ä¸€ç³»åˆ—æ¡ä»¶è¿”å›ä¸€æ ·çš„ç»“æœï¼Œå¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œè®©é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚ ä¼˜åŒ–å‰double getVipDiscount() { if(age&lt;18){ return 0.8; } if(\"æ·±åœ³\".equals(city)){ return 0.8; } if(isStudent){ return 0.8; } //do somethig } ä¼˜åŒ–ådouble getVipDiscount(){ if(age&lt;18|| \"æ·±åœ³\".equals(city)||isStudent){ return 0.8; } //doSomthing } å¦‚æœè¿”å›ç»Ÿä¸€ç»“æœçš„æ¡ä»¶è¿‡å¤šï¼Œå¯ä»¥å†ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå°è£…èµ·æ¥ğŸ˜„ ä¼˜åŒ–äº”ï¼šä½¿ç”¨Optionalæœ‰æ—¶å€™if-elseæ¯”è¾ƒå¤šï¼Œæ˜¯å› ä¸ºéç©ºåˆ¤æ–­å¯¼è‡´çš„ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥ä½¿ç”¨Java9çš„Optionalè¿›è¡Œä¼˜åŒ–ã€‚ ä¼˜åŒ–å‰String str = \"wkk\"; if (str != null) { System.out.println(str); } else { System.out.println(\"Null\"); } ä¼˜åŒ–åOptional&lt;String&gt; strOptional = Optional.ofNullable(\"wkk\"); strOptional.ifPresentOrElse(System.out::println, () -&gt; System.out.println(\"Null\")); Java8çš„Optionalè™½ç„¶æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨Optionalæ¥ä¼˜åŒ–éç©ºçš„èµ‹å€¼æ“ä½œ ç¤ºä¾‹ï¼š ç”µæ± å¹³å°æœå½¹çŠ¶æ€èµ‹å€¼ï¼šå¦‚æœä¸ºnullï¼Œèµ‹å€¼ä¸º0ï¼Œå¦åˆ™ä¸ºåŸæ¥çš„å€¼ batteryBasicInfoCollectDto.setFlowControlState(Optional.ofNullable(batteryInfo.getFlowControlState()).orElse(0)); ä¼˜åŒ–å…­ï¼šè¡¨é©±åŠ¨æ³•ä¼˜åŒ–å‰è¡¨é©±åŠ¨æ³•ï¼Œåˆç§°ä¹‹ä¸ºè¡¨é©±åŠ¨ã€è¡¨é©±åŠ¨æ–¹æ³•ã€‚è¡¨é©±åŠ¨æ–¹æ³•æ˜¯ä¸€ç§ä½¿ä½ å¯ä»¥åœ¨è¡¨ä¸­æŸ¥æ‰¾ä¿¡æ¯ï¼Œè€Œä¸å¿…ç”¨å¾ˆå¤šçš„é€»è¾‘è¯­å¥ï¼ˆifæˆ–Caseï¼‰æ¥æŠŠå®ƒä»¬æ‰¾å‡ºæ¥çš„æ–¹æ³•ã€‚ä»¥ä¸‹çš„demoï¼ŒæŠŠmapæŠ½è±¡æˆè¡¨ï¼Œåœ¨mapä¸­æŸ¥æ‰¾ä¿¡æ¯ï¼Œè€Œçœå»ä¸å¿…è¦çš„é€»è¾‘è¯­å¥ã€‚ if (param.equals(value1)) { doAction1(someParams); } else if (param.equals(value2)) { doAction2(someParams); } else if (param.equals(value3)) { doAction3(someParams); } ä¼˜åŒ–å// è¿™é‡Œæ³›å‹æ˜¯ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œå®é™…å¯æ›¿æ¢ä¸ºä½ éœ€è¦çš„ç±»å‹ Map&lt;?, Function&lt;?&gt; action&gt; actionMappings = new HashMap&lt;&gt;(); // åˆå§‹åŒ– actionMappings.put(value1, (someParams) -&gt; { doAction1(someParams)}); actionMappings.put(value2, (someParams) -&gt; { doAction2(someParams)}); actionMappings.put(value3, (someParams) -&gt; { doAction3(someParams)}); // çœç•¥å¤šä½™é€»è¾‘è¯­å¥ actionMappings.get(param).apply(someParams); ä¼˜åŒ–ä¸ƒï¼šä¼˜åŒ–é€»è¾‘ç»“æ„ï¼Œè®©æ­£å¸¸æµç¨‹èµ°ä¸»å¹²ä¼˜åŒ–å‰public double getAdjustedCapital(){ if(_capital &lt;= 0.0 ){ return 0.0; } if(_intRate &gt; 0 &amp;&amp; _duration &gt;0){ return (_income / _duration) *ADJ_FACTOR; } return 0.0; } ä¼˜åŒ–å public double getAdjustedCapital(){ if(_capital &lt;= 0.0 ){ return 0.0; } if(_intRate &lt;= 0 || _duration &lt;= 0){ return 0.0; } return (_income / _duration) *ADJ_FACTOR; } å°†æ¡ä»¶åè½¬ä½¿å¼‚å¸¸æƒ…å†µå…ˆé€€å‡ºï¼Œè®©æ­£å¸¸æµç¨‹ç»´æŒåœ¨ä¸»å¹²æµç¨‹ï¼Œå¯ä»¥è®©ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ã€‚ ä¼˜åŒ–å…«ï¼šç­–ç•¥æ¨¡å¼+å·¥å‚æ–¹æ³•æ¶ˆé™¤if-elseç­–ç•¥ç±»å®šä¹‰ï¼šä¸€ä¸ªç­–ç•¥æ¥å£å’Œä¸€ç»„å®ç°è¿™ä¸ªæ¥å£çš„ç­–ç•¥ç±»ã€‚ ç‰¹ç‚¹ï¼šå®¢æˆ·ç«¯ä»£ç åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œå¯ä»¥çµæ´»åœ°æ›¿æ¢ä¸åŒçš„ç­–ç•¥ã€‚ å‡è®¾éœ€æ±‚ï¼šæ ¹æ®ä¸åŒå‹‹ç« ç±»å‹ï¼Œå¤„ç†ç›¸å¯¹åº”çš„å‹‹ç« æœåŠ¡ ä¼˜åŒ–å‰ String medalType = \"guest\"; if (\"guest\".equals(medalType)) { System.out.println(\"å˜‰å®¾å‹‹ç« \"); } else if (\"vip\".equals(medalType)) { System.out.println(\"ä¼šå‘˜å‹‹ç« \"); } else if (\"guard\".equals(medalType)) { System.out.println(\"å±•ç¤ºå®ˆæŠ¤å‹‹ç« \"); } ä¼˜åŒ–åé¦–å…ˆï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªæ¡ä»¶é€»è¾‘ä»£ç å—ï¼ŒæŠ½è±¡æˆä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ä»£ç ï¼š //å‹‹ç« æ¥å£ public interface IMedalService { void showMedal(); } æˆ‘ä»¬æ ¹æ®æ¯ä¸ªé€»è¾‘æ¡ä»¶ï¼Œå®šä¹‰ç›¸å¯¹åº”çš„ç­–ç•¥å®ç°ç±»ï¼Œå¯å¾—ä»¥ä¸‹ä»£ç ï¼š //å®ˆæŠ¤å‹‹ç« ç­–ç•¥å®ç°ç±» public class GuardMedalServiceImpl implements IMedalService { @Override public void showMedal() { System.out.println(\"å±•ç¤ºå®ˆæŠ¤å‹‹ç« \"); } } //å˜‰å®¾å‹‹ç« ç­–ç•¥å®ç°ç±» public class GuestMedalServiceImpl implements IMedalService { @Override public void showMedal() { System.out.println(\"å˜‰å®¾å‹‹ç« \"); } } //VIPå‹‹ç« ç­–ç•¥å®ç°ç±» public class VipMedalServiceImpl implements IMedalService { @Override public void showMedal() { System.out.println(\"ä¼šå‘˜å‹‹ç« \"); } } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å®šä¹‰ç­–ç•¥å·¥å‚ç±»ï¼Œç”¨æ¥ç®¡ç†è¿™äº›å‹‹ç« å®ç°ç­–ç•¥ç±»ï¼Œå¦‚ä¸‹ï¼š //å‹‹ç« æœåŠ¡å·¥äº§ç±» public class MedalServicesFactory { private static final Map&lt;String, IMedalService&gt; map = new HashMap&lt;&gt;(); static { map.put(\"guard\", new GuardMedalServiceImpl()); map.put(\"vip\", new VipMedalServiceImpl()); map.put(\"guest\", new GuestMedalServiceImpl()); } public static IMedalService getMedalService(String medalType) { return map.get(medalType); } } ä½¿ç”¨äº†ç­–ç•¥+å·¥å‚æ¨¡å¼ä¹‹åï¼Œä»£ç å˜å¾—ç®€æ´å¤šäº†ï¼Œå¦‚ä¸‹ï¼š public class Test { public static void main(String[] args) { String medalType = \"guest\"; IMedalService medalService = MedalServicesFactory.getMedalService(medalType); medalService.showMedal(); } }","categories":[{"name":"ä»£ç è´¨é‡","slug":"ä»£ç è´¨é‡","permalink":"https://winniekun.github.io/categories/%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F/"}],"tags":[{"name":"if-elseä¼˜åŒ–","slug":"if-elseä¼˜åŒ–","permalink":"https://winniekun.github.io/tags/if-else%E4%BC%98%E5%8C%96/"}]},{"title":"lombokä»‹ç»","slug":"å·¥å…·/lombok-introduce","date":"2020-10-02T12:08:21.000Z","updated":"2020-10-04T14:34:01.269Z","comments":true,"path":"lombok-introduce/","link":"","permalink":"https://winniekun.github.io/lombok-introduce/","excerpt":"Lombokä½¿ç”¨ Lombokæ˜¯ä¸€æ¬¾å¥½ç”¨é¡ºæ‰‹çš„å·¥å…·ï¼Œå€¼å¾—å»å¥½å¥½å»ç†Ÿç»ƒä½¿ç”¨å’Œæ·±ç©¶ã€‚Lombokæ˜¯ä¸€ç§Javaâ„¢å®ç”¨å·¥å…·ï¼Œå¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜æ¶ˆé™¤Javaçš„å†—é•¿ä»£ç ï¼Œå°¤å…¶æ˜¯å¯¹äºç®€å•çš„Javaå¯¹è±¡ï¼ˆPOJOï¼‰ã€‚å®ƒé€šè¿‡æ³¨é‡Šå®ç°è¿™ä¸€ç›®çš„ã€‚é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­å®ç°Lombokï¼Œå¼€å‘äººå‘˜å¯ä»¥èŠ‚çœæ„å»ºè¯¸å¦‚hashCode()å’Œequals()è¿™æ ·çš„æ–¹æ³•ä»¥åŠä»¥å¾€ç”¨æ¥åˆ†ç±»å„ç§accessorå’Œmutatorçš„å¤§é‡æ—¶é—´ã€‚","text":"Lombokä½¿ç”¨ Lombokæ˜¯ä¸€æ¬¾å¥½ç”¨é¡ºæ‰‹çš„å·¥å…·ï¼Œå€¼å¾—å»å¥½å¥½å»ç†Ÿç»ƒä½¿ç”¨å’Œæ·±ç©¶ã€‚Lombokæ˜¯ä¸€ç§Javaâ„¢å®ç”¨å·¥å…·ï¼Œå¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜æ¶ˆé™¤Javaçš„å†—é•¿ä»£ç ï¼Œå°¤å…¶æ˜¯å¯¹äºç®€å•çš„Javaå¯¹è±¡ï¼ˆPOJOï¼‰ã€‚å®ƒé€šè¿‡æ³¨é‡Šå®ç°è¿™ä¸€ç›®çš„ã€‚é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­å®ç°Lombokï¼Œå¼€å‘äººå‘˜å¯ä»¥èŠ‚çœæ„å»ºè¯¸å¦‚hashCode()å’Œequals()è¿™æ ·çš„æ–¹æ³•ä»¥åŠä»¥å¾€ç”¨æ¥åˆ†ç±»å„ç§accessorå’Œmutatorçš„å¤§é‡æ—¶é—´ã€‚ ä½¿ç”¨æ­¥éª¤ å¯¼å…¥Mavenä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;${lomok.version}&lt;/version&gt; &lt;/dependency&gt; åœ¨IDEä¸­å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼ˆlombok pluginï¼‰ å¸¸ç”¨æ³¨è§£è¯¦è§£ç®€åŒ–ä»£ç ï¼Œå¢åŠ å¯è¯»æ€§@Getter&amp;@Setter@Getter @Setter public class Person { private Integer id; private String name; private String age; } é€šè¿‡@Getterå’Œ@Setterä¹‹åï¼Œå…¶å°±ç±»ä¼¼äºå¦‚ä¸‹çš„ä»£ç ï¼š public class Persons { private Integer id; private String name; private String age; public Integer getId() { return id; } public void setId(Integer id) { this.id = id; } public String getName() { return name; } public void setName(String name) { this.name = name; } public String getAge() { return age; } public void setAge(String age) { this.age = age; } } @Dataå…¶ç­‰åŒäºå¦‚ä¸‹çš„å‡ ä¸ªæ³¨è§£ï¼Œä½¿ç”¨çš„é¢‘ç‡æœ€é«˜ @Getter/@Setter @ToString @EqualsAndHashCode @RequiredArgsConstructor @Buiderè‡ªåŠ¨ç”Ÿæˆæµå¼setå†™æ³•ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„è®¾å®šObjectå€¼ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶è¯¥æ–¹æ³•å¾ˆå¥½ï¼Œä½†æ˜¯å› ä¸ºå¤§å¤šæ•°çš„æ¡†æ¶éƒ½ä½¿ç”¨åˆ°äº†setæ–¹æ³•è¿›è¿›è¡Œæ³¨å…¥ï¼Œæ‰€ä»¥åœ¨å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å°†@Builderå’Œ@Dataä¸€èµ·ä½¿ç”¨ã€‚ // æ–¹ä¾¿æŸ¥çœ‹è¾“å‡ºå¯¹è±¡ @ToString @Builder public class Person { private Integer id; private String name; private String age; public static void main(String[] args) { Person person = Person.builder().age(\"11\").id(1).name(\"wkk\").build(); System.out.println(person); } } //Builderçš„ä½¿ç”¨ç­‰åŒäºå¦‚ä¸‹ public static class PersonBuilder { private Integer id; private String name; private String age; PersonBuilder() { } public Person.PersonBuilder id(Integer id) { this.id = id; return this; } public Person.PersonBuilder name(String name) { this.name = name; return this; } public Person.PersonBuilder age(String age) { this.age = age; return this; } public Person build() { return new Person(this.id, this.name, this.age); } public String toString() { return \"Person.PersonBuilder(id=\" + this.id + \", name=\" + this.name + \", age=\" + this.age + \")\"; } } æ—¥å¿—ä½¿ç”¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åšæ—¥å¿—å¤„ç†ï¼Œéƒ½ä¼šå…ˆç”Ÿæˆä¸€ä¸ªLoggerçš„é™æ€å¸¸é‡ï¼Œä½¿ç”¨@Slf4jä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œå…¨ä¸ç”¨newä¸€ä¸ªè¯¥å¸¸é‡äº†ã€‚ public class Person{ private static final Logger logger = LoggerFactory.getLogger(Person.class); private Integer id; private String name; private String age; public static void main(String[] args){ logger.info(\"logger: {}\", \"aaaa\"); } } // Lombokå®ç° @Slf4j public class Person { private Integer id; private String name; private String age; public static void main(String[] args) { System.out.println(\"fsda\"); log.info(\"Person: {}\", \"fdsa\"); } } æµå¼å¯¹è±¡çš„å…³é—­","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"https://winniekun.github.io/tags/%E5%9F%BA%E7%A1%80/"}]},{"title":"2020å®ä¹ å‰çš„æ€»ç»“","slug":"ç¢ç¢å¿µ/before-internship","date":"2020-09-06T11:11:50.000Z","updated":"2020-10-01T15:12:36.296Z","comments":true,"path":"before-internship/","link":"","permalink":"https://winniekun.github.io/before-internship/","excerpt":"å‰è¨€2020å¹´2æœˆåº•ï¼Œåœ¨è‡ªå·±ç¡®å®šè¦æ‰¾å®ä¹ çš„æ—¶å€™ï¼Œå¼€å§‹å’Œå¥³æœ‹å‹å“­è¯‰æ‰€å®³æ€•è‡ªå·±æ‰¾ä¸åˆ°å®ä¹ ï¼Œæ²¡æœ‰å…¬å¸è¦æˆ‘ï¼Œæˆ‘å¤ªèœäº†ç­‰ç­‰ç­‰ã€‚ç»è¿‡è€—æ—¶åŠå¹´çš„æ—¶é—´ï¼Œç»ˆäºç¡®å®šä¸‹æ¥çš„äº†å®ä¹ åœ°ç‚¹å’Œå®ä¹ å…¬å¸ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æŒºå¥½ç©å„¿çš„ï¼Œæ‰€ä»¥å°±è®°å½•ä¸‹æ¥å§ã€‚","text":"å‰è¨€2020å¹´2æœˆåº•ï¼Œåœ¨è‡ªå·±ç¡®å®šè¦æ‰¾å®ä¹ çš„æ—¶å€™ï¼Œå¼€å§‹å’Œå¥³æœ‹å‹å“­è¯‰æ‰€å®³æ€•è‡ªå·±æ‰¾ä¸åˆ°å®ä¹ ï¼Œæ²¡æœ‰å…¬å¸è¦æˆ‘ï¼Œæˆ‘å¤ªèœäº†ç­‰ç­‰ç­‰ã€‚ç»è¿‡è€—æ—¶åŠå¹´çš„æ—¶é—´ï¼Œç»ˆäºç¡®å®šä¸‹æ¥çš„äº†å®ä¹ åœ°ç‚¹å’Œå®ä¹ å…¬å¸ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æŒºå¥½ç©å„¿çš„ï¼Œæ‰€ä»¥å°±è®°å½•ä¸‹æ¥å§ã€‚ ç°åœ¨æŒºå°´å°¬çš„ï¼Œæœ¬æ¥æƒ³ç€å†å®ä¹ ä¹‹å‰æŠŠæ–‡ç« å†™å¥½ï¼Œä½†æ˜¯åé¢æœ‰åˆ«çš„äº‹æƒ…å°±æ²¡æœ‰æ¥å¾—åŠå†™ï¼Œæœ€åæƒ³å†™çš„æ—¶å€™ï¼Œå‘ç°hexoå‡ºé—®é¢˜äº†ã€‚æ‰€ä»¥å°±ä¸€ç›´æ‹–åˆ°äº†å›½åº†å‡æœŸï¼ŒæŠ½äº†ç‚¹æ—¶é—´æ”¹æ”¹ï¼Œç»ˆäºåˆèƒ½é‡æ–°å†™blogäº†ã€‚ ç›®å‰å·²ç»åœ¨NIOå®ä¹ ä¸¤å‘¨äº†ï¼Œç¬¬ä¸€å‘¨è¿˜å¥½ï¼Œå°±æ˜¯çœ‹çœ‹å…¬å¸æ–‡æ¡£ï¼Œç„¶åæŒ‰ç…§éœ€æ±‚å®Œå–„äº†ä¸€ä¸ªæ¥å£ï¼Œåé¢è€å¸ˆå®‰æ’æˆ‘çœ‹å‡ ä¸ªèŠ‚ç‚¹çš„ä»£ç ï¼Œç„¶åä¿®å¤sonarQubeä¸Šæ£€æµ‹å‡ºçš„Bugã€‚ç¬¬äºŒå‘¨å°±å¼€å§‹å¿™ç¢Œäº†ï¼Œåˆšå¥½æ’æœŸï¼Œåˆ†é…äº†æˆ‘è¿˜æŒºå¤šçš„ä»»åŠ¡ï¼Œå¸Œæœ›èƒ½åšçš„åˆå¥½åˆæ£’ã€‚ æ”¾å¼ æˆ‘æ‰€åœ¨æ¥¼çš„å‰å°ï¼Œæ„Ÿè§‰è¿˜æŒºå¥½çœ‹çš„ï¼ˆå‡æœŸå‰ä¸€å¤©èµ°çš„æ™šï¼Œåˆšå¥½æ²¡æœ‰å¤šå°‘äººï¼Œé¡ºæ‰‹æ‹çš„ğŸ˜„ï¼‰ã€‚ NIO å›½åº†å‡æœŸäººæ˜¯çœŸçš„å¤šï¼Œè™¹æ¡¥è½¦ç«™çˆ†æ»¡ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè„‘å­é‡Œç«Ÿç„¶æ˜¯é‡œå±±è¡Œçš„ç”»é¢â€¦ è™¹æ¡¥ç«è½¦ç«™ æ€»ç»“é¢è¯•çœŸçš„å¹¶ä¸å¯æ€•ï¼Œå¤§ä¸äº†å°±æ˜¯ç»™é¢è¯•å®˜æ„Ÿè§‰ä½ ä¸è¡Œï¼Œåœ¨é¢è¯•å®˜é¢å‰å°¬èŠä¸€ä¸ªå°æ—¶ï¼Œå…¶ä»–çš„çœŸçš„æ²¡ä»€ä¹ˆã€‚é¢å¤šäº†å°±æ„Ÿè§‰è¿˜æŒºå¥½ç©å„¿çš„ï¼ˆå°±æ˜¯æ¯æ¬¡é¢è¯•å‰è¿˜æ˜¯ä¼šç´§å¼ å¥½é•¿æ—¶é—´ï¼‰ã€‚é¢è¯•æœŸé—´ï¼Œæ„Ÿè§‰æœ‰ä¸€äº›é—®é¢˜å¹¶æ²¡æœ‰æ ‡å‡†çš„ç­”æ¡ˆï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å’Œé¢è¯•å®˜è®¨è®ºçš„å½¢å¼é˜è¿°è‡ªå·±çš„è§‚ç‚¹ã€‚æœ€åå°±æ˜¯è®°å¾—é¢è¯•ååšå¥½å¤ç›˜ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å¸®åŠ©è‡ªå·±æŸ¥ç¼ºè¡¥æ¼ï¼Œè¿˜èƒ½è®©è‡ªå·±èƒ½å¤Ÿæ›´å¥½çš„æ¢³ç†çŸ¥è¯†ç‚¹ã€‚","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"}]},{"title":"æ­»ç£•å›¾","slug":"LeetCode/stick-to-graph","date":"2020-08-20T00:59:56.000Z","updated":"2020-08-30T04:50:22.250Z","comments":true,"path":"stick-to-graph/","link":"","permalink":"https://winniekun.github.io/stick-to-graph/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¹ï¼š å›¾ è¯´å®è¯å›¾ç›®å‰é‡åˆ°çš„é¢˜ç›®ç±»å‹ä¸å¤š, å†åŠ ä¸Šä»Šå¹´å›¾è®ºè¯¾ç¨‹ä¸Šçš„ä¸€äº›ç®—æ³•, åªèƒ½è¯´ç®—æ˜¯è¦†ç›–äº†å›¾ç›¸å…³çš„ä¸€ä¸¢ä¸¢çš„å†…å®¹ğŸ˜„ æœ€è¿‘LeetCodeæ¯æ—¥ä¸€é¢˜, é‡åˆ°äº†è¾ƒå¤šçš„å›¾éå†(æ·±åº¦éå†, å¹¿åº¦éå†)é—®é¢˜, æ„Ÿè§‰æ˜¯æœ‰è¿¹å¯å¾ªçš„, æ‰€ä»¥åšä¸€ä¸‹æ•´ç†å§.","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¹ï¼š å›¾ è¯´å®è¯å›¾ç›®å‰é‡åˆ°çš„é¢˜ç›®ç±»å‹ä¸å¤š, å†åŠ ä¸Šä»Šå¹´å›¾è®ºè¯¾ç¨‹ä¸Šçš„ä¸€äº›ç®—æ³•, åªèƒ½è¯´ç®—æ˜¯è¦†ç›–äº†å›¾ç›¸å…³çš„ä¸€ä¸¢ä¸¢çš„å†…å®¹ğŸ˜„ æœ€è¿‘LeetCodeæ¯æ—¥ä¸€é¢˜, é‡åˆ°äº†è¾ƒå¤šçš„å›¾éå†(æ·±åº¦éå†, å¹¿åº¦éå†)é—®é¢˜, æ„Ÿè§‰æ˜¯æœ‰è¿¹å¯å¾ªçš„, æ‰€ä»¥åšä¸€ä¸‹æ•´ç†å§. é¢˜ç›® 130. è¢«å›´ç»•çš„åŒºåŸŸ 133. å…‹éš†å›¾ 733. å›¾åƒæ¸²æŸ“ 529. æ‰«é›·æ¸¸æˆ é¢˜è§£","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"dfs","slug":"dfs","permalink":"https://winniekun.github.io/tags/dfs/"},{"name":"bfs","slug":"bfs","permalink":"https://winniekun.github.io/tags/bfs/"}]},{"title":"ArrayDeque-analysis","slug":"æºç /JDK/queue/ArrayDeque-analysis","date":"2020-07-08T07:27:56.000Z","updated":"2020-08-30T04:50:22.257Z","comments":true,"path":"ArrayDeque-analysis/","link":"","permalink":"https://winniekun.github.io/ArrayDeque-analysis/","excerpt":"ä¾èµ–","text":"ä¾èµ– ArrayDequeä¾èµ– å®ç°äº†Dequeæ¥å£, Serializableæ¥å£, Cloneableæ¥å£, ç»§æ‰¿äº†AbstractCollectionç±», åŒæ—¶å¯ä»¥çœ‹åˆ°çš„æ˜¯Dequeæ¥å£ç»§æ‰¿è‡ªQueueæ¥å£, å®ƒæ˜¯å¯¹Queueçš„ä¸€ç§å¢å¼º. Deque æ¥å£çš„å®ç°ç±»å¯ä»¥è¢«å½“ä½œ FIFOï¼ˆé˜Ÿåˆ—ï¼‰ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œ LIFOï¼ˆæ ˆï¼‰æ¥ä½¿ç”¨ Queueå’ŒDequeDequeæ˜¯å¯¹Queueçš„å¢å¼º, æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹Queueçš„å…·ä½“è®¾è®¡: public interface Queue&lt;E&gt; extends Collection&lt;E&gt; { // æ·»åŠ  boolean add(E e); // æ·»åŠ  ä¸åŒçš„å®ç°ä½¿ç”¨çš„æ·»åŠ æ–¹å¼ä¸åŒ // listä½¿ç”¨add // queueä½¿ç”¨offer boolean offer(E e); // åˆ é™¤ E remove(); // å¼¹å‡º E poll(); E element(); // è·å–å¤´éƒ¨æ•°æ® E peek(); } Dequeçš„è®¾è®¡ public interface Deque&lt;E&gt; extends Queue&lt;E&gt; { void addFirst(E e); void addLast(E e); boolean offerFirst(E e); boolean offerLast(E e); E removeFirst(); E removeLast(); E pollFirst(); E pollLast(); E getFirst(); E getLast(); E peekFirst(); E peekLast(); boolean removeFirstOccurrence(Object o); boolean removeLastOccurrence(Object o); boolean add(E e); boolean offer(E e); E remove(); E poll(); E element(); E peek(); // *** æ ˆ ***// void push(E e); E pop(); // *** Collectionä¸­çš„æ–¹æ³• *** boolean remove(Object o); boolean contains(Object o); public int size(); Iterator&lt;E&gt; iterator(); Iterator&lt;E&gt; descendingIterator(); } Dequeä¸­æ–°å¢äº†ä»¥ä¸‹å‡ ç±»æ–¹æ³•ï¼š *Firstï¼Œè¡¨ç¤ºä»é˜Ÿåˆ—å¤´æ“ä½œå…ƒç´ ï¼› *Lastï¼Œè¡¨ç¤ºä»é˜Ÿåˆ—å°¾æ“ä½œå…ƒç´ ï¼› *push(e)ï¼Œpop()ï¼Œä»¥æ ˆçš„æ–¹å¼æ“ä½œå…ƒç´ çš„æ–¹æ³•ï¼› å…¶æŠ½è±¡çš„æ ·å­ å­—æ®µ&amp;å±æ€§// åº•å±‚ä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´  transient Object[] elements; // non-private to simplify nested class access // é˜Ÿåˆ—å¤´ä½ç½® transient int head; // é˜Ÿåˆ—å°¾ä½ç½® transient int tail; // æœ€å°åˆå§‹å®¹é‡ private static final int MIN_INITIAL_CAPACITY = 8; ä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ , é»˜è®¤çš„æœ€å°åˆå§‹åŒ–å®¹é‡ä¸º8, åŒæ—¶æœ‰å¤´å°¾ä¸¤ä¸ªæ ‡è®°ä½ æ„é€ å‡½æ•°// é»˜è®¤æ„é€ å‡½æ•°æ•°ç»„å®¹é‡ä¸º16 public ArrayDeque() { elements = new Object[16]; } // æŒ‡å®šåˆå§‹å®¹é‡æ„é€ å‡½æ•° public ArrayDeque(int numElements) { allocateElements(numElements); } // å°†é›†åˆcä¸­çš„å…ƒç´ åˆå§‹åŒ–åˆ°æ•°ç»„ä¸­ public ArrayDeque(Collection&lt;? extends E&gt; c) { allocateElements(c.size()); addAll(c); } // åˆå§‹åŒ–æ•°ç»„ private void allocateElements(int numElements) { elements = new Object[calculateSize(numElements)]; } // å’ŒHashMapçš„ç±»ä¼¼, æ±‚å¤§äºä¸”æœ€æ¥è¿‘numelemnetsçš„2çš„å¹‚æ¬¡ä¸”ä¸å°äº8 private static int calculateSize(int numElements) { int initialCapacity = MIN_INITIAL_CAPACITY; if (numElements &gt;= initialCapacity) { initialCapacity = numElements; initialCapacity |= (initialCapacity &gt;&gt;&gt; 1); initialCapacity |= (initialCapacity &gt;&gt;&gt; 2); initialCapacity |= (initialCapacity &gt;&gt;&gt; 4); initialCapacity |= (initialCapacity &gt;&gt;&gt; 8); initialCapacity |= (initialCapacity &gt;&gt;&gt; 16); initialCapacity++; if (initialCapacity &lt; 0) // Too many elements, must back off initialCapacity &gt;&gt;&gt;= 1;// Good luck allocating 2 ^ 30 elements } return initialCapacity; } é€šè¿‡æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“é»˜è®¤åˆå§‹å®¹é‡æ˜¯16ï¼Œæœ€å°å®¹é‡æ˜¯8ã€‚ å…¥é˜Ÿå¤´éƒ¨å…¥é˜Ÿpublic void addFirst(E e) { if (e == null) throw new NullPointerException(); // å°†headæŒ‡é’ˆå‡1å¹¶ä¸æ•°ç»„é•¿åº¦å‡1å–æ¨¡ // è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ•°ç»„åˆ°å¤´äº†è¾¹ç•Œæº¢å‡º // å¦‚æœåˆ°å¤´äº†å°±ä»å°¾å†å‘å‰ // ç›¸å½“äºå¾ªç¯åˆ©ç”¨æ•°ç»„ elements[head = (head - 1) &amp; (elements.length - 1)] = e; // å¦‚æœå¤´å°¾æŒ¨åœ¨ä¸€èµ·äº†ï¼Œå°±æ‰©å®¹ // æ‰©å®¹è§„åˆ™ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¸¤å€ if (head == tail) doubleCapacity(); } æ‰©å®¹// æ‰©å®¹ä¸ºä¸¤å€ private void doubleCapacity() { assert head == tail; int p = head; int n = elements.length; int r = n - p; // number of elements to the right of p int newCapacity = n &lt;&lt; 1; if (newCapacity &lt; 0) throw new IllegalStateException(\"Sorry, deque too big\"); Object[] a = new Object[newCapacity]; // å°†æ—§æ•°ç»„headä¹‹åçš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ System.arraycopy(elements, p, a, 0, r); // å°†æ—§æ•°ç»„ä¸‹æ ‡0åˆ°headä¹‹é—´çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ System.arraycopy(elements, 0, a, r, p); // èµ‹å€¼ä¸ºæ–°æ•°ç»„ elements = a; // headæŒ‡å‘0ï¼ŒtailæŒ‡å‘æ—§æ•°ç»„é•¿åº¦è¡¨ç¤ºçš„ä½ç½® head = 0; tail = n; } å¯è§†åŒ– å°¾éƒ¨å…¥é˜Ÿpublic void addLast(E e) { if (e == null) throw new NullPointerException(); // åœ¨å°¾æŒ‡é’ˆçš„ä½ç½®æ”¾å…¥å…ƒç´  // å¯ä»¥çœ‹åˆ°tailæŒ‡é’ˆæŒ‡å‘çš„æ˜¯é˜Ÿåˆ—æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½® elements[tail] = e; // tailæŒ‡é’ˆåŠ 1ï¼Œå¦‚æœåˆ°æ•°ç»„å°¾äº†å°±ä»å¤´å¼€å§‹ if ( (tail = (tail + 1) &amp; (elements.length - 1)) == head) doubleCapacity(); } å…¥é˜Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä»é˜Ÿåˆ—å¤´æˆ–è€…ä»é˜Ÿåˆ—å°¾ï¼› å¦‚æœå®¹é‡ä¸å¤Ÿäº†ï¼Œç›´æ¥æ‰©å¤§ä¸ºä¸¤å€ï¼› é€šè¿‡å–æ¨¡çš„æ–¹å¼è®©å¤´å°¾æŒ‡é’ˆåœ¨æ•°ç»„èŒƒå›´å†…å¾ªç¯ï¼› x &amp; (len - 1) = x % lenï¼Œä½¿ç”¨&amp;çš„æ–¹å¼æ›´å¿«(len=2çš„å¹‚æ¬¡ç­‰å¼æˆç«‹)ï¼› å‡ºé˜Ÿå¤´éƒ¨å‡ºé˜Ÿpublic E pollFirst() { int h = head; @SuppressWarnings(\"unchecked\") // å–é˜Ÿåˆ—å¤´å…ƒç´  E result = (E) elements[h]; // Element is null if deque empty if (result == null) return null; // é˜Ÿå¤´å…ƒç´ ä¸ºç©º elements[h] = null; // Must null out slot // é˜Ÿå¤´å³ç§» head = (h + 1) &amp; (elements.length - 1); return result; } å°¾éƒ¨å‡ºé˜Ÿpublic E pollLast() { // å› ä¸ºé˜Ÿå°¾æ ‡è®°çš„æ˜¯æœ€åä¸€ä¸ªä¸ºä¸ä¸ºç©ºçš„å…ƒç´ çš„åä¸€ä½ int t = (tail - 1) &amp; (elements.length - 1); @SuppressWarnings(\"unchecked\") // è·å–é˜Ÿå°¾å…ƒç´  E result = (E) elements[t]; if (result == null) return null; // é˜Ÿå°¾è®¾ç½®ä¸ºç©º elements[t] = null; // é‡æ–°è®¾ç½®tail tail = t; return result; } ä»¥ä¸‹æ˜¯ä¸€æ¬¡ArrayDequeçš„å¤´éƒ¨å…¥é˜Ÿ, å°¾éƒ¨å‡ºé˜Ÿçš„å¯è§†åŒ–æ“ä½œ ArrayDeque&lt;Integer&gt; arrayDeque = new ArrayDeque&lt;&gt;(6); ArrayDequeUtil.getField(arrayDeque); for (int i = 1; i &lt;=10; i++) { arrayDeque.addFirst(i); ArrayDequeUtil.getField(arrayDeque); } arrayDeque.pollLast(); ArrayDequeUtil.getField(arrayDeque); æ ˆçš„å®ç°å…¥æ ˆä»¥ä¸‹æ˜¯Dequeå®ç°å…¥æ ˆçš„æ“ä½œ public void push(E e) { addFirst(e); } public void addFirst(E e) { if (e == null) throw new NullPointerException(); elements[head = (head - 1) &amp; (elements.length - 1)] = e; if (head == tail) doubleCapacity(); } æœ€å, å…¶ä¾èµ–çš„è¿˜æ˜¯addFirst(), ä¹Ÿå°±æ˜¯ä»å¤´éƒ¨æ·»åŠ å…ƒç´  å‡ºæ ˆä»¥ä¸‹æ˜¯Dequeå®ç°å‡ºæ ˆçš„æ“ä½œ public E pop() { return removeFirst(); } public E removeFirst() { E x = pollFirst(); if (x == null) throw new NoSuchElementException(); return x; } æœ€å, å…¶ä¾èµ–çš„è¿˜æ˜¯pollFirst(), ä¹Ÿå°±æ˜¯ä»å¤´éƒ¨åˆ é™¤å…ƒç´ , ä¹Ÿå°±æ˜¯åå…¥çš„å…ƒç´ å…ˆå‡º è¯´ç™½äº†å®ç°æ ˆçš„æ–¹å¼å°±æ˜¯ä»…ä»…åªæ“ä½œé˜Ÿåˆ—å¤´å³å¯ æ€»ç»“&amp;é¢è¯•å°é—®é¢˜ ä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ—ï¼Ÿ åŒç«¯é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå®ƒçš„ä¸¤ç«¯éƒ½å¯ä»¥è¿›å‡ºå…ƒç´ ï¼Œæ•…è€Œå¾—ååŒç«¯é˜Ÿåˆ— ArrayDequeæ˜¯æ€ä¹ˆå®ç°åŒç«¯é˜Ÿåˆ—çš„ï¼Ÿ åº•å±‚ä¸ºæ•°ç»„, ç„¶åé€šè¿‡å–æ¨¡çš„æ–¹å¼æ„é€ ä¸€ä¸ªå¾ªç¯æ•°ç»„, å‡ºé˜Ÿå…¥é˜Ÿæ˜¯é€šè¿‡å¤´å°¾æŒ‡é’ˆå¾ªç¯åˆ©ç”¨æ•°ç»„å®ç°çš„. ArrayDequeæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ ä¸æ˜¯çº¿ç¨‹å®‰å…¨ ArrayDequeçš„æ‰©å®¹æœºåˆ¶ï¼Ÿ ArrayDequeåœ¨å®¹é‡ä¸è¶³æ—¶(head == tail)ä¼šå‡ºå‘æ‰©å®¹, æ‰©å®¹ä¸ºåŸå…ˆçš„ä¸¤å€, å…·ä½“çš„æ‰©å®¹æœºåˆ¶, å¯ä»¥çœ‹ä¸Šè¿°å¯è§†åŒ–è¿‡ç¨‹","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"Queue","slug":"Queue","permalink":"https://winniekun.github.io/tags/Queue/"}]},{"title":"trie","slug":"ç®—æ³•/trie","date":"2020-07-07T11:58:58.000Z","updated":"2020-08-30T04:50:22.259Z","comments":true,"path":"trie/","link":"","permalink":"https://winniekun.github.io/trie/","excerpt":"å‰ç¼€æ ‘åŸç†","text":"å‰ç¼€æ ‘åŸç† Trie, ç”±Edward Fredkinæå‡º, æ¥è‡ªè‹±æ–‡å•è¯retrieval, Trieä¹Ÿç§°ä¸ºå‰ç¼€æ ‘, ç”¨äºä¿å­˜å…³è”æ•°ç»„ï¼Œå…¶ä¸­çš„é”®é€šå¸¸æ˜¯å­—ç¬¦ä¸²ã€‚ä¸äºŒå‰æŸ¥æ‰¾æ ‘ä¸åŒï¼Œé”®ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®šã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™éƒ½æœ‰ç›¸åŒçš„å‰ç¼€ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œæ ¹èŠ‚ç‚¹å¯¹åº”ç©ºå­—ç¬¦ä¸²ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„å€¼ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹å’Œéƒ¨åˆ†å†…éƒ¨èŠ‚ç‚¹æ‰€å¯¹åº”çš„é”®æ‰æœ‰ç›¸å…³çš„å€¼ã€‚ å¯¹äºå­—ç¬¦Trieè€Œè¨€, å¦‚æœä½¿ç”¨äºŒå‰æ ‘é‚£æ ·çš„ä¸¤ä¸ªåˆ†æ”¯æ˜æ˜¾æ˜¯ä¸å¤Ÿçš„. ä¸¾ä¸ªä¾‹å­, è‹±è¯­ä¸­ä¸€å…±æœ‰26ä¸ªå­—æ¯, æ¯ä¸ªå­—æ¯è¿˜åŒºåˆ†å¤§å°å†™, å¦‚æœå¿½ç•¥å¤§å°å†™çš„è¯, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç®€å•çš„é™å®šåˆ†æ”¯(å­æ ‘)ä¸ªæ•°ä¸º26. å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²Trie Trie ä¸€ä¸ªä¿å­˜äº†8ä¸ªé”®çš„trieç»“æ„ï¼Œâ€Aâ€, â€œtoâ€, â€œteaâ€, â€œtedâ€, â€œtenâ€, â€œiâ€, â€œinâ€, â€œinn è¿™åªæ˜¯é’ˆå¯¹äºä¸åŒºåˆ†å¤§å°å†™çš„è‹±è¯­å­—æ¯, è‹¥æ˜¯åŒºåˆ†å¤§å°å†™, åŒæ—¶è¿˜æœ‰æ ‡ç‚¹ç­‰, é‚£ä¹ˆåˆ†ä¹‹çš„æ•°é‡ä¼šæ›´åŠ çš„åºå¤§ä¸”ä¸ç¡®å®š, è¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•£åˆ—è¡¨æ¥è§£å†³åŠ¨æ€æ•°é‡çš„åˆ†æ”¯. Trieçš„å‡ºç°, è§£å†³äº†æ•£åˆ—è¡¨æ— æ³•è§£å†³çš„å­—ç¬¦ä¸²æ•°é›†é—®é¢˜: æ‰¾åˆ°å…·æœ‰åŒä¸€å‰ç¼€çš„å…¨éƒ¨é”®å€¼ã€‚ æŒ‰è¯å…¸åºæšä¸¾å­—ç¬¦ä¸²çš„æ•°æ®é›†ã€‚ åŒæ—¶Trieç”±æ•£åˆ—è¡¨çš„å¦ä¸€æ–¹é¢æ˜¯: éšç€æ•°æ®é‡çš„å¢å¤§, æ•£åˆ—è¡¨çš„æŸ¥æ‰¾æ•ˆç‡å¯èƒ½ä¼šé™ä½åˆ°$O(n)$, ä¸å“ˆå¸Œè¡¨ç›¸æ¯”, Trie æ ‘åœ¨å­˜å‚¨å¤šä¸ªå…·æœ‰ç›¸åŒå‰ç¼€çš„é”®æ—¶å¯ä»¥ä½¿ç”¨è¾ƒå°‘çš„ç©ºé—´. æ­¤æ—¶Trieåªéœ€è¦$O(m)$çš„æ—¶é—´å¤æ‚åº¦ï¼Œå…¶ä¸­$m$ä¸ºé”®é•¿ã€‚ å‰ç¼€æ ‘çš„å®ç°Trie æ ‘æ˜¯ä¸€ä¸ªæœ‰æ ¹çš„æ ‘ï¼Œå…¶ç»“ç‚¹å…·æœ‰ä»¥ä¸‹å­—æ®µï¼šã€‚ æœ€å¤š$R$ä¸ªæŒ‡å‘å­ç»“ç‚¹çš„é“¾æ¥ï¼Œå…¶ä¸­æ¯ä¸ªé“¾æ¥å¯¹åº”å­—æ¯è¡¨æ•°æ®é›†ä¸­çš„ä¸€ä¸ªå­—æ¯, ç®€å•èµ·è§, å‡å®š$R$ä¸º 26, å°å†™è‹±è¯­å­—æ¯æ•°é‡ å¸ƒå°”å­—æ®µ, ä»¥æŒ‡å®šèŠ‚ç‚¹æ˜¯å¯¹åº”é”®çš„ç»“å°¾è¿˜æ˜¯åªæ˜¯é”®å‰ç¼€. èŠ‚ç‚¹æ„é€ åœ¨æ„é€ ä¹‹å‰, å…ˆå±•ç¤ºåŒ…å«ä¸‰ä¸ªå•è¯â€seaâ€,â€sellsâ€,â€sheâ€çš„ Trieçš„æ ·å­, åŠ æ·±ç†è§£ class TrieNode { private TrieNode[] links; private boolean isEnd; private final int R = 26; public TrieNode() { links = new TrieNode[R]; } public boolean containsKey(char ch) { return links[ch - 'a'] != null; } public void put(char ch, TrieNode node) { links[ch - 'a'] = node; } public TrieNode get(char ch) { return links[ch - 'a']; } public void setEnd() { isEnd = true; } public boolean isEnd() { return isEnd; } } æ’å…¥/** * æ’å…¥ */ public void insert(String word) { // ä»æ ¹èŠ‚ç‚¹å¼€å§‹, æ ¹èŠ‚ç‚¹ä¸ºç©º TrieNode node = root; for (int i = 0; i &lt; word.length(); i++) { char current = word.charAt(i); if (!node.containsKey(current)) { node.put(current, new TrieNode()); } node = node.get(current); } node.setEnd(); } æŸ¥æ‰¾æ¯ä¸ªé”®åœ¨ trie ä¸­è¡¨ç¤ºä¸ºä»æ ¹åˆ°å†…éƒ¨èŠ‚ç‚¹æˆ–å¶çš„è·¯å¾„ã€‚æˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªé”®å­—ç¬¦ä»æ ¹å¼€å§‹ï¼Œã€‚æ£€æŸ¥å½“å‰èŠ‚ç‚¹ä¸­ä¸é”®å­—ç¬¦å¯¹åº”çš„é“¾æ¥ã€‚æœ‰ä¸¤ç§æƒ…å†µï¼š å­˜åœ¨é“¾æ¥ã€‚æˆ‘ä»¬ç§»åŠ¨åˆ°è¯¥é“¾æ¥åé¢è·¯å¾„ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ç»§ç»­æœç´¢ä¸‹ä¸€ä¸ªé”®å­—ç¬¦ã€‚ ä¸å­˜åœ¨é“¾æ¥ã€‚è‹¥å·²æ— é”®å­—ç¬¦ï¼Œä¸”å½“å‰ç»“ç‚¹æ ‡è®°ä¸º isEndï¼Œåˆ™è¿”å› trueã€‚å¦åˆ™æœ‰ä¸¤ç§å¯èƒ½ï¼Œå‡è¿”å› false : è¿˜æœ‰é”®å­—ç¬¦å‰©ä½™ï¼Œä½†æ— æ³•è·Ÿéš Trie æ ‘çš„é”®è·¯å¾„ï¼Œæ‰¾ä¸åˆ°é”®ã€‚ æ²¡æœ‰é”®å­—ç¬¦å‰©ä½™ï¼Œä½†å½“å‰ç»“ç‚¹æ²¡æœ‰æ ‡è®°ä¸º isEndã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¾…æŸ¥æ‰¾é”®åªæ˜¯Trieæ ‘ä¸­å¦ä¸€ä¸ªé”®çš„å‰ç¼€ã€‚ private TrieNode searchPrefix(String word) { TrieNode node = root; for (int i = 0; i &lt; word.length(); i++) { char current = word.charAt(i); if (node.containsKey(current)) { node = node.get(current); } else { return null; } } return node; } public boolean search(String word) { TrieNode node = searchPrefix(word); return node != null &amp;&amp; node.isEnd(); } /** * æ˜¯å¦å­˜åœ¨è¾“å…¥å‰ç¼€çš„å­—ç¬¦ */ public boolean startsWith(String prefix) { TrieNode node = searchPrefix(prefix); return node != null; } æ•´ä½“class Trie { private TrieNode root; /** * åˆå§‹åŒ– */ public Trie() { root = new TrieNode(); } /** * æ’å…¥ */ public void insert(String word) { TrieNode node = root; for (int i = 0; i &lt; word.length(); i++) { char current = word.charAt(i); if (!node.containsKey(current)) { node.put(current, new TrieNode()); } node = node.get(current); } node.setEnd(); } /** * åˆ é™¤ */ public boolean search(String word) { TrieNode node = searchPrefix(word); return node != null &amp;&amp; node.isEnd(); } private TrieNode searchPrefix(String word) { TrieNode node = root; for (int i = 0; i &lt; word.length(); i++) { char current = word.charAt(i); if (node.containsKey(current)) { node = node.get(current); } else { return null; } } return node; } /** * æ˜¯å¦å­˜åœ¨è¾“å…¥å‰ç¼€çš„å­—ç¬¦ */ public boolean startsWith(String prefix) { TrieNode node = searchPrefix(prefix); return node != null; } class TrieNode { private TrieNode[] links; private boolean isEnd; private final int R = 26; public TrieNode() { links = new TrieNode[R]; } public boolean containsKey(char ch) { return links[ch - 'a'] != null; } public void put(char ch, TrieNode node) { links[ch - 'a'] = node; } public TrieNode get(char ch) { return links[ch - 'a']; } public void setEnd() { isEnd = true; } public boolean isEnd() { return isEnd; } } } æ•æ„Ÿè¯è¿‡æ»¤çš„å‰ç¼€æ ‘å®ç°å› ä¸ºæ•æ„Ÿè¯é™¤äº†è‹±æ–‡å­—æ¯ä¹‹å¤–, è¿˜æœ‰å…¶ä»–çš„å­—ç¬¦, æ‰€ä»¥ä½¿ç”¨æ•£åˆ—è¡¨æ¥å®ç°, public class Trie{ // æ ¹èŠ‚ç‚¹ private TrieNode rootNode = new TrieNode(); // å°†ä¸€ä¸ªæ•æ„Ÿè¯æ·»åŠ åˆ°å‰ç¼€æ ‘ä¸­ private void addKeyword(String keyword) { TrieNode tempNode = rootNode; for (int i = 0; i &lt; keyword.length(); i++) { char c = keyword.charAt(i); TrieNode subNode = tempNode.getSubNode(c); if(!tempNode.containsKey(c)){ tempNode.addSubNode(c, new TrieNode()); } tempNode = tempNode.getSubNode(c); } tempNode.setKeywordEnd(true); } // å‰ç¼€æ ‘ private class TrieNode { // å…³é”®è¯ç»“æŸæ ‡è¯† private boolean isKeywordEnd = false; // å­èŠ‚ç‚¹(keyæ˜¯ä¸‹çº§å­—ç¬¦,valueæ˜¯ä¸‹çº§èŠ‚ç‚¹) private Map&lt;Character, TrieNode&gt; subNodes = new HashMap&lt;&gt;(); public boolean isKeywordEnd() { return isKeywordEnd; } public void setKeywordEnd(boolean keywordEnd) { isKeywordEnd = keywordEnd; } // æ·»åŠ å­èŠ‚ç‚¹ public void addSubNode(Character c, TrieNode node) { subNodes.put(c, node); } // è·å–å­èŠ‚ç‚¹ public TrieNode getSubNode(Character c) { return subNodes.get(c); } } } å®ä¾‹è®²è§£æœ€ç»ˆå®ç°public class SensitiveFilter { // æ›¿æ¢ç¬¦ private static final String REPLACEMENT = \"***\"; // æ ¹èŠ‚ç‚¹ private TrieNode rootNode = new TrieNode(); // åŠ è½½æ•æ„Ÿå­—ç¬¦, åªåŠ è½½ä¸€æ¬¡ @PostConstruct public void init() { try ( InputStream is = this.getClass().getClassLoader().getResourceAsStream(\"sensitive-word.txt\"); BufferedReader reader = new BufferedReader(new InputStreamReader(is)); ) { String keyword; while ((keyword = reader.readLine()) != null) { // æ·»åŠ åˆ°å‰ç¼€æ ‘ this.addKeyword(keyword); } } catch (IOException e) { logger.error(\"åŠ è½½æ•æ„Ÿè¯æ–‡ä»¶å¤±è´¥: \" + e.getMessage()); } } // å°†ä¸€ä¸ªæ•æ„Ÿè¯æ·»åŠ åˆ°å‰ç¼€æ ‘ä¸­ private void addKeyword(String keyword) { TrieNode tempNode = rootNode; for (int i = 0; i &lt; keyword.length(); i++) { char c = keyword.charAt(i); TrieNode subNode = tempNode.getSubNode(c); if(!tempNode.containsKey(c)){ tempNode.addSubNode(c, new TrieNode()); } tempNode = tempNode.getSubNode(c); } tempNode.setKeywordEnd(true); } /** * è¿‡æ»¤æ•æ„Ÿè¯ * * @param text å¾…è¿‡æ»¤çš„æ–‡æœ¬ * @return è¿‡æ»¤åçš„æ–‡æœ¬ */ public String filter(String text) { if (StringUtils.isBlank(text)) { return null; } // æŒ‡é’ˆ1 TrieNode tempNode = rootNode; // æŒ‡é’ˆ2 int begin = 0; // æŒ‡é’ˆ3 int position = 0; // ç»“æœ StringBuilder sb = new StringBuilder(); while (position &lt; text.length()) { char c = text.charAt(position); // è·³è¿‡ç¬¦å· if (isSymbol(c)) { // è‹¥æŒ‡é’ˆ1å¤„äºæ ¹èŠ‚ç‚¹,å°†æ­¤ç¬¦å·è®¡å…¥ç»“æœ,è®©æŒ‡é’ˆ2å‘ä¸‹èµ°ä¸€æ­¥ if (tempNode == rootNode) { sb.append(c); begin++; } // æ— è®ºç¬¦å·åœ¨å¼€å¤´æˆ–ä¸­é—´,æŒ‡é’ˆ3éƒ½å‘ä¸‹èµ°ä¸€æ­¥ position++; continue; } // æ£€æŸ¥ä¸‹çº§èŠ‚ç‚¹ tempNode = tempNode.getSubNode(c); if (tempNode == null) { // ä»¥beginå¼€å¤´çš„å­—ç¬¦ä¸²ä¸æ˜¯æ•æ„Ÿè¯ sb.append(text.charAt(begin)); // è¿›å…¥ä¸‹ä¸€ä¸ªä½ç½® position = ++begin; // é‡æ–°æŒ‡å‘æ ¹èŠ‚ç‚¹ tempNode = rootNode; } else if (tempNode.isKeywordEnd()) { // å‘ç°æ•æ„Ÿè¯,å°†begin~positionå­—ç¬¦ä¸²æ›¿æ¢æ‰ sb.append(REPLACEMENT); // è¿›å…¥ä¸‹ä¸€ä¸ªä½ç½® begin = ++position; // é‡æ–°æŒ‡å‘æ ¹èŠ‚ç‚¹ tempNode = rootNode; } else { // æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦ position++; } } // å°†æœ€åä¸€æ‰¹å­—ç¬¦è®¡å…¥ç»“æœ sb.append(text.substring(begin)); return sb.toString(); } // åˆ¤æ–­æ˜¯å¦ä¸ºç¬¦å· private boolean isSymbol(Character c) { // 0x2E80~0x9FFF æ˜¯ä¸œäºšæ–‡å­—èŒƒå›´ return !CharUtils.isAsciiAlphanumeric(c) &amp;&amp; (c &lt; 0x2E80 || c &gt; 0x9FFF); } // å‰ç¼€æ ‘ private class TrieNode { // å…³é”®è¯ç»“æŸæ ‡è¯† private boolean isKeywordEnd = false; // å­èŠ‚ç‚¹(keyæ˜¯ä¸‹çº§å­—ç¬¦,valueæ˜¯ä¸‹çº§èŠ‚ç‚¹) private Map&lt;Character, TrieNode&gt; subNodes = new HashMap&lt;&gt;(); public boolean isKeywordEnd() { return isKeywordEnd; } public void setKeywordEnd(boolean keywordEnd) { isKeywordEnd = keywordEnd; } // æ·»åŠ å­èŠ‚ç‚¹ public void addSubNode(Character c, TrieNode node) { subNodes.put(c, node); } // è·å–å­èŠ‚ç‚¹ public TrieNode getSubNode(Character c) { return subNodes.get(c); } public boolean containsKey(Character c){ return subNodes.containsKey(c); } } } References ç®—æ³•æ–°è§£ å®ç° Trie (å‰ç¼€æ ‘) é—®ç­”ç¤¾åŒº-æ•æ„Ÿè¯è¿‡æ»¤ åŸºäºå‰ç¼€æ ‘å›¾æ–‡è¯¦è§£æ•æ„Ÿè¯è¿‡æ»¤ Trie Tree çš„å®ç° (é€‚åˆåˆå­¦è€…) é¢è¯•è¢«è™ è¯´è¯´æ¸¸æˆä¸­çš„æ•æ„Ÿè¯è¿‡æ»¤æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://winniekun.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"trie","slug":"trie","permalink":"https://winniekun.github.io/tags/trie/"}]},{"title":"Cookieå’ŒSession","slug":"ç½‘ç»œ/Cookie-Session","date":"2020-07-06T01:36:34.000Z","updated":"2020-08-30T04:50:22.262Z","comments":true,"path":"Cookie-Session/","link":"","permalink":"https://winniekun.github.io/Cookie-Session/","excerpt":"å‰è¨€","text":"å‰è¨€ Sessionå’ŒCookieçš„ä½œç”¨æ˜¯ä¸ºäº†ä¿æŒè®¿é—®ç”¨æˆ·ä¸åç«¯æœåŠ¡å™¨çš„äº¤äº’çŠ¶æ€ CookieCookieçš„ä½œç”¨é€šä¿—æ¥è®²å°±æ˜¯å½“ä¸€ä¸ªç”¨æˆ·é€šè¿‡HTTPè¯·æ±‚è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™, æœåŠ¡å™¨å°†ä¸€äº›Key/Valueçš„é”®å€¼å¯¹è¿”å›ç»™å®¢æˆ·ç«¯, å¹¶ä¸”è¿˜å¯ä»¥ç»™è¿™äº›æ•°æ®æ·»åŠ ä¸€äº›é™åˆ¶æ¡ä»¶: å­˜æ´»æ—¶é—´, ç”Ÿæ•ˆèŒƒå›´ç­‰, åœ¨ç¬¦åˆé™åˆ¶æ¡ä»¶çš„æƒ…å†µä¸‹, è¯¥ç”¨æˆ·å†æ¬¡å‘èµ·è¯·æ±‚, æ•°æ®å°†ä¼šè¢«å®Œæ•´çš„è¿”å›ç»™æœåŠ¡å™¨. @RequestMapping(value = \"/cookie/set\", method = RequestMethod.GET) @ResponseBody public String setCookie(HttpServletResponse response){ // ç”Ÿæˆcookie Cookie cookie = new Cookie(\"wkk\", CommunityUtil.generateUUID()); // è®¾ç½®ç”Ÿæ•ˆèŒƒå›´ cookie.setPath(\"/community/alpha\"); // è®¾ç½®cookieçš„ç”Ÿæ•ˆæ—¶é—´ï¼ˆé»˜è®¤å­˜åœ¨å†…å­˜ä¸­ï¼Œ è®¾ç½®æ—¶é—´ä¹‹åä¼šå­˜åœ¨ç¡¬ç›˜ä¸­ï¼‰ cookie.setMaxAge(10); // å‘é€ç»™å®¢æˆ·ç«¯ response.addCookie(cookie); return \"set cookie\"; } Cookie W3Cåœ¨è®¾è®¡Cookieçš„æ—¶å€™, å®é™…ä¸Šè€ƒè™‘çš„æ˜¯ä¸ºäº†è®°å½•ç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´çš„webåº”ç”¨çš„è¡Œä¸ºè·¯å¾„. å› ä¸ºHTTPæ˜¯æ— çŠ¶æ€åè®®, å½“ç”¨æˆ·è®¿é—®å®Œä¸€æ¬¡è¯·æ±‚ç»“æŸä¹‹å, åç«¯æœåŠ¡å™¨æ— æ³•çŸ¥é“ä¸‹ä¸€æ¬¡æ¥è®¿çš„æ˜¯å¦è¿˜æ˜¯ä¸Šæ¬¡è®¿é—®çš„ç”¨æˆ·. ä½¿ç”¨Cookieså¸¦æ¥çš„ä¼˜åŠ¿: çŸ­æ—¶é—´å†…, å¦‚æœä¸ç”¨æˆ·ç›¸å…³çš„æ•°æ®é¢‘ç¹è¢«è®¿é—®, å¯ä»¥ä¸ºè¯¥æ•°æ®æ·»åŠ ç¼“å­˜, æé«˜æ•°æ®çš„è®¿é—®æ€§èƒ½ è‹¥æ˜¯åŒä¸€å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚, æ¯æ¬¡å‘å‡ºçš„è¯·æ±‚éƒ½ä¼šåŒ…å«ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ä¹‹å, æœåŠ¡å™¨è®¾ç½®çš„ä¿¡æ¯, è¿™æ ·æœåŠ¡å™¨å°±å¯ä»¥æ ¹æ®Cookieæ¥åˆ’åˆ†ç”¨æˆ·. Sessionè™½ç„¶Cookieçš„å‡ºç°å¯ä»¥è®©æœåŠ¡å™¨è¯†åˆ«æ¯ä¸ªå®¢æˆ·çš„è¯·æ±‚, ä½†æ˜¯æ¯æ¬¡å®¢æˆ·çš„è®¿é—®éƒ½å¿…é¡»è¿”å›è¿™äº›Cookie, å¦‚æœCookieå¾ˆå¤š, æ— ç–‘æ˜¯å¢åŠ äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´æ•°æ®çš„ä¼ è¾“é‡, è€ŒSessionçš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜. Session åŒä¸€ä¸ªå®¢æˆ·ç«¯æ¯æ¬¡å’ŒæœåŠ¡ç«¯äº¤äº’çš„æ—¶å€™, ä¸éœ€è¦æ¯æ¬¡éƒ½ä¼ å›æ‰€æœ‰çš„Cookieå€¼, è€Œåªè¦ä¼ å›ä¸€ä¸ªID, è¿™ä¸ªIDæ˜¯å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ç”Ÿæˆçš„, è€Œä¸”æ¯ä¸ªå®¢æˆ·ç«¯æ˜¯å”¯ä¸€çš„, è¿™æ ·æ¯ä¸ªå®¢æˆ·ç«¯å°±æœ‰äº†å”¯ä¸€çš„ID, å®¢æˆ·ç«¯åªè¦è¿”å›IDå³å¯, è¿™ä¸ªIDå°±æ˜¯åä¸ºJSSIONIDçš„ä¸€ä¸ªCookie å®‰å…¨é—®é¢˜è™½ç„¶Cookieå’ŒSessionéƒ½å¯ä»¥è·Ÿè¸ªå®¢æˆ·ç«¯çš„è®¿é—®è®°å½•, ä½†æ˜¯å·¥ä½œæ–¹å¼ä¸åŒ, Cookieæ˜¯é€šè¿‡æŠŠæ‰€æœ‰è¦ä¿å­˜çš„æ•°æ®é€šè¿‡HTTPçš„å¤´éƒ¨ä»å®¢æˆ·ç«¯ä¼ é€’åˆ°æœåŠ¡åº¦ç«¯, ç„¶ååˆä»æœåŠ¡ç«¯ä¼ åˆ°å®¢æˆ·ç«¯, æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åˆ°å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸­, è¿™äº›Cookieæ•°æ®å¯ä»¥ç›´æ¥è®¿é—®åˆ°, è®¾ç½®å¯ä»¥ä¿®æ”¹, æ‰€ä»¥å®‰å…¨æ€§å—åˆ°å¾ˆå¤§çš„æŒ‘æˆ˜ ç›¸æ¯”è€Œè¨€, Sessionçš„å®‰å…¨æ€§é«˜å¾ˆå¤š, å› ä¸ºSessionçš„æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨é‡Œ, åªæ˜¯é€šè¿‡Cookieä¼ é€’ä¸€ä¸ªSessionIDè€Œå·², æ‰€ä»¥Sessionæ›´é€‚åˆå­˜å‚¨ç”¨æˆ·éšç§å’Œé‡è¦çš„æ•°æ®","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://winniekun.github.io/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"http","slug":"http","permalink":"https://winniekun.github.io/tags/http/"}]},{"title":"å•ä¾‹æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼/SingletonPattern","date":"2020-07-02T13:35:20.000Z","updated":"2021-03-31T11:22:40.128Z","comments":true,"path":"SingletonPattern/","link":"","permalink":"https://winniekun.github.io/SingletonPattern/","excerpt":"å‰è¨€","text":"å‰è¨€ â€œä½ çŸ¥é“èŒ´é¦™è±†çš„â€˜èŒ´â€™å­—æœ‰å‡ ç§å†™æ³•å—ï¼Ÿâ€ çº ç»“å•ä¾‹æ¨¡å¼æœ‰å‡ ç§å†™æ³•æœ‰ç”¨å—? æœ‰ç‚¹ç”¨, é¢è¯•ä¸­ç»å¸¸é€‰æ‹©å…¶ä¸­ä¸€ç§æˆ–å‡ ç§å†™æ³•ä½œä¸ºè¯å¤´, ä»¥æ­¤å±•å¼€è€ƒå¯Ÿé¢è¯•è€…çš„code style ä»¥åŠå…¶ä»–ç›¸å…³çš„çŸ¥è¯†ç‚¹. ä½†æ˜¯è¿‡äºçº ç»“è¿™äº›å†™æ³•, åè€Œç±»ä¼¼äºâ€èŒ´â€å­—æœ‰å‡ ä¸ªå†™æ³•â€¦ æ€æƒ³, æ€æƒ³, æ€æƒ³. é‡è¦äº‹æƒ…è¯´ä¸‰é ç±»åŠ è½½é¡ºåºç±»åŠ è½½(classLoader)æœºåˆ¶ä¸€èˆ¬éµä»ä¸‹é¢çš„åŠ è½½é¡ºåº å¦‚æœç±»è¿˜æ²¡æœ‰è¢«åŠ è½½ï¼š å…ˆæ‰§è¡Œçˆ¶ç±»çš„é™æ€ä»£ç å—å’Œé™æ€å˜é‡åˆå§‹åŒ–ï¼Œé™æ€ä»£ç å—å’Œé™æ€å˜é‡çš„æ‰§è¡Œé¡ºåºè·Ÿä»£ç ä¸­å‡ºç°çš„é¡ºåºæœ‰å…³ã€‚ æ‰§è¡Œå­ç±»çš„é™æ€ä»£ç å—å’Œé™æ€å˜é‡åˆå§‹åŒ–ã€‚ æ‰§è¡Œçˆ¶ç±»çš„å®ä¾‹å˜é‡åˆå§‹åŒ– æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•° æ‰§è¡Œå­ç±»çš„å®ä¾‹å˜é‡åˆå§‹åŒ– æ‰§è¡Œå­ç±»çš„æ„é€ å‡½æ•° åŒæ—¶ï¼ŒåŠ è½½ç±»çš„è¿‡ç¨‹æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œåˆ«çš„çº¿ç¨‹æ— æ³•è¿›å…¥ã€‚ å¦‚æœç±»å·²ç»è¢«åŠ è½½ï¼š é™æ€ä»£ç å—å’Œé™æ€å˜é‡ä¸åœ¨é‡å¤æ‰§è¡Œï¼Œå†åˆ›å»ºç±»å¯¹è±¡æ—¶ï¼Œåªæ‰§è¡Œä¸å®ä¾‹ç›¸å…³çš„å˜é‡åˆå§‹åŒ–å’Œæ„é€ æ–¹æ³•ã€‚ staticå…³é”®å­—ä¸€ä¸ªç±»ä¸­å¦‚æœæœ‰æˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•è¢«staticå…³é”®å­—ä¿®é¥°ï¼Œé‚£ä¹ˆè¯¥æˆå‘˜å˜é‡æˆ–æ–¹æ³•å°†ç‹¬ç«‹äºè¯¥ç±»çš„ä»»ä½•å¯¹è±¡ã€‚å®ƒä¸ä¾èµ–ç±»ç‰¹å®šçš„å®ä¾‹ï¼Œè¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ï¼Œåªè¦è¿™ä¸ªç±»è¢«åŠ è½½ï¼Œè¯¥æˆå‘˜å˜é‡æˆ–æ–¹æ³•å°±å¯ä»¥é€šè¿‡ç±»åå»è¿›è¡Œè®¿é—®ï¼Œå®ƒçš„ä½œç”¨ç”¨ä¸€å¥è¯æ¥æè¿°å°±æ˜¯ï¼Œä¸ç”¨åˆ›å»ºå¯¹è±¡å°±å¯ä»¥è°ƒç”¨æ–¹æ³•æˆ–è€…å˜é‡ï¼Œè¿™ç®€ç›´å°±æ˜¯ä¸ºå•ä¾‹æ¨¡å¼çš„ä»£ç å®ç°é‡èº«æ‰“é€ çš„ã€‚ é¥¿æ±‰æ¨¡å¼public class Singleton { private static Singleton instance = new Singleton(); private Singleton() { } public static Singleton getInstance() { return instance; } } åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†å®ä¾‹åŒ–, é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜. å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„, å› ä¸ºç±»åŠ è½½æ—¶å°±å®ä¾‹åŒ–äº†, æ²¡æœ‰è¾¾åˆ°Lazy Loading (æ‡’åŠ è½½) çš„æ•ˆæœ, å¦‚æœè¯¥å®ä¾‹æ²¡è¢«ä½¿ç”¨, å†…å­˜å°±æµªè´¹äº†. æ‡’æ±‰æ¨¡å¼é¡¾åæ€ä¹‰, å°±æ˜¯åˆå§‹åŒ–çš„æ—¶å€™, ä¸ä¼šä¸»åŠ¨çš„å»åˆ›å»ºå®ä¾‹, è€Œæ˜¯åœ¨è°ƒç”¨getInstance()çš„æ—¶å€™, æ‰ä¼šè¢«åŠ¨çš„å»åˆ›å»º. public class Singleton { private static Singleton instance = null; private LazySingleton(){ } public static Singleton getInstance(){ if(instance == null){ instance = new Singleton(); } return instance; } } åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹, æ²¡æœ‰ä»»ä½•é—®é¢˜, ä½†æ˜¯å› ä¸ºå…¶ä¸ºçº¿ç¨‹ä¸å®‰å…¨çš„, åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹, è­¬å¦‚ä¸¤ä¸ªçº¿ç¨‹A, Béƒ½æ‰§è¡Œäº†getInstance()æ–¹æ³•, å¹¶ä¸”éƒ½æ‰§è¡Œåˆ°äº†ç¬¬9è¡Œä»£ç , ç„¶åAå› ä¸ºå…¶ä»–åŸå› , ä¼‘çœ äº†ä¸€ä¼šå„¿, å¾…Båˆ›å»ºäº†å®ä¾‹å¯¹è±¡ä¹‹å, Aæœ‰åˆ›å»ºäº†ä¸€ä¸ª, æ˜¾ç„¶, è¿™æ˜¯ä¸ç¬¦åˆå•åˆ©æ¨¡å¼çš„ è§£å†³1åœ¨getInstance()æ–¹æ³•å†…éƒ¨æ·»åŠ åŒæ­¥ä»£ç å—, æˆ–è€…ç›´æ¥å°†è¯¥æ–¹æ³•æ”¹ä¸ºåŒæ­¥æ–¹æ³• public class Singleton { private static Singleton instance = null; private LazySingleton(){ } public synchronized static Singleton getInstance(){ if(instance == null){ instance = new Singleton(); } return instance; } } å¥½å¤„æ˜¯å†™èµ·æ¥ç®€å•, ä¸”ç»å¯¹çº¿ç¨‹å®‰å…¨; åå¤„æ˜¯å¹¶å‘æ€§èƒ½æå·®, äº‹å®ä¸Šå®Œå…¨é€€åŒ–åˆ°äº†ä¸²è¡Œ. å•ä¾‹åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡, ä½†å°±ç®—åˆå§‹åŒ–ä»¥å, synchronizedçš„é”ä¹Ÿæ— æ³•é¿å¼€, ä»è€ŒgetInstance()å®Œå…¨å˜æˆäº†ä¸²è¡Œæ“ä½œ. æ€§èƒ½ä¸æ•æ„Ÿçš„åœºæ™¯å»ºè®®ä½¿ç”¨ã€‚ è§£å†³2ä¹Ÿå°±æ˜¯è‡­åæ˜­è‘—çš„åŒé‡æ£€éªŒæ–¹æ³• public class Singleton { private static Singleton instance; // åŒé‡é”æ£€éªŒ public static Singleton getInstance() { if (instance == null) { // ç¬¬7è¡Œ synchronized (Singleton.class) { if (instance == null) { instance = new Singleton(); // ç¬¬10è¡Œ } } } return instance; } } ç”±äºæŒ‡ä»¤é‡æ’åºçš„é—®é¢˜, å¯èƒ½ä¼šè¢«é‡æ’åºä¸ºå¦‚ä¸‹: instance = new Singleton(); // ç¬¬10è¡Œ // å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ 1 memory=allocate();// åˆ†é…å†…å­˜ ç›¸å½“äºcçš„malloc 2 ctorInstanc(memory) //åˆå§‹åŒ–å¯¹è±¡ 3 s=memory //è®¾ç½®sæŒ‡å‘åˆšåˆ†é…çš„åœ°å€ // ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤å¯èƒ½ä¼šè¢«é‡æ’åºä¸º 1-3-2ï¼Œä¹Ÿå°±æ˜¯ï¼š 1 memory=allocate();// åˆ†é…å†…å­˜ ç›¸å½“äºcçš„malloc 3 s=memory //è®¾ç½®sæŒ‡å‘åˆšåˆ†é…çš„åœ°å€ 2 ctorInstanc(memory) //åˆå§‹åŒ–å¯¹è±¡ è€Œä¸€æ—¦å‡è®¾å‘ç”Ÿäº†è¿™æ ·çš„é‡æ’åºï¼Œæ¯”å¦‚çº¿ç¨‹Aåœ¨ç¬¬10è¡Œæ‰§è¡Œäº†æ­¥éª¤1å’Œæ­¥éª¤3ï¼Œä½†æ˜¯æ­¥éª¤2è¿˜æ²¡æœ‰æ‰§è¡Œå®Œã€‚è¿™ä¸ªæ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹Bæ‰§è¡Œåˆ°äº†ç¬¬7è¡Œï¼Œå®ƒä¼šåˆ¤å®šinstanceä¸ä¸ºç©ºï¼Œç„¶åç›´æ¥è¿”å›äº†ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæˆçš„instanceï¼ è§£å†³3public class Singleton { private static volatile Singleton instance; // åŒé‡é”æ£€éªŒ public static Singleton getInstance() { if (instance == null) { // ç¬¬7è¡Œ synchronized (Singleton.class) { if (instance == null) { instance = new Singleton(); // ç¬¬10è¡Œ } } } return instance; } } è¿™æ ·å°±ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨ æšä¸¾æ¨¡å¼// æšä¸¾ // ThreadSafe public enum Singleton4 { SINGLETON; } ä½¿ç”¨javapè¿›è¡Œåç¼–è¯‘å¾—åˆ°å¦‚ä¸‹ç»“æœ // æšä¸¾ // ThreadSafe public class Singleton4 extends Enum&lt;Singleton4&gt; { ... public static final Singleton4 SINGLETON = new Singleton4(); ... } å¯ä»¥çœ‹åˆ°, å…¶æœ¬è´¨ä¹Ÿè¿˜æ˜¯é¥¿æ±‰æ¨¡å¼ é™æ€å†…éƒ¨ç±»å®ç°/** * JVMåœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼ˆclassè¢«åŠ åœ¨åï¼Œä¸”è¢«çº¿ç¨‹ä½¿ç”¨ä¹‹å‰ï¼‰ä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ– * æ‰§è¡Œç±»çš„åˆå§‹åŒ–æœŸé—´ï¼ŒJVMä¼šå»è·å–ä¸€ä¸ªé”ï¼Œé”ä¼šåŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»çš„åˆå§‹åŒ– * @author weikunkun * @since 2021/3/20 */ public class InstanceFactory { private static class InstanceHolder { public static Object object = new Object(); } public static Object getInstance() { return InstanceHolder.object; } }","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://winniekun.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"åˆ›å»ºå‹æ¨¡å¼","slug":"åˆ›å»ºå‹æ¨¡å¼","permalink":"https://winniekun.github.io/tags/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/"}]},{"title":"Javaä¸­å¼‚å¸¸ç±»ä½“ç³»","slug":"JavaåŸºç¡€/é¢è¯•36è®²/Throwable","date":"2020-07-02T11:57:04.000Z","updated":"2021-07-21T02:46:30.041Z","comments":true,"path":"Throwable/","link":"","permalink":"https://winniekun.github.io/Throwable/","excerpt":"","text":"è§£ç­”Exceptionå’ŒErrorå‡ç»§æ‰¿è‡ªTrowable, å¦‚ä¸‹å›¾æ‰€ç¤º: ä¾èµ–å›¾ Throwablepublic Throwable() {...} public Throwable(String message) {...} public Throwable(String message, Throwable cause) {...} public Throwable(Throwable cause) {...} ... é€šè¿‡æ„é€ å‡½æ•°ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ ¸å¿ƒçš„å‚æ•°ä¸ºä¸¤ä¸ªï¼š message è¡¨ç¤ºå¼‚å¸¸ä¿¡æ¯ cause é€ æˆå¼‚å¸¸çš„å¼‚å¸¸ï¼ˆå¥—å¨ƒè¡Œä¸ºï¼ï¼ï¼ï¼‰ ä¸Šå±‚çš„å¼‚å¸¸é€šè¿‡åº•å±‚çš„å¼‚å¸¸è§¦å‘ä¸€å±‚ä¸€å±‚çš„æŠ›ä¸Šæ¥ Exceptionã€Erroråœ¨ Java ä¸­åªæœ‰ Throwable ç±»å‹çš„å®ä¾‹æ‰å¯ä»¥è¢«æŠ›å‡ºï¼ˆthrowï¼‰æˆ–è€…æ•è·ï¼ˆcatchï¼‰ï¼Œå®ƒæ˜¯å¼‚å¸¸å¤„ç†æœºåˆ¶çš„åŸºæœ¬ç»„æˆç±»å‹, Exceptionå’ŒErrorä»£è¡¨äº†å¯¹ä¸åŒå¼‚å¸¸æƒ…å†µçš„åˆ†ç±» Exception: ç¨‹åºæ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹, å¯ä»¥é¢„æ–™çš„æ„å¤–æƒ…å†µ, å¯ä»¥å¹¶ä¸”åº”è¯¥è¢«æ•è·, ä¹‹åè¿›è¡Œå¤„ç†, æœ€åä»èƒ½ç¨‹åºç»§ç»­æ­£å¸¸è¿è¡Œ åˆå¯ä»¥è¢«ç»†åˆ†ä¸ºå¯æ£€æŸ¥å¼‚å¸¸å’Œä¸å¯æ£€æŸ¥å¼‚å¸¸ å¯æ£€æŸ¥å¼‚å¸¸: ç¼–è¯‘æœŸé—´å‡ºç°çš„å¼‚å¸¸, å¿…é¡»è¿›è¡Œæ•è·å¤„ç† ä¸å¯æ£€æŸ¥å¼‚å¸¸: è¿è¡ŒæœŸé—´å‡ºç°çš„å¼‚å¸¸, è­¬å¦‚ArrayIndexOutOfBoundsException, NullPointerExceptionä¹‹ç±» Error: æ­£å¸¸æƒ…å†µä¸‹, ä¸å¤§å¯èƒ½å‡ºç°çš„å¼‚å¸¸, ç»å¤§å¤šæ•°Errorçš„å‡ºç°ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ, ä¸ä¾¿äºä¹Ÿä¸éœ€è¦æ•è·, è­¬å¦‚OutOfMemoryErrorä¹‹ç±», éƒ½æ˜¯Errorçš„å­ç±» ç²—ç•¥äº†è§£äº†ä¸Šè¿°çš„Exceptionå’ŒErrorçš„å…³ç³»å’Œæ¦‚è¿°ä¹‹åï¼Œå†æ¥ä¸ªè¯¦ç»†çš„å›¾ï¼ŒåŠ æ·±ç†è§£ Java å¼‚å¸¸å¤§å®¶æ— æœ‰è¿™ä¹ˆå¤šçš„å¼‚å¸¸ç±»å‹ï¼Œä¸»è¦è¿˜æ˜¯ä¸ºäº†èƒ½å¤Ÿæ›´åŠ å‡†ç¡®çš„æ•è·å¼‚å¸¸ï¼Œå¢åŠ ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ã€‚åŒæ—¶å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæ›´åŠ ç²¾ç¡®é˜è¿°å¼‚å¸¸åŸå› ã€‚é€šå¸¸æ˜¯ç»§æ‰¿Exceptionæˆ–è€…Exceptionä¸­çš„æŸä¸ªå­ç±»ã€‚ å¼‚å¸¸å¤„ç†try-catchæœ€ç›´æ¥çš„è§£å†³æ–¹å¼å°±æ˜¯å‡ºç°å¼‚å¸¸ï¼Œè§£å†³å¼‚å¸¸ã€‚ try { // doSomething(); } catch (Exception e) { // 1. è®°å½•å¼‚å¸¸ log.error(\"something error\"); // 2. æ‰§è¡Œå¼‚å¸¸çš„ä¸šåŠ¡é€»è¾‘ doExcepptionHandler(); // 3. ä¹Ÿå¯ä»¥æ‰§è¡Œå®Œå¼‚å¸¸é€»è¾‘ä¹‹åï¼Œå†æŠ›å‡ºå¼‚å¸¸ throw e } finallytry { } catch (Exception e) { } finally { } æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚ ä¹Ÿå¯ä»¥è¿™æ ·ï¼š try { } finally { } ä¸æ•è·å‡ºç°çš„å¼‚å¸¸ï¼Œå¼‚å¸¸ç»§ç»­å‘ä¸Šä¼ é€’ã€‚ æ€»ç»“å¯¹äºå¼‚å¸¸çš„å¤„ç†ï¼Œæ€»æœ‰ä¸€å±‚ä»£ç éœ€è¦ä¸ºå¼‚å¸¸è´Ÿè´£ï¼Œå¯èƒ½æ˜¯çŸ¥é“å¦‚ä½•å¤„ç†å¼‚å¸¸çš„ä»£ç ï¼Œå¯èƒ½æ˜¯é¢å¯¹ç”¨æˆ·çš„ä»£ç ï¼Œå¯èƒ½æ˜¯ä¸»ç¨‹åºã€‚ æœ‰äº†å¼‚å¸¸æœºåˆ¶åï¼Œç¨‹åºçš„æ­£ç¡®é€»è¾‘å’Œå¼‚å¸¸é€»è¾‘å¯ä»¥ç›¸åˆ†ç¦»ï¼Œå¼‚å¸¸æƒ…å†µå¯ä»¥é›†ä¸­å¤„ç†ï¼Œå¼‚å¸¸è¿˜å¯ä»¥å‘ä¸Šä¼ é€’ï¼Œä¸éœ€è¦æ¯å±‚æ–¹æ³•éƒ½éœ€è¦å¤„ç†ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"},{"name":"é¢è¯•36è®²","slug":"é¢è¯•36è®²","permalink":"https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"}]},{"title":"Spring Beançš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ","slug":"JavaåŸºç¡€/é¢è¯•36è®²/spring-bean-knowledge-point","date":"2020-07-01T12:38:31.000Z","updated":"2021-04-05T15:26:25.201Z","comments":true,"path":"spring-bean-knowledge-point/","link":"","permalink":"https://winniekun.github.io/spring-bean-knowledge-point/","excerpt":"Spring Beançš„ç”Ÿå‘½å‘¨æœŸ","text":"Spring Beançš„ç”Ÿå‘½å‘¨æœŸ Springçš„ç”Ÿå‘½å‘¨æœŸä»æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºåˆ›å»ºå’Œé”€æ¯ä¸¤ä¸ªéƒ¨åˆ†. å®ä¾‹åŒ–Beanå¯¹è±¡ è®¾ç½®Beanå±æ€§ è‹¥æ˜¯é€šè¿‡å„ç§Awareæ¥å£å£°æ˜äº†ä¾èµ–å…³ç³»,åˆ™ä¼šæ³¨å…¥ Bean å¯¹å®¹å™¨åŸºç¡€è®¾æ–½å±‚é¢çš„ä¾èµ– å¦‚æœbeanå®ç°äº†BeanNameAwareæ¥å£, åˆ™å°†BeanIdé€šè¿‡setBeanNameæ³¨å…¥Springä¸­. å¦‚æœbeanå®ç°äº†BeanFactoryAwareæ¥å£, åˆ™å°†BeanFactoryå®¹å™¨å®ä¾‹é€šè¿‡setBeanFactoryæ³¨å…¥Springä¸­ å¦‚æœbeanå®ç°äº†ApplicationContextAwareæ¥å£, åˆ™å°†beanæ‰€åœ¨çš„åº”ç”¨çš„ä¸Šä¸‹æ–‡é€šè¿‡setApplicationContextæ³¨å…¥Springä¸­ å¦‚æœbeanå®ç°äº†BeanPostProcessoræ¥å£, åˆ™è°ƒç”¨å‰ç½®åˆå§‹åŒ–æ–¹æ³•, postProcessorBeforeInitialization() å¦‚æœbeanå®ç°äº†InitializingBeanæ¥å£, åˆ™è°ƒç”¨afterPropertiesSet()æ–¹æ³•, è°ƒç”¨è‡ªèº«çš„åˆå§‹åŒ–æ–¹æ³• å¦‚æœbeanå®ç°äº†BeanPostProcessoræ¥å£, åˆ™è°ƒç”¨åç½®åˆå§‹åŒ–æ–¹æ³•, postProcessorAfterInitialization() beanå·²ç»å‡†å¤‡å°±ç»ª, å¯ä»¥ä½¿ç”¨, ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­, ç›´åˆ°åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯ å¦‚æœbeanå®ç°äº†DisposableBeanæ¥å£, åˆ™è°ƒç”¨destroy()æ–¹æ³• è°ƒç”¨è‡ªèº«çš„destroyæ–¹æ³• Spring Bean çš„ä½œç”¨åŸŸSpring Bean æœ‰äº”ä¸ªä½œç”¨åŸŸï¼Œå…¶ä¸­æœ€åŸºç¡€çš„ä¸ºåŠ ç²—çš„ä¸¤ç§ singleton Springçš„é»˜è®¤ä½œç”¨äº, ä¸ºæ¯ä¸ªIOCå®¹å™¨åˆ›å»ºå”¯ä¸€çš„Beanå®ä¾‹ prototype é’ˆå¯¹æ¯ä¸ªgetBeanè¯·æ±‚, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªBeanå®ä¾‹ request æ¯æ¬¡Httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºæ–°çš„Bean, ä»…é€‚ç”¨äºWebApplicationContext session ä¸€ä¸ªHttpSessionå®šä¹‰ä¸€ä¸ªBean. è¯¥ä½œç”¨äºä»…é€‚ç”¨äºWebApplicationContext globalSession åŒä¸€ä¸ªå…¨å±€Http Session å®šä¹‰ä¸€ä¸ªBean. è¯¥ä½œç”¨åŸŸåŒæ ·ä»…é€‚ç”¨äºWebApplicationContext","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"},{"name":"é¢è¯•36è®²","slug":"é¢è¯•36è®²","permalink":"https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"}]},{"title":"WeakHashMapæºç è§£è¯»","slug":"æºç /JDK/map/weakhashmap-analysis","date":"2020-06-20T10:42:30.000Z","updated":"2020-08-30T04:50:22.256Z","comments":true,"path":"weakhashmap-analysis/","link":"","permalink":"https://winniekun.github.io/weakhashmap-analysis/","excerpt":"","text":"","categories":[],"tags":[]},{"title":"LinkedHashMapæºç è§£è¯»","slug":"æºç /JDK/map/linkedhashmap-analysis","date":"2020-06-20T10:38:04.000Z","updated":"2021-05-04T14:46:52.357Z","comments":true,"path":"linkedhashmap-analysis/","link":"","permalink":"https://winniekun.github.io/linkedhashmap-analysis/","excerpt":"LinkedHashMapæºç è§£è¯»","text":"LinkedHashMapæºç è§£è¯» ä¾èµ– LinkedHashMapä¾èµ– LinkedHashMapç»§æ‰¿HashMap, æ‹¥æœ‰HashMapçš„æ‰€æœ‰ç‰¹æ€§, å¹¶ä¸”è¿˜é¢å¤–å¢åŠ äº†æŒ‰ä¸€å®šé¡ºåºè®¿é—®çš„åŠŸèƒ½ æ¦‚è¿°LinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œåœ¨ HashMap åŸºç¡€ä¸Šï¼Œé€šè¿‡ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè§£å†³äº† HashMap ä¸èƒ½éšæ—¶ä¿æŒéå†é¡ºåºå’Œæ’å…¥é¡ºåºä¸€è‡´çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒLinkedHashMap å¯¹è®¿é—®é¡ºåºä¹Ÿæä¾›äº†ç›¸å…³æ”¯æŒã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¯¥ç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç¼“å­˜ã€‚åœ¨å®ç°ä¸Šï¼ŒLinkedHashMap å¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ª HashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨è¦†å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚ èŠ‚ç‚¹çš„æ„é€ static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; { Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) { super(hash, key, value, next); } } LinkedHashMapå†…éƒ¨çš„Entryç›¸è¾ƒäºNodeèŠ‚ç‚¹å¤šäº†ä¸¤ä¸ªbeforeã€afterå¼•ç”¨ï¼Œç”¨æ¥ç»´æŠ¤LinkedHashMapå†…éƒ¨å…ƒç´ çš„é¡ºåº(å…¶å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨)ã€‚è¿™äº›è¿˜å¥½ç†è§£ï¼Œä¸è¿‡æ¯”è¾ƒå¥½å¥‡çš„æ˜¯ï¼Œä¸ºä»€ä¹ˆHashMapå†…éƒ¨çš„TreeNodeèŠ‚ç‚¹åè€Œç»§æ‰¿çš„æ˜¯Entryï¼Œè€Œä¸æ˜¯HashMapå†…éƒ¨çš„Node TreeNode ç»§æ‰¿ LinkedHashMap çš„å†…éƒ¨ç±» Entry åï¼Œå°±å…·å¤‡äº†å’Œå…¶ä»– Entry ä¸€èµ·ç»„æˆé“¾è¡¨çš„èƒ½åŠ›ã€‚ä½†æ˜¯è¿™é‡Œä¼šæœ‰ä¸€ä¸ªç–‘é—®ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ HashMap æ—¶ï¼ŒTreeNode å¹¶ä¸éœ€è¦å…·å¤‡ç»„æˆé“¾è¡¨èƒ½åŠ›ã€‚å¦‚æœç»§æ‰¿ LinkedHashMap å†…éƒ¨ç±» Entry ï¼ŒTreeNode å°±å¤šäº†ä¸¤ä¸ªç”¨ä¸åˆ°çš„å¼•ç”¨ï¼Œè¿™æ ·åšä¸æ˜¯ä¼šæµªè´¹ç©ºé—´å—ï¼Ÿç®€å•è¯´æ˜ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼ˆæ°´å¹³æœ‰é™ï¼Œä¸ä¿è¯å®Œå…¨æ­£ç¡®ï¼‰ï¼Œè¿™é‡Œè¿™ä¹ˆåšç¡®å®ä¼šæµªè´¹ç©ºé—´ï¼Œä½†ä¸ TreeNode é€šè¿‡ç»§æ‰¿è·å–çš„ç»„æˆé“¾è¡¨çš„èƒ½åŠ›ç›¸æ¯”ï¼Œè¿™ç‚¹æµªè´¹æ˜¯å€¼å¾—çš„ã€‚åœ¨ HashMap çš„è®¾è®¡æ€è·¯æ³¨é‡Šä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µè¯ï¼š Because TreeNodes are about twice the size of regular nodes, weuse them only when bins contain enough nodes to warrant use(see TREEIFY_THRESHOLD). And when they become too small (due toremoval or resizing) they are converted back to plain bins. Inusages with well-distributed user hashCodes, tree bins arerarely used. TreeNode å¯¹è±¡çš„å¤§å°çº¦æ˜¯æ™®é€š Node å¯¹è±¡çš„2å€ï¼Œæˆ‘ä»¬ä»…åœ¨æ¡¶ï¼ˆbinï¼‰ä¸­åŒ…å«è¶³å¤Ÿå¤šçš„èŠ‚ç‚¹æ—¶å†ä½¿ç”¨ã€‚å½“æ¡¶ä¸­çš„èŠ‚ç‚¹æ•°é‡å˜å°‘æ—¶ï¼ˆå–å†³äºåˆ é™¤å’Œæ‰©å®¹ï¼‰ï¼ŒTreeNode ä¼šè¢«è½¬æˆ Nodeã€‚å½“ç”¨æˆ·å®ç°çš„ hashCode æ–¹æ³•å…·æœ‰è‰¯å¥½åˆ†å¸ƒæ€§æ—¶ï¼Œæ ‘ç±»å‹çš„æ¡¶å°†ä¼šå¾ˆå°‘è¢«ä½¿ç”¨ã€‚ é€šè¿‡ä¸Šé¢çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦ hashCode çš„å®ç°ä¸ç³Ÿç³•ï¼ŒNode ç»„æˆçš„é“¾è¡¨å¾ˆå°‘ä¼šè¢«è½¬æˆç”± TreeNode ç»„æˆçš„çº¢é»‘æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ TreeNode ä½¿ç”¨çš„å¹¶ä¸å¤šï¼Œæµªè´¹é‚£ç‚¹ç©ºé—´æ˜¯å¯æ¥å—çš„ã€‚å‡å¦‚ TreeNode æœºåˆ¶ç»§æ‰¿è‡ª Node ç±»ï¼Œé‚£ä¹ˆå®ƒè¦æƒ³å…·å¤‡ç»„æˆé“¾è¡¨çš„èƒ½åŠ›ï¼Œå°±éœ€è¦ Node å»ç»§æ‰¿ LinkedHashMap çš„å†…éƒ¨ç±» Entryã€‚è¿™ä¸ªæ—¶å€™å°±å¾—ä¸å¿å¤±äº†ï¼Œæµªè´¹å¾ˆå¤šç©ºé—´å»è·å–ä¸ä¸€å®šç”¨å¾—åˆ°çš„èƒ½åŠ›ã€‚ ç±»çš„å±æ€§/** * The head (eldest) of the doubly linked list. */ transient LinkedHashMap.Entry&lt;K,V&gt; head; /** * The tail (youngest) of the doubly linked list. */ transient LinkedHashMap.Entry&lt;K,V&gt; tail; /** * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt; * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order. * * @serial */ final boolean accessOrder; æ„é€ å‡½æ•°public LinkedHashMap() { super(); accessOrder = false; } public LinkedHashMap(int initialCapacity) { super(initialCapacity); accessOrder = false; } public LinkedHashMap(int initialCapacity, float loadFactor) { super(initialCapacity, loadFactor); accessOrder = false; } public LinkedHashMap(Map&lt;? extends K, ? extends V&gt; m) { super(); accessOrder = false; putMapEntries(m, false); } public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) { super(initialCapacity, loadFactor); this.accessOrder = accessOrder; } å’ŒHashMapçš„æ„é€ å‡½æ•°æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡å…¥å‚accessOrderæ¥åˆ¤æ–­å†…éƒ¨ç»´æŠ¤ä»€ä¹ˆé¡ºåºçš„åŒå‘é“¾è¡¨ã€‚ å¢é“¾è¡¨çš„å»ºç«‹è¿‡ç¨‹æ˜¯åœ¨æ’å…¥é”®å€¼å¯¹èŠ‚ç‚¹æ—¶å¼€å§‹çš„ï¼Œåˆå§‹æƒ…å†µä¸‹ï¼Œè®© LinkedHashMap çš„ head å’Œ tail å¼•ç”¨åŒæ—¶æŒ‡å‘æ–°èŠ‚ç‚¹ï¼Œé“¾è¡¨å°±ç®—å»ºç«‹èµ·æ¥äº†ã€‚éšåä¸æ–­æœ‰æ–°èŠ‚ç‚¹æ’å…¥ï¼Œé€šè¿‡å°†æ–°èŠ‚ç‚¹æ¥åœ¨ tail å¼•ç”¨æŒ‡å‘èŠ‚ç‚¹çš„åé¢ï¼Œå³å¯å®ç°é“¾è¡¨çš„æ›´æ–°ã€‚ å› ä¸ºLinkedHashMapç»§æ‰¿äº†HashMapï¼Œå…¶å¹¶æœªæ•´ä½“é‡å†™çˆ¶ç±»çš„putæ“ä½œï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çˆ¶ç±»çš„putæ“ä½œï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒLinkedHashMap æ˜¯æ€ä¹ˆåšåˆ°åœ¨æœªé‡å†™çˆ¶ç±»æ–¹æ³•æƒ…å†µä¸‹ï¼Œæœ‰ä½¿å¾—å†…éƒ¨çš„èŠ‚ç‚¹å…·æœ‰é“¾è¡¨çš„èƒ½åŠ›å‘¢ï¼Ÿç ”è¯»æºç  putVal()public V put(K key, V value) { return putVal(hash(key), key, value, false, true); } final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { // å¯¹åº”tableæ•°ç»„ Node&lt;K,V&gt;[] tab; // å¯¹åº”ä½ç½®çš„ Node èŠ‚ç‚¹ Node&lt;K,V&gt; p; // n tableçš„é•¿åº¦ // åŸtabä¸­å¯¹åº”æ”¾å…¥Nodeçš„ä½ç½® int n, i; // å¦‚æœ table æœªåˆå§‹åŒ–ï¼Œæˆ–è€…å®¹é‡ä¸º 0 ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ // (ç¬¬ä¸€æ¬¡è§è¿™ç§èµ‹å€¼å’Œåˆ¤æ–­èåˆçš„æ“ä½œï¼Œå­¦åˆ°äº†å­¦åˆ°äº†) if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // å¦‚æœå¯¹åº”çš„ä½ç½®çš„NodeèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥åˆ›å»º Node èŠ‚ç‚¹å³å¯ã€‚ // (n-1)&amp;hash è·å–æ‰€åœ¨tableçš„ä½ç½® if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else { // å“ˆå¸Œå†²çªè§£å†³ // key åœ¨ HashMap å¯¹åº”çš„è€èŠ‚ç‚¹ Node&lt;K,V&gt; e; K k; // hashç›¸ç­‰ keyç›¸ç­‰ æ‰§è¡Œè¦†ç›– if (p.hash == hash &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // ä¸ºçº¢é»‘æ ‘çš„èŠ‚ç‚¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // ä¸ºNodeèŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜æ˜¯é“¾è¡¨ï¼Œä¸”ä¸æ˜¯è¦†ç›–æ“ä½œã€‚éœ€è¦éå†æŸ¥æ‰¾ else { // åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¿›è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œä»€ä¹ˆæ—¶å€™çº¢é»‘æ ‘è½¬é“¾è¡¨ for (int binCount = 0; ; ++binCount) { // å¦‚æœé“¾è¡¨éå†å®Œäº†éƒ½æ²¡æœ‰æ‰¾åˆ°ç›¸åŒkeyçš„å…ƒç´ ï¼Œè¯´æ˜è¯¥keyå¯¹åº”çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™åœ¨é“¾è¡¨ // æœ€åæ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ if ((e = p.next) == null) { // ===1âƒ£ï¸æ ¸å¿ƒç‚¹=== // newNode() p.next = newNode(hash, key, value, null); // é“¾è¡¨çš„é•¿åº¦å¦‚æœæ•°é‡è¾¾åˆ° TREEIFY_THRESHOLDï¼ˆ8ï¼‰æ—¶ï¼Œåˆ™è¿›è¡Œæ ‘åŒ–ã€‚ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; } // å¦‚æœå¾…æ’å…¥çš„keyåœ¨é“¾è¡¨ä¸­æ‰¾åˆ°äº†ï¼Œåˆ™é€€å‡ºå¾ªç¯ if (e.hash == hash&amp;&amp;((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; } } // è¦†ç›–æ“ä½œï¼Œ ä¹Ÿå°±æ˜¯ç›¸åŒçš„keyçš„valueè¿›è¡Œè¦†ç›– if (e != null) { // existing mapping for key V oldValue = e.value; // onlyIfAbsentè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¦†ç›–oldValue if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; } } ++modCount; // å¦‚æœè¶…è¿‡é˜€å€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null; } // LinkedHashMapä¸­ï¼Œé‡å†™äº†HashMapçš„`newNode()`æ–¹æ³• Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; e) { // é‡å†™äº†newNodeæ–¹æ³• // ä½¿å¾—è¿”å›çš„èŠ‚ç‚¹ä¸ºEntryèŠ‚ç‚¹ï¼Œå…·æœ‰beforeã€nextæŒ‡é’ˆ LinkedHashMap.Entry&lt;K,V&gt; p = new LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e); linkNodeLast(p); return p; } // å°†æœ€åæ–°çš„èŠ‚ç‚¹åŠ å…¥åˆ°åŒå‘é“¾è¡¨çš„å°¾éƒ¨ private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) { LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; if (last == null) head = p; else { p.before = last; last.after = p; } } æ€»ç»“ æ•´ä½“æ¥çœ‹ï¼Œå°±æ˜¯ä¸Šè¿°çš„æ–¹å¼ï¼Œåœ¨æ•´ä¸ªputValæ–¹æ³•ä¸­ï¼Œé‡å†™äº†newNode()æ–¹æ³•ï¼ŒåŒæ—¶newNodeæ–¹æ³•ä¸­ï¼ŒLinkedHashMapè¿˜æ‰§è¡Œäº†è‡ªå®šä¹‰çš„linkedNodeLast()æ–¹æ³•ã€‚ å°çŸ¥è¯†ç‚¹ é€šè¿‡é˜…è¯»putValæ–¹æ³•ï¼Œä¼šå‘ç°è¿˜æœ‰ä¸‰ä¸ªafterå¼€å¤´çš„æ–¹æ³• // Callbacks to allow LinkedHashMap post-actions // å›è°ƒæ–¹æ³•ï¼Œä¾›LinekdHashæ‰§è¡Œä¸€äº›åç½®å¤„ç† // åœ¨hashmapä¸­å¹¶æœªåšå‡ºå…·ä½“çš„å®ç° // ä½†æ˜¯åœ¨linkedhashmapä¸­åšå‡ºäº†å…·ä½“çš„å®ç° void afterNodeAccess(Node&lt;K,V&gt; p) { } void afterNodeInsertion(boolean evict) { } void afterNodeRemoval(Node&lt;K,V&gt; p) { } åˆ å’Œæ’å…¥æ“ä½œä¸€æ ·ï¼ŒLinkedHashMapçš„åˆ é™¤æ“ä½œä¹Ÿæ˜¯ç›´æ¥è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œä¸è¿‡çˆ¶ç±»çš„åˆ é™¤é€»è¾‘å¹¶ä¸ä¼šä¿®å¤LinkedHashMapå†…éƒ¨ç»´æŠ¤çš„åŒå‘é“¾è¡¨ï¼Œè¿™ä¹Ÿä¸æ˜¯çˆ¶ç±»åˆ é™¤æ–¹æ³•çš„èŒè´£ï¼Œæ‰€ä»¥LinkedHashMapæ˜¯å¦‚ä½•å®ç°åœ¨åˆ é™¤è¿‡ç¨‹ä¸­ç»´æŠ¤å†…éƒ¨çš„åŒå‘é“¾è¡¨çš„å‘¢ï¼Ÿä¸Šæºç  removeNode(int hash, Object key, Object value,boolean matchValue, boolean movable)public boolean remove(Object key, Object value) { return removeNode(hash(key), key, value, true, true) != null; } final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) { // è¿™äº›å’Œå¢é‡Œé¢æ˜¯å·®ä¸å¤šçš„ // tabï¼šæ¡¶æ•°ç»„ pï¼šå¾…åˆ é™¤èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ n: æ¡¶æ•°ç»„å¤§å° index: æ¡¶æ•°ç»„ç¬¬iä¸ªä½ç½® Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null&amp;&amp;(n = tab.length)&gt;0 &amp;&amp;(p=tab[index=(n-1)&amp;hash])!= null) { // nodeä¸ºéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) { if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else { do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { node = e; break; } p = e; } while ((e = e.next) != null); } } // æ‰¾åˆ°å¯¹åº”çš„keyè¿›è¡Œremoveæ ¸å¿ƒ if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) { if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); // å¦‚æœnode == pï¼Œè¯´æ˜æ˜¯é“¾è¡¨å¤´æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; // è°ƒç”¨åˆ é™¤å›è°ƒæ–¹æ³•è¿›è¡Œåç»­æ“ä½œ afterNodeRemoval(node); return node; } } return null; } // LinkedHashMapä¸­afterNodeRemovalå…·ä½“å®ç° // åŒå‘é“¾è¡¨çš„æ­£å¸¸åˆ é™¤æ“ä½œ void afterNodeRemoval(Node&lt;K,V&gt; e) { // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.before = p.after = null; if (b == null) head = a; else b.after = a; if (a == null) tail = b; else a.before = b; } // linkedlistçš„åˆ é™¤æ“ä½œ E unlink(Node&lt;E&gt; x) { // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; // åç»§èŠ‚ç‚¹ final Node&lt;E&gt; prev = x.prev; // å‰é©±èŠ‚ç‚¹ // åˆ é™¤çš„ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if (prev == null) { first = next; } else { prev.next = next; x.prev = null; } // åˆ é™¤çš„ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ if (next == null) { last = prev; } else { next.prev = prev; x.next = null; } } è¯´ç™½äº†å°±æ˜¯åŒå‘é“¾è¡¨çš„åˆ é™¤ï¼Œå…·ä½“åˆ é™¤é€»è¾‘å’ŒLinkedListæ˜¯ä¸€æ ·çš„ï¼Œå…ˆç¡®å®šå½“å‰èŠ‚ç‚¹çš„å‰é©±ã€åç»§èŠ‚ç‚¹ï¼Œä¹‹åå…ˆä¿®æ”¹æŒ‡å‘åæ–­é“¾é˜²æ­¢æ•´ä¸ªé“¾è¡¨æ–­å¼€ï¼Œåœ¨æ­¤æœŸé—´éœ€è¦åˆ¤æ–­ä¸‹è¦åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¦ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€æœ€åä¸€ä¸ªèŠ‚ç‚¹ï¼Œé˜²æ­¢çˆ†NPE æ€»ç»“åˆ é™¤çš„è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œä¸Šé¢è¿™ä¹ˆå¤šä»£ç å…¶å®å°±åšäº†ä¸‰ä»¶äº‹ï¼š æ ¹æ® hash å®šä½åˆ°æ¡¶ä½ç½® éå†é“¾è¡¨æˆ–è°ƒç”¨çº¢é»‘æ ‘ç›¸å…³çš„åˆ é™¤æ–¹æ³• ä» LinkedHashMap ç»´æŠ¤çš„åŒé“¾è¡¨ä¸­ç§»é™¤è¦åˆ é™¤çš„èŠ‚ç‚¹ æŸ¥å› ä¸ºLinkedHashMapå†…éƒ¨æœ‰ä¸¤ç§æœºåˆ¶ç»´æŠ¤å†…éƒ¨çš„åŒå‘é“¾è¡¨ï¼ˆæŒ‰ç…§æ’å…¥é¡ºåºã€æŒ‰ç…§è®¿é—®é¡ºåºï¼‰å‰é¢è¯´äº†æ’å…¥é¡ºåºçš„å®ç°ï¼Œæ¥ä¸‹æ¥ç ”ç©¶ä¸‹è®¿é—®é¡ºåºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMap æ˜¯æŒ‰æ’å…¥é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ– LinkedHashMapï¼ŒæŒ‡å®š accessOrder å‚æ•°ä¸º trueï¼Œå³å¯è®©å®ƒæŒ‰è®¿é—®é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚ æ’å…¥é¡ºåºã€è®¿é—®é¡ºåºçš„åŒºåˆ«æ’å…¥é¡ºåº:æ˜¯æŒ‡LinkedHashMapåœ¨æ•°æ®æ’å…¥æ—¶çš„æ’å…¥é¡ºåº æ¯”å¦‚è¯´1,2,3,4â€¦æ•°æ®ä¾æ¬¡ä»å°åˆ°å¤§æ’å…¥ è‹¥æŒ‰ç…§æ’å…¥é¡ºåºè¾“å‡º,è¾“å‡ºç»“æœå°±æ˜¯1,2,3,4â€¦ è®¿é—®é¡ºåº:åˆ™æ˜¯è¯´åŒæ ·æŒ‰ç…§æ’å…¥1,2,3,4â€¦ä»å°åˆ°å¤§æœ‰åºçš„æ’å…¥ 1. å¦‚æœåœ¨æ’å…¥åä½ éšæœºè®¿é—®äº†æŸä¸ªå…ƒç´ ,é‚£ä¹ˆé‚£ä¸ªå…ƒç´ åˆ™ä¼šæ’åˆ—åˆ°é›†åˆçš„æœ€åä¸€ä½ @Test public void insetAndVisitedOrder() { Map&lt;String, String&gt; map = orderMap(); System.out.println(map); System.out.println(\"=================\"); map.get(\"key-3\"); System.out.println(map); } public Map&lt;String, String&gt; orderMap() { Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;(8, 0.75F, true); for (int i = 0; i &lt; 5; i++) { map.put(\"key-\" + i, \"value-\" + i); } return map; } // {key-0=value-0, key-1=value-1, key-2=value-2, key-3=value-3, key-4=value-4} // ================= // {key-0=value-0, key-1=value-1, key-2=value-2, key-4=value-4, key-3=value-3} é˜è¿°å®Œæ¯•ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹å…¶å†…éƒ¨å¦‚ä½•ç»´æŠ¤è¿™ä¸¤ç§ç±»å‹çš„è®¿é—®é¡ºåº get(Object key)public V get(Object key) { Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; // å¦‚æœ accessOrder ä¸º trueï¼Œåˆ™è°ƒç”¨ afterNodeAccess å°†è¢«è®¿é—®èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨æœ€å if (accessOrder) afterNodeAccess(e); return e.value; } void afterNodeAccess(Node&lt;K,V&gt; e) { // move node to last LinkedHashMap.Entry&lt;K,V&gt; last; // ä¸æ˜¯å°¾éƒ¨èŠ‚ç‚¹ if (accessOrder &amp;&amp; (last = tail) != e) { LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; p.after = null; if (b == null) head = a; else b.after = a; if (a != null) a.before = b; else last = b; if (last == null) head = p; else { p.before = last; last.after = p; } tail = p; ++modCount; } } æ•´ä½“çš„æ“ä½œå…±ä¸ºä¸¤æ­¥ åˆ é™¤å½“å‰èŠ‚ç‚¹æ‰€åœ¨çš„ä½ç½® å°†å½“å‰èŠ‚ç‚¹æ’å…¥åˆ°åŒå‘é“¾è¡¨çš„å°¾éƒ¨ æ³¨æ„å¯èƒ½å½“å‰èŠ‚ç‚¹å¯èƒ½æ˜¯headèŠ‚ç‚¹ã€tailèŠ‚ç‚¹ åŒç†ï¼Œå› ä¸ºæ˜¯ç»´æŠ¤äº†è®¿é—®çš„åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥åœ¨å¯¹å¤–æä¾›çš„APIï¼ŒåŒ…å«æœ‰è®¿é—®æ€§è´¨çš„ï¼Œéƒ½ä¼šè°ƒç”¨afterNodeAccessæ¥ç»´æŠ¤è¯¥åŒå‘é“¾è¡¨ å¦‚ï¼š get getOrDefault image-20210504201032288 åº”ç”¨LRUç¼“å­˜æ“ä½œ åœ¨é˜è¿°ç¼“å­˜å®ç°ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªafterNodeInsertionæ²¡æœ‰è®²è§£ void afterNodeInsertion(boolean evict) { // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) { K key = first.key; removeNode(hash(key), key, null, false, true); } } // ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®æ¡ä»¶ä¹‹ä¸€ï¼Œé€šè¿‡è¦†ç›–æ­¤æ–¹æ³•å¯å®ç°ä¸åŒç­–ç•¥çš„ç¼“å­˜ protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) { return false; } ä¸Šé¢çš„æºç çš„æ ¸å¿ƒé€»è¾‘åœ¨ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä¹‹å‰å¹¶æ²¡æœ‰è¿›è¡Œåˆ†æã€‚ä¸Šé¢çš„ä»£ç åšçš„äº‹æƒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯é€šè¿‡ä¸€äº›æ¡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹ã€‚çœ‹åˆ°è¿™é‡Œï¼Œå¤§å®¶åº”è¯¥çŸ¥é“ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•çš„ç”¨é€”äº†ã€‚å½“æˆ‘ä»¬åŸºäº LinkedHashMap å®ç°ç¼“å­˜æ—¶ï¼Œé€šè¿‡è¦†å†™removeEldestEntryæ–¹æ³•å¯ä»¥å®ç°è‡ªå®šä¹‰ç­–ç•¥çš„ LRU ç¼“å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ ¹æ®èŠ‚ç‚¹æ•°é‡åˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹ï¼Œæˆ–è€…æ ¹æ®èŠ‚ç‚¹çš„å­˜æ´»æ—¶é—´åˆ¤æ–­æ˜¯å¦ç§»é™¤è¯¥èŠ‚ç‚¹ç­‰ public class SimpleCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; { private static final int MAX_NODE_NUM = 100; private int limit; public SimpleCache() { this(MAX_NODE_NUM); } public SimpleCache(int limit) { super(limit, 0.75f, true); this.limit = limit; } public V save(K key, V val) { return put(key, val); } public V getOne(K key) { return get(key); } public boolean exists(K key) { return containsKey(key); } /** * åˆ¤æ–­èŠ‚ç‚¹æ•°æ˜¯å¦è¶…é™ * @param eldest * @return è¶…é™è¿”å› trueï¼Œå¦åˆ™è¿”å› false */ @Override protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) { return size() &gt; limit; } } æ€»ç»“ LinkedHashMapç»§æ‰¿è‡ªHashMapï¼Œå…·æœ‰HashMapçš„æ‰€æœ‰ç‰¹æ€§ LinkedHashMapå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¥ç»´æŠ¤èŠ‚ç‚¹ç›´æ¥çš„é¡ºåº å¦‚æœaccessOrderä¸ºfalseï¼Œåˆ™å¯ä»¥æŒ‰æ’å…¥å…ƒç´ çš„é¡ºåºéå†å…ƒç´  å¦‚æœaccessOrderä¸ºtrueï¼Œ åˆ™å¯ä»¥æŒ‰è®¿é—®å…ƒç´ çš„é¡ºåºéå†å…ƒç´  LinkedHashMapçš„å®ç°éå¸¸ç²¾å¦™ï¼Œå¾ˆå¤šæ–¹æ³•éƒ½æ˜¯åœ¨HashMapä¸­ç•™çš„é’©å­ï¼ˆHookï¼‰ï¼Œç›´æ¥å®ç°è¿™äº›Hookå°±å¯ä»¥å®ç°å¯¹åº”çš„åŠŸèƒ½äº†ï¼Œå¹¶ä¸éœ€è¦å†é‡å†™put()ç­‰æ–¹æ³• é»˜è®¤çš„LinkedHashMapå¹¶ä¸ä¼šç§»é™¤æ—§å…ƒç´ ï¼Œå¦‚æœéœ€è¦ç§»é™¤æ—§å…ƒç´ ï¼Œåˆ™éœ€è¦é‡å†™removeEldestEntry()æ–¹æ³•è®¾å®šç§»é™¤ç­–ç•¥ï¼› LinkedHashMapå¯ä»¥ç”¨æ¥å®ç°LRUç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼› references LinkedHashMapæºç è¯¦ç»†åˆ†æï¼ˆJDK1.8ï¼‰","categories":[],"tags":[]},{"title":"CopyOnWriteArrayListæºç è§£è¯»","slug":"æºç /JDK/list/copy-on-write-arraylist","date":"2020-06-19T11:18:54.000Z","updated":"2020-08-30T04:50:22.255Z","comments":true,"path":"copy-on-write-arraylist/","link":"","permalink":"https://winniekun.github.io/copy-on-write-arraylist/","excerpt":"CopyOnWriteArrayListæºç è§£è¯»","text":"CopyOnWriteArrayListæºç è§£è¯» ä¾èµ– CopyOnWriteArrayListä¾èµ– å­—æ®µ&amp;å±æ€§// ç”¨äºä¿®æ”¹æ•°ç»„çš„æ—¶å€™åŠ é” final transient ReentrantLock lock = new ReentrantLock(); // çœŸæ­£å­˜å‚¨å…ƒç´ çš„åœ°æ–¹ åªèƒ½é€šè¿‡get setè®¿é—® // ä½¿ç”¨volatileä¿®é¥° ä¿è¯å¯è§æ€§(ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹ å¯¹å…¶ä»–çº¿ç¨‹å¯è§) private transient volatile Object[] array; final Object[] getArray() { return array; } final void setArray(Object[] a) { array = a; } æ„é€ æ–¹æ³•// åˆ›å»ºç©ºæ•°ç»„ public CopyOnWriteArrayList() { setArray(new Object[0]); } // public CopyOnWriteArrayList(Collection&lt;? extends E&gt; c) { Object[] elements; // å¦‚æœcä¹Ÿæ˜¯CopyOnWriteArrayListç±»å‹ // åˆ™ç›´æ¥å°†å…¶çš„arrayæ‹¿æ¥ç”¨, å±äºæµ…æ‹·è´ // cå’Œæ–°çš„CopyOnWriteArrayListå…±äº«åŒä¸€ä¸ªæ•°ç»„ if (c.getClass() == CopyOnWriteArrayList.class) elements = ((CopyOnWriteArrayList&lt;?&gt;)c).getArray(); else { elements = c.toArray(); // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elements.getClass() != Object[].class) elements = Arrays.copyOf(elements, elements.length, Object[].class); } setArray(elements); } // æŠŠtoCopyInçš„å…ƒç´ æ‹·è´ç»™å½“å‰listçš„æ•°ç»„ã€‚ public CopyOnWriteArrayList(E[] toCopyIn) { setArray(Arrays.copyOf(toCopyIn, toCopyIn.length, Object[].class)); } å¢add(E e)// æ·»åŠ ä¸€ä¸ªå…ƒç´ åœ¨æœ«å°¾ public boolean add(E e) { final ReentrantLock lock = this.lock; // ä¿®æ”¹æ•°ç»„ä¹‹å‰åŠ é” lock.lock(); try { Object[] elements = getArray(); int len = elements.length; // å°†æ•°ç»„æ‹·è´åˆ°æ–°æ•°ç»„ä¸­, æ–°æ•°ç»„é•¿åº¦æ¯”æ—§æ•°ç»„é•¿åº¦å¤š1 Object[] newElements = Arrays.copyOf(elements, len + 1); newElements[len] = e; // arrayæŒ‡å‘æ–°çš„æ•°ç»„ setArray(newElements); return true; } finally { // é‡Šæ”¾é” lock.unlock(); } } æ€»ç»“åœ¨å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå…ƒç´ æ­¥éª¤: å…ˆåŠ é” è·å–å…ƒç´ æ•°ç»„ åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„, é•¿åº¦æ¯”åŸæ•°ç»„é•¿åº¦å¤š1, å¹¶æŠŠåŸæ•°ç»„çš„å†…å®¹æ‹·è´åˆ°æ–°æ•°ç»„ åœ¨æ–°æ•°ç»„æœ«å°¾æ·»åŠ å…ƒç´  æŠŠæ–°æ•°ç»„èµ‹å€¼ç»™å½“å‰å¯¹è±¡çš„arrayå±æ€§ï¼Œè¦†ç›–åŸæ•°ç»„ è§£é” add(int index, E element)// æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´  public void add(int index, E element) { final ReentrantLock lock = this.lock; lock.lock(); try { Object[] elements = getArray(); int len = elements.length; // åˆ¤æ–­æ·»åŠ ä½ç½®æ˜¯å¦åˆæ³• if (index &gt; len || index &lt; 0) throw new IndexOutOfBoundsException(\"Index: \"+index+ \", Size: \"+len); Object[] newElements; // éœ€è¦ç§»åŠ¨å…ƒç´ çš„ä¸ªæ•° int numMoved = len - index; if (numMoved == 0) newElements = Arrays.copyOf(elements, len + 1); else { // æ–°æ•°ç»„çš„é•¿åº¦ä¸ºå…ƒç´ ç»„çš„é•¿åº¦+1 newElements = new Object[len + 1]; // å…ˆå°†åŸæ•°ç»„indexä¹‹å‰çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ System.arraycopy(elements, 0, newElements, 0, index); // å†å°†åŸæ•°ç»„indexä¹‹åçš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„ System.arraycopy(elements, index, newElements, index + 1, numMoved); } // æ–°æ•°ç»„ä¸­indexçš„ä½ç½®èµ‹å€¼element newElements[index] = element; // arrayæŒ‡å‘æ–°çš„æ•°ç»„ setArray(newElements); } finally { // è§£é” lock.unlock(); } } æ€»ç»“ æ‰§è¡Œæ­¥éª¤: å…ˆåŠ é” åˆ¤æ–­ä½ç½®æ˜¯å¦åˆæ³• è®¡ç®—ç§»åŠ¨çš„ä½ç½®, è‹¥ä¸º0, ç­‰åŒäºåœ¨æœ«å°¾æ·»åŠ å…ƒç´  è‹¥æ˜¯ä¸ä¸º0, åˆ™åˆ†æ­¥éª¤æ·»åŠ åŸæ•°ç»„å…ƒç´ åˆ°æ–°æ•°ç»„, å…ˆæ˜¯indexä¹‹å‰, å†æ˜¯indexä¹‹å, æœ€åæ˜¯index æŠŠæ–°æ•°ç»„èµ‹å€¼ç»™å½“å‰å¯¹è±¡çš„arrayå±æ€§ï¼Œè¦†ç›–åŸæ•°ç»„ è§£é” ä¸ºä»€ä¹ˆè¿™é‡Œä½¿ç”¨System.arraycopy(), è€Œä¸æ˜¯copyOf() å› ä¸ºæ–°æ•°ç»„å·²ç»è¢«åˆå§‹åŒ–äº†, ç›´æ¥å°†åŸæ•°ç»„ä¸­çš„å…ƒç´ å¤åˆ¶è¿‡æ¥å³å¯, è‹¥æ˜¯ä½¿ç”¨copyOf()å®ç°èµ·æ¥éº»çƒ¦,è€Œä¸”éœ€è¦åˆ›å»ºä¸¤æ¬¡æ–°çš„æ•°ç»„, è¿˜æœ‰å±€éƒ¨tempæ•°ç»„, æ€»ä¹‹, æ€ä¹ˆå®ç°èµ·æ¥æ–¹ä¾¿æ€ä¹ˆæ¥, å¦‚å‰ä¸€ä¸ªadd(E e)æ–¹æ³•, ç›´æ¥ä½¿ç”¨copyOf()æ–¹æ³•å°±èƒ½å®ç°, ä½¿ç”¨System.arraycopy()éœ€è¦å…ˆåˆå§‹åŒ–, ç„¶åå†å¤åˆ¶, åè€Œéº»çƒ¦äº† addAll(Collection&lt;? extends E&gt; c)public boolean addAll(Collection&lt;? extends E&gt; c) { Object[] cs = (c.getClass() == CopyOnWriteArrayList.class) ? ((CopyOnWriteArrayList&lt;?&gt;)c).getArray() : c.toArray(); if (cs.length == 0) return false; final ReentrantLock lock = this.lock; lock.lock(); try { Object[] elements = getArray(); int len = elements.length; // åŸæ•°ç»„é•¿åº¦ä¸º0 if (len == 0 &amp;&amp; cs.getClass() == Object[].class) setArray(cs); else { // åˆ›å»ºæ–°æ•°ç»„, é•¿åº¦ä¸ºåŸæ•°ç»„é•¿åº¦ + cçš„å…ƒç´ ä¸ªæ•° // å¹¶å°†å…ƒç´ ç»„çš„å…ƒç´ æ‹·è´è¿›å» Object[] newElements = Arrays.copyOf(elements, len + cs.length); // å°†cçš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­, ä»lenä½ç½®å¼€å§‹ System.arraycopy(cs, 0, newElements, len, cs.length); setArray(newElements); } return true; } finally { lock.unlock(); } } addAll(int index, Collection&lt;? extends E&gt; c)åŒç† æŸ¥get()å°±æ˜¯ç®€å•çš„æ ¹æ®ç´¢å¼•è·å–æ•°ç»„å…ƒç´  public E get(int index) { return get(getArray(), index); } private E get(Object[] a, int index) { return (E) a[index]; } åˆ remove(int index)public E remove(int index) { final ReentrantLock lock = this.lock; // åŠ é” lock.lock(); try { Object[] elements = getArray(); int len = elements.length; // è·å–æ—§å€¼ E oldValue = get(elements, index); // ç§»åŠ¨å…ƒç´ ä¸ªæ•° int numMoved = len - index - 1; // å¦‚æœåˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ , ç›´æ¥æ‹·è´å‡ºä¸€ä¸ªæ–°çš„len-1çš„æ•°ç»„å³å¯ if (numMoved == 0) setArray(Arrays.copyOf(elements, len - 1)); else { Object[] newElements = new Object[len - 1]; System.arraycopy(elements, 0, newElements, 0, index); System.arraycopy(elements, index + 1, newElements, index, numMoved); setArray(newElements); } return oldValue; } finally { lock.unlock(); } } æ€»ç»“ æ­¥éª¤: åŠ é” è·å–åŸæ•°ç»„åŠé•¿åº¦ è·å–æ—§å€¼ è®¡ç®—éœ€è¦ç§»åŠ¨å…ƒç´ çš„ä¸ªæ•° è‹¥æ˜¯ç§»åŠ¨æ¬¡æ•°=0, å³åˆ é™¤æœ«å°¾å…ƒç´ , ç›´æ¥å¤åˆ¶ä¸€ä¸ªé•¿åº¦ä¸ºåŸæ•°ç»„é•¿åº¦-1çš„æ•°ç»„, å°†åŸæ•°ç»„len-1çš„å…ƒç´ æ”¾å…¥å³å¯ è‹¥æ˜¯ç§»åŠ¨æ¬¡æ•°&gt;0, åˆ™ç°å°†indexå‰çš„å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„(æ–°æ•°ç»„ç¡®å®šé•¿åº¦ä¸ºåŸé•¿åº¦-1), ç„¶åå¤åˆ¶indexä¹‹åçš„å…ƒç´  è¿”å›æ—§å€¼ è§£é” ä¸ºä»€ä¹ˆç§»åŠ¨å…ƒç´ ä¸ªæ•°çš„è®¡ç®—å’Œadd`æ–¹æ³•ä¸ä¸€æ · å› ä¸ºæ·»åŠ å…ƒç´ åˆ°æŒ‡å®šä½ç½®æ—¶, åŸæ•°ç»„çš„å¯¹åº”ä½ç½®ä¸Šçš„å…ƒç´ aä¸åˆ é™¤, ç§»åŠ¨çš„æ—¶å€™aä¹Ÿéœ€è¦ç§»åŠ¨ åˆ é™¤çš„æ—¶å€™, ç›´æ¥åŸæ•°ç»„å¯¹åº”ä½ç½®çš„ä¸Šçš„å…ƒç´ ç›´æ¥åˆ é™¤, æ‰€ä»¥ä¸éœ€è¦ç§»åŠ¨ æ•°ç»„é•¿åº¦åœ¨ä¹‹å‰çš„ArrayList, LinkedList ä¸­ sizeéƒ½æ˜¯æˆå‘˜å˜é‡, åœ¨å¯¹æ•°ç»„åšä¿®æ”¹çš„æ—¶å€™, sizeæ‰§è¡Œ++ æˆ–â€”å³å¯, ä½†æ˜¯è¿™é‡Œå´ä¸æ˜¯ public int size() { return getArray().length; } æˆ‘ä»¬å‘ç°, æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯æ‹·è´ä¸€ä»½æ­£å¥½å¯ä»¥å­˜å‚¨ç›®æ ‡ä¸ªæ•°å…ƒç´ çš„æ•°ç»„ï¼Œæ‰€ä»¥ä¸éœ€è¦sizeå±æ€§äº†ï¼Œæ•°ç»„çš„é•¿åº¦å°±æ˜¯é›†åˆçš„å¤§å°ï¼Œè€Œä¸åƒArrayListæ•°ç»„çš„é•¿åº¦å®é™…æ˜¯è¦å¤§äºé›†åˆçš„å¤§å°çš„ã€‚ æ€»ç»“ ä½¿ç”¨å¯é‡å…¥é”å’Œvolatileä¿è¯çº¿ç¨‹å®‰å…¨ å†™æ“ä½œéƒ½éœ€è¦åŠ é”, ç„¶ååœ¨æ­¤æœŸé—´åˆ›å»ºæ–°çš„æ•°ç»„, å¹¶åœ¨æ–°æ•°ç»„ä¸­åšä¿®æ”¹, ä¹‹åå†ç”¨æ–°æ•°ç»„æ›¿åŸæ•°ç»„, ç©ºé—´å¤æ‚åº¦ä¸º$O(n)$ è¯»æ“ä½œä¸éœ€è¦åŠ é”, æ”¯æŒéšæœºè®¿é—®, ç©ºé—´å¤æ‚åº¦ä¸º$O(1)$ é‡‡ç”¨è¯»å†™åˆ†ç¦»æ€æƒ³(è¯»å†™è€…é—®é¢˜), ä½†æ˜¯å†™æ“ä½œå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´, é€‚ç”¨äºè¯»å¤š, å†™å°‘çš„æƒ…æ™¯ åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§, ä¸èƒ½ä¿è¯å®æ—¶ä¸€è‡´æ€§ é¢è¯•ç›¸å…³é—®é¢˜ CopyOnWriteArrayListæ˜¯æ€ä¹ˆä¿è¯å¹¶å‘å®‰å…¨çš„ï¼Ÿ CopyOnWriteArrayListçš„å®ç°é‡‡ç”¨äº†ä»€ä¹ˆæ€æƒ³ï¼Ÿ CopyOnWriteArrayListæ˜¯ä¸æ˜¯å¼ºä¸€è‡´æ€§çš„ï¼Ÿ CopyOnWriteArrayListé€‚ç”¨äºä»€ä¹ˆæ ·çš„åœºæ™¯ï¼Ÿ CopyOnWriteArrayListæ’å…¥ã€åˆ é™¤ã€æŸ¥è¯¢å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å„æ˜¯å¤šå°‘ï¼Ÿ CopyOnWriteArrayListä¸ºä»€ä¹ˆæ²¡æœ‰sizeå±æ€§ï¼Ÿ","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"List","slug":"List","permalink":"https://winniekun.github.io/tags/List/"},{"name":"JUC","slug":"JUC","permalink":"https://winniekun.github.io/tags/JUC/"}]},{"title":"æ­»ç£•åŠ¨æ€è§„åˆ’","slug":"LeetCode/stick-to-dynamic-programming","date":"2020-06-16T02:54:10.000Z","updated":"2021-06-28T04:46:20.223Z","comments":true,"path":"stick-to-dynamic-programming/","link":"","permalink":"https://winniekun.github.io/stick-to-dynamic-programming/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¸ƒï¼š DP ç»ˆäºè½®åˆ°äº†DP, æ€ä¹ˆè¯´ç±», æ„Ÿè§‰è‡ªå·±å†™DPçš„é¢˜æŒºç„å¹»çš„, çŠ¶æ€å¥½äº†, èƒ½æ‰¾å‡ºè½¬ç§»æ–¹ç¨‹, å°±èƒ½ç¬é—´è§£å†³, æä¸å¥½è¿˜èƒ½ä¼˜åŒ–, çŠ¶æ€ä¸å¥½äº†, åªçŸ¥é“å¯ä»¥ç”¨DP, ä¹Ÿåªæ˜¯çŸ¥é“â€¦.","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¸ƒï¼š DP ç»ˆäºè½®åˆ°äº†DP, æ€ä¹ˆè¯´ç±», æ„Ÿè§‰è‡ªå·±å†™DPçš„é¢˜æŒºç„å¹»çš„, çŠ¶æ€å¥½äº†, èƒ½æ‰¾å‡ºè½¬ç§»æ–¹ç¨‹, å°±èƒ½ç¬é—´è§£å†³, æä¸å¥½è¿˜èƒ½ä¼˜åŒ–, çŠ¶æ€ä¸å¥½äº†, åªçŸ¥é“å¯ä»¥ç”¨DP, ä¹Ÿåªæ˜¯çŸ¥é“â€¦. çš„ç¡®, å’Œç½‘ä¸Šçš„å¾ˆå¤šæ€»ç»“ç±»ä¼¼, åšåˆ°åé¢ä¹Ÿæ„Ÿè§‰DPä½¿ç”¨çš„æ•°å­¦çŸ¥è¯†å°±æ˜¯æ•°å­¦å½’çº³æ³•, ç„¶åè¿˜æœ‰è‡ªèº«çš„ä¼˜åŒ–, è­¬å¦‚å¤§å¤šæ•°æƒ…å†µè‡ªåº•å‘ä¸Šçš„DPå¾€å¾€è¦æ¯”è‡ªé¡¶å‘ä¸‹çš„DPå®ç°èµ·æ¥ç®€çº¦ä¸”æ•ˆç‡é«˜, ä¹Ÿå¯ä½¿ç”¨æ»šåŠ¨æ•°ç»„å°†é«˜çº¬çš„dpæ•°ç»„é™ç»´. ä¸¤å¤§ç‰¹æ€§ æ— åæ•ˆè¡Œ ä¸€æ—¦f(i,j)ç¡®å®šï¼Œå°±ä¸ç”¨å…³å¿ƒ â€œæˆ‘ä»¬å¦‚ä½•è®¡ç®—å‡ºf(i,j)â€ã€‚ æƒ³è¦ç¡®å®šf(i,j)ï¼Œåªéœ€è¦çŸ¥é“f(i-1,j)å’Œf(i,j-1)çš„å€¼ï¼Œè€Œè‡³äºå®ƒä»¬ æ˜¯å¦‚ä½•ç®—å‡ºæ¥çš„ï¼Œå¯¹å½“å‰æˆ–ä¹‹åçš„ä»»ä½•å­é—®é¢˜éƒ½æ²¡æœ‰å½±å“ã€‚ è¿‡å»ä¸ä¾èµ–å°†æ¥ï¼Œå°†æ¥ä¸å½±å“è¿‡å» â€”- æ™ºå·…è¯­å½• æœ€ä¼˜å­ç»“æ„ f(i,j)çš„å®šä¹‰å°±å·²ç»è•´å«äº†â€œæœ€ä¼˜â€ã€‚ å¤§é—®é¢˜çš„æœ€ä¼˜è§£å¯ä»¥ç”±è‹¥å¹²ä¸ªå° é—®é¢˜çš„æœ€ä¼˜è§£æ¨å‡ºã€‚(max, min, sumâ€¦) DPèƒ½é€‚ç”¨çš„é—®é¢˜:èƒ½å°†å¤§é—®é¢˜æ‹†æˆå‡ ä¸ªå°é—®é¢˜ï¼Œä¸”æ»¡è¶³æ— åæ•ˆæ€§ã€æœ€ä¼˜å­ç»“æ„æ€§è´¨ã€‚ é¢˜ç›®ç‰¹ç‚¹ è®¡æ•° æœ‰å¤šå°‘ç§æ–¹å¼èµ°åˆ°å³ä¸‹è§’ æœ‰å¤šå°‘ç§æ–¹æ³•é€‰å‡ºkä¸ªæ•°ä½¿å¾—å’Œæ˜¯sum æ±‚æœ€å¤§å€¼æœ€å°å€¼ ä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’è·¯å¾„çš„æœ€å¤§æ•°å­—å’Œ æœ€é•¿ä¸Šå‡å­åºåˆ—é•¿åº¦ æ±‚å­˜åœ¨æ€§ å–çŸ³å­æ¸¸æˆï¼Œå…ˆæ‰‹æ˜¯å¦å¿…èƒœ èƒ½ä¸èƒ½é€‰å‡ºkä¸ªæ•°ä½¿å¾—å’Œæ˜¯sum ä¸»è¦ç±»å‹I:æ—¶é—´åºåˆ—æ¨¡å‹ç»™å‡ºä¸€ä¸ªåºåˆ—ï¼ˆå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥è®¤ä¸ºä¸€å¤©ï¼Œå¹¶ä¸”ä»Šå¤©çš„çŠ¶æ€åªå–å†³äºæ˜¨å¤©çš„çŠ¶æ€ å¥—è·¯ å®šä¹‰$dp[i][j]$ï¼š è¡¨ç¤ºç¬¬i-thè½®çš„ç¬¬jç§çŠ¶æ€ï¼ˆj=1,2,3,..kï¼‰ åƒæ–¹ç™¾è®¡å°†$dp[i][j]$å’Œå‰ä¸€è½®çš„çŠ¶æ€$dp[i-1][j]$äº§ç”Ÿå…³ç³»ï¼ˆj=1,2,3,..kï¼‰ æœ€åçš„ç»“æœå°±æ˜¯$dp[last][j]$çš„æŸç§æ“ä½œï¼ˆsumã€maxã€minâ€¦ï¼‰ image-20210503140232767 II:æ—¶é—´åºåˆ—åŠ å¼ºç‰ˆ(å­åºåˆ—æ¨¡å‹)ç»™å‡ºä¸€ä¸ªåºåˆ—ï¼ˆæ•°ç»„ã€å­—ç¬¦ä¸²ï¼‰ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥è®¤ä¸ºä¸€å¤©ï¼Œä½†æ˜¯ä»Šå¤©çš„çŠ¶æ€å’Œä¹‹å‰çš„æŸä¸€å¤©ç›¸å…³ï¼Œéœ€è¦è¿›è¡ŒæŒ‘é€‰ å¥—è·¯ å®šä¹‰$dp[i]$: è¡¨ç¤ºç¬¬i-thè½®çš„çŠ¶æ€ï¼Œä¸€èˆ¬è¿™ä¸ªçŠ¶ä½“è¦æ±‚å’Œå…ƒç´ iç›´æ¥ç›¸å…³â“ åƒæ–¹ç™¾è®¡çš„å°†$dp[i]$ä¸ä¹‹å‰çš„çŠ¶æ€$dp[iâ€™]$äº§ç”Ÿå…³ç³»ï¼ˆi=1,2,3..i-1ï¼‰æ“ä½œå¦‚ï¼ˆsumã€maxã€minï¼‰ $dp[i]$è‚¯å®šä¸èƒ½ä¸å¤§äº içš„è½®æ¬¡æœ‰ä»»ä½•å…³ç³»ï¼Œå¦ åˆ™è¿åäº†DP çš„æ— åæ•ˆæ€§ã€‚ æœ€ç»ˆçš„ç»“æœä¸º$dp[i]$ä¸­çš„æŸä¸€ä¸ª III:åŒåºåˆ—æ¨¡å‹ç»™å‡ºä¸¤ä¸ªåºåˆ—$S$å’Œ$T$ (æ•°ç»„ã€å­—ç¬¦ä¸²)ï¼Œå¯¹å®ƒä»¬ä¸¤ä¸ªæäº‹æƒ… ç¼–è¾‘è·ç¦»å…¬å¼ å¥—è·¯ï¼š å®šäº$dp[i][j]$: è¡¨ç¤ºé’ˆå¯¹$S[1:i]$å’Œ$T[1:j]$çš„å­é—®é¢˜çš„æ±‚è§£ åƒæ–¹ç™¾è®¡å°†$dp[i][j]$å¾€ä¹‹å‰çš„çŠ¶æ€å»è½¬ç§»ï¼š$dp[i-1][j], dp[i][j-1], dp[i-1][j-1]$ æœ€ç»ˆçš„ç»“æœä¸º$dp[m][n]$ IV:ç¬¬Iç±»åŒºé—´å‹DPç»™å‡ºä¸€ä¸ªåºåˆ—ï¼ˆæ•°ç»„ã€å­—ç¬¦ä¸²ï¼‰ï¼Œæ˜ç¡®è¦æ±‚åˆ†å‰²æˆkä¸ªè¿ç»­ç©ºé—´ï¼Œè¦ä½ è®¡ç®—è¿™äº›åŒºé—´çš„æŸä¸ªæœ€ä¼˜æ€§è´¨ã€‚ å¥—è·¯ çŠ¶æ€å®šä¹‰ï¼š$dp[i][k]$è¡¨ç¤ºé’ˆå¯¹$S[1:i]$åˆ†æˆkä¸ªåŒºé—´ï¼Œæ­¤æ—¶èƒ½å¤Ÿå¾—åˆ°çš„æœ€ä¼˜è§£ æœå¯»æœ€åä¸€ä¸ªåŒºé—´çš„èµ·å§‹ä½ç½®$j$ï¼Œå°†$dp[i][k]$åˆ†å‰²æˆ$dp[j-1][k-1]$å’Œ$ä¸¤ä¸ªéƒ¨åˆ† æœ€ç»ˆçš„ç»“æœæ˜¯$dp[N][K]$ image-20210503143245100 V:ç¬¬IIç±»åŒºé—´å‹DPåªç»™å‡ºä¸€ä¸ªåºåˆ—Sï¼ˆæ•°ç»„ã€å­—ç¬¦ä¸²ï¼‰ï¼Œæ±‚ä¸€ä¸ªé’ˆå¯¹è¿™ä¸ªåºåˆ—çš„æœ€ä¼˜è§£ é€‚åˆæ¡ä»¶ï¼š è¿™ä¸ªæœ€ä¼˜è§£å¯¹äºåºåˆ—çš„indexè€Œè¨€ï¼Œæ²¡æœ‰â€œæ— åæ•ˆæ€§â€ã€‚å³æ— æ³•è®¾è®¡$dp[i]$ä½¿å¾— $dp[i]$ä»…ä¾èµ–äº$dp[j] (j&lt;i)$. ä½†æ˜¯å¤§åŒºé—´çš„æœ€ä¼˜è§£ï¼Œå¯ä»¥ä¾èµ–å°åŒºé—´çš„æœ€ä¼˜è§£ã€‚ å¥—è·¯ï¼š å®šä¹‰$dp[i][j]$:è¡¨ç¤ºé’ˆå¯¹$s[i:j]$çš„å­é—®é¢˜çš„æ±‚è§£ã€‚ åƒæ–¹ç™¾è®¡å°†æœ€å¤§åŒºé—´çš„$dp[i][j]$å¾€å°åŒºé—´çš„$dp[iâ€™][jâ€™]$è½¬ç§» ç¬¬ä¸€å±‚å¾ªç¯æ˜¯åŒºé—´å¤§å°ï¼›ç¬¬äºŒå±‚å¾ªç¯æ˜¯èµ·å§‹ç‚¹ æœ€ç»ˆçš„ç»“æœæ˜¯$dp[1][N]$ image-20210503144732050 VI:èƒŒåŒ…å…¥é—¨é¢˜ç›®æŠ½è±¡ï¼šç»™å‡ºNä»¶ç‰©å“ï¼Œæ¯ä¸ªç‰©å“å¯ç”¨ä¸å¯ç”¨ï¼ˆè‹¥å¹²ç§ä¸åŒçš„ç”¨æ³•ï¼‰éœ€è¦æ¶ˆè€—ä¸€å®šçš„ä»£ä»·ã€‚è¦æ±‚ä»¥æŸä¸ªæœ‰ä¸Šé™Cçš„ä»£ä»·æ¥å®ç°æœ€å¤§æ”¶ç›Šã€‚ï¼ˆæœ‰æ—¶å€™åè¿‡æ¥ï¼Œè¦æ±‚ä»¥æŸä¸ªæœ‰ä¸‹é™çš„æ”¶ç›Šæ¥å®ç° æœ€å°ä»£ä»·ã€‚ï¼‰ å¥—è·¯ï¼š å®šä¹‰$dp[i][j]$è¡¨ç¤ºåªä»å‰iä»¶ç‰©å“çš„å­é›†é‡Œé¢é€‰æ‹©ã€ä»£ä»·ä¸º$j$çš„æœ€å¤§æ”¶ç›Š j = 1ã€2ã€3ã€4â€¦C åƒæ–¹ç™¾è®¡çš„å°†$dp[i][j]$å¾€$dp[i-1][jâ€™]$è½¬ç§»ï¼šè€ƒè™‘å¦‚ä½•ä½¿ç”¨ç‰©å“iï¼Œå¯¹ä»£ä»·/æ”¶ç›Šçš„å½±å“ ç¬¬ä¸€å±‚å»ºè®®å¾ªç¯ç‰©å“ ç¬¬äºŒå±‚å»ºè®®å¾ªç¯å®¹é‡/ä»£ä»· æœ€åçš„ç»“æœ$max{dp[N][c]} | c \\in {1,2,..c}$ LeetCode&amp;Offer DPé¢˜ç›®æ•´ç†(æŒ‰ç…§ä¸Šè¿°çš„åˆ†ç±»æ•´ç†)ç‰¢è®°åŠ¨å½’çš„æ­¥éª¤ï¼š ç¡®å®šdpçš„æ•°ç»„å’Œä¸‹æ ‡çš„å«ä¹‰ ç¡®å®šé€’å½’å…¬å¼ dpæ•°ç»„çš„åˆå§‹åŒ– ç¡®å®šéå†é¡ºåº åˆ—ä¸¾dpæ•°ç»„ æ—¶é—´åºåˆ—æ¨¡å‹âŒ 198. æ‰“å®¶åŠ«èˆ âœ… 213. æ‰“å®¶åŠ«èˆ II âœ… 337. æ‰“å®¶åŠ«èˆ III âœ… 121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº âœ… 122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IIâœ… 123. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IIIâœ… 188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IVâœ… 309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸ 376. æ‘†åŠ¨åºåˆ— 487. æœ€å¤§è¿ç»­1çš„ä¸ªæ•° IIâœ… 1186. åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œâœ… 714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹ å‰‘æŒ‡ Offer 63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ æ—¶é—´åºåˆ—æ¨¡å‹åŠ å¼ºç‰ˆ(å­åºåˆ—é—®é¢˜)âœ… 300. æœ€é•¿é€’å¢å­åºåˆ—âœ… 368. æœ€å¤§æ•´é™¤å­é›†âœ… åŒåºåˆ—æ¨¡å‹âœ…å¤‡æ³¨ï¼šè®¾ç½®dpç©ºé—´æ˜¯ï¼Œçœ‹æœ‰æ•ˆä½ä»0è¿˜æ˜¯1å¼€å§‹ã€‚ ä»1å¼€å§‹ï¼Œæ˜¯ä¸ºäº†è®©dpè½¬ç§»æ–¹ç¨‹æ›´åŠ å…·æœ‰é€‚ç”¨æ€§ï¼Œèƒ½ä»æœ€å¼€å§‹çš„å­—ç¬¦ä¸²å°±èƒ½è®¡ç®— ä»0å¼€å§‹ï¼Œéœ€è¦é¢å¤–è€ƒè™‘åˆå§‹åŒ–è¿‡ç¨‹ã€‚è¡Œã€åˆ— é¢˜ç›®ï¼š 72. ç¼–è¾‘è·ç¦» 32. æœ€é•¿æœ‰æ•ˆæ‹¬å· 115. ä¸åŒçš„å­åºåˆ— 1143. æœ€é•¿å…¬å…±å­åºåˆ— æœ€é•¿å…¬å…±å­ä¸² å­—ç¬¦ä¸²äº¤é”™ç»„æˆ åŒºé—´åºåˆ—æ¨¡å‹ 1278. åˆ†å‰²å›æ–‡ä¸² III 813. æœ€å¤§å¹³å‡å€¼å’Œçš„åˆ†ç»„ åŒºé—´åºåˆ—æ¨¡å‹åŠ å¼ºç‰ˆèƒŒåŒ…æ¨¡å‹æ•°ç»„ç³»åˆ— 70. çˆ¬æ¥¼æ¢¯ 746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯ 72. ç¼–è¾‘è·ç¦» 198. æ‰“å®¶åŠ«èˆ 213. æ‰“å®¶åŠ«èˆ II 337. æ‰“å®¶åŠ«èˆ III 53. æœ€å¤§å­åºå’Œ 322. é›¶é’±å…‘æ¢ 518. é›¶é’±å…‘æ¢ II 120 ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ 300 æœ€é•¿ä¸Šå‡å­åºåˆ— 354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å° 64 æœ€å°è·¯å¾„å’Œ 174 åœ°ä¸‹åŸæ¸¸æˆ ä¸åŒè·¯å¾„ ä¸åŒè·¯å¾„II é¢˜è§£æ—¶é—´åºåˆ—æ¨¡å‹âŒ198. æ‰“å®¶åŠ«èˆ âœ…æ—¶é—´åºåˆ—æ¨¡å‹ï¼šå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ å¯ä»¥è®¤ä¸ºä¸€å¤©ï¼Œå¹¶ä¸”ä»Šå¤©çš„çŠ¶æ€åªå–å†³äºæ˜¨å¤©çš„çŠ¶æ€ å®šäºçŠ¶æ€$dp[i][j]$ è¡¨ç¤ºç¬¬iå®¶ï¼Œå·æˆ–ä¸å· $j\\in {0,1}, i \\in {N_i}$ è½¬ç§»æ–¹ç¨‹ $ dp[i][j]=\\left{ \\begin{array}{rcl} dp[i][0]= dp[i-1][1] + val[i] &amp;&amp; {å·}\\ dp[i][1]=Math.max(dp[i-1][0], dp[i-1][1]) &amp;&amp;{ä¸å·}\\end{array} \\right. $ class Solution { public int rob(int[] nums) { // 0è¡¨ç¤ºå· // 1è¡¨ç¤ºä¸å· int[][] dp = new int[nums.length][2]; dp[0][0] = nums[0]; for (int i = 1; i &lt; nums.length; i++) { dp[i][0] = dp[i-1][1] + nums[i]; dp[i][1] = Math.max(dp[i-1][1], dp[i-1][0]); int temp = Math.max(dp[i][0], dp[i][1]); } int len = nums.length; return Math.max(dp[len-1][0], dp[len-1][1]); } } ä¸€ç»´è§£æ³• å®šä¹‰çŠ¶æ€ $dp[i]$è¡¨åˆ°ç¬¬iå®¶èƒ½å·åˆ°çš„æœ€é«˜é‡‘é¢ å¯»æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹ $dp[0]=nums[0]$ : ç›®å‰åªæœ‰ä¸€å®¶, æ‰€ä»¥å¯¹äºå°å·æ¥è¯´, å°±å·è¿™ä¸€å®¶å°±æ˜¯æœ€é«˜é‡‘é¢ $dp[1] = Math.max(nums[0], nums[1])$: ç›®å‰æœ‰ä¸¤å®¶, å¯¹äºå°å·æ¥è¯´å› ä¸ºæ¡ä»¶é™åˆ¶, æ‰€ä»¥åªèƒ½å·ä¸¤å®¶ä¸­é‡‘é¢æœ€å¤§çš„é‚£å®¶ $dp[2] = Math.max(dp[0]+nums[2], dp[1])$: ç›®å‰æœ‰ä¸‰å®¶, å¯¹äºå°å·æ¥è¯´å› ä¸ºæ¡ä»¶é™åˆ¶, æœ‰ä¸¤ç§å¯èƒ½ $dp[3] = Math.max(dp[2], dp[1]+nums[3])$ $dp[i] = Math.max(dp[i-1], dp[i-2]+nums[i])$ ç¡®å®šè¾¹ç•Œå€¼ $dp[0] = nums[0]$ $dp[1] = Math.max(nums[0], nums[1])$ public int rob(int[] nums) { // TODO æ ¡éªŒ int[] dp = new int[nums.length]; dp[0] = nums[0]; dp[1] = Math.max(nums[1], nums[0]); for (int i = 2; i &lt; nums.length; i++) { dp[i] = Math.max(dp[i-1], nums[i] + dp[i-2]); } return dp[nums.length-1]; } 213. æ‰“å®¶åŠ«èˆ II âœ…ç»•åœˆåœˆçš„æ‰“å®¶åŠ«èˆï¼Œåœ¨å¾ªç¯æ•°ç»„ä¸­æ‰“å®¶åŠ«èˆï¼Œæ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡éœ€è¦åˆ†ç±»è®¨è®ºäº†ï¼ˆæ³¨æ„æ•°ç»„çš„è¾¹ç•Œï¼Œå¯èƒ½ä¼šå‡ºç°è¶Šç•Œé—®é¢˜ï¼‰ Trick:é¦–ä½å’Œæœ«ä½ä¸èƒ½åŒæ—¶æŠ¢ï¼Œè¿™è¯´æ˜è‡³å°‘æœ‰ä¸€ä¸ªä¸èƒ½æŠ¢ã€‚ è€ƒè™‘é¦–ä½çš„æˆ¿å­æˆ‘ä¸æŠ¢ï¼Œé‚£ä¹ˆå¯¹äºhouse[1]~house[last]å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ House Robberé—®é¢˜ã€‚ è€ƒè™‘æœ«ä½çš„æˆ¿å­æˆ‘ä¸æŠ¢ï¼Œé‚£ä¹ˆå¯¹äºhouse[0]~house[last-1]å°±æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ House Robberé—®é¢˜ã€‚ class Solution { public int rob(int[] nums) { // ç¯å½¢ // 1. é¦–ä½å’Œæœ«ä½ä¸èƒ½åŒæ—¶æŠ¢ // 1.1 é¦–ä½æŠ¢ array[1:N-1]; // 1.2 æœ«ä½æŠ¢ array[2:N]; if (nums.length == 1) { return nums[0]; } int len = nums.length; int first = rob(nums, 0, len - 2); int last = rob(nums, 1, len - 1); return Math.max(first, last); } private int rob(int[] nums, int first, int last) { int len = last - first + 1; if (last == first) { return nums[first]; } int[][] dp = new int[len][2]; // 0 è¡¨ç¤ºå·. dp[i][0] = dp[i-1][0] + val[i]; // 1 è¡¨ç¤ºä¸å· dp[i][1] = max(dp[i-1][0], dp[i-1][1]); dp[0][0] = nums[first]; for (int i = 1; i &lt; len; i++) { dp[i][0] = dp[i-1][1] + nums[first + i]; dp[i][1] = Math.max(dp[i-1][0], dp[i-1][1]); } return Math.max(dp[len - 1][0], dp[len - 1][1]); } } ä¸€ç»´è§£æ³• image-20210412181723948 ä¸ç®¡æ˜¯ç¯å½¢çš„è¿˜æ˜¯æ­£å¸¸çš„æ•°ç»„ï¼Œæ•°ç»„çš„ä½ç½®æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼Œæ‰€ä»¥ä¸ä¼šå› ä¸ºå·äº†iå®¶ä¹‹åï¼Œi-1å’Œi+1å°±æˆä¸ºé‚»å±…äº†ï¼Œä¸‹æ¬¡å¯ä»¥è€ƒè™‘åœ¨i-1å’Œi+1å·äº† public int rob(int[] nums) { // dp // å®šä¹‰dpæ•°ç»„å’Œä¸‹æ ‡å«ä¹‰ // dp[i] åˆ°ç¬¬ié—´æˆ¿å­åï¼Œèƒ½è·å–çš„æœ€å¤§é‡‘é¢ // dp[i] = Max(dp[i-1],dp[i-2] + nums[i]); // æŒ‰ç…§åˆ†ç±» // 1. å°å·å·çš„æˆ¿é—´ä¸åŒ…å«å¤´å°¾ // 2. å°å·å·çš„æˆ¿é—´åŒ…å«å¤´éƒ¨ // 3. å°å·å·çš„æˆ¿é—´åŒ…å«å°¾éƒ¨ // 1 åŒ…å«åœ¨äº†2ã€3ä¸¤ç§æƒ…å†µä¸­äº† if (nums == null || nums.length == 0) { return 0; } if (nums.length == 1) { return nums[0]; } int left = 0; int right = nums.length - 1; int first = rob(nums, 0, right - 1); int second = rob(nums, 1, right); return Math.max(first, second); } private int rob(int[] nums, int left, int right) { if (left == right) { return nums[left]; } int len = right - left + 1; int[] dp = new int[len]; dp[0] = nums[left]; dp[1] = Math.max(nums[left], nums[left + 1]); for (int i = 2; i &lt; len; i++) { dp[i] = Math.max(dp[i-1], dp[i-2] + nums[i+left]); } return dp[len-1]; } 337. æ‰“å®¶åŠ«èˆ III âœ…åœ¨æ ‘ä¸Šå·ã€‚ã€‚ã€‚ ä½¿ç”¨ååºéå†ï¼Œå·²ç»åŒ…å«äº†éå†ï¼Œæ‰€ä»¥åªéœ€è¦ç¡®å®šååºé¢éå†ï¼Œéå†è¿‡ç¨‹ä¸­å‘ä¸Šä¼ é€’ä»€ä¹ˆå†…å®¹ï¼ŒæŒ‰ç…§æ—¶é—´åºåˆ—æ¨¡å‹å®šä¹‰ï¼Œå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªäºŒç»´æ•°ç»„ $ arrayi[2]=\\left{ \\begin{array}{rcl}array_i[0]=array{left}[1] + array{right}[1] + root.val &amp;&amp; {å·}\\ array[1]=Max(array{left}[0], array{right}[1]) + Max(arry{right}[0], aray_{right}[1]) &amp;&amp;{ä¸å·}\\end{array} \\right. $ class Solution { public int rob(TreeNode root) { if (root == null) { return 0; } int[] array = postOrer(root); return Math.max(array[0], array[1]); } private int[] postOrer(TreeNode root) { int[] array = new int[2]; if (root == null) { return array; } int[] left = postOrer(root.left); int[] right = postOrer(root.right); // int[] array = new int[2]; // 0 è¡¨ç¤ºå· max(left[1], right[1]) + root.val; // 1 è¡¨ç¤ºä¸å· // å‘ä¸Šä¼ é€’æ•´ä¸ªarrayæ•°ç»„ // å·å½“å‰èŠ‚ç‚¹ int first = root.val+left[1]+right[1]; // ä¸å·å½“å‰èŠ‚ç‚¹ int second = Math.max(left[0], left[1]) + Math.max(right[0], right[1]); // ans = Math.max() array[0] = first; array[1] = second; return array; } } 121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºâœ…ä¹°å–è‚¡ç¥¨æœ‰çº¦æŸï¼Œæ ¹æ®é¢˜ç›®æ„æ€ï¼Œæœ‰ä»¥ä¸‹ä¸¤ä¸ªçº¦æŸæ¡ä»¶ï¼š æ¡ä»¶ 1ï¼šä½ ä¸èƒ½åœ¨ä¹°å…¥è‚¡ç¥¨å‰å–å‡ºè‚¡ç¥¨ï¼› æ¡ä»¶ 2ï¼šæœ€å¤šåªå…è®¸å®Œæˆä¸€ç¬”äº¤æ˜“ã€‚ å› æ­¤ å½“å¤©æ˜¯å¦æŒè‚¡ æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„å› ç´ ï¼Œè€Œå½“å‰æ˜¯å¦æŒè‚¡å’Œæ˜¨å¤©æ˜¯å¦æŒè‚¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥ä¹Ÿä¸ºæ—¶é—´åºåˆ—æ¨¡å‹ è‹¥æ˜¯æ˜¨å¤©ä¸æŒè‚¡ï¼Œä»Šå¤©æŒè‚¡ï¼Œåˆ™å’Œç¬¬ä¸€å¤©æŒè‚¡ä¸€ä¸ªé“ç†ï¼Œåˆ™å½“å‰çš„é‡‘é¢æ•°é‡ä¸º$-V[i]$ï¼Œæœ€åæˆ‘ä»¬åªéœ€è¦è¿”å›æœ€åä¸€å¤©ä¸æŒè‚¡çš„æœ€å¤§é‡‘é¢æ•°é‡å³å¯ã€‚ $ dp[i][2]=\\left{ \\begin{array}{rcl}dp[i][0]= Max(dp[i-1][0], -v[i]]) &amp;&amp; {æŒè‚¡}\\ dp[i][1]=Max(dp[i-1][0] + v[i], dp[i-1][1]) &amp;&amp;{ä¸æŒè‚¡}\\end{array} \\right. $ class Solution { public int maxProfit(int[] prices) { int len = prices.length; if (len &lt; 2) { return 0; } // å¯ä»¥ç†è§£ä¸ºæŠ˜çº¿ç»Ÿè®¡å›¾ï¼Œç„¶åæ±‚ä¸Šå‡æœ€é«˜çš„çº¿æ®µ // ä¸è¿‡è¿™æ¬¡ä½¿ç”¨åŠ¨è§„ // 0 æŒè‚¡ -prices[i] // 1 ä¸æŒè‚¡ +prices[i] int[][] dp = new int[len][2]; dp[0][0] = -prices[0]; // ç¬¬0å¤©æŒè‚¡æ‰‹ä¸Šçš„ç°é‡‘ dp[0][1] = 0; //ç¬¬0å¤©ä¸æŒè‚¡ï¼Œæ‰‹ä¸Šçš„ç°é‡‘ for (int i = 1; i &lt; len; i++) { dp[i][0] = Math.max(dp[i-1][0], -prices[i]); dp[i][1] = Math.max(dp[i-1][0] + prices[i], dp[i-1][1]); } return dp[len - 1][1]; } } é™„åŠ ä¸€é¢˜å‰‘æŒ‡ Offer 63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ï¼Œä¸€æ‘¸ä¸€æ ·ã€‚ 122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II âœ… æ ¹æ®ä¸Šè¿°çš„è½¬ç§»æ–¹å¼ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çŠ¶æ€è½¬æ¢ $ dp[i][2]=\\left{ \\begin{array}{rcl}dp[i][0]= Max(dp[i-1][0], dp[i-1][1]-v[i]]) &amp;&amp; {æŒè‚¡}\\ dp[i][1]=Max(dp[i-1][0] + v[i], dp[i-1][1]) &amp;&amp;{ä¸æŒè‚¡}\\end{array} \\right. $ class Solution { public int maxProfit(int[] prices) { // åŠ¨å½’ int len = prices.length; int[][] dp = new int[len][2]; // åˆå§‹åŒ– // 0 è¡¨ç¤º ç¬¬iå¤©æŒæœ‰è‚¡ç¥¨ // 1 è¡¨ç¤º ç¬¬iä¸æŒæœ‰è‚¡ç¥¨ dp[0][1] = 0; dp[0][0] = -prices[0]; for (int i = 1; i &lt; len; i++) { dp[i][0] = Math.max(dp[i-1][0], dp[i-1][1] - prices[i]); dp[i][1] = Math.max(dp[i-1][1], dp[i-1][0] + prices[i]); } return dp[len-1][1]; } } 714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹âœ…å’Œä¸Šè¿°åŒç†ï¼Œéœ€è¦æ·»åŠ æ‰‹ç»­è´¹ class Solution { public int maxProfit(int[] prices, int fee) { int len = prices.length; // 0 : æŒè‚¡ï¼ˆä¹°å…¥ï¼‰ // 1 : ä¸æŒè‚¡ï¼ˆå”®å‡ºï¼‰ // dp å®šä¹‰ç¬¬iå¤©æŒè‚¡/ä¸æŒè‚¡ æ‰€å¾—æœ€å¤šç°é‡‘ int[][] dp = new int[len][2]; dp[0][0] = -prices[0]; for (int i = 1; i &lt; len; i++) { dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][1] - prices[i]); dp[i][1] = Math.max(dp[i - 1][0] + prices[i] - fee, dp[i - 1][1]); } return Math.max(dp[len - 1][0], dp[len - 1][1]); } } 123. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IIIâœ… image-20210503100324818 æ€è·¯ æœ€é«˜æŒæœ‰ä¸¤è‚¡ï¼Œåˆ†ä¸ºå››ç§çŠ¶æ€ $ dp[i][j]=\\left{ \\begin{array}{rcl} dp[i][0] = Max(dp[i-1][0], -val[i]) &amp;&amp; {ç¬¬iå¤©ï¼ŒæŒç¬¬æœ‰1è‚¡çš„æœ€å¤§åˆ©æ¶¦}\\ dp[i][1]=Max(dp[i-1][1], dp[i-1][0] + val[i]) &amp;&amp; {ç¬¬iå¤©ï¼Œå”®å‡ºç¬¬1è‚¡çš„æœ€å¤§æ”¶ç›Š} \\dp[i][2] = Max(dp[i-1][2], dp[i-1][1] - val[i] &amp;&amp; {ç¬¬iå¤©ï¼ŒæŒæœ‰ç¬¬2è‚¡çš„æœ€å¤§æ”¶ç›Š} \\dp[i][3] = Max(dp[i-1][3], dp[i-1][2] + val[i]) &amp;&amp; {ç¬¬iå¤©ï¼Œå”®å‡ºç¬¬2è‚¡çš„æœ€å¤§æ”¶ç›Š} \\end{array} \\right. $ æœ€åçš„ç»“æœä¸º$Max{dp[N][i]} (i = 0, 1, 2, 3)$ class Solution { public int maxProfit(int[] prices) { int n = prices.length; long[][] dp = new long[n][4]; // 0 æŒæœ‰1è‚¡ // 1 å”®å‡º1è‚¡ // 2 æŒæœ‰2è‚¡ // 3 å”®å‡º2è‚¡ // ç¬¬0å¤© æŒæœ‰ä¸€è‚¡ï¼Œ ç¬¬0å¤©ä¸å¯èƒ½å‡ºç°å”®å‡ºçš„ç°è±¡ï¼Œåªæœ‰æŒæœ‰ç¬¬ä¸€è‚¡çš„å¯èƒ½ dp[0][0] = -prices[0]; dp[0][2] = -prices[0]; for (int i = 1; i &lt; n; i++) { dp[i][0] = Math.max(dp[i-1][0], -prices[i]); dp[i][1] = Math.max(dp[i-1][0] + prices[i], dp[i-1][1]); dp[i][2] = Math.max(dp[i-1][1] - prices[i], dp[i-1][2]); dp[i][3] = Math.max(dp[i-1][2] + prices[i], dp[i-1][3]); } long res = 0; for(int i = 0; i &lt; 4; i++) { res = Math.max(res, dp[n-1][i]); } return (int)res; } } 188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IVâœ…å±äº123é¢˜çš„æŠ½è±¡ç±»å‹ï¼Œkæ¬¡ä¹°å–ï¼Œåˆ™æˆ‘ä»¬ä¼šå‡ºç°2*kæ¬¡çš„æŒæœ‰ã€å”®å–çŠ¶æ€ï¼Œç„¶åæˆ‘ä»¬å‡è®¾å¶æ•°ä¸ºæŒæœ‰è‚¡ç¥¨ï¼Œå¥‡æ•°ä¸ºå”®å–è‚¡ç¥¨ image-20210503202846471 class Solution { public int maxProfit(int k, int[] prices) { // ç±»æ¯”ä¹°å–è‚¡ç¥¨III if (prices == null || prices.length == 0) { return 0; } int len = prices.length; int[][] dp = new int[len][2*k]; for (int i = 0; i &lt; 2 * k; i++) { if (i % 2 == 0) { dp[0][i] = -prices[0]; } } for (int i = 1; i &lt; len; i++) { for (int j = 0; j &lt; 2 * k ; j++) { if (j == 0) { dp[i][j] = Math.max(dp[i-1][0], -prices[i]); } else if (j % 2 == 0) { dp[i][j] = Math.max(dp[i-1][j], dp[i-1][j-1] - prices[i]); } else { dp[i][j] = Math.max(dp[i-1][j], dp[i-1][j-1] + prices[i]); } } } // return Arrays.stream(dp[n -1]).max().getAsInt(); int res = 0; for (int i = 0; i &lt; 2 * k; i++) { res = Math.max(dp[len-1][i], res); } return res; } } 309. æœ€ä½³ä¹°å–è‚¡ç¥¨æ—¶æœºå«å†·å†»æœŸâœ… image-20210625160741945 $ dp[i][j]=\\left{ \\begin{array}{rcl} dp[i][0] = Max(dp[i-1][0], dp[i - 1][1] - priece[i]]) &amp;&amp; {ç¬¬iå¤©ï¼ŒåˆšæŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©ç›Š}\\ dp[i][1]=Max(dp[i-1][1], dp[i-1][2]) &amp;&amp; {å†·å†»çš„æœ€å¤§æ”¶ç›Š} \\dp[i][2] = Max(dp[i-1][2], dp[i-1][0] + val[i] &amp;&amp; {è¿™ä¸€è½®å·²ç»æ¸…ç©ºè‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š} \\end{array} \\right. $ class Solution { public int maxProfit(int[] prices) { int n = prices.length; if (n &lt; 2) { return 0; } //å®šä¹‰ å‰iå¤© ä¸åŒçŠ¶æ€çš„æœ€å¤§åˆ©æ¶¦ int[][] dp = new int[n][3]; // åˆå§‹åŒ– // 0 : ä¹°å…¥ // 1 : å†·å†» // 2 : æ¸…ç©º dp[0][0] = -prices[0]; dp[0][1] = 0; dp[0][2] = 0; for (int i = 1; i &lt; n; i++) { dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][1] - prices[i]); dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][2]); dp[i][2] = Math.max(dp[i - 1][2], dp[i - 1][0] + prices[i]); } return Arrays.stream(dp[n - 1]).max().getAsInt(); } } 276. æ …æ æ¶‚è‰²256. ç²‰åˆ·æˆ¿å­265. ç²‰åˆ·æˆ¿å­ II487. æœ€å¤§è¿ç»­1çš„ä¸ªæ•° IIâœ… image-20210503235309983 class Solution { public int findMaxConsecutiveOnes(int[] nums) { int len = nums.length; // ä»¥ å½“å‰å…ƒç´ ä¸ºç»“å°¾ï¼Œæ˜¯å¦å½¢å¼ç¿»è½¬æƒåˆ©çš„æœ€é•¿è¿ç»­çš„1 int[][] dp = new int[len][2]; // 0 æœªç¿»è½¬1 // 1 ç¿»è½¬1 dp[0][1] = 1; dp[0][0] = nums[0] == 1 ? 1 : 0; int ans = Math.max(dp[0][1], dp[0][0]); for (int i = 1; i &lt; len; i++) { if (nums[i] == 1) { dp[i][0] = dp[i-1][0] + 1; dp[i][1] = dp[i-1][1] + 1; } else { dp[i][1] = dp[i-1][0] + 1; dp[i][0] = 0; } ans = Math.max(ans, Math.max(dp[i][0], dp[i][1])); } return ans; } } 1186. åˆ é™¤ä¸€æ¬¡å¾—åˆ°å­æ•°ç»„æœ€å¤§å’Œâœ… image-20210503235251921 class Solution { public int maximumSum(int[] nums) { int len = nums.length; // 0 ä¸åˆ é™¤ // 1 åˆ é™¤ int ans = nums[0]; int[][] dp = new int[len][2]; dp[0][0] = nums[0]; dp[0][1] = 0; for (int i = 1; i &lt; len; i++) { dp[i][0] = Math.max(dp[i-1][0]+nums[i], nums[i]); dp[i][1] = Math.max(dp[i-1][0], dp[i-1][1] + nums[i]); int temp = Math.max(dp[i][0], dp[i][1]); ans = Math.max(ans, temp); } return ans; } } æ—¶é—´åºåˆ—æ¨¡å‹åŠ å¼ºç‰ˆï¼ˆå­åºåˆ—æ¨¡å‹ï¼‰âœ…300. æœ€é•¿é€’å¢å­åºåˆ—âœ…class Solution { public int lengthOfLIS(int[] nums) { int len = nums.length; if (len &lt; 2) { return len; } int[] dp = new int[len]; Arrays.fill(dp, 1); dp[0] = 1; int ans = 1; for (int i = 1; i &lt; len; i++) { for (int j = 0; j &lt; i; j++) { if (nums[i] &gt; nums[j]) { dp[i] = Math.max(dp[j] + 1, dp[i]); } } ans = Math.max(dp[i], ans); } return ans; } } 368. æœ€å¤§æ•´é™¤å­é›†âœ…class Solution { public List&lt;Integer&gt; largestDivisibleSubset(int[] nums) { int len = nums.length; // ç¬¬ 1 æ­¥ï¼šåŠ¨æ€è§„åˆ’æ‰¾å‡ºæœ€å¤§å­é›†çš„ä¸ªæ•°ã€æœ€å¤§å­é›†ä¸­çš„æœ€å¤§æ•´æ•° int[] dp = new int[len]; Arrays.sort(nums); Arrays.fill(dp, 1); int maxSize = 1; int maxVal = dp[0]; for (int i = 1; i &lt; len; i++) { for (int j = 0; j &lt; i; j++) { if (nums[i] % nums[j] == 0) { dp[i] = Math.max(dp[i], dp[j] + 1); } } if (dp[i] &gt; maxSize) { maxSize = dp[i]; maxVal = nums[i]; } } // ç¬¬ 2 æ­¥ï¼šå€’æ¨è·å¾—æœ€å¤§å­é›† List&lt;Integer&gt; res = new ArrayList&lt;Integer&gt;(); if (maxSize == 1) { res.add(nums[0]); return res; } for (int i = len - 1; i &gt;= 0 &amp;&amp; maxSize &gt; 0; i--) { if (dp[i] == maxSize &amp;&amp; maxVal % nums[i] == 0) { res.add(nums[i]); maxVal = nums[i]; maxSize--; } } return res; } } 1105. å¡«å……ä¹¦æ¶åŒåºåˆ—æ¨¡å‹âœ…åŒºé—´åºåˆ—æ¨¡å‹åšåˆ°ç°åœ¨ï¼Œå…¶å®å¯ä»¥æ„Ÿè§‰åˆ°ï¼Œå¯¹äºåŒºé—´åºåˆ—æ¨¡å‹ï¼Œå…¶å®åŸºæœ¬æ€æƒ³æ˜¯å’Œå­åºåˆ—æ¨¡å‹æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡å­åºåˆ—æ¨¡å‹æ˜¯ä»å‰é¢çš„å¤šç§çŠ¶æ€é‡Œé¢è·å–æœ€ä¼˜ç»“æœï¼Œè€ŒåŒºé—´åºåˆ—æ˜¯ä¾æ®å‰é¢å¤šç§çŠ¶æ€+å‰©ä½™çš„å…ƒç´ æ„æˆçš„ç»“æœ å…±åŒå†³å®šçš„æœ€ä¼˜ç»“æœã€‚ 1278. åˆ†å‰²å›æ–‡ä¸² IIIæ˜ç¡®è¦æ±‚åˆ†å‰²æˆKä¸ªè¿ç»­åŒºé—´ æ€è·¯ï¼šï¼ˆç»å…¸çš„åŒºé—´åºåˆ—DPï¼‰ é¦–å…ˆéœ€è¦é¢„å¤„ç†æ¯ä¸ªåŒºé—´$[i, j]$å˜æˆå›æ–‡æ‰€éœ€ä¿®æ”¹çš„å­—ç¬¦æ•°é‡(ç›´æ¥æš´åŠ›å°±èƒ½è·å¾—)ï¼Œ è®¡ä¸º$cost[i,j]$ è®¾$dp[i][j]$è¡¨ç¤ºå‰$i$ä¸ªå­—ç¬¦ï¼Œåˆ†ä¸º$j$æ®µï¼Œæœ€å°‘æ‰€éœ€è¦ä¿®æ”¹çš„å­—ç¬¦æ•°é‡ï¼Œæœ‰æ•ˆå­—ç¬¦çš„ä¸‹æ ‡ä»$1$å¼€å§‹ åˆå§‹æ—¶$dp[i,j]$ä¸º$+\\infty$, $dp[0,0] = 0$ è½¬ç§»æ—¶ï¼Œæšä¸¾å‰ä¸€æ¬¡çš„åˆ†å‰²ç‚¹$l \\in {0, i-1}$ è¿™æ¬¡è½¬ç§»æ‰€äº§ç”Ÿçš„æ–°çš„åŒºé—´ä¸º$[l+1, i]$ï¼Œ$dp[i][j] = min(dp[l][j-1] + g(l+1, j))$ã€‚ æœ€ç»ˆçš„ç­”æ¡ˆ$dp[N][K]$ å¤æ‚åº¦åˆ†æ é¢„å¤„ç†éœ€è¦$O(n^3)$ åŠ¨æ€è§„åˆ’éœ€è¦$O(nk)$ç©ºé—´ æ€»æ—¶é—´å¤æ‚åº¦$O(n^3)$ public static int palindromePartition(String s, int _k) { int n = s.length(); s = \"#\" + s; int K = _k; int[][] dp = new int[n+1][K+1]; int[][] cost = new int[n+1][n+1]; // fill for (int[] temp : dp) { Arrays.fill(temp, 1000); } for (int i = 1; i &lt;= n; i++){ dp[i][1]=calc(s.substring(1, i+1)); } for (int i = 1; i &lt;= n; i++) { for (int j = i; j &lt;= n; j++) { cost[i][j] = cost[i][j] = calc(s.substring(i, j + 1)); } } dp[1][1] = 0; for (int i = 1; i &lt;= n; i++) { for (int k = 1; k &lt;= Math.min(i, K); k++) { for (int l = 0; l &lt;= i - 1; l++) { dp[i][k] = Math.min(dp[i][k], dp[l][k-1] + cost[l + 1][i]); } } } return dp[n][K]; } private static int calc(String t) { int a = 0; int left = 0; int right = t.length() - 1; while (left &lt; right) { if (t.charAt(left) != t.charAt(right)) { a++; } left++; right--; } return a; } 813. æœ€å¤§å¹³å‡å€¼å’Œçš„åˆ†ç»„æœ¬é¢˜æ±‚â€œæœ€å¤§å€¼â€ï¼Œä¸€èˆ¬å¯ä»¥æœDPçš„æ–¹å‘è€ƒè™‘ã€‚å¦å¤–ï¼Œé¢˜æ„é‡Œæœ‰æ˜ç¡®çš„åˆ†æˆkä¸ªsubarrayçš„è¦æ±‚ï¼Œå¤§æ¦‚ç‡å°±æ˜¯åŒºé—´å‹DPã€‚ å¥—è·¯: å®šä¹‰$dp[i][k]$ï¼Œè¡¨ç¤ºå°†å‰$i$ä¸ªå…ƒç´ åˆ†æˆ$k$ä¸ªsubarrayçš„æœ€ä¼˜è§£ï¼Œè¿™é‡Œè¡¨ç¤ºå‰$i$ä¸ªå…ƒç´ ï¼Œæ„æˆ$k$ä¸ªç»„ï¼Œå¾—åˆ°çš„æœ€å¤§å¹³å‡æ•°çš„å€¼ã€‚çªç ´å£å°±æ˜¯é’ˆå¯¹æœ€åä¸€ä¸ªå…ƒç´ $A[i]$ï¼Œå®ƒå¿…å®šæ˜¯åœ¨å½“å‰çš„æœ€åä¸€ä¸ªsubarrayã€‚ è€ƒè™‘æœ€åçš„åŒºé—´çš„é¦–å…ƒç´ $j$ä¼šåœ¨å“ªé‡Œï¼Ÿå¦‚æœé€‰å®šäº†è¿™ä¸ªä½ç½®$j$ï¼Œé‚£ä¹ˆ$dp[i][k]$å°±åˆ†è§£ä¸ºäº†ä¸¤ä¸ªå­é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯$dp[j-1][k-1]$ï¼Œæ˜¯ä»¥å‰å·²ç»è§£å†³çš„çŠ¶æ€ï¼Œå¦ä¸€ä¸ªå°±æ˜¯$s[j:i]$è¿™æ®µåŒºé—´çš„å¹³å‡å€¼ã€‚ä¸¤è€…ç›¸åŠ å°±æ˜¯$dp[i][k]$.æˆ‘ä»¬æœç´¢æ‰€æœ‰çš„$j$çš„ä½ç½®ï¼Œé€‰æ‹©ä½¿$dp[i][k]$æœ€å¤§åŒ–çš„ç»“æœã€‚ public static double largestSumOfAverages(int[] nums, int k) { if (nums == null || nums.length == 0) { return 0D; } int len = nums.length; // dp[i][j]: å‰iä¸ªå…ƒç´ ï¼Œåˆ’åˆ†ä¸ºjç»„ï¼Œè·å¾—çš„æœ€å¤§å¹³å‡æ€»å€¼ double[][] dp = new double[len+1][k+1]; // ä¼˜åŒ– è·å–å‰ç¼€å’Œ //å­˜å‚¨å‰ç¼€å’Œ double[] prefixSum = getPrefixSum(nums); // int[] prefixSum = new int[len + 1]; // for(int i = 1; i &lt;= len; i++){ // prefixSum[i] = prefixSum[i - 1] + nums[i - 1]; // } for (int i = 1; i &lt;= len; i++) { // å…ƒç´  for (int j = 1; j &lt;= Math.min(i, k); j++) { // ç»„ if(j == 1){ //é’ˆå¯¹åªæœ‰1ä¸ªåˆ†ç»„çš„æƒ…å†µ dp[i][j] = (double)prefixSum[i] / i; continue; } for (int l = 0; l &lt;= i - 1; l++) { dp[i][j] = Math.max(dp[i][j], dp[l][j-1] + (double)(prefixSum[i] - prefixSum[l]) / (i - l)); } } } return dp[len][k]; } private static double[] getPrefixSum(int[] nums) { int len = nums.length; double[] prefixSum = new double[len + 1]; for (int i = 1; i &lt;= len; i++) { prefixSum[i] = prefixSum[i-1] + nums[i-1]; } return prefixSum; } åŒºé—´åºåˆ—æ¨¡å‹åŠ å¼ºç‰ˆèƒŒåŒ…æ¨¡å‹æ•°ç»„ç³»åˆ— 70. çˆ¬æ¥¼æ¢¯ å®šä¹‰çŠ¶æ€: $dp[i]$ ä»£è¡¨åˆ°è¾¾ç¬¬$i$é˜¶å°é˜¶, æœ‰å¤šå°‘ç§èµ°æ³• å¯»æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹ $dp[1] = 1$: åˆ°è¾¾ç¬¬1é˜¶å°é˜¶åªæœ‰ä¸€ç§èµ°æ³•$[1]$ $dp[2] = 2$: åˆ°è¾¾ç¬¬2é˜¶å°é˜¶æœ‰ä¸¤ç§èµ°æ³•$[1,1], [2]$ $dp[3] = 3$: åˆ°è¾¾ç¬¬3é˜¶å°é˜¶æœ‰ä¸‰ç§èµ°æ³•$[1,1,1], [1,2], [2, 1]$ $dp[4] = 5$: åˆ°è¾¾ç¬¬4é˜¶å°é˜¶æœ‰äº”ç§èµ°æ³•$[1,1,1,1], [1,1,2],[1,2,1],[2,2][2,1,1]$ é€šè¿‡ä¸Šè¿°çš„æ¨æ¼”, å¯ä»¥å½’çº³, $dp[i]=dp[i-1] + dp[i-2]$, ä¹Ÿå°±æ˜¯åˆ°è¾¾ç¬¬$i$é˜¶çš„å°é˜¶å…±æœ‰ä¸¤ç§å¯èƒ½æ–¹å¼, ç¬¬ä¸€ç§æ˜¯é€šè¿‡ç¬¬$i-1$é˜¶å†èµ°1æ­¥, ç¬¬äºŒç§æ˜¯é€šè¿‡ç¬¬$i-2$é˜¶å†èµ°2æ­¥, åŒæ—¶åˆ°è¾¾ç¬¬$i-1$é˜¶çš„èµ°æ³•æœ‰$dp[i-1]$ç§, åˆ°è¾¾ç¬¬$i-2$é˜¶çš„èµ°æ³•æœ‰$dp[i-2]$ç§, åˆ™$dp[i] = dp[i-1] + dp[i-2]$ ç¡®å®šè¾¹ç•Œå€¼ åˆšæ‰æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„æ—¶å€™å·²ç»ç¡®å®šå¥½äº† $dp[1] = 1$ $dp[2] = 2$ å› ä¸ºè®¡ç®—æœºä¸­, ç´¢å¼•æ˜¯ä»0å¼€å§‹çš„, å¦‚æœæˆ‘ä»¬å®šä¹‰é•¿åº¦ä¸ºnçš„æ•°ç»„, åˆ™æœ€åä¸€ä¸ªæ•°ç»„çš„ç´¢å¼•ä¸ºn-1(æˆ‘ä»¬ç†è§£ä¸Šçš„dp[n]ä¹Ÿå°±æ˜¯æ•°ç»„ä¸­çš„dp[n-1]), åˆ™æˆ‘ä»¬å®šä¹‰çš„è¾¹ç•Œå€¼$dp[0] = 1$, $dp[1] = 2$, åŒç†, è‹¥æ˜¯æƒ³ç›´æ¥è¿”å›dp[n], åˆ™æˆ‘ä»¬å°±éœ€è¦å°†ç´¢å¼•ä¸º0çš„æ•°ç»„å…ƒç´ ç©ºå‡ºæ¥, ä¹Ÿå°±æ˜¯dp[0] = 0, dp[1] = 1, dp[2] = 2 public int climbStairsI(int n) { if(n &lt;= 2){ return n; } int[] dp = new int[n]; dp[0] = 1; dp[1] = 2; for(int i = 2; i&lt;n; i++){ dp[i] = dp[i-1] + dp[i-2]; } return dp[n-1]; } public int climbStairsII(int n) { if(n &lt;= 2){ return n; } int[] dp = new int[n+1]; dp[0] = 0; dp[1] = 1; dp[2] = 2; for(int i = 3; i&lt;=n; i++){ dp[i] = dp[i-1] + dp[i-2]; } return dp[n]; } æœ€åä¼˜åŒ– å› ä¸ºæˆ‘ä»¬ä¸Šè¿°çš„ç®—æ³•, æ¶ˆè€—äº†$O(n)$çš„ç©ºé—´, åŒæ—¶æˆ‘ä»¬èƒ½æ„Ÿè§‰åˆ°å¯ä»¥ä½¿ç”¨ç´¯åŠ çš„æ–¹å¼è¿›è¡Œè®¡ç®—, è€Œä¸”ä¹Ÿåªéœ€è¦è¿”å›æœ€ç»ˆç»“æœ, ä¸­é—´ç»“æœæˆ‘ä»¬æ²¡å¿…è¦å­˜å‚¨èµ·æ¥, æ‰€ä»¥å¯ä»¥åšåŠ æ³•è¿ç®— public int climbStairs(int n) { if(n &lt;= 2){ return n; } int a = 1; int b = 2; int temp; for(int i = 3; i&lt;=n; i++){ temp = a + b; a = b; b = temp; } return b; } 746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯$ f[i] = cost[i] + min(f[i+1], f[i+2])$ public int minCostClimbingStairs(int[] cost) { int f1 = 0, f2 = 0; for (int i = cost.length - 1; i &gt;= 0; --i) { int f0 = cost[i] + Math.min(f1, f2); f2 = f1; f1 = f0; } return Math.min(f1, f2); } 73. ç¼–è¾‘è·ç¦» å®šä¹‰çŠ¶æ€: $dp[i][j]$ è¡¨ç¤ºAçš„å‰iä¸ªå­—ç¬¦åˆ°Bçš„å‰jä¸ªå­—ç¬¦ä¹‹é—´çš„ç¼–è¾‘è·ç¦» å¯»æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹ æˆ‘è§‰å¾—äºŒç»´çš„çŠ¶æ€, ç”»åœ¨çº¸ä¸Šæ›´åŠ çš„ç®€å•æ˜äº† $dp[0][j]$è¡¨ç¤ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²Aåˆ°Bçš„å‰jä¸ªå­—ç¬¦ä¹‹é—´çš„è·ç¦» $dp[i][0]$è¡¨ç¤ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²Båˆ°å­—ç¬¦ä¸²Açš„å‰iä¸ªå­—ç¬¦ä¹‹é—´çš„è·ç¦» $d[i,j]=min(d[i-1,j]+1 ã€d[i,j-1]+1ã€d[i-1,j-1]+temp)$ è¿™ä¸‰ä¸ªå½“ä¸­çš„æœ€å°å€¼ $str1[i] == str2[j]$ï¼Œè¡¨ç¤ºç›¸åŒ, ç”¨tempè®°å½•å®ƒï¼Œä¸º0ã€‚å¦åˆ™tempè®°ä¸º1 $dp[i-1][j]$ è¡¨ç¤ºå¢åŠ æ“ä½œ $dp[i][j-1]$è¡¨ç¤ºåˆ é™¤æ“ä½œ $dp[i-1][j-1] + temp$è¡¨ç¤ºæ›¿æ¢æ“ä½œ è¾¹ç•Œå€¼ $dp[i][0]$ $dp[0][j]$ public static int minDistance(String word1, String word2) { int m = word1.length(); int n = word2.length(); int[][] dp = new int[m+1][n+1]; dp[0][0] = 0; // åˆå§‹åŒ–dp for(int i = 1; i&lt;=m; i++){ dp[i][0] = dp[i-1][0] + 1; } for(int j = 1; j&lt;=n; j++){ dp[0][j] = dp[0][j-1] + 1; } int temp = 0; // è½¬ç§»æ–¹ç¨‹: dp[i][j] = Math.min(dp[i-1][j-1]+temp, // dp[i][j-1]+1, dp[i-1][j]+1); for(int i = 1; i&lt;=m; i++){ for(int j = 1; j&lt;=n; j++){ // å› ä¸ºæˆ‘ä»¬çš„æ•°ç»„è¿™åªæœ‰æ•ˆä½ä»1å¼€å§‹ // æ‰€ä»¥æ ‡è®°å½“å‰éå†åˆ°çš„å­—ç¬¦ä¸²çš„ä½ç½®ä¸ºi-1|j-1 if(word1.charAt(i-1) == word2.charAt(j-1)){ temp = 0; }else { temp = 1; } dp[i][j] = Math.min(Math.min(dp[i-1][j], dp[i][j-1]) + 1, dp[i-1][j-1] + temp); } } return dp[m][n]; } 337. æ‰“å®¶åŠ«èˆ IIIåœ¨æ ‘ä¸Šå·ã€‚ã€‚ã€‚ ä½¿ç”¨ååºéå†ï¼Œå®šä¹‰ä¸€ä¸ªäºŒç»´æ•°ç»„ dp[0] : ä¸å·å½“å‰èŠ‚ç‚¹çš„ç»“æœ $dp[0] = Math.max(left[0], left[1]) + Math.max(rigth[0] + right[1])$ dp[1]ï¼šå·å½“å‰èŠ‚ç‚¹çš„ç»“æœ $dp[1] = root.val + left[0] + right[0]$ public int rob(TreeNode root) { int[] res = postOrder(root); return Math.max(res[0], res[1]); } private int[] postOrder(TreeNode root) { if (root == null) { return new int[2]; } int[] left = postOrder(root.left); int[] right = postOrder(root.right); int[] res = new int[2]; // ä¸å·å½“å‰èŠ‚ç‚¹ int first = Math.max(left[0], left[1]) + Math.max(right[0], right[1]); // å·å½“å‰èŠ‚ç‚¹ int second = root.val+left[0]+right[0]; res[0] = first; res[1] = second; return res; } 53. æœ€å¤§å­åºå’Œ322. é›¶é’±å…‘æ¢518. é›¶é’±å…‘æ¢ II120 ä¸‰è§’å½¢æœ€å°è·¯å¾„å’Œ300 æœ€é•¿ä¸Šå‡å­åºåˆ—354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°æœ€åçš„æ€è·¯å’Œæœ€é•¿ä¸Šå‡å­åºåˆ—ä¸€æ ·ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹ä¹‹å‰éœ€è¦æ•´ç†å¥½æ•°æ® /** * 354 ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å° * æ€è·¯ï¼š è¯¦è§ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—216é¡µ * @author weikunkun * @since 2021/4/2 */ public class LC_354 { public int maxEnvelopes(int[][] envelopes) { // æ€è·¯ // å°è£…ä¸€ä¸ªä¿¡å°å¯¹è±¡ï¼Œç„¶åæŒ‰ç…§ä¿¡å°çš„å®½åº¦è¿›è¡Œæ’åº å°-å¤§ // å¦‚æœå®½åº¦ç›¸åŒï¼ŒæŒ‰ç…§é«˜åº¦æ’åº å¤§åˆ°å° // ä¹‹å å¯¹ é«˜åº¦åºåˆ— æ±‚æœ€é•¿é€’å¢å­åºåˆ—å³å¯ Envelope[] array = genEnvelope(envelopes); int[] heights = genHeightArray(array); int[] dp = new int[heights.length]; Arrays.fill(dp, 1); int maxNumber = 0; for (int i = 0; i &lt; heights.length; i++) { int cur = heights[i]; int j = 0; int max = 0; while (j &lt; i) { if (heights[j] &lt; cur) { max = Math.max(max, dp[j]); } j++; } dp[i] = max + 1; maxNumber = Math.max(dp[i], maxNumber); } return maxNumber; } private Envelope[] genEnvelope(int[][] envelopes) { Envelope[] array = new Envelope[envelopes.length]; int i = 0; for (int[] envelope : envelopes) { Envelope env = new Envelope(envelope[0], envelope[1]); array[i++] = env; } Arrays.sort(array, new EnvelopComparetor()); return array; } private int[] genHeightArray(Envelope[] array) { int[] heights = new int[array.length]; int i = 0; for (Envelope envelope : array) { heights[i++] = envelope.height; } return heights; } } // æ„å»ºä¸€ä¸ªä¿¡å°å¯¹è±¡ class Envelope { public int wight; public int height; public Envelope(int wight, int height) { this.wight = wight; this.height = height; } } class EnvelopComparetor implements Comparator&lt;Envelope&gt; { @Override public int compare(Envelope o1, Envelope o2) { return o1.wight != o2.wight ? o1.wight - o2.wight : o2.height - o1.height; } } 64 æœ€å°è·¯å¾„å’Œ174 åœ°ä¸‹åŸæ¸¸æˆä»ä¸‹è‡³ä¸Šï¼Œç„¶åæ¯æ¬¡å½“å‰ä½ç½®çš„è¡€é‡ï¼Œä¸º dp[i+1][j+1] - dungeon[i][j] public int calculateMinimumHP(int[][] dungeon) { int[][] dp = new int[dungeon.length][dungeon[0].length]; int rows = dungeon.length; int cols = dungeon[0].length; dp[rows-1][cols-1] = Math.max(1-dungeon[rows-1][cols-1], 1); for (int i = rows-2; i &gt;= 0; i--) { dp[i][cols-1] = Math.max(1, dp[i+1][cols-1] - dungeon[i][cols-1]); } for (int i = cols-2; i &gt;= 0; i--) { dp[rows-1][i] = Math.max(1, dp[rows - 1][i + 1] - dungeon[rows-1][i]); } for (int i = rows - 2; i &gt;= 0; i--) { for (int j = cols - 2; j &gt;= 0; j--) { int min = Math.min(dp[i+1][j], dp[i][j+1]); dp[i][j] = Math.max(1, min - dungeon[i][j]); } } return dp[0][0]; } 62. ä¸åŒè·¯å¾„public int uniquePaths(int m, int n) { int[][] dp = new int[m][n]; dp[0][0] = 1; for(int i = 1; i &lt; m; i++) { dp[i][0] = 1; } for (int i = 1; i &lt; n; i++) { dp[0][i] = 1; } for (int i = 1; i &lt; m; i++) { for (int j = 1; j &lt; n; j++) { dp[i][j] = dp[i-1][j] + dp[i][j-1]; } } return dp[m-1][n-1]; } 63. ä¸åŒè·¯å¾„IIpublic int uniquePathsWithObstacles(int[][] obstacleGrid) { if (null == obstacleGrid || obstacleGrid.length == 0 || null == obstacleGrid[0] || obstacleGrid[0].length == 0) { return 0; } int m = obstacleGrid.length; int n = obstacleGrid[0].length; if (obstacleGrid[0][0] == 1) { return 0; } int[][] dp = new int[m][n]; dp[0][0] = 1; for(int i = 1; i &lt; m; i++) { if (obstacleGrid[i][0] == 1) { dp[i][0] = 0; break; } else { dp[i][0] = 1; } } for (int i = 1; i &lt; n; i++) { if (obstacleGrid[0][i] == 1) { dp[0][i] = 0; break; } else { dp[0][i] = 1; } } for (int i = 1; i &lt; m; i++) { for (int j = 1; j &lt; n; j++) { if (obstacleGrid[i][j] == 0) { dp[i][j] = dp[i-1][j] + dp[i][j-1]; } else { dp[i][j] = 0; } } } return dp[m-1][n-1]; } å­—ç¬¦ä¸²ç³»åˆ—72. ç¼–è¾‘è·ç¦»è¿™ä¸ªåœ¨æ•°ç»„éƒ¨åˆ†å·²ç»è®²è§£è¿‡äº†ã€‚ 32. æœ€é•¿æœ‰æ•ˆæ‹¬å· ç¡®å®šdpæ•°ç»„ï¼Œå’Œç´¢å¼•ä¸‹æ ‡æ„ä¹‰ $dp[i]$ è¡¨ç¤º ä»¥s[i]ç»“å°¾çš„æœ€é•¿æœ‰æ•ˆæ‹¬å· ç¡®å®šé€’å½’å…¬å¼ s[i]æ˜¯'('ï¼Œä»¥å®ƒä¸ºç»“å°¾çš„å­ä¸²ï¼Œè‚¯å®šä¸æ˜¯æœ‰æ•ˆæ‹¬å·å­ä¸²â€”â€”dp[i] = 0 s[i]æ˜¯')'ï¼Œ ä»¥å®ƒä¸ºç»“å°¾çš„å­ä¸²ï¼Œåˆ†ç±»è®¨è®º s[i-1] == '(' dp[i] = dp[i-2] + 1; s[i-1] == ')' s[i-1]çš„æœ€é•¿å­ä¸²ä¸ºdp[i-1], æ‰€ä»¥å‡å»å¾—s[i-dp[i-1]-1] s[i-dp[i-1]-1]ä¸å­˜åœ¨æˆ–ä¸º')'ï¼Œåˆ™s[i]æ‰¾ä¸åˆ°åŒ¹é…ï¼Œç›´æ¥ggâ€”â€”dp[i]=0 s[i-dp[i-1]-1]æ˜¯'('ï¼Œä¸s[i]åŒ¹é…ï¼Œæœ‰æ•ˆé•¿åº¦ = 2 + è·¨è¿‡çš„dp[i-1]+ å‰æ–¹çš„dp[i-dp[i-1]-2]ã€‚ç­‰ä¸€ä¸‹ï¼Œs[i-dp[i-1]-2]è¦å­˜åœ¨æ‰è¡Œï¼ s[i-dp[i-1]-2]å­˜åœ¨ï¼Œdp[i] = dp[i-1] + dp[i-dp[i-1]-2] + 2s[i-dp[i-1]-2]ä¸å­˜åœ¨ï¼Œdp[i] = dp[i-1] + 2 public int longestValidParentheses(String s) { int maxans = 0; int[] dp = new int[s.length()]; for (int i = 1; i &lt; s.length(); i++) { if (s.charAt(i) == ')') { if (s.charAt(i - 1) == '(') { dp[i] = (i &gt;= 2 ? dp[i - 2] : 0) + 2; } else if (i - dp[i - 1] &gt; 0 &amp;&amp; s.charAt(i - dp[i - 1] - 1) == '(') { dp[i] = dp[i - 1] + ((i - dp[i - 1]) &gt;= 2 ? dp[i - dp[i - 1] - 2] : 0) + 2; } maxans = Math.max(maxans, dp[i]); } } return maxans; } 115. ä¸åŒçš„å­åºåˆ—è¿™é“é¢˜æ„Ÿè§‰å’Œç¼–è¾‘è·ç¦»å…¬å¼çš„æ€è·¯å·®ä¸å¤šï¼Œä¸è¿‡ï¼Œæ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œåªéœ€è¦è€ƒè™‘å‡è¿™ä¸€ä¸ªæ­¥éª¤å³å¯ã€‚ è¿˜æ˜¯é‚£ä¸€ä¸ªä¾‹å­æ¥è¯´å§ï¼š è¾“å…¥ï¼šS=\"bagbagbag\", T=\"bag\" è¾“å‡ºï¼š5 Support/typora-user-images/image-20200907231246178.png å®šä¹‰çŠ¶æ€ $dp[i][j]$ è¡¨ç¤ºä¸º$T$çš„å‰$i$ä¸ªå­—ç¬¦å¯ä»¥ç”±$S$çš„å‰$j$ä¸ªå­—ç¬¦ç»„æˆæœ€å¤šçš„ä¸ªæ•° å¯»æ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹ $S[i] == T[j]$ å–$S[i]$ï¼Œé‚£ä¹ˆå½“å‰æƒ…å†µæ€»æ•°ï¼Œåº”è¯¥å’Œå­—ç¬¦ä¸²$S$çš„å‰$i-1$ä¸ªå­—ç¬¦æ‰€æ„æˆçš„å­åºåˆ—ä¸­å‡ºç°å­—ç¬¦ä¸²$T$çš„å‰$j-1$ä¸ªå­—ç¬¦çš„æƒ…å†µæ€»æ•°ç›¸ç­‰ã€‚$dp[i][j] = dp[i-1][j-1]$ ä¸å–$S[i]$,é‚£ä¹ˆå½“å‰æƒ…å†µæ€»æ•°ï¼Œåº”è¯¥å’Œå­—ç¬¦ä¸²$S$çš„å‰$i$ä¸ªå­—ç¬¦æ‰€æ„æˆçš„å­åºåˆ—ä¸­å‡ºç°å­—ç¬¦ä¸²$T$çš„å‰$j-1$ä¸ªå­—ç¬¦çš„æƒ…å†µæ€»æ•°ç›¸ç­‰ã€‚$dp[i][j] = dp[i][j-1]$é‚£ä¹ˆ$dp[i][j]$åº”ç­‰äºè¿™ä¸¤ç§æƒ…å†µçš„å’Œã€‚$dp[i][j] = dp[i-1][j-1] + dp[i][j-1]$ $S[i] != T[j]$ åªæœ‰ä¸€ç§æƒ…å†µï¼Œå’Œ$S[i] == T[j]$çš„ç¬¬äºŒç§æƒ…å†µæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºå½“å‰ä¸ç›¸ç­‰ï¼Œä¹Ÿå°±ä¸èƒ½å–ï¼ˆå›¾ä¸­è“è‰²æ¡†ï¼‰ã€‚ $dp[i][j] = dp[i][j-1]$ çŠ¶æ€è½¬ç§»æ–¹ç¨‹ $ dp[i][j]=\\left{ \\begin{array}{rcl} dp[i][j] = dp[i-1][j-1] + dp[i][j-1] &amp; &amp; {S[i] == T[j]}\\ dp[i][j]=dp[i][j-1] &amp; &amp; {S[i] != T[j]} \\end{array} \\right. $ ç¡®å®šè¾¹ç•Œå€¼ $dp[0][j]=1$ï¼Œæ­¤æ—¶è¡¨ç¤ºä¸ºT==NULLï¼Œä¹Ÿå°±æ˜¯ç©ºå­—ç¬¦ä¸²Tå¯ä»¥ç”±éç©ºçš„Sç»„æˆçš„æœ€å¤šçš„ä¸ªæ•°ï¼Œå¾ˆæ˜æ˜¾ä¸º1ã€‚ $dp[i][0] = 0$ï¼Œæ­¤æ—¶è¡¨ç¤ºä¸ºS==NULLï¼Œä¹Ÿå°±æ˜¯éç©ºå­—ç¬¦ä¸²Tå¯ä»¥ç”±ç©ºçš„å­—ç¬¦ä¸²Sç»„æˆçš„æœ€å¤šçš„ä¸ªæ•°ï¼Œå¾ˆæ˜æ˜¾ä¸º0ã€‚ public int numDistinct(String s, String t) { int m = s.length(); int n = t.length(); int[][] dp = new int[n + 1][m + 1]; dp[0][0] = 1; for (int i = 1; i &lt;= n; i++) { dp[i][0] = 0; } for (int i = 1; i &lt;= m; i++) { dp[0][i] = 1; } // æ³¨æ„iå’Œjå’Œé¢˜è§£ä¸Šçš„æ˜¯ç›¸åçš„ for (int i = 1; i &lt;= n; i++) { for (int j = 1; j &lt;= m; j++) { if (t.charAt(i - 1) == s.charAt(j - 1)) { dp[i][j] = dp[i][j - 1] + dp[i - 1][j - 1]; } else { dp[i][j] = dp[i][j - 1]; } } } return dp[n][m]; } 1143. æœ€é•¿å…¬å…±å­åºåˆ—æ€è·¯å’Œç¼–è¾‘è·ç¦»å·®ä¸å¤šï¼Œç¼–è¾‘è·ç¦»è¿”å›æœ€åçš„ç»“æœï¼Œè¿™é‡Œéœ€è¦éå†æ•´ä¸ªdpçŸ©é˜µï¼Œè¿”å›æœ€å¤§ã€‚ /** * é¦–å…ˆå®šä¹‰å¥½ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ— * å‡è®¾ è¡Œ text2 * å‡è®¾ åˆ— text1 * å¯¹äºè¡Œï¼š text1[0] å’Œtext2[i]ä¸­ä»»æ„ä¸€ä½ç½®å­—ç¬¦ç›¸åŒï¼Œåˆ™i-lenä½ç½®ä¸º1 * å¯¹äºåˆ—ï¼š åŒç† * éé¦–è¡Œå’Œé¦–åˆ—ï¼š 1. dp[i-1][j] dp[i][j-1] dp[i-1][j-1]+1 æœ€å¤§ * @param text1 * @param text2 * @return */ public int longestCommonSubsequence(String text1, String text2) { int[][] dp = new int[text1.length()][text2.length()]; int max = 0; // åˆå§‹åŒ–è¡Œ // åˆå§‹åŒ–åˆ— // éå†æ•´ä¸ª int rows = dp.length; int cols = dp[0].length; dp[0][0] = text1.charAt(0) == text2.charAt(0) ? 1 : 0; for (int i = 1; i &lt; rows; i++) { dp[i][0] = Math.max(dp[i-1][0], text1.charAt(i) == text2.charAt(0) ? 1 : 0); max = Math.max(dp[i][0], max); } for (int i = 1; i &lt; cols; i++) { dp[0][i] = Math.max(dp[0][i-1], text1.charAt(0) == text2.charAt(i) ? 1 : 0); max = Math.max(dp[0][i], max); } for (int i = 1; i &lt; rows; i++) { for (int j = 1; j &lt; cols; j++) { dp[i][j] = Math.max(dp[i-1][j], dp[i][j-1]); if (text2.charAt(j) == text1.charAt(i)) { dp[i][j] = Math.max(dp[i][j], dp[i-1][j-1] + 1); } max = Math.max(dp[i][j], max); } } return max; } æœ€é•¿å…¬å…±å­ä¸²æ‰¾åˆ°äº†å’Œå…¬å…±å­ä¸²ç±»ä¼¼çš„æ•°ç»„ï¼Œå°±æ‹¿ç€æ›¿ä»£ä¸€ä¸‹ image-20210413155100877 public int findLengthII(int[] nums1, int[] nums2) { int len1 = nums1.length; int len2 = nums2.length; int[][] dp = new int[len1][len2]; // // if nums1[i] == nums2[j] dp[i][j] = dp[i-1][j-1] + 1; // else dp[i][j] = 0; int max = 0; for (int i = 0; i &lt; len1; i++) { if (nums1[i] == nums2[0]) { dp[i][0] = 1; max = Math.max(max, dp[i][0]); } } for (int i = 0; i &lt; len2; i++) { if (nums2[i] == nums1[0]) { dp[0][i] = 1; max = Math.max(max, dp[0][i]); } } for (int i = 1; i &lt; len1; i++) { for (int j = 1; j &lt; len2; j++) { if (nums1[i] == nums2[j]) { dp[i][j] = dp[i-1][j-1] + 1; max = Math.max(dp[i][j], max); } } } return max; } å­—ç¬¦ä¸²äº¤é”™ç»„æˆclass Solution { public boolean isInterleave(String s1, String s2, String s3) { int n = s1.length(), m = s2.length(), t = s3.length(); if (n + m != t) { return false; } boolean[][] f = new boolean[n + 1][m + 1]; f[0][0] = true; for (int i = 0; i &lt;= n; ++i) { for (int j = 0; j &lt;= m; ++j) { int p = i + j - 1; if (i &gt; 0) { f[i][j] = f[i][j] || (f[i - 1][j] &amp;&amp; s1.charAt(i - 1) == s3.charAt(p)); } if (j &gt; 0) { f[i][j] = f[i][j] || (f[i][j - 1] &amp;&amp; s2.charAt(j - 1) == s3.charAt(p)); } } } return f[n][m]; } }","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"https://winniekun.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"}]},{"title":"æ­»ç£•å•è°ƒæ ˆ","slug":"LeetCode/stick-to-monotonicity-stack","date":"2020-06-14T11:56:11.000Z","updated":"2021-05-16T16:40:37.343Z","comments":true,"path":"stick-to-monotonicity-stack/","link":"","permalink":"https://winniekun.github.io/stick-to-monotonicity-stack/","excerpt":"","text":"å•è°ƒæ ˆå‰å‡ å¤©åˆ·æ¯æ—¥ä¸€é¢˜çš„æ—¶å€™, é‡åˆ°äº†ä¸€ä¸ªå¾ˆæœ‰è¶£çš„é¢˜, åˆšå¼€å§‹è‡ªå·±ç›´æ¥æš´åŠ›ACäº†, ç„¶åä¼˜åŒ–çš„æ—¶å€™, å‘ç°äº†å•è°ƒæ ˆè¿™ä¹ˆä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„, å¾ˆæœ‰è¶£. é¦–å…ˆ, å•è°ƒæ ˆçš„ä½œç”¨èŒƒå›´ä¸å¤§, åªé€‚åˆç”¨æ¥åšä¸€ç±»é¢˜ç›®â€”Next Greater Element é¢˜ç›®æ¥é›¨æ°´æ€è·¯å‚è€ƒç”œå§¨é¢˜è§£ public int trap(int[] height) { // æ€è·¯ ç»´æŠ¤ä¸€ä¸ªæœ€å°æ ˆ if (height == null || height.length == 0) { return 0; } int ans = 0; Deque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;(); for (int i = 0; i &lt; height.length; i++) { while (!stack.isEmpty() &amp;&amp; height[stack.peek()] &lt; height[i]) { int curIdx = stack.pop(); while(!stack.isEmpty() &amp;&amp; height[stack.peek()] == height[curIdx]) { stack.pop(); } if (!stack.isEmpty()) { int left = stack.peek(); int len = i - left -1 ; int high = Math.min(height[i], height[left]) - height[curIdx]; ans += len * high; } } stack.push(i); } return ans; }","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"å•è°ƒæ ˆ","slug":"å•è°ƒæ ˆ","permalink":"https://winniekun.github.io/tags/%E5%8D%95%E8%B0%83%E6%A0%88/"}]},{"title":"æ’åºç®—æ³•æ€»ç»“","slug":"ç®—æ³•/æ’åº/sorting-algorithms-summary","date":"2020-06-10T05:30:17.000Z","updated":"2021-06-30T16:47:34.280Z","comments":true,"path":"sorting-algorithms-summary/","link":"","permalink":"https://winniekun.github.io/sorting-algorithms-summary/","excerpt":"æ’åºç®—æ³•æ€»ç»“","text":"æ’åºç®—æ³•æ€»ç»“ å¸¸ç”¨æ’åºç®—æ³• æ—¶é—´å¤æ‚åº¦ ç©ºé—´å¤æ‚åº¦ æ˜¯å¦ä¸ºç¨³å®šæ’åº æ˜¯å¦ä¸ºåŸåœ°æ’åº ç›´æ¥æ’å…¥æ’åº $O(n^2)$ $O(1)$ âœ” âœ” æŠ˜åŠæ’å…¥æ’åº $ O(n^2)$ (åªä¼˜åŒ–äº†æ¯”è¾ƒçš„è¿‡ç¨‹) $O(1)$ âœ” âœ” å¸Œå°”æ’åº å’Œå¢é‡æœ‰å…³ï¼Œæœ€å$O(n^2)$ $O(1)$ âŒ âœ” å†’æ³¡æ’åº $O(n^2)$ $O(1)$ âœ” âœ” å¿«é€Ÿæ’åº $O(nlog_2n)$ $O(log_2n)$ âŒ âœ” ç®€å•é€‰æ‹©æ’åº $O(n^2)$ $O(1)$ âŒ âœ” å †æ’åº $O(nlog_2n)$ $O(1)$ âŒ âœ” å½’å¹¶æ’åº $O(nlog_2n)$ $O(n)$ âœ” âŒ ==åŸºæ•°æ’åº== $O(dn) dæ˜¯ä½æ•°$ $O(d)$ âœ” âŒ ==æ¡¶æ’åº== $O(n+k)$ kä¸ºæ¡¶ä¸ªæ•°ï¼Œnä¸ºå…ƒç´ æ•°é‡ $O(n+k)$ âœ” âŒ References ä¸¥ç‰ˆæ•°æ®ç»“æ„ æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[]},{"title":"lock","slug":"Javaè¿›é˜¶/å¹¶å‘/lock","date":"2020-05-30T02:26:14.000Z","updated":"2020-08-30T04:50:22.248Z","comments":true,"path":"lock/","link":"","permalink":"https://winniekun.github.io/lock/","excerpt":"ç®€ä»‹","text":"ç®€ä»‹ é”ç”¨æ¥æ§åˆ¶å¤šä¸ªçº¿ç¨‹çš„åŒæ­¥è®¿é—®å…±äº«èµ„æº, ä¸€ä¸ªé”å¯ä»¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æº(è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«èµ„æº), åœ¨Javaä¸­, å†…ç½®é”â€”-åŸºäºå¯¹è±¡çš„é” , å®ƒä¸€èˆ¬æ˜¯é…åˆsynchronizedå…³é”®å­—ä½¿ç”¨çš„, åŒæ—¶synchronizedçš„ä¸€ç³»åˆ—ä¼˜åŒ– , è¡ç”Ÿå‡ºäº†åå‘é” , è½»é‡çº§é”, é‡é‡çº§é”. åŒæ—¶åœ¨java.util.concurrent.locksåŒ…ä¸‹, è¿˜æä¾›äº†å‡ ä¸ªå…³äºé”çš„æ¥å£, æŠ½è±¡ç±»åŠå…·ä½“æ˜¯å®ç°çš„é”. ä»–ä»¬çš„æ‹¥æœ‰æ›´é«˜çš„çµæ´»æ€§å’Œæ›´åŠ å¼ºå¤§çš„åŠŸèƒ½. åŸºç¡€ä½¿ç”¨ Lock lock = new ReentraLock(); lock.lock(); try{ // ä¸šåŠ¡é€»è¾‘ }final{ // é‡Šæ”¾é” lock.unlock() } é”çš„åˆ†ç±»é”å¯ä»¥æ ¹æ®ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥è¿›è¡Œåˆ†ç±». å½“ç„¶è¿˜æœ‰å…¶ä»–ç±»å‹çš„é”ç±»å‹, å¦‚: å…¬å¹³é”, éå…¬å¹³é”; åå‘é”, è½»é‡çº§é”, é‡é‡çº§é”; ä¹è§‚é”, æ‚²è§‚é”; é‡å…¥é”å’Œéé‡å…¥é”èƒ½å¦é‡æ–°è¿›å…¥é”, ä¹Ÿå°±æ˜¯è¯´é”æ”¯æŒä¸€ä¸ªçº¿ç¨‹å¯¹èµ„æºé‡å¤åŠ é”. synchronizedå…³é”®å­—å°±æ˜¯ä½¿ç”¨çš„é‡å…¥é”ã€‚æ¯”å¦‚è¯´ï¼Œä½ åœ¨ä¸€ä¸ªsynchronizedå®ä¾‹æ–¹æ³•é‡Œé¢è°ƒç”¨å¦ä¸€ä¸ªæœ¬å®ä¾‹çš„synchronizedå®ä¾‹æ–¹æ³•ï¼Œå®ƒå¯ä»¥é‡æ–°è¿›å…¥è¿™ä¸ªé”ï¼Œä¸ä¼šå‡ºç°ä»»ä½•å¼‚å¸¸ã€‚ å…¬å¹³é”å’Œéå…¬å¹³é”å…¬å¹³å’Œéå…¬å¹³çš„é€šä¿—æ„ä¹‰å°±æ˜¯FIFOå…ˆæ¥ååˆ° , å¯¹äºä¸€ä¸ªé”æ¥è¯´, å…ˆå¯¹é”è¯·æ±‚çš„çº¿ç¨‹ä¼šå…ˆè¢«æ»¡è¶³, åå¯¹é”å‘èµ·è¯·æ±‚çš„çº¿ç¨‹ä¼šåè¢«æ»¡è¶³, å…¶å°±æ˜¯å…¬å¹³é” ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéå…¬å¹³é”èƒ½æå‡ä¸€å®šçš„æ•ˆç‡ã€‚ä½†æ˜¯éå…¬å¹³é”å¯èƒ½ä¼šå‘ç”Ÿçº¿ç¨‹é¥¥é¥¿ï¼ˆæœ‰ä¸€äº›çº¿ç¨‹é•¿æ—¶é—´å¾—ä¸åˆ°é”ï¼‰çš„æƒ…å†µã€‚æ‰€ä»¥è¦æ ¹æ®å®é™…çš„éœ€æ±‚æ¥é€‰æ‹©éå…¬å¹³é”å’Œå…¬å¹³é”ã€‚ è¯»å†™é”å’Œæ’å®ƒé”synchronizedç”¨çš„é”å’ŒReentrantLock éƒ½æ˜¯æ’å®ƒé”, ä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»ä»…å…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®èµ„æº è¯»å†™é”å…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®èµ„æº, å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè¯»é”å’Œå†™é” é€šè¿‡åˆ†ç¦»è¯»é”å’Œå†™é”ï¼Œä½¿å¾—åœ¨â€œè¯»å¤šå†™å°‘â€çš„ç¯å¢ƒä¸‹ï¼Œå¤§å¤§åœ°æé«˜äº†æ€§èƒ½ã€‚(æ“ä½œç³»ç»Ÿä¸­çš„è¯»å†™è€…é—®é¢˜) juc.locksåŒ… locksåŒ…ä¸€è§ˆ æ¥å£: Lock ReadWriteLock ConditionLockè·å–é”å’Œé‡Šæ”¾é”çš„æ–¹æ³•å£°æ˜ public interface Lock { void lock(); void unlock(); void lockInterruptibly() throws InterruptedException; boolean tryLock(); boolean tryLock(long time, TimeUnit unit) throws InterruptedException; Condition newCondition(); } ReadWriteLockè¿”å›è¯»é”å’Œå†™é” public interface ReadWriteLock { /** * Returns the lock used for reading. * * @return the lock used for reading */ Lock readLock(); /** * Returns the lock used for writing. * * @return the lock used for writing */ Lock writeLock(); } Conditionæ„Ÿè§‰å’ŒObjectç±»ä¸­çš„waitå’Œnotify/notifyAllæœºåˆ¶å¾ˆåƒ, ä¸è¿‡æ›´åŠ é«˜ç«¯å§ public interface Condition { void await() throws InterruptedException; boolean await(long time, TimeUnit unit) throws InterruptedException; long awaitNanos(long nanosTimeout) throws InterruptedException; void awaitUninterruptibly(); boolean awaitUntil(Date deadline) throws InterruptedException; void signal(); void signalAll(); } çœ‹ä¸‹ä¸¤è€…çš„åŒºåˆ«å§ å¯¹æ¯”é¡¹ Objectç›‘è§†å™¨ Condition å‰ç½®æ¡ä»¶ è·å–å¯¹è±¡çš„é” è°ƒç”¨Lock.lockè·å–é”ï¼Œè°ƒç”¨Lock.newConditionè·å–Conditionå¯¹è±¡ è°ƒç”¨æ–¹å¼ ç›´æ¥è°ƒç”¨ï¼Œæ¯”å¦‚object.notify() ç›´æ¥è°ƒç”¨ï¼Œæ¯”å¦‚condition.await() ç­‰å¾…é˜Ÿåˆ—çš„ä¸ªæ•° ä¸€ä¸ª å¤šä¸ª å½“å‰çº¿ç¨‹é‡Šæ”¾é”è¿›å…¥ç­‰å¾…çŠ¶æ€ æ”¯æŒ æ”¯æŒ å½“å‰çº¿ç¨‹é‡Šæ”¾é”è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåœ¨ç­‰å¾…çŠ¶æ€ä¸­ä¸ä¸­æ–­ ä¸æ”¯æŒ æ”¯æŒ å½“å‰çº¿ç¨‹é‡Šæ”¾é”å¹¶è¿›å…¥è¶…æ—¶ç­‰å¾…çŠ¶æ€ æ”¯æŒ æ”¯æŒ å½“å‰çº¿ç¨‹é‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°å°†æ¥çš„æŸä¸ªæ—¶é—´ ä¸æ”¯æŒ æ”¯æŒ å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªçº¿ç¨‹ æ”¯æŒ æ”¯æŒ å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å…¨éƒ¨çº¿ç¨‹ æ”¯æŒ æ”¯æŒ æŠ½è±¡ç±»: AQS AQLS AOSAQSä¹‹å‰å·²ç»ç»†è®²äº†, AQLSå’ŒAQSå®ç°åŸç†ä¸€æ ·, åªä¸è¿‡ stateç±»å‹æ”¹ä¸ºäº†long AOSæ˜¯AQSå’ŒAQLSçš„çˆ¶ç±», æ ¹æ®æºç å¯ä»¥æ¨æµ‹å‡º, å…¶ä½œç”¨æ˜¯è¡¨ç¤ºé”å’ŒæŒæœ‰è€…(çº¿ç¨‹)çš„å…³ç³» AOS public abstract class AbstractOwnableSynchronizer implements java.io.Serializable { /** Use serial ID even though all fields transient. */ private static final long serialVersionUID = 3737899427754241961L; /** * Empty constructor for use by subclasses. */ protected AbstractOwnableSynchronizer() { } /** * ç‹¬å æ¨¡å¼ï¼Œé”çš„æŒæœ‰è€… */ private transient Thread exclusiveOwnerThread; /** * è®¾ç½®é”æŒæœ‰è€… */ protected final void setExclusiveOwnerThread(Thread thread) { exclusiveOwnerThread = thread; } /** * è·å–é”çš„æŒæœ‰çº¿ç¨‹ */ protected final Thread getExclusiveOwnerThread() { return exclusiveOwnerThread; } } å…·ä½“å®ç°ç±»ReentrantLockä¹‹å‰è®²è¿‡çš„é‡å…¥é”å’Œéé‡å…¥é”ä»¥åŠå…¬å¹³é”å’Œéå…¬å¹³é”åœ¨ReentrantLockå‡æ¶‰åŠåˆ°äº†. æˆ‘ä»¬å¯ä»¥æ ¹æ®æºç çœ‹ä¸‹å…·ä½“çš„å®ç°æ–¹å¼ public class ReentrantLock implements Lock, java.io.Serializable { private static final long serialVersionUID = 7373984872572414699L; /** Synchronizer providing all implementation mechanics */ private final Sync sync; abstract static class Sync extends AbstractQueuedSynchronizer { // å…·ä½“å®ç° } /** * Sync object for non-fair locks */ static final class NonfairSync extends Sync { // å…·ä½“å®ç° } /** * Sync object for fair locks */ static final class FairSync extends Sync { // å…·ä½“å®ç° } public ReentrantLock() { sync = new NonfairSync(); } public ReentrantLock(boolean fair) { sync = fair ? new FairSync() : new NonfairSync(); } // Lockæ¥å£çš„æ–¹æ³•å®ç° ... // è‡ªå·±ä¸€äº›é€»è¾‘ ... public final boolean isFair() { return sync instanceof FairSync; } } ä»æ•´ä½“ä¸Šçœ‹, ReentrantLockæœ‰ä¸€ä¸ªæŠ½è±¡å†…éƒ¨ç±»Syncç»§æ‰¿AQS, ç”¨äºå®ç°è‡ªå·±çš„åŒæ­¥å™¨, åŒæ—¶æœ‰ä¸¤ä¸ªéæŠ½è±¡å†…éƒ¨ç±»NonfairSyncå’ŒFairSync, ç»§æ‰¿äº†Sync, ä»å­—é¢æ„æ€æ¥çœ‹, å°±æ˜¯å…¬å¹³åŒæ­¥å™¨å’Œéå…¬å¹³åŒæ­¥å®¹å™¨ è¿™æ„å‘³ç€, ReentrantLockæ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”, åœ¨æ„é€ å‡½æ•°é‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªbooleanç±»å‹çš„å‚æ•°ï¼Œæ¥æŒ‡å®šå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªå…¬å¹³é”ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³çš„ã€‚è¿™ä¸ªå‚æ•°ä¸€æ—¦å®ä¾‹åŒ–åå°±ä¸èƒ½ä¿®æ”¹ï¼Œåªèƒ½é€šè¿‡isFair()æ–¹æ³•æ¥æŸ¥çœ‹ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹éå…¬å¹³é”å®ç°çš„å®ç°, èµ°ä¸€éæµç¨‹: abstract static class Sync extends AbstractQueuedSynchronizer { private static final long serialVersionUID = -5179523762034025860L; abstract void lock(); // éå…¬å¹³çš„è·å–èµ„æº final boolean nonfairTryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); // èµ„æºå¯ç”¨ if (c == 0) { if (compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } // è‹¥æ˜¯å½“å‰çº¿ç¨‹å·²ç»è·å–äº†é” å¯é‡å…¥ else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(\"Maximum lock count exceeded\"); setState(nextc); return true; } return false; } // other method } åœ¨å®ç°éå…¬å¹³é”çš„åŒæ—¶, é€šè¿‡å¢åŠ äº†å†æ¬¡è·å–èµ„æºçš„å¤„ç†é€»è¾‘å®ç°äº†å¯é‡å…¥é”: åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºè·å–é”çš„çº¿ç¨‹ æ¥åˆ¤æ–­æ“ä½œæ˜¯å¦æˆåŠŸ, å¦‚æœæ˜¯åŒä¸€çº¿ç¨‹, åˆ™åŒæ­¥çŠ¶æ€å€¼è¿›è¡Œå¢åŠ å¹¶è¿”å›true è¡¨ç¤ºè·å–åŒæ­¥æˆåŠŸ. é‚£ä¹ˆåŒç†, é‡Šæ”¾é”åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€çš„æ—¶å€™, å‡å°‘åŒæ­¥çŠ¶æ€å€¼, ä¸º0 åˆ™è¡¨ç¤ºé‡Šæ”¾å®Œå…¨ protected final boolean tryRelease(int releases) { int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) { free = true; // å…¨éƒ¨é‡Šæ”¾çš„è¯ç›´æ¥æŠŠç‹¬å çº¿ç¨‹è®¾ç½®ä¸ºnull setExclusiveOwnerThread(null); } setState(c); return free; } éå…¬å¹³é”çš„å®ç°, å°±æ˜¯åç”³è¯·èµ„æºçš„çº¿ç¨‹å’Œå…ˆç”³è¯·èµ„æºçš„çº¿ç¨‹ä¸€æ ·, è°èƒ½é€šè¿‡compareAndSetStateè®¾ç½®æˆåŠŸ, åˆ™å¼€å§‹æ‰§è¡Œä»»åŠ¡. ReentrantReadWriteLockå®ƒä¸ReentrantLockçš„åŠŸèƒ½ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯å¯é‡å…¥çš„ï¼Œæ”¯æŒéå…¬å¹³é”å’Œå…¬å¹³é”ã€‚ä¸åŒçš„æ˜¯ï¼Œå®ƒè¿˜æ”¯æŒâ€è¯»å†™é”â€œã€‚ // å†…éƒ¨ç»“æ„ private final ReentrantReadWriteLock.ReadLock readerLock; private final ReentrantReadWriteLock.WriteLock writerLock; final Sync sync; abstract static class Sync extends AbstractQueuedSynchronizer { // å…·ä½“å®ç° } static final class NonfairSync extends Sync { // å…·ä½“å®ç° } static final class FairSync extends Sync { // å…·ä½“å®ç° } public static class ReadLock implements Lock, java.io.Serializable { private final Sync sync; protected ReadLock(ReentrantReadWriteLock lock) { sync = lock.sync; } // å…·ä½“å®ç° } public static class WriteLock implements Lock, java.io.Serializable { private final Sync sync; protected WriteLock(ReentrantReadWriteLock lock) { sync = lock.sync; } // å…·ä½“å®ç° } // æ„é€ æ–¹æ³•ï¼Œåˆå§‹åŒ–ä¸¤ä¸ªé” public ReentrantReadWriteLock(boolean fair) { sync = fair ? new FairSync() : new NonfairSync(); readerLock = new ReadLock(this); writerLock = new WriteLock(this); } // è·å–è¯»é”å’Œå†™é”çš„æ–¹æ³• public ReentrantReadWriteLock.WriteLock writeLock() { return writerLock; } public ReentrantReadWriteLock.ReadLock readLock() { return readerLock; } ReentrantReadWriteLockå®ç°äº†è¯»å†™é”ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªå°å¼Šç«¯ï¼Œå°±æ˜¯åœ¨â€œå†™â€æ“ä½œçš„æ—¶å€™ï¼Œå…¶å®ƒçº¿ç¨‹ä¸èƒ½å†™ä¹Ÿä¸èƒ½è¯»ã€‚æˆ‘ä»¬ç§°è¿™ç§ç°è±¡ä¸ºå†™é¥¥é¥¿. StampedLockStampedLockç±»æ˜¯åœ¨Java 8 æ‰å‘å¸ƒçš„ï¼Œä¹Ÿæ˜¯Doug Leaå¤§ç¥æ‰€å†™ï¼Œæœ‰äººå·ç§°å®ƒä¸ºé”çš„æ€§èƒ½ä¹‹ç‹ã€‚å®ƒæ²¡æœ‰å®ç°Lockæ¥å£å’ŒReadWriteLockæ¥å£ï¼Œä½†å®ƒå…¶å®æ˜¯å®ç°äº†â€œè¯»å†™é”â€çš„åŠŸèƒ½ï¼Œå¹¶ä¸”æ€§èƒ½æ¯”ReentrantReadWriteLockæ›´é«˜ã€‚StampedLockè¿˜æŠŠè¯»é”åˆ†ä¸ºäº†â€œä¹è§‚è¯»é”â€å’Œâ€œæ‚²è§‚è¯»é”â€ä¸¤ç§ã€‚ ç­‰æœ‰å¤§æ®µæ—¶é—´çš„æ—¶å€™, å†å¥½å¥½åˆ†ææºç  References Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ æ·±å…¥æµ…å‡ºJavaå¤šçº¿ç¨‹","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"é”","slug":"é”","permalink":"https://winniekun.github.io/tags/%E9%94%81/"}]},{"title":"cas","slug":"Javaè¿›é˜¶/å¹¶å‘/cas","date":"2020-05-28T03:45:05.000Z","updated":"2021-03-30T11:24:56.012Z","comments":true,"path":"cas/","link":"","permalink":"https://winniekun.github.io/cas/","excerpt":"CASæ¦‚å¿µ","text":"CASæ¦‚å¿µ CAS ï¼ŒCompare And Swap ï¼Œå³æ¯”è¾ƒå¹¶äº¤æ¢ã€‚Doug Lea å¤§ç¥åœ¨å®ç°åŒæ­¥ç»„ä»¶æ—¶ï¼Œå¤§é‡ä½¿ç”¨CAS æŠ€æœ¯ï¼Œé¬¼æ–§ç¥å·¥åœ°å®ç°äº†Java å¤šçº¿ç¨‹çš„å¹¶å‘æ“ä½œã€‚æ•´ä¸ª AQS åŒæ­¥ç»„ä»¶ã€Atomic åŸå­ç±»æ“ä½œç­‰ç­‰éƒ½æ˜¯åŸº CAS å®ç°çš„ï¼Œç”šè‡³ ConcurrentHashMap åœ¨ JDK 1.8 çš„ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿè°ƒæ•´ä¸º CAS + synchronized ã€‚å¯ä»¥è¯´ï¼ŒCAS æ˜¯æ•´ä¸ª J.U.C çš„åŸºçŸ³ã€‚ CAS åœ¨CASä¸­ï¼Œæœ‰è¿™æ ·ä¸‰ä¸ªå€¼ï¼š Vï¼šè¦æ›´æ–°çš„å˜é‡(var) Eï¼šé¢„æœŸå€¼(expected)/åŸå€¼(old value) Nï¼šæ–°å€¼(new) æ¯”è¾ƒå¹¶äº¤æ¢çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ¤æ–­Væ˜¯å¦ç­‰äºEï¼Œå¦‚æœç­‰äºï¼Œå°†Vçš„å€¼è®¾ç½®ä¸ºNï¼›å¦‚æœä¸ç­‰ï¼Œè¯´æ˜å·²ç»æœ‰å…¶å®ƒçº¿ç¨‹æ›´æ–°äº†Vï¼Œåˆ™å½“å‰çº¿ç¨‹æ”¾å¼ƒæ›´æ–°ï¼Œä»€ä¹ˆéƒ½ä¸åšã€‚ æ‰€ä»¥è¿™é‡Œçš„é¢„æœŸå€¼Eæœ¬è´¨ä¸ŠæŒ‡çš„æ˜¯â€œæ—§å€¼â€ã€‚ æˆ‘ä»¬ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è§£é‡Šè¿™ä¸ªè¿‡ç¨‹ï¼š å¦‚æœæœ‰ä¸€ä¸ªå¤šä¸ªçº¿ç¨‹å…±äº«çš„å˜é‡iåŸæœ¬ç­‰äº5ï¼Œæˆ‘ç°åœ¨åœ¨çº¿ç¨‹Aä¸­ï¼Œæƒ³æŠŠå®ƒè®¾ç½®ä¸ºæ–°çš„å€¼6; æˆ‘ä»¬ä½¿ç”¨CASæ¥åšè¿™ä¸ªäº‹æƒ…ï¼› é¦–å…ˆæˆ‘ä»¬ç”¨iå»ä¸5å¯¹æ¯”ï¼Œå‘ç°å®ƒç­‰äº5ï¼Œè¯´æ˜æ²¡æœ‰è¢«å…¶å®ƒçº¿ç¨‹æ”¹è¿‡ï¼Œé‚£æˆ‘å°±æŠŠå®ƒè®¾ç½®ä¸ºæ–°çš„å€¼6ï¼Œæ­¤æ¬¡CASæˆåŠŸï¼Œiçš„å€¼è¢«è®¾ç½®æˆäº†6ï¼› å¦‚æœä¸ç­‰äº5ï¼Œè¯´æ˜iè¢«å…¶å®ƒçº¿ç¨‹æ”¹è¿‡äº†ï¼ˆæ¯”å¦‚ç°åœ¨içš„å€¼ä¸º2ï¼‰ï¼Œé‚£ä¹ˆæˆ‘å°±ä»€ä¹ˆä¹Ÿä¸åšï¼Œæ­¤æ¬¡CASå¤±è´¥ï¼Œiçš„å€¼ä»ç„¶ä¸º2ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œiå°±æ˜¯Vï¼Œ5å°±æ˜¯Eï¼Œ6å°±æ˜¯Nã€‚ é‚£æœ‰æ²¡æœ‰å¯èƒ½æˆ‘åœ¨åˆ¤æ–­äº†iä¸º5ä¹‹åï¼Œæ­£å‡†å¤‡æ›´æ–°å®ƒçš„æ–°å€¼çš„æ—¶å€™ï¼Œè¢«å…¶å®ƒçº¿ç¨‹æ›´æ”¹äº†içš„å€¼å‘¢ï¼Ÿ ä¸ä¼šçš„ã€‚å› ä¸ºCASæ˜¯ä¸€ç§åŸå­æ“ä½œï¼Œå®ƒæ˜¯ä¸€ç§ç³»ç»ŸåŸè¯­ï¼Œæ˜¯ä¸€æ¡CPUçš„åŸå­æŒ‡ä»¤ï¼Œä»CPUå±‚é¢ä¿è¯å®ƒçš„åŸå­æ€§ å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨CASæ“ä½œä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šèƒœå‡ºï¼Œå¹¶æˆåŠŸæ›´æ–°ï¼Œå…¶ä½™å‡ä¼šå¤±è´¥ï¼Œä½†å¤±è´¥çš„çº¿ç¨‹å¹¶ä¸ä¼šè¢«æŒ‚èµ·ï¼Œä»…æ˜¯è¢«å‘ŠçŸ¥å¤±è´¥ï¼Œå¹¶ä¸”å…è®¸å†æ¬¡å°è¯•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œã€‚ CAS çš„å®ç°Javaå®ç°CASçš„åŸç† - Unsafeç±»åœ¨Javaä¸­, å¦‚æœæœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯nativeçš„, é‚£ä¹ˆJavaä¸è´Ÿè´£å®ç°å®ƒ, è€Œæ˜¯äº¤ç”±åº•å±‚çš„JVMä½¿ç”¨Cæˆ–C++å»å®ç°. åœ¨Javaä¸­æœ‰ä¸€ä¸ªUnsafeç±», ä½äºsun.miscåŒ…ä¸­, é‡Œé¢æ˜¯nativeæ–¹æ³•, å…¶ä¸­æœ‰å‡ ä¸ªå…³äºCASçš„ public final native boolean compareAndSwapObject(Object var1, long var2, Object var4, Object var5); public final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5); public final native boolean compareAndSwapLong(Object var1, long var2, long var4, long var6); J.U.C ä¸‹çš„ Atomic ç±»ï¼Œéƒ½æ˜¯é€šè¿‡ CAS æ¥å®ç°çš„, ä»¥AtomicIntegerä¸ºä¾‹å­, é˜è¿°CASçš„å®ç° AtomicInteger// setup to use Unsafe.compareAndSwapInt for updates private static final Unsafe unsafe = Unsafe.getUnsafe(); private static final long valueOffset; static { try { valueOffset = unsafe.objectFieldOffset (AtomicInteger.class.getDeclaredField(\"value\")); } catch (Exception ex) { throw new Error(ex); } } private volatile int value; Unsafe æ˜¯ CAS çš„æ ¸å¿ƒç±»ï¼ŒJava æ— æ³•ç›´æ¥è®¿é—®åº•å±‚æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯é€šè¿‡æœ¬åœ° native æ–¹æ³•æ¥è®¿é—®ã€‚ä¸è¿‡å°½ç®¡å¦‚æ­¤ï¼ŒJVMè¿˜æ˜¯å¼€äº†ä¸€ä¸ªåé—¨ï¼šUnsafe ï¼Œå®ƒæä¾›äº†ç¡¬ä»¶çº§åˆ«çš„åŸå­æ“ä½œã€‚ valueOffset ä¸ºå˜é‡å€¼åœ¨å†…å­˜ä¸­çš„åç§»åœ°å€ï¼ŒUnsafe å°±æ˜¯é€šè¿‡åç§»åœ°å€æ¥å¾—åˆ°æ•°æ®çš„åŸå€¼çš„ã€‚ value å½“å‰å€¼ï¼Œä½¿ç”¨ volatile ä¿®é¥°ï¼Œä¿è¯å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çœ‹è§çš„æ˜¯åŒä¸€ä¸ªã€‚ // AtomicIntergerç±» public final int addAndGet(int delta) { return unsafe.getAndAddInt(this, valueOffset, delta) + delta; } // Unsafe(æ ¸å¿ƒ) CASçš„å…·ä½“å®ç° public final int getAndAddInt(Object var1, long var2, int var4) { int var5; do { // æ”¾å…¥doå†…, æ—¶åˆ»è·å–æœ€æ–°çš„æœŸæœ›å€¼(æœŸæœ›å€¼åœ¨å¤šçº¿ç¨‹ä¸­ä¼šè¢«å…¶ä»–çš„çº¿ç¨‹ä¿®æ”¹) var5 = this.getIntVolatile(var1, var2); } while(!this.compareAndSwapInt(var1, var2, var5, var5 + var4)); return var5; } // Unsafe // var1: å¯¹è±¡ // var2: å¯¹è±¡åœ°å€ // var4: é¢„æœŸå€¼ // var5: æ–°å€¼ public final native boolean compareAndSwapInt(Object var1, long var2, int var4, int var5); CASæ˜¯æ— é”çš„åŸºç¡€ï¼Œå®ƒå…è®¸æ›´æ–°å¤±è´¥ã€‚æ‰€ä»¥ç»å¸¸ä¼šä¸whileå¾ªç¯æ­é…ï¼Œåœ¨å¤±è´¥åä¸æ–­å»é‡è¯•ã€‚ getAndInt()æ–¹æ³•, å…¶è¿”å›çš„å€¼æ˜¯é¢„æœŸå€¼(E), ä¹Ÿå°±æ˜¯æ—§å€¼, æ–°å€¼(N)æ˜¯var5+var4 è¿™é‡Œä½¿ç”¨çš„æ˜¯do-whileå¾ªç¯ã€‚è¿™ç§å¾ªç¯ä¸å¤šè§ï¼Œå®ƒçš„ç›®çš„æ˜¯ä¿è¯å¾ªç¯ä½“å†…çš„è¯­å¥è‡³å°‘ä¼šè¢«æ‰§è¡Œä¸€éã€‚è¿™æ ·æ‰èƒ½ä¿è¯return çš„å€¼væ˜¯æˆ‘ä»¬æœŸæœ›çš„å€¼ã€‚ The difference between do-while and while is that do-while evaluates its expression at the bottom of the loop instead of the top. Therefore, the statements within the do block are always executed at least once. Java Documents CASå®ç°åŸå­æ“ä½œçš„ä¸‰å¤§é—®é¢˜&amp;è§£å†³æ–¹æ¡ˆCAS è™½ç„¶é«˜æ•ˆåœ°è§£å†³äº†åŸå­æ“ä½œï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›ç¼ºé™·çš„ï¼Œä¸»è¦è¡¨ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š å¾ªç¯æ—¶é—´å¤ªé•¿ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡åŸå­æ“ä½œ ABA é—®é¢˜ å¾ªç¯æ—¶é—´è¿‡é•¿ å¦‚æœCASä¸€ç›´ä¸æˆåŠŸå‘¢ï¼Ÿè¿™ç§æƒ…å†µç»å¯¹æœ‰å¯èƒ½å‘ç”Ÿï¼Œå¦‚æœè‡ªæ—‹ CAS é•¿æ—¶é—´åœ°ä¸æˆåŠŸï¼Œåˆ™ä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚åœ¨ J.U.C ä¸­ï¼Œæœ‰äº›åœ°æ–¹å°±é™åˆ¶äº† CAS è‡ªæ—‹çš„æ¬¡æ•°ï¼Œä¾‹å¦‚ï¼š BlockingQueue çš„ SynchronousQueue ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡åŸå­æ“ä½œ ä½¿ç”¨JDK 1.5å¼€å§‹å°±æä¾›çš„AtomicReferenceç±»ä¿è¯å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼ŒæŠŠå¤šä¸ªå˜é‡æ”¾åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢è¿›è¡ŒCASæ“ä½œï¼› ä½¿ç”¨é”ã€‚é”å†…çš„ä¸´ç•ŒåŒºä»£ç å¯ä»¥ä¿è¯åªæœ‰å½“å‰çº¿ç¨‹èƒ½æ“ä½œã€‚ ABAé—®é¢˜æ‰€è°“çš„ABAé—®é¢˜å°±æ˜¯, ä¸€ä¸ªå€¼åŸå…ˆæ˜¯A, ç„¶åæ”¹ä¸ºB, åé¢åˆæ”¹ä¸ºA, ä¹‹åç”¨CASè¿›è¡Œæ£€æµ‹æ˜¯æ£€æµ‹ä¸å‡ºæ¥çš„. ä½†æ˜¯å®é™…ä¸Šæ˜¯æ›´æ–°äº†ä¸¤æ¬¡. è§£å†³è¯¥é—®é¢˜é€šå¸¸æ˜¯åœ¨å˜é‡å‰é¢è¿½åŠ ç‰ˆæœ¬å·æˆ–è€…æ—¶é—´æˆ³. ä»JDK 1.5å¼€å§‹ï¼ŒJDKçš„atomicåŒ…é‡Œæä¾›äº†ä¸€ä¸ªç±»AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ã€‚ References æ·±å…¥åˆ†æCAS CASä¸åŸå­æ“ä½œ","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"å‰‘æŒ‡offeré¢˜è§£","slug":"LeetCode/coding-interviews","date":"2020-05-28T02:37:49.000Z","updated":"2021-07-05T05:19:16.366Z","comments":true,"path":"coding-interviews/","link":"","permalink":"https://winniekun.github.io/coding-interviews/","excerpt":"æ•°æ®ç»“æ„ç±»é¢˜ç›®","text":"æ•°æ®ç»“æ„ç±»é¢˜ç›® Array é¢è¯•é¢˜3: æ•°ç»„ä¸­é‡å¤çš„æ•°å­— é¢è¯•é¢˜4: äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾ é¢è¯•é¢˜11: æ—‹è½¬æ•°ç»„ä¸­çš„æœ€å°æ•°å­— é¢è¯•é¢˜21: è°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢ é¢è¯•é¢˜29: é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µ é¢è¯•é¢˜39: æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°æ“ä½œä¸€åŠçš„æ•°å­— é¢è¯•é¢˜42: è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ é¢è¯•é¢˜45: æŠŠæ•°ç»„æ’æˆæœ€å°çš„æ•° é¢è¯•é¢˜47: ç¤¼ç‰©çš„æœ€å¤§å€¼ é¢è¯•é¢˜51: æ•°ç»„ä¸­çš„é€†åºå¯¹ é¢è¯•é¢˜53: åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­— é¢è¯•é¢˜53-I: åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾æ•°å­—I é¢è¯•é¢˜53-II: 0 ~ n-1 ä¸­ç¼ºå¤±çš„æ•°å­— é¢è¯•é¢˜56: æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° é¢è¯•é¢˜66: æ„å»ºä¹˜ç§¯æ•°ç»„ LinkedList é¢è¯•é¢˜6ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨ é¢è¯•é¢˜18ï¼šåˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹ é¢è¯•é¢˜22ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹ é¢è¯•é¢˜23ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£èŠ‚ç‚¹ é¢è¯•é¢˜24ï¼šåè½¬é“¾è¡¨ é¢è¯•é¢˜25ï¼šåˆå¹¶ä¸¤ä¸ªæˆ–kä¸ªæœ‰åºé“¾è¡¨ é¢è¯•é¢˜35ï¼šå¤æ‚é“¾è¡¨çš„å¤åˆ¶ é¢è¯•é¢˜36ï¼š äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨ é¢è¯•é¢˜52ï¼šä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹ é¢è¯•é¢˜56ï¼šåˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹ Tree é¢è¯•é¢˜7ï¼šé‡å»ºäºŒå‰æ ‘ é¢è¯•é¢˜26ï¼šæ ‘çš„å­ç»“æ„ é¢è¯•é¢˜27ï¼šäºŒå‰æ ‘çš„é•œåƒ é¢è¯•é¢˜28ï¼šå¯¹ç§°çš„äºŒå‰æ ‘ é¢è¯•é¢˜32-Iï¼šä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ é¢è¯•é¢˜32-IIï¼šä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ II é¢è¯•é¢˜32-IIIï¼šä»ä¸Šåˆ°ä¸‹æ‰“å°äºŒå‰æ ‘ III é¢è¯•é¢˜33ï¼šäºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ— é¢è¯•é¢˜34ï¼š äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„ é¢è¯•é¢˜36ï¼šäºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨ é¢è¯•é¢˜37ï¼šåºåˆ—åŒ–äºŒå‰æ ‘ é¢è¯•é¢˜54ï¼šäºŒå‰æœç´¢æ ‘çš„ç¬¬kå¤§èŠ‚ç‚¹ é¢è¯•é¢˜55-Iï¼š äºŒå‰æ ‘çš„æ·±åº¦ é¢è¯•é¢˜55-IIï¼šå¹³è¡¡äºŒå‰æ ‘ é¢è¯•é¢˜68-Iï¼šäºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ é¢è¯•é¢˜68-IIï¼šäºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ Stack &amp; Queue é¢è¯•é¢˜9ï¼šç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ— é¢è¯•é¢˜9-I: ä¸¤ä¸ªé˜Ÿåˆ—å®ç°æ ˆ é¢è¯•é¢˜30ï¼šåŒ…å«minå‡½æ•°çš„æ ˆ é¢è¯•é¢˜31ï¼šæ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ— é¢è¯•é¢˜58-Iï¼šç¿»è½¬å•è¯é¡ºåº é¢è¯•é¢˜59-Iï¼šæ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼ Heap é¢è¯•é¢˜29: æœ€å°çš„kä¸ªæ•° é¢è¯•é¢˜41: æ•°æ®æµä¸­çš„ä¸­ä½æ•° Hash Table é¢è¯•é¢˜3: æ•°ç»„ä¸­é‡å¤çš„æ•°å­— å›¾ é¢è¯•é¢˜12: çŸ©é˜µä¸­çš„è·¯å¾„ é¢è¯•é¢˜13: æœºå™¨äººçš„è¿åŠ¨èŒƒå›´ å…·ä½“ç®—æ³•ç±»é¢˜ç›®æœç´¢ç®—æ³• é¢è¯•é¢˜4: äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾ é¢è¯•é¢˜11: æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­— é¢è¯•é¢˜39: æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­— åŠ¨æ€è§„åˆ’ é¢è¯•é¢˜10-I: 10- I. æ–æ³¢é‚£å¥‘æ•°åˆ— é¢è¯•é¢˜10-II: 10- II. é’è›™è·³å°é˜¶é—®é¢˜ é¢è¯•é¢˜19: 19. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… é¢è¯•é¢˜42: 42. è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ é¢è¯•é¢˜46: 46. æŠŠæ•°å­—ç¿»è¯‘æˆå­—ç¬¦ä¸² é¢è¯•é¢˜47: 47. ç¤¼ç‰©çš„æœ€å¤§ä»·å€¼ é¢è¯•é¢˜48: 48. æœ€é•¿ä¸å«é‡å¤å­—ç¬¦çš„å­å­—ç¬¦ä¸² é¢è¯•é¢˜49: 49. ä¸‘æ•° é¢è¯•é¢˜60: 60. n ä¸ªéª°å­çš„ç‚¹æ•° é¢è¯•é¢˜63: 63. è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ å›æº¯ é¢è¯•é¢˜12: çŸ©é˜µä¸­çš„è·¯å¾„ é¢è¯•é¢˜13: æœºå™¨äººçš„è¿åŠ¨èŒƒå›´ æ’åº é¢è¯•é¢˜29: æœ€å°çš„kä¸ªæ•° (å †æ’åº) é¢è¯•é¢˜39: æ•°ç»„ä¸­å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸€åŠçš„æ•°å­— (å¿«æ’åº) é¢è¯•é¢˜51: æ•°ç»„ä¸­çš„é€†åºå¯¹(å½’å¹¶æ’åº) ä½è¿ç®— é¢è¯•é¢˜15: äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•° é¢è¯•é¢˜56-I: æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° é¢è¯•é¢˜56-II: æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II åˆ·é¢˜è®°å½•é¢è¯•é¢˜3-Iï¼šæ•°ç»„ä¸­é‡å¤çš„æ•°å­—é¢˜ç›®ä¸€ï¼šæ‰¾å‡ºæ•°ç»„ä¸­çš„é‡å¤æ•°å­—æ–¹æ³•ä¸€: æ’åºä¹‹å æŸ¥æ‰¾æ’åºï¼Œä¹‹åé‡åˆ°æœ‰é‡å¤çš„è¿”å›è¯¥æ•°å­—å³å¯ æ—¶é—´å¤æ‚åº¦ï¼š O(nlogn) ç©ºé—´å¤æ‚åº¦ï¼šO(1) // å†…ç½®æ’åºç®—æ³• public int findRepeatNumber(int[] arrays) { Arrays.sort(arrays); int t = 0; for (int i = 0; i &lt; arrays.length-1; i++) { if (arrays[i] == arrays[i + 1]) { t = arrays[i]; } } return t; } // ä½¿ç”¨å¿«æ’ public int findRepeatNumber(int[] nums) { quickSort(nums); for(int i = 1; i&lt;nums.length; i++){ if(nums[i] == nums[i-1]){ return nums[i]; } } return -1; } private void quickSort(int[] nums){ quickSort(nums, 0, nums.length-1); } private void quickSort(int[] nums, int low, int high){ if(low &gt; high){ return; } else{ int position = patition(nums, low, high); quickSort(nums, low, position-1); quickSort(nums, position+1, high); } } private int patition(int[] nums, int low, int high){ int position = nums[low]; while(low &lt; high){ while(low &lt; high &amp;&amp; nums[high] &gt;= position){ high--; } nums[low] = nums[high]; while(low &lt; high &amp;&amp; nums[low] &lt;= position){ low++; } nums[high] = nums[low]; } nums[low] = position; return low; } æ–¹æ³•äºŒ: æ•£åˆ—è¡¨ å°†æ‰€æœ‰çš„å…ƒç´ å½“åškeyå­˜å¦‚æ•£åˆ—è¡¨ï¼Œvalueè¡¨ç¤ºkeyå‡ºç°çš„ä¸ªæ•° public int findRepeatNumber(int[] nums) { int a = 0; HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;Integer, Integer&gt;(); for (int i : nums) { if (map.containsKey(i)) { Integer integer = map.get(i); integer += 1; a = i; } else { map.put(i, 0); } } return a; } æ–¹æ³•ä¸‰: ä½å›¾ å…·ä½“å¯å‚è§ç¼–ç¨‹ç ç‘æˆ–ç®—æ³•æ–°è§£ é¢è¯•é¢˜3-IIï¼šä¸ä¿®æ”¹æ•°ç»„ï¼Œæ‰¾å‡ºé‡å¤çš„æ•°å­—äºŒåˆ†æŸ¥æ‰¾287. å¯»æ‰¾é‡å¤æ•° public int findDuplicate(int[] nums) { int i = 0; int j = nums.length - 1; while( i &lt; j ){ // j = mid // æ‰€ä»¥ mid = (i+j)/2 // è‹¥æœi = mid // åˆ™ mid = (i + j + 1)/2 int mid = (i + j) /2; int count = 0; // ç»Ÿè®¡å°äºä¸­å€¼çš„æ•°é‡ for(int num : nums){ if(num &lt;= mid){ count++; } } // å¦‚æœç»Ÿè®¡å‡ºçš„æ•°é‡&gt;ä¸­å€¼ // é‡å¤çš„å…ƒç´ å¯å®šå‡ºç°åœ¨i~midåŒºé—´, æ‰€ä»¥mid+1~jåŒºé—´å°±å¯ä»¥ä¸ç”¨è€ƒè™‘äº† if(count &gt; mid){ j = mid; }else { i = mid + 1; } } return i; } é¢è¯•é¢˜4ï¼šäºŒç»´æ•°ç»„æŸ¥æ‰¾ä»å·¦ä¸‹è§’å¼€å§‹ public boolean findNumberIn2DArray(int[][] matrix, int target) { int m = matrix.length -1; int n = 0; while(m &gt;= 0 &amp;&amp; n&lt;=matrix[0].length-1){ if(matrix[m][n] &lt; target){ n++; }else if(matrix[m][n] &gt; target){ m--; } else { return true; } } return false; } é¢è¯•é¢˜5ï¼šæ›¿æ¢ç©ºæ ¼public String replaceSpace(String s) { StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; s.length(); i++) { if(s.charAt(i) == ' '){ sb.append(\"%20\"); } else{ sb.append(s.charAt(i)); } } return sb.toString(); } é¢è¯•é¢˜6ï¼šä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨public int[] reversePrint(ListNode head) { // ä½¿ç”¨æ ˆ ListNode p = head; Stack&lt;ListNode&gt; stack = new Stack&lt;&gt;(); while (p != null){ stack.push(p); p = p.next; } int[] res = new int[stack.size()]; int i = 0; while (!stack.isEmpty()){ res[i++] = stack.pop().val; } return res; } // å¤´æ’æ³•é‡æ–°æ„é€ é“¾è¡¨ ç„¶åä¾æ¬¡æ”¾å…¥ public ArrayList&lt;Integer&gt; printListFromTailToHead(ListNode listNode) { ListNode dummy = new ListNode(-1); ArrayList&lt;Integer&gt; list = new ArrayList&lt;&gt;(); while(listNode != null){ ListNode temp = listNode.next; listNode.next = dummy.next; dummy.next = listNode; listNode = temp; } listNode = dummy.next; while(listNode != null){ list.add(listNode.val); listNode = listNode.next; } return list; } é¢è¯•é¢˜7ï¼š é‡å»ºäºŒå‰æ ‘public static TreeNode buildTree(int[] preorder, int[] inorder) { Map&lt;Integer, Integer&gt; inMap = new HashMap&lt;Integer, Integer&gt;(); for (int i = 0; i &lt; inorder.length; i++) { inMap.put(inorder[i], i); } TreeNode root = buildTree(preorder, 0, preorder.length - 1, inorder, 0, inorder.length - 1, inMap); return root; } public static TreeNode buildTree(int[] preorder, int preStart, int preEnd, int[] inorder, int inStart, int inEnd, Map&lt;Integer, Integer&gt; inMap) { if (preStart &gt; preEnd) { return null; } TreeNode root = new TreeNode(preorder[preStart]); // å½“å‰æ ¹èŠ‚ç‚¹æ‰€åœ¨ä¸­åºéå†ä½ç½® int inRoot = inMap.get(root.val); // è¯¥æ ¹èŠ‚ç‚¹å·¦è¾¹å­èŠ‚ç‚¹çš„ä¸ªæ•° int numsLeft = inRoot - inStart; root.left = buildTree(preorder, preStart + 1, preStart + numsLeft, inorder, inStart, inRoot - 1, inMap); root.right = buildTree(preorder, preStart + numsLeft + 1 , preEnd, inorder, inRoot + 1, inEnd, inMap); return root; } é¢è¯•é¢˜8ï¼š äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹é¢è¯•é¢˜9ï¼š ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—// ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ— Deque&lt;Integer&gt; A, B; public interview9() { A = new ArrayDeque&lt;&gt;(); B = new ArrayDeque&lt;&gt;(); } public void appendTail(int value) { A.push(value); } public int deleteHead() { if (!B.isEmpty()) { return B.removeLast(); } // è¡¨æ˜ä¸¤ä¸ªæ ˆéƒ½ä¸ºç©ºäº†, æ‰€ä»¥æ²¡æœ‰èƒ½è¿”å›çš„å€¼äº† if (A.isEmpty()) { return -1; } while (!A.isEmpty()) { B.addLast(A.removeLast()); } return B.removeLast(); } é¢è¯•é¢˜10ï¼š æ–æ³¢é‚£å¥‘æ•°åˆ—æ–¹æ³•ä¸€ï¼šé€’å½’ æ–¹æ³•äºŒï¼šDP é¢˜ç›®äºŒï¼šé’è›™è·³å°é˜¶é¢˜ç›®ä¸‰ï¼š çŸ©é˜µè¦†ç›–é¢è¯•é¢˜11ï¼š æ—‹è½¬æ•°ç»„ä¸­çš„æœ€å°æ•°å­—äºŒåˆ†æŸ¥æ‰¾, æ³¨æ„å…ƒç´ ä¼šé‡å¤ public int minArray(int[] numbers) { int i = 0; int j = numbers.length -1; while(i &lt; j){ int mid = (i + j )/2; if(numbers[mid] &gt; numbers[j]){ i = mid + 1; }else if(numbers[mid] &lt; numbers[j]){ j = mid; }else { j -= 1; } } return numbers[i]; } é¢è¯•é¢˜12ï¼šçŸ©é˜µä¸­çš„è·¯å¾„public boolean exist(char[][] matrix, String str) { int n = matrix.length; int m = matrix[0].length; for (int i = 0; i &lt; n; i++) { for (int j = 0; j &lt; m; j++) { if (hasPathCore(matrix, str, 0, i, j)) { return true; } } } return false; } public boolean hasPathCore(char[][] matrix, String str, int start, int row, int col) { int n = matrix.length; int m = matrix[0].length; if (start == str.length()) { return true; } if (row &lt; 0 || row &gt;= n || col &lt; 0 || col &gt;= m || matrix[row][col] != str.charAt(start)) { return false; } char c = matrix[row][col]; matrix[row][col] = ' '; boolean result = hasPathCore(matrix, str, start + 1, row + 1, col) || hasPathCore(matrix, str, start + 1, row - 1, col) || hasPathCore(matrix, str, start + 1, row, col + 1) || hasPathCore(matrix, str, start + 1, row, col - 1); matrix[row][col] = c; return result; } é¢è¯•é¢˜13ï¼šæœºå™¨äººçš„è¿åŠ¨èŒƒå›´private int count = 0; public int movingCount(int m, int n, int k) { boolean[][] vistied = new boolean[m][n]; visit(vistied, k, m, n, 0, 0); return count; } public void visit(boolean visited[][], int k , int m, int n, int i, int j){ if(i &lt;0 || i&gt;=m || j &lt; 0 || j&gt;= n || visited[i][j] || cal(i, j) &gt; k){ return; } visited[i][j] = true; count++; visit(visited, k, m, n, i+1, j); visit(visited, k, m, n, i-1, j); visit(visited, k, m, n, i, j+1); visit(visited, k, m, n, i, j -1); } private int cal(int i, int j) { int calI = calculate(i); int calJ = calculate(j); return calI + calJ; } private int calculate(int num){ int sum = 0; while (num != 0){ sum += (num%10); num /= 10; } return sum; } é¢è¯•é¢˜14ï¼šå‰ªç»³å­åŠ¨æ€è§„åˆ’ //ç†è§£ä¸å¥½ public int cuttingRope(int n) { if (n &lt;= 3) { return n - 1; } int a = n / 3; int b = n % 3; if (b == 0) { return (int) Math.pow(3, a); } else if (b == 1) { return (int) (Math.pow(3, a - 1) * 4); } return (int) Math.pow(3, a) * 2; } public int cuttingRopeII(int n) { int[] dp = new int[n+1]; if(n&lt;=1){ return 0; } if(n==2){ return 1; } if(n==3){ return 2; } dp[0] = 0; dp[1] = 1; dp[2] = 2; dp[3] = 3; int max = 0; int temp = 0; for(int i = 4; i&lt;=n; i++){ for(int k=1; k&lt;=i/2; k++){ temp = dp[k] * dp[i-k]; if(max &lt; temp){ max = temp; } } dp[i] = max; } return dp[n]; } é¢è¯•é¢˜15ï¼šäºŒè¿›åˆ¶ä¸­1ä¸ªä¸ªæ•°public static int numberOf2(int n){ // n &amp; (n - 1) ä¼šæ¶ˆé™¤ n ä¸­æœ€åä¸€ä½ä¸­çš„ 1ã€‚ int res = 0; while (n != 0){ n &amp;= (n-1); res++; } return res; } é¢è¯•é¢˜16ï¼šæ•°å€¼çš„æ•´æ•°æ¬¡æ–¹é¢è¯•é¢˜17ï¼šæ‰“å°ä»1åˆ°æœ€å¤§çš„nä½æ•´æ•°public int[] printNumbers(int n ){ int nums = (int) Math.pow(10, n); int[] res = new int[nums-1]; for (int i = 0; i &lt; nums-1; i++) { res[i] = i+1; } return res; } é¢è¯•é¢˜18ï¼šåˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹public static ListNode deleteNode(ListNode head, ListNode q) { ListNode dummy = new ListNode(-1); if (head == null) { return null; } dummy.next = head; ListNode pre = dummy; ListNode p = head; while (p != null) { if (p == q) { pre.next = p.next; p = pre.next; } else { pre = p; p = p.next; } } return dummy.next; } é¢è¯•é¢˜19ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è¿˜æ²¡ç†å¥½ é¢è¯•é¢˜20ï¼šè¡¨ç¤ºæ•°å€¼çš„å­—ç¬¦ä¸²æŒ‰ç…§é¢˜ç›®æç¤ºå†™å°±æ˜¯äº† .: .ä¹‹å‰ä¸èƒ½å‡ºç°.å’Œe e: eä¹‹å‰ä¸èƒ½å‡ºç°e, ä¸”å‰ä¸€ä½å¿…é¡»æ˜¯æ•°å­—,ä¸”åé¢å¿…é¡»è¿˜è¦æœ‰æ•°å­— +/-: +/-åªèƒ½å‡ºç°åœ¨0ä½ç½®æˆ–è€…eåé¢ public static boolean isNumber(String s) { if(s == null || s.length() == 0){ return false; } boolean res = true; boolean isNums = false; boolean isDot = false; boolean isE = false; String trim = s.trim(); for (int i = 0; i &lt; trim.length(); i++) { if (trim.charAt(i) &lt;= '9' &amp;&amp; trim.charAt(i) &gt;= '0') { isNums = true; } else if (trim.charAt(i) == 'e' || trim.charAt(i) == 'E') { if (!isNums || isE) { return false; } isE = true; // é˜²æ­¢å‡ºç°12eçš„æƒ…å†µ(ä¸èƒ½è¡¨ç¤ºæ•°å­—) isNums = false; } else if (trim.charAt(i) == '.') { if (isE || isDot) { return false; } isDot = true; } else if (trim.charAt(i) == '+' || trim.charAt(i) == '-') { if (i != 0 &amp;&amp; trim.charAt(i - 1) != 'E' &amp;&amp; trim.charAt(i - 1) != 'e') { return false; } } else { return false; } } return isNums; } é¢è¯•é¢˜21ï¼šè°ƒæ•´æ•°ç»„é¡ºåºä½¿å¥‡æ•°ä½äºå¶æ•°å‰é¢// æœ€ç›´ç™½çš„åšæ³•ï¼Œä¾æ¬¡éå†ï¼Œç„¶åé‡åˆ°å¶æ•°çš„æ—¶å€™ // åé¢çš„å…ƒç´ è°ƒå‰é¢ï¼Œè¯¥å…ƒç´ æ”¾ç½®æœ«å°¾ public int[] exchange(int[] nums) { if (nums == null || nums.length &lt; 2) { return nums; } int left = 0; int right = nums.length - 1; int temp[] = new int[nums.length]; for (int i = 0; i &lt; nums.length; i++) { if ((nums[i] &amp; 1) == 0) {//å¶æ•° temp[right--] = nums[i]; } else {//å¥‡æ•° temp[left++] = nums[i]; } } return temp; } // åŒæŒ‡é’ˆæ–¹æ³• public static int[] exchangeII(int[] nums) { int p = 0; int q = nums.length - 1; while (p &lt; q) { while (p &lt; q &amp;&amp; nums[p] % 2 == 0) { if(nums[q] %2 == 1){ int temp = nums[p]; nums[p] = nums[q]; nums[q] = temp; p++; q--; }else if(nums[q] %2 == 0){ q--; } } while (p &lt; q &amp;&amp; nums[p]%2 == 1){ p++; } } return nums; } // ä¸Šé¢çš„é€»è¾‘ æ˜¯åŸºäºæ­£å¸¸äº¤æ¢é€»è¾‘ // ä½†æ˜¯æ˜¯ä¾æ¬¡å¤„ç†ï¼Œ å¯ä»¥å…ˆå‡è®¾ç¬¦åˆæ¡ä»¶ï¼Œ ä¹‹åå°†ä¸ç¬¦åˆæ¡ä»¶çš„ä¸€ä¸€å¤„ç† // ç±»ä¼¼å¿«æ’çš„æ¢è½´å¤„ç† // ä»£ç çš„å¯è¯»æ€§æ›´é«˜ public static int[] exchangeIII(int[] nums){ int pBegin = 0; int pRear = nums.length-1; while (pBegin &lt; pRear){ while (pBegin &lt; pRear &amp;&amp; nums[pBegin]%2 == 1){ pBegin ++; } while (pBegin &lt; pRear &amp;&amp; nums[pRear] %2 == 0){ pRear--; } if(pBegin &lt; pRear){ int temp = nums[pBegin]; nums[pBegin] = nums[pRear]; nums[pRear] = temp; } } return nums; } é¢è¯•é¢˜22ï¼šé“¾è¡¨ä¸­å€’æ•°ç¬¬Kä¸ªèŠ‚ç‚¹// éå†ä¸¤æ¬¡é“¾è¡¨ public static ListNode getKthFromEnd(ListNode head, int k){ if(head==null){ return null; } int length = getLength(head); if(k&gt;length){ return null; } if(k==length){ return head; } ListNode preNode = getPreNode(head, length - k); return preNode.next; } private static ListNode getPreNode(ListNode head, int preK){ while (preK &gt; 1){ head = head.next; preK--; } return head; } private static int getLength(ListNode head){ int length = 0; while (head != null){ head = head.next; length ++; } return length; } // åŒæŒ‡é’ˆè§£å†³ public static ListNode getKthFromEndII(ListNode head, int k){ if(head == null || k==0){ return null; } ListNode fast = head; ListNode slow = head; while (k-1 &gt; 0){ fast = fast.next; k--; } while (fast.next != null){ fast = fast.next; slow = slow.next; } return slow; } é¢è¯•é¢˜23ï¼šé“¾è¡¨ä¸­ç¯çš„å…¥å£èŠ‚ç‚¹åŒæŒ‡é’ˆä¹‹å¿«æ…¢æŒ‡é’ˆ public ListNode meetingNode(ListNode head) { ListNode entry = null; if (head == null) { return entry; } ListNode fast = head; ListNode slow = head; while (fast != null &amp;&amp; fast.next != null) { fast = fast.next.next; slow = slow.next; if (fast == slow) { ListNode slowII = head; while (slow != slowII) { slowII = slowII.next; slow = slowII.next; } return slow; } } return null; } é¢è¯•é¢˜24ï¼šåè½¬é“¾è¡¨å¤´æ’æ³• public static ListNode reverseList(ListNode head){ ListNode dummmy = new ListNode(-1); ListNode p = head; while (p != null){ ListNode temp = p.next; p.next = dummmy.next; dummmy.next = p; p = temp; } return dummmy.next; } é¢è¯•é¢˜25ï¼š åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨// å°¾æ’æ³• public ListNode mergeTwoLists(ListNode l1, ListNode l2){ ListNode dummy = new ListNode(-1); ListNode rear = dummy; while (l1!= null &amp;&amp; l2!= null){ if(l1.value &lt;= l2.value){ rear.next = l1; l1 = l1.next; }else { rear.next = l2; l2 = l2.next; } rear = rear.next; } if (l1 != null){ rear.next = l1; } if (l2!= null) { rear.next = l2; } return dummy.next; } é¢è¯•é¢˜26ï¼šæ ‘çš„å­ç»“æ„public boolean isSubStructure(TreeNode A, TreeNode B){ boolean res = false; if(A!=null &amp;&amp; B!=null){ if(A.val == B.val){ res = doesHaveTree2(A, B); }if(!res){ res = isSubStructure(A.left, B); }if(!res){ res = isSubStructure(A.right, B); } } return res; } private boolean doesHaveTree2(TreeNode A, TreeNode B){ if(B == null) { return true; } if(A == null){ return false; } if(A.val != B.val){ return false; } return doesHaveTree2(A.left, B.left) &amp;&amp; doesHaveTree2(A.right, B.right); } é¢è¯•é¢˜27ï¼šäºŒå‰æ ‘çš„é•œåƒpublic TreeNode mirrorTree(TreeNode root) { if (root != null) { TreeNode temp = root.left; root.left = root.right; root.right = temp; mirrorTree(root.left); mirrorTree(root.right); } return root; } é¢è¯•é¢˜28ï¼šå¯¹ç§°äºŒå‰æ ‘// é€’å½’ public boolean isSymmetric(TreeNode root) { if (root == null) { return true; } return isSymmetric(root.left, root.right); } private boolean isSymmetric(TreeNode left, TreeNode right) { if (left == null &amp;&amp; right == null) { return true; } if ((left != null &amp;&amp; right == null) || (left == null &amp;&amp; right != null) || (left.value != right.value)){ return false; } return isSymmetric(left.left, right.right) &amp;&amp; isSymmetric(left.right, right.left); } é¢è¯•é¢˜29ï¼š é¡ºæ—¶é’ˆæ‰“å°çŸ©é˜µæ‰“å°çŸ©é˜µçš„é¡ºåºæ˜¯ â€œä»å·¦å‘å³ã€ä»ä¸Šå‘ä¸‹ã€ä»å³å‘å·¦ã€ä»ä¸‹å‘ä¸Šâ€ å¾ªç¯ã€‚åŸºç¡€ç‚¹ä¸ºï¼ˆ0,0ï¼‰ æµç¨‹ ç©ºå€¼å¤„ç† åˆå§‹åŒ–ï¼Œ åˆå§‹åŒ– ä¸Šä¸‹å·¦å³çš„å››ä¸ªè¾¹ç•Œtã€ bã€ lã€r å¾ªç¯æ‰“å° æ ¹æ®è¾¹ç•Œä¾æ¬¡æ·»åŠ åˆ°reså°¾éƒ¨ è¾¹ç•Œä¿®æ”¹ï¼ˆå†…ç¼©1ï¼‰ è¾¹ç•Œæ˜¯å¦ç›¸é‡ï¼Œè‹¥ç›¸é‡åˆ™æ‰“å°å®Œæ¯• | æ‰“å°æ–¹å‘ | æ ¹æ®è¾¹ç•Œæ‰“å° | è¾¹ç•Œå†…ç¼© | æ˜¯å¦æ‰“å°å®Œæ¯• || :â€”â€”â€”: | :â€”â€”â€”â€”â€”â€”â€”â€”â€”: | :â€”â€”â€”: | :â€”â€”â€”â€”â€”: || ä»å·¦åˆ°å³ | å·¦è¾¹ç•Œï¼šlï¼Œå³è¾¹ç•Œ: r | t+1 | æ˜¯å¦t+1&gt;b || ä»ä¸Šåˆ°ä¸‹ | ä¸Šè¾¹ç•Œ: tï¼Œä¸‹è¾¹ç•Œ: b | r-1 | æ˜¯å¦r-1","categories":[{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://winniekun.github.io/categories/%E5%89%91%E6%8C%87offer/"}],"tags":[{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://winniekun.github.io/tags/%E5%89%91%E6%8C%87offer/"}]},{"title":"Vector&Stackæºç è§£è¯»","slug":"æºç /JDK/list/vector&stack-analysis","date":"2020-05-26T08:29:05.000Z","updated":"2020-08-30T04:50:22.255Z","comments":true,"path":"vector&stack-analysis/","link":"","permalink":"https://winniekun.github.io/vector&stack-analysis/","excerpt":"Vectoræºç è§£è¯»","text":"Vectoræºç è§£è¯» Vectorä¾èµ– æ”¯æŒæ³›å‹, ç»§æ‰¿äº†AbstractListç±», å®ç°äº†Listæ¥å£ RandomAccessç”¨æ¥è¡¨æ˜å…¶æ”¯æŒéšæœºè®¿é—® Cloneableç”¨æ¥è¡¨æ˜å…¶æ”¯æŒæ‹·è´ Serializableç”¨æ¥è¡¨æ˜æ”¯æŒåºåˆ—åŒ– Vectorçš„å®ç°å’ŒArrayLisåŸºæœ¬ç±»ä¼¼, åº•å±‚ä½¿ç”¨çš„éƒ½æ˜¯Objectç±»å‹çš„æ•°ç»„, åªä¸è¿‡Vectoråœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†å…³é”®å­—synchronized, å®ç°äº†çº¿ç¨‹å®‰å…¨. æ‰€ä»¥å…·ä½“çš„å®ç°å°±ä¸ä¸€ä¸€å±•å¼€æ¥äº†, ä½†æ˜¯å…¶æ‰©å®¹æœºåˆ¶å¤§å°å’ŒArrayListçš„ä¸å®¹,å…¶ä»–çš„éƒ¨åˆ†, åˆ†æStackæºç çš„æ—¶å€™ç›¸å…³æ¶‰åŠä¼šå†åˆ†æä¸‹ æ„é€ å‡½æ•°Vector()// æ— å‚æ„é€  public Vector() { this(10); } Vector(int initialCapacity)// æŒ‡å®šåˆå§‹åŒ–å®¹é‡ public Vector(int initialCapacity) { this(initialCapacity, 0); } Vector(int initialCapacity, int capacityIncrement)// å³æŒ‡å®šåˆå§‹åŒ–å®¹é‡åˆæŒ‡å®šæ‰©å®¹å¤§å° public Vector(int initialCapacity, int capacityIncrement) { super(); if (initialCapacity &lt; 0) throw new IllegalArgumentException(\"Illegal Capacity: \"+ initialCapacity); this.elementData = new Object[initialCapacity]; this.capacityIncrement = capacityIncrement; } Vector(Collection&lt;? extends E&gt; c)// æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„Vector public Vector(Collection&lt;? extends E&gt; c) { elementData = c.toArray(); elementCount = elementData.length; // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, elementCount, Object[].class); } æ‰©å®¹æœºåˆ¶private void grow(int minCapacity) { // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); elementData = Arrays.copyOf(elementData, newCapacity); } å¯ä»¥çœ‹åˆ°å…¶æ‰©å®¹æœºåˆ¶å’ŒArrayListçš„ä¸åŒ, ArrayListçš„æ‰©å®¹æ˜¯åŸå®¹é‡çš„1.5å€, ä½†æ˜¯Vectorçš„æ‰©å®¹æœºåˆ¶å’ŒcapacityIncrementç›¸å…³ capacityIncrement&gt;0 åˆ™ æ‰©å®¹å®¹é‡ä¸º capacityIncrement, æœ€åçš„å®¹é‡ä¸º oldCapacity + capacityIncrement capacityIncrement&lt;0 åˆ™ æ‰©å®¹å®¹é‡ä¸º oldCapacity , æœ€åçš„å®¹é‡ä¸º 2å€oldCapacity æ€»ç»“å…±å››ä¸ªæ„é€ å‡½æ•°, é»˜è®¤çš„åˆå§‹åŒ–æ•°ç»„å®¹é‡ä¸º10, æ‰©å®¹å¤§å°ä¸æ˜¯ç¨‹åºå†…éƒ¨å®ç°, è€Œæ˜¯ç”¨æˆ·å®šä¹‰, é»˜è®¤ä¸ºåŸæ•°ç»„çš„ä¸¤å€, è‹¥æ˜¯ç”¨æˆ·æŒ‡å®šäº†æ‰©å®¹å¤§å°, åˆ™æ‰©å®¹ä¸ºæŒ‡å®šçš„å®¹é‡ Stackæºç è§£è¯» Stackæ–¹æ³• empty()public boolean empty() { return size() == 0; } peek()public synchronized E peek() { int len = size(); if (len == 0) throw new EmptyStackException(); return elementAt(len - 1); } peek()å‡½æ•°è°ƒç”¨äº†çˆ¶ç±»Vectorçš„ elementAt()æ–¹æ³• public synchronized E elementAt(int index) { if (index &gt;= elementCount) { throw new ArrayIndexOutOfBoundsException(index + \" &gt;= \" + elementCount); } return elementData(index); } elementData()å‡½æ•°å’ŒArrayListä¸­çš„ä¸€æ · è¯´ç™½äº†å°±æ˜¯è¿”å›æ•°ç»„ä¸­æœ€åä¸€ä½çš„å…ƒç´  pop()public synchronized E pop() { E obj; int len = size(); obj = peek(); removeElementAt(len - 1); return obj; } pop()å‡½æ•°è°ƒç”¨äº†çˆ¶ç±»Vectorçš„ removeElementAt()æ–¹æ³• è¿™ä¸ªæ–¹æ³•å’ŒArrayListçš„remove(int index)æ˜¯ä¸€æ ·çš„, åªä¸è¿‡æ·»åŠ äº†synchronizedå…³é”®å­—å®ç°çº¿ç¨‹å®‰å…¨ public synchronized void removeElementAt(int index) { modCount++; if (index &gt;= elementCount) { throw new ArrayIndexOutOfBoundsException(index + \" &gt;= \" + elementCount); } else if (index &lt; 0) { throw new ArrayIndexOutOfBoundsException(index); } int j = elementCount - index - 1; if (j &gt; 0) { System.arraycopy(elementData, index + 1, elementData, index, j); } elementCount--; elementData[elementCount] = null; /* to let gc do its work */ } ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ , åŸºæœ¬ä¸Šä¸ä¼šæ‰§è¡Œå‰é¢çš„åˆ¤æ–­åˆ†æ”¯, ä¼šç›´æ¥æ‰§è¡Œ elementCount--; elementData[elementCount] = null; /* to let gc do its work */ push()public E push(E item) { addElement(item); return item; } push()è°ƒç”¨äº†addElement()æ–¹æ³•, è¯¥æ–¹æ³•é¦–å…ˆä¼šç¡®å®šelementCountæ˜¯å¦å¤§äºç°åœ¨æ•°ç»„çš„å®¹é‡å¤§å°, è‹¥å¤§æ‰©å®¹, å¦åˆ™ç›´æ¥æ·»åŠ  public synchronized void addElement(E obj) { modCount++; ensureCapacityHelper(elementCount + 1); elementData[elementCount++] = obj; } ç„¶ååœ¨æ•°ç»„å°¾éƒ¨æ·»åŠ å…ƒç´ . search()è¿”å›å¯¹åº”å…ƒç´ æ‰€åœ¨å †çš„ä½ç½® è¿™ä¸ªå¯¹äºåº•å±‚çš„æ•°ç»„è€Œè¨€, æ˜¯ç›¸åçš„, æ‰€ä»¥ä»å°¾åˆ°å¤´éå†å…ƒç´ ,åŒæ—¶å› ä¸ºå…è®¸å…ƒç´ ä¸ºç©º, æ‰€ä»¥é¦–å…ˆä¼šå…ˆåˆ¤æ–­æŸ¥è¯¢å…ƒç´ æ˜¯å¦ä¸ºç©º æ„Ÿè§‰è¿™äº›ç´¢å¼•ä½ç½®å’Œæ•°ç»„ç¬¬å‡ ä¸ªå…ƒç´ çš„é—®é¢˜å¾ˆæ¼ç«, ä¸¤è€…å§‹ç»ˆå·®ä¸ª1 public synchronized int search(Object o) { int i = lastIndexOf(o); // é€†åºè¿”å› if (i &gt;= 0) { return size() - i; } return -1; } // elementCountè®°å½•ä¸ºæ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•° // ä½†æ˜¯æ•°ç»„æ˜¯ä»ä½ç½®0å¼€å§‹ // æ‰€ä»¥åœ¨æ•°ç»„ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„ä½ç½®ä¸ºelementCount-1 public synchronized int lastIndexOf(Object o) { return lastIndexOf(o, elementCount-1); } public synchronized int lastIndexOf(Object o, int index) { if (index &gt;= elementCount) throw new IndexOutOfBoundsException(index + \" &gt;= \"+ elementCount); if (o == null) { for (int i = index; i &gt;= 0; i--) if (elementData[i]==null) return i; } else { for (int i = index; i &gt;= 0; i--) if (o.equals(elementData[i])) return i; } return -1; } æ€»ç»“Vectorå’ŒArrayListçš„å¼‚åŒ:å¼‚: Vectoré€šè¿‡åœ¨æ¶‰åŠåˆ°çº¿ç¨‹ä¸å®‰å…¨çš„æ–¹æ³•ä¸Šæ·»åŠ synchronizedå…³é”®å­—å®ç°äº†çº¿ç¨‹å®‰å…¨,è€ŒArrayListä¸ºçº¿ç¨‹ä¸å®‰å…¨ Vectorçš„æ‰©å®¹æœºåˆ¶å¯ç”±ç”¨æˆ·è‡ªå®šä¹‰, è‹¥ä¸ºå®šä¹‰åˆ™æ‰©ä¸ºåŸæ•°ç»„çš„ä¸¤å€ ArrayListçš„æ‰©å®¹æœºåˆ¶ä¸èƒ½é€šè¿‡ç”¨æˆ·è‡ªå®šä¹‰, æ­£å¸¸æƒ…å†µæ‰©å®¹ä¸ºåŸæ•°ç»„çš„1.5å€ åŒ: åº•å±‚éƒ½æ˜¯Objectæ•°ç»„ removeæ–¹æ³•éƒ½ä¸ä¼šæ”¹å˜åº•å±‚æ•°ç»„çš„å¤§å° Stackç»§æ‰¿Vectorç±», æ‰€æœ‰æ˜¯çº¿ç¨‹å®‰å…¨çš„, åŒæ—¶åº•å±‚ä¹Ÿæ˜¯Objectæ•°ç»„, å…¥æ ˆç­‰åŒäºåœ¨æ•°ç»„ä¸­ä¾æ¬¡æ·»åŠ å…ƒç´ , å‡ºæ ˆåœ¨æ•°ç»„ä¸­å°±æ˜¯åˆ é™¤æ•°ç»„ä¸­æœ€åçš„å…ƒç´ , ç„¶åå°†æœ€åçš„ä½ç½®è®¾ç½®ä¸ºç©º, æ•°ç»„æ•´ä½“çš„å¤§å°æ˜¯ä¸ä¼šéšç€å‡ºæ ˆè€Œæ”¹å˜çš„.","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"List","slug":"List","permalink":"https://winniekun.github.io/tags/List/"}]},{"title":"æ­»ç£•äºŒåˆ†æŸ¥æ‰¾","slug":"LeetCode/stick-to-binary-search","date":"2020-05-23T06:21:39.000Z","updated":"2020-08-30T04:50:22.250Z","comments":true,"path":"stick-to-binary-search/","link":"","permalink":"https://winniekun.github.io/stick-to-binary-search/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—å…­ï¼šäºŒåˆ†æŸ¥æ‰¾","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—å…­ï¼šäºŒåˆ†æŸ¥æ‰¾ äºŒåˆ†æŸ¥æ‰¾æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­æœ€åŸºæœ¬ã€æœ€æœ‰ç”¨çš„ç®—æ³•ä¹‹ä¸€ï¼Œåœ¨åŸºç¡€ç®—æ³•çš„å­¦ä¹ ä¸­æ˜¯éå¸¸é‡è¦çš„ã€‚ äºŒåˆ†æŸ¥æ‰¾çš„æœ€åŸºæœ¬é—®é¢˜æ˜¯åœ¨æœ‰åºæ•°ç»„é‡ŒæŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„å…ƒç´  äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æ˜¯å…¸å‹çš„ã€Œå‡æ²»æ€æƒ³ã€çš„åº”ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾å°†å¾…æœç´¢çš„åŒºé—´é€æ¸ç¼©å°ï¼Œä»¥è¾¾åˆ°ã€Œç¼©å‡é—®é¢˜è§„æ¨¡ã€çš„ç›®çš„ï¼› æŒæ¡äºŒåˆ†æŸ¥æ‰¾çš„ä¸¤ç§æ€è·¯ï¼š æ€è·¯ 1ï¼šåœ¨å¾ªç¯ä½“å†…éƒ¨æŸ¥æ‰¾å…ƒç´ ï¼šwhile (left &lt;= right)ï¼› æ€è·¯ 2ï¼šåœ¨å¾ªç¯ä½“å†…éƒ¨æ’é™¤å…ƒç´ ï¼šwhile (left &lt; right)ã€‚ å…¨éƒ¨ä½¿ç”¨å·¦é—­å³é—­åŒºé—´ï¼Œä¸å»ºè®®ä½¿ç”¨å·¦é—­å³å¼€åŒºé—´ï¼Œåè€Œä½¿å¾—é—®é¢˜å˜å¾—å¤æ‚ï¼› åº”ç”¨1ã€åœ¨åŠæœ‰åºï¼ˆæ—‹è½¬æœ‰åºæˆ–è€…æ˜¯å±±è„‰ï¼‰æ•°ç»„é‡ŒæŸ¥æ‰¾å…ƒç´ ï¼› 2ã€ç¡®å®šä¸€ä¸ªæœ‰èŒƒå›´çš„æ•´æ•°ï¼› 3ã€éœ€è¦æŸ¥æ‰¾çš„ç›®æ ‡å…ƒç´ æ»¡è¶³æŸä¸ªç‰¹å®šçš„æ€§è´¨ã€‚ æ¨¡æ¿ä¸€class Solution { public int search(int[] nums, int target) { // ç‰¹æ®Šç”¨ä¾‹åˆ¤æ–­ int len = nums.length; if (len == 0) { return -1; } // åœ¨ [left, right] åŒºé—´é‡ŒæŸ¥æ‰¾ target int left = 0; int right = len - 1; while (left &lt;= right) { // ä¸ºäº†é˜²æ­¢ left + right æ•´å½¢æº¢å‡ºï¼Œå†™æˆå¦‚ä¸‹å½¢å¼ int mid = left + (right - left) / 2; if (nums[mid] == target) { return mid; } else if (nums[mid] &gt; target) { // ä¸‹ä¸€è½®æœç´¢åŒºé—´ï¼š[left, mid - 1] right = mid - 1; } else { // æ­¤æ—¶ï¼šnums[mid] &lt; target // ä¸‹ä¸€è½®æœç´¢åŒºé—´ï¼š[mid + 1, right] left = mid + 1; } } return -1; } } lower_boundï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºæˆ–ç­‰äº target çš„æ•°å­—ï¼› upper_boundï¼šæŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äº target çš„æ•°å­—ã€‚ è¿™ä¸€ç±»é—®é¢˜çš„æè¿°ç»å¸¸è®©äººè§‰å¾—å¤´æ™•ï¼Œä½¿ç”¨æ¨¡æ¿ä¸€ï¼Œå°±éœ€è¦è€ƒè™‘è¿”å› left è¿˜æ˜¯ rightã€‚ å¦‚æœä½¿ç”¨æ¨¡æ¿äºŒï¼Œç”±äºé€€å‡ºå¾ªç¯ä»¥åä¸€å®šæœ‰ left == rightï¼Œå°±åªéœ€è¦å•ç‹¬åˆ¤æ–­ leftæˆ–right æ˜¯å¦æ»¡è¶³é¢˜æ„ã€‚ æ¨¡æ¿äºŒpublic int search(int[] nums, int left, int right, int target) { while (left &lt; right) { // é€‰æ‹©ä¸­ä½æ•°æ—¶ä¸‹å–æ•´ int mid = left + (right - left) / 2; if (check(mid)) { // ä¸‹ä¸€è½®æœç´¢åŒºé—´æ˜¯ [mid + 1, right] left = mid + 1 } else { // ä¸‹ä¸€è½®æœç´¢åŒºé—´æ˜¯ [left, mid] right = mid } } // é€€å‡ºå¾ªç¯çš„æ—¶å€™ï¼Œç¨‹åºåªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ æ²¡æœ‰çœ‹åˆ°ã€‚ // è§†æƒ…å†µï¼Œæ˜¯å¦éœ€è¦å•ç‹¬åˆ¤æ–­ leftï¼ˆæˆ–è€… rightï¼‰è¿™ä¸ªä¸‹æ ‡çš„å…ƒç´ æ˜¯å¦ç¬¦åˆé¢˜æ„ } public int search(int[] nums, int left, int right, int target) { while (left &lt; right) { // é€‰æ‹©ä¸­ä½æ•°æ—¶ä¸Šå–æ•´ int mid = left + (right - left + 1) / 2; if (check(mid)) { // ä¸‹ä¸€è½®æœç´¢åŒºé—´æ˜¯ [left, mid - 1] right = mid - 1; } else { // ä¸‹ä¸€è½®æœç´¢åŒºé—´æ˜¯ [mid, right] left = mid; } } // é€€å‡ºå¾ªç¯çš„æ—¶å€™ï¼Œç¨‹åºåªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ æ²¡æœ‰çœ‹åˆ°ã€‚ // è§†æƒ…å†µï¼Œæ˜¯å¦éœ€è¦å•ç‹¬åˆ¤æ–­ leftï¼ˆæˆ–è€… rightï¼‰è¿™ä¸ªä¸‹æ ‡çš„å…ƒç´ æ˜¯å¦ç¬¦åˆé¢˜æ„ } ç‰¹å¾ï¼šwhile (left &lt; right)ï¼Œè¿™é‡Œä½¿ç”¨ä¸¥æ ¼å°äº &lt; è¡¨ç¤ºçš„ä¸´ç•Œæ¡ä»¶æ˜¯ï¼šå½“åŒºé—´é‡Œçš„å…ƒç´ åªæœ‰ 2 ä¸ªæ—¶ï¼Œä¾ç„¶å¯ä»¥æ‰§è¡Œå¾ªç¯ä½“ã€‚æ¢å¥è¯è¯´ï¼Œé€€å‡ºå¾ªç¯çš„æ—¶å€™ä¸€å®šæœ‰ left == right æˆç«‹ï¼Œè¿™ä¸€ç‚¹åœ¨å®šä½å…ƒç´ ä¸‹æ ‡çš„æ—¶å€™æå…¶æœ‰ç”¨ï¼› åœ¨å¾ªç¯ä½“ä¸­ï¼Œå…ˆè€ƒè™‘ nums[mid] åœ¨æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ä¸‹ä¸æ˜¯ç›®æ ‡å…ƒç´ ï¼Œè¿›è€Œè€ƒè™‘ä¸¤ä¸ªåŒºé—´ [left, mid - 1] ä»¥åŠ [mid + 1, right] é‡Œå…ƒç´ çš„æ€§è´¨ï¼Œç›®çš„ä¾ç„¶æ˜¯ç¡®å®šä¸‹ä¸€è½®æœç´¢çš„åŒºé—´ï¼› æ ¹æ®è¾¹ç•Œæƒ…å†µï¼Œçœ‹å–ä¸­é—´æ•°çš„æ—¶å€™æ˜¯å¦éœ€è¦ä¸Šå–æ•´(ä¹Ÿå°±æ˜¯mid æ˜¯å¦çš„è®¡ç®—æ˜¯å¦éœ€è¦åŠ 1) æ³¨æ„äº‹é¡¹ï¼š å…ˆå†™åˆ†æ”¯ï¼Œå†å†³å®šä¸­é—´æ•°æ˜¯å¦ä¸Šå–æ•´ï¼› åœ¨ä½¿ç”¨å¤šäº†ä»¥åï¼Œå°±å¾ˆå®¹æ˜“è®°ä½ï¼Œåªè¦çœ‹åˆ° left = mid ï¼Œå®ƒå¯¹åº”çš„å–ä¸­ä½æ•°çš„å–æ³•ä¸€å®šæ˜¯ int mid = left + (right - left + 1) / 2;ã€‚ LeetCode äºŒåˆ†æŸ¥æ‰¾é¢˜ç›®æ•´ç† 704 äºŒåˆ†æŸ¥æ‰¾ (åŸºç¡€,ç»å…¸åº”ç”¨) 35 æ’å…¥æœç´¢ä½ç½® 69 xçš„å¹³æ–¹æ ¹ 34 åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®(ç»å…¸, å¾ˆå¥½çš„æ¨¡æ¿) é¢˜è§£704. äºŒåˆ†æŸ¥æ‰¾ å…³äºå†™left = mid + 1;è¿˜æ˜¯å†™right = mid - 1; ä¸Šæ„Ÿåˆ°å›°æƒ‘ï¼Œä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„æ€è€ƒç­–ç•¥æ˜¯ï¼š æ°¸è¿œå»æƒ³ä¸‹ä¸€è½®ç›®æ ‡å…ƒç´ åº”è¯¥åœ¨å“ªä¸ªåŒºé—´é‡Œ: å¦‚æœç›®æ ‡å…ƒç´ åœ¨åŒºé—´ [left, mid - 1] é‡Œï¼Œå°±éœ€è¦è®¾ç½®è®¾ç½® right = mid - 1ï¼› å¦‚æœç›®æ ‡å…ƒç´ åœ¨åŒºé—´ [mid + 1, right] é‡Œï¼Œå°±éœ€è¦è®¾ç½®è®¾ç½® left = mid + 1ï¼› è€ƒè™‘ä¸ä»”ç»†æ˜¯åˆå­¦äºŒåˆ†æ³•å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œè¿™é‡Œåˆ‡å¿Œè·³æ­¥ï¼Œéœ€è¦ä»”ç»†æƒ³æ¸…æ¥šæ¯ä¸€è¡Œä»£ç çš„å«ä¹‰ï¼› å¾ªç¯å¯ä»¥ç»§ç»­çš„æ¡ä»¶æ˜¯ while (left &lt;= right)ï¼Œç‰¹åˆ«åœ°ï¼Œå½“ left == right å³å½“å¾…æœç´¢åŒºé—´é‡Œåªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾ä¹Ÿå¿…é¡»è¿›è¡Œä¸‹å»ï¼› public int search(int[] nums, int target) { int i = 0; int j = nums.length - 1; while (i &lt;= j) { // é˜²æ­¢æ•´å‹æº¢å‡º // int mid = i + (j-i)/2; int mid = (i+j)/2; if(nums[mid] == target){ return mid; }else if(nums[mid] &lt; target){ i = mid+1; }else if(nums[mid] &gt; target){ j = mid-1; } } return -1; } 35. æœç´¢æ’å…¥ä½ç½®ä½¿ç”¨ä¸Šè¿°çš„æ¨¡æ¿æ¥çš„è¯,éœ€è¦è€ƒè™‘æ˜¯è¿”å›i, è¿˜æ˜¯j ä½¿ç”¨æ¨¡æ¿äºŒçš„è¯,ä¸ç”¨è€ƒè™‘ // æ¨¡æ¿ä¸€è§£æ³• public static int searchInsert(int[] nums, int target) { if(target &gt; nums[nums.length-1]){ return nums.length; } int low = 0; int high = nums.length - 1; while (low &lt;= high) { int mid = (low + high) / 2; if(target == nums[mid]){ return mid; }else if(nums[mid] &lt; target){ low = mid+1; }else { high = mid-1; } } return high; } // æ¨¡æ¿äºŒè§£æ³• public static int searchInsertII(int[] nums, int target) { int len = nums.length; if (len == 0) { return 0; } // ç‰¹åˆ¤ if (nums[len - 1] &lt; target) { return len; } int left = 0; int right = len - 1; while (left &lt; right) { int mid = left + (right - left) / 2; // ä¸¥æ ¼å°äº target çš„å…ƒç´ ä¸€å®šä¸æ˜¯è§£ if (nums[mid] &lt; target) { // ä¸‹ä¸€è½®æœç´¢åŒºé—´æ˜¯ [mid + 1, right] left = mid + 1; } else { right = mid; } } return left; } 69. x çš„å¹³æ–¹æ ¹public int mySqrt(int x) { if (x == 0) { return 0; } if (x == 1) { return 1; } int i = 1; int j = x / 2; while (i &lt; j) { int mid = (i + j + 1) / 2; // å¤§äºä¸€å®šæ—  if (mid &gt; x / mid){ // ä¸‹ä¸€è½®æœç´¢çš„åŒºé—´æ˜¯ [left, mid - 1] j = mid -1; }else { // ä¸‹ä¸€è½®æœç´¢çš„åŒºé—´æ˜¯ [mid, right] i = mid; } } return i; } 34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®public int[] searchRange(int[] nums, int target) { int i = 0; int j = nums.length - 1; int first = findFirstPosition(nums, target); if(first == 1){ return new int[]{-1, -1}; } int secondPosition = findSecondPosition(nums, target); return new int[]{first, secondPosition}; } public int findFirstPosition(int[] nums, int target) { int i = 0; int j = nums.length - 1; while (i &lt; j) { int mid = (i + j) / 2; // å°äºä¸€å®šæ²¡æœ‰è§£ if (nums[mid] &lt; target) { i = mid + 1; } else { j = mid; } } if (nums[i] == target) { return i; } else { return -1; } } public int findSecondPosition(int[] nums, int target) { int i = 0; int j = nums.length - 1; while (i &lt; j){ int mid = (i + j + 1)/2; if(nums[mid] &gt; target){ j = mid-1; }else { i = mid; } } if (nums[i] == target){ return i; }else { return -1; } } 278. ç¬¬ä¸€ä¸ªé”™è¯¯çš„ç‰ˆæœ¬è‹¥æ˜¯ä¸­é—´ä½ç½®çš„ç‰ˆæœ¬ä¸ºfalse, è¯´æ˜ç¬¬ä¸€ä¸ªé”™è¯¯ç‰ˆæœ¬åœ¨[mid+1, right]; public int firstBadVersion(int n) { int left = 1, right = n; while (left &lt; right) { int mid = left + (right - left) / 2; if (!isBadVersion(mid)) { left = mid + 1; } else { right = mid; } } return left; } References äºŒåˆ†æŸ¥æ‰¾ç®—æ³• ç‰¹åˆ«å¥½ç”¨çš„äºŒåˆ†æŸ¥æ‰¾æ³•æ¨¡æ¿ï¼ˆç¬¬ 2 ç‰ˆï¼‰","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"äºŒåˆ†æœç´¢","slug":"äºŒåˆ†æœç´¢","permalink":"https://winniekun.github.io/tags/%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2/"}]},{"title":"èŠå¤©å®¤çš„BIO NIOå®ç°","slug":"Javaè¿›é˜¶/IO/chat-room","date":"2020-05-21T13:03:39.000Z","updated":"2020-08-30T04:50:22.244Z","comments":true,"path":"chat-room/","link":"","permalink":"https://winniekun.github.io/chat-room/","excerpt":"ç®€æ˜“å®¢æˆ·ç«¯-æœåŠ¡ç«¯","text":"ç®€æ˜“å®¢æˆ·ç«¯-æœåŠ¡ç«¯ æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªServerSocketå®ä¾‹, ç»‘å®šå¯¹åº”çš„ç«¯å£ä¹‹å, åœ¨whileå¾ªç¯ä¸­é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯çš„è¯·æ±‚, å®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸä¹‹å,åˆ›å»ºä¸€ä¸ªè¾“å…¥æµå’Œä¸€ä¸ªè¾“å‡ºæµ å†è¿›è¡Œæ•°æ®äº¤äº’. åˆ›å»ºä¸€ä¸ªServerSocketå¹¶ç»‘å®šç«¯å£ é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚ é“¾æ¥ä¹‹å, äº¤äº’æ•°æ® public static void main(String[] args) { final int DEFAULT_PORT = 8888; final String QUIET = \"quiet\"; ServerSocket server = null; try { server = new ServerSocket(DEFAULT_PORT); System.out.println(\"[å¯åŠ¨æœåŠ¡å™¨ï¼Œ ç›‘å¬ç«¯å£ \" + DEFAULT_PORT + \"]\"); while (true) { // ç­‰å¾…é“¾æ¥ Socket client = server.accept(); System.out.println(\"[å®¢æˆ·ç«¯ \" + client.getPort() + \" å·²ç»é“¾æ¥]\"); BufferedReader reader = new BufferedReader( new InputStreamReader(client.getInputStream())); BufferedWriter writer = new BufferedWriter( new OutputStreamWriter(client.getOutputStream())); // è¯»å–å®¢æˆ·ç«¯æ•°æ® String msg = null; while (((msg = reader.readLine()) != null)) { System.out.println(\"[å®¢æˆ·ç«¯ \" + client.getPort() + \"å‘é€æ•°æ® \" + msg + \"]\"); // è¿”å›ä¸ªå®¢æˆ·ç«¯æ•°æ® writer.write(\"{ echo \" + msg + \"} \\n\"); writer.flush(); if(QUIET.equalsIgnoreCase(msg)){ break; } } } } catch (IOException e) { e.printStackTrace(); } finally { if (server != null) { try { server.close(); } catch (IOException e) { e.printStackTrace(); } } } } å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªSocketå®ä¾‹(æœåŠ¡å™¨åœ°å€, ç«¯å£), ä¹‹åå°†åˆ›å»ºä¸¤ä¸ªè¾“å…¥æµ(ä¸€ä¸ªç”¨äºè¯»å–æœåŠ¡ç«¯å‘é€çš„æ•°æ®, ä¸€ä¸ªç”¨äºè¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®), ä¸€ä¸ªè¾“å‡ºæµ(å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®å‘é€ä¸ªæœåŠ¡ç«¯) åˆ›å»ºSocket é“¾æ¥æœåŠ¡å™¨ å’ŒæœåŠ¡å™¨äº¤äº’ public static void main(String[] args) { final String DEFAULT_SERVER_HOST = \"localhost\"; final String QUIET = \"quiet\"; final int DEFAULT_SERVER_PORT = 8888; try ( Socket client = new Socket(DEFAULT_SERVER_HOST, DEFAULT_SERVER_PORT); // åˆ›å»ºIOæµ BufferedReader reader = new BufferedReader( new InputStreamReader(client.getInputStream())); BufferedWriter writer = new BufferedWriter( new OutputStreamWriter(client.getOutputStream())); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ä¿¡æ¯ BufferedReader consoleReader = new BufferedReader(new InputStreamReader(System.in)); ) { while (true) { // è¯»å–ç”¨æˆ·è¾“å…¥æ•°æ® String input = consoleReader.readLine(); // å‘é€ç»™æœåŠ¡å™¨ writer.write(input + \"\\n\"); writer.flush(); // è¾“å‡ºæœåŠ¡å™¨è¿”å›æ•°æ® String accept = reader.readLine(); System.out.println(\"[æœåŠ¡å™¨ å‘é€æ•°æ® \" + accept + \"]\"); // æŸ¥çœ‹æ˜¯å¦é€€å‡º if(QUIET.equalsIgnoreCase(input)){ break; } } } catch (IOException e) { e.printStackTrace(); } } æ€»ç»“ä¸Šè¿°ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤ç¨‹åºå®Œæˆ,ä½†æ˜¯å› ä¸º server.accept() InputStream.read() OutputStream.write() å‡å­˜åœ¨é˜»å¡é—®é¢˜, å½“æœ‰æ–°çš„å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ—¶,æœåŠ¡ç«¯éœ€è¦æ‰§è¡Œå®Œä¸Šä¸€ä¸ªè¯·æ±‚ä¹‹å,æ‰èƒ½å»æ‰§è¡Œè¿™ä¸ªè¯·æ±‚.æ‰€æœ‰æˆ‘ä»¬å¯ä»¥å°†é˜»å¡çš„éƒ¨åˆ†ç‹¬ç«‹å‡ºæ¥ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ‰§è¡Œè¿™éƒ¨åˆ†å†…å®¹. å°†ç”¨æˆ·çš„è¾“å…¥å¤„ç†ç”¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹å¤„ç† å°†æœåŠ¡ç«¯ä¸­çš„æ•°æ®å¤„ç†ç‹¬ç«‹å‡ºæ¥, åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„çº¿ç¨‹æ¥æ‰§è¡Œå¯¹åº”å®¢æˆ·ç«¯çš„æ•°æ®äº¤äº’ ä¼˜åŒ–1: æœåŠ¡ç«¯ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºçº¿ç¨‹å¤„ç† æœåŠ¡ç«¯Constantç”¨äºå­˜æ”¾ä¸€äº›é™æ€å¸¸é‡ public interface Constant { /** * é»˜è®¤ç«¯å£ */ int DEFAULT_PORT = 8888; /** * IPåœ°å€ */ String DEFAULT_HOST = \"localhost\"; /** * é€€å‡ºå‘½ä»¤ */ String QUIT = \"quit\"; } Serverå’ŒåŸºç¡€çš„ç‰ˆæœ¬æœ‰æ‰€ä¸åŒçš„æ˜¯, æœåŠ¡ç«¯è½¬å‘æ¶ˆæ¯ç»™å®¢æˆ·ç«¯,æ˜¯é™¤äº†å‘é€æ¶ˆæ¯çš„é‚£ä¸ªå®¢æˆ·ç«¯. public class ChatServer implements Constant { private ServerSocket server = null; private ExecutorService executor; private Map&lt;Integer, Writer&gt; connectionClients; public ChatServer() { this.connectionClients = new HashMap&lt;&gt;(); this.executor = Executors.newFixedThreadPool(10); } // æ–°å¢ç”¨æˆ·æ·»åŠ åˆ°map public synchronized void add(Socket socket) throws IOException { if (socket != null) { int port = socket.getPort(); BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream())); connectionClients.put(port, writer); System.out.println(\"å®¢æˆ·ç«¯ [\" + port + \"] å·²ç»è¿æ¥æœåŠ¡å™¨\"); } } // ä¸‹çº¿å®¢æˆ·ç§»é™¤ public synchronized void removeClient(Socket socket) throws IOException { if (socket != null) { int port = socket.getPort(); if (connectionClients.containsKey(port)) { connectionClients.get(port).close(); } connectionClients.remove(port); System.out.println(\"å®¢æˆ·ç«¯ [\" + port + \"]å·²ç»æ–­å¼€è¿æ¥\"); } } // è½¬å‘æ¶ˆæ¯ public synchronized void forwardMSG(Socket socket, String msg) throws IOException { // è½¬å‘ç»™é™¤å»å‘é€è€…çš„å…¶ä»–åœ¨çº¿ç”¨æˆ· for (Integer integer : connectionClients.keySet()) { if (!integer.equals(socket.getPort())) { Writer writer = connectionClients.get(integer); writer.write(msg); writer.flush(); } } } // å…¨éƒ¨è½¬å‘ public synchronized void forwardAllMSG(String msg) throws IOException { for (Integer integer : connectionClients.keySet()) { connectionClients.get(integer).write(msg); connectionClients.get(integer).flush(); } } public synchronized void close(){ if(server != null){ try { server.close(); System.out.println(\"å…³é—­æœåŠ¡å™¨\"); } catch (IOException e) { e.printStackTrace(); } } } public void start() { try { // ç»‘å®šç›‘å¬ç«¯å£ server = new ServerSocket(DEFAULT_PORT); System.out.println(\"[å¯åŠ¨æœåŠ¡å™¨ï¼Œ ç›‘å¬ç«¯å£ \" + DEFAULT_PORT + \"]\"); while (true) { // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ Socket socket = server.accept(); // åˆ›å»ºæ–°çš„çº¿ç¨‹, ç”¨äºå¤„ç†å®¢æˆ·ç«¯æ•°æ® new Thread(new ChatHandler(socket, this)).start(); //executor.execute(new ChatHandler(socket, this)); } } catch (IOException e) { e.printStackTrace(); }finally { close(); } } public static void main(String[] args) { ChatServer server = new ChatServer(); server.start(); } } ChatHandlerç”¨äºå¤„ç†å’Œå®¢æˆ·ç«¯äº¤äº’çš„çº¿ç¨‹ public class ChatHandler implements Runnable, Constant { Socket client; ChatServer chatServer; public ChatHandler(Socket socket, ChatServer chatServer){ this.client = socket; this.chatServer = chatServer; } @Override public void run() { try { // å­˜å‚¨æ–°ä¸Šçº¿ç”¨æˆ· chatServer.add(client); BufferedReader reader = new BufferedReader(new InputStreamReader(client.getInputStream())); String msg = null; while ((msg = reader.readLine()) != null){ // è¯»å…¥å®¢æˆ·ç«¯çš„æ¶ˆæ¯ String fwdMSG = \"å®¢æˆ·ç«¯ [\" + client.getPort() + \"] æ¶ˆæ¯ä¸º \" + msg + \"\\n\"; System.out.print(fwdMSG); // è¯»å‡ºè½¬å‘ç»™å…¶ä»–çš„å®¢æˆ·ç«¯ chatServer.forwardMSG(client, fwdMSG); // æ£€æµ‹æ˜¯å¦é€€å‡º if(QUIT.equalsIgnoreCase(msg)){ break; } } } catch (IOException e) { e.printStackTrace(); }finally { try { chatServer.removeClient(client); } catch (IOException e) { e.printStackTrace(); } } } } å®¢æˆ·ç«¯é™¤äº†å°†æ•°æ®å‘é€ç»™æœåŠ¡ç«¯ä»¥åŠæ¥å—æœåŠ¡ç«¯çš„æ•°æ®,è¿˜éœ€è¦ä¸€ä¸ªæ¥å—ç”¨æˆ·äº§ç”Ÿçš„æ•°æ®çš„çº¿ç¨‹ Clientpublic class ChatClient implements Constant { private Socket socket; private BufferedReader reader; private BufferedWriter writer; // å‘é€ç»™æœåŠ¡å™¨æ•°æ® public void send(String msg) throws IOException { if (!socket.isOutputShutdown()) { writer.write(msg + \"\\n\"); writer.flush(); } } // æ¥å—æœåŠ¡å™¨è½¬å‘çš„ä¿¡æ¯ public String receive() throws IOException { String msg = null; if (!socket.isInputShutdown()) { msg = reader.readLine(); } return msg; } // å…³é—­ public void close() { if (writer != null) { try { System.out.println(\"å®¢æˆ·ç«¯\" + socket.getLocalPort() + \"å…³é—­\"); writer.close(); } catch (IOException e) { e.printStackTrace(); } } } // å‡†å¤‡é€€å‡º public boolean readyQuit(String s) { return s.equalsIgnoreCase(QUIT); } // å¼€å§‹ public void start() { try { socket = new Socket(DEFAULT_HOST, DEFAULT_PORT); writer = new BufferedWriter(new OutputStreamWriter(socket.getOutputStream())); reader = new BufferedReader(new InputStreamReader(socket.getInputStream())); // ç­‰å¾…ç”¨æˆ·è¾“å…¥ä¿¡æ¯ new Thread(new UserInputHandler(this)).start(); // è¯»å–æœåŠ¡å™¨æ•°æ® String msg = null; while ((msg = receive()) != null){ System.out.println(msg); } } catch (IOException e) { e.printStackTrace(); } finally { close(); } } public static void main(String[] args) { ChatClient chatClient = new ChatClient(); chatClient.start(); } } UserInputHandlerpublic class UserInputHandler implements Runnable, Constant { ChatClient chatClient; public UserInputHandler(ChatClient chatClient) { this.chatClient = chatClient; } @Override public void run() { try { // ç­‰å¾…ç”¨æˆ·è¾“å…¥ BufferedReader consoleReader = new BufferedReader( new InputStreamReader(System.in)); while (true) { // è·å–ç”¨æˆ·è¾“å…¥æ•°æ® String input = consoleReader.readLine(); // å‘æœåŠ¡å™¨å‘é€è¾“å…¥æ•°æ® chatClient.send(input); if(chatClient.readyQuit(input)){ break; } } } catch (IOException e) { e.printStackTrace(); } } } æ€»ç»“è¯¥æ¨¡å‹æœ€å¤§çš„é—®é¢˜å°±æ˜¯ç¼ºä¹å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›ï¼Œå½“å®¢æˆ·ç«¯å¹¶å‘è®¿é—®é‡å¢åŠ åï¼ŒæœåŠ¡ç«¯çš„çº¿ç¨‹ä¸ªæ•°å’Œå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°å‘ˆ1:1çš„æ­£æ¯”å…³ç³»ï¼ŒJavaä¸­çš„çº¿ç¨‹ä¹Ÿæ˜¯æ¯”è¾ƒå®è´µçš„ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ•°é‡å¿«é€Ÿè†¨èƒ€åï¼Œç³»ç»Ÿçš„æ€§èƒ½å°†æ€¥å‰§ä¸‹é™ï¼Œéšç€è®¿é—®é‡çš„ç»§ç»­å¢å¤§ï¼Œç³»ç»Ÿæœ€ç»ˆå°±æ­»æ‰äº†ã€‚ ä¼˜åŒ–2: æœåŠ¡ç«¯ä½¿ç”¨çº¿ç¨‹æ± æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸ºäº†æ”¹è¿›è¿™ç§ä¸€è¿æ¥ä¸€çº¿ç¨‹çš„æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†è¿™äº›çº¿ç¨‹ï¼Œå®ç°ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚çš„æ¨¡å‹ï¼ˆæœåŠ¡ç«¯çš„çº¿ç¨‹ä¸ªæ•°å’Œå®¢æˆ·ç«¯å¹¶å‘è®¿é—®æ•°å‘ˆM:Nçš„å…³ç³»ï¼ŒNå¯ä»¥è¿œè¿œå¤§äºMï¼Œä½†æ˜¯åº•å±‚è¿˜æ˜¯ä½¿ç”¨çš„åŒæ­¥é˜»å¡I/Oï¼‰ï¼Œé€šå¸¸è¢«ç§°ä¸ºâ€œä¼ªå¼‚æ­¥I/Oæ¨¡å‹â€œã€‚ä¼ªå¼‚æ­¥I/Oæ¨¡å‹å›¾ï¼š å’Œä¼˜åŒ–1ç»å¤§å¤šæ•°éƒ¨åˆ†çš„ä»£ç æ˜¯ç±»ä¼¼çš„,æ‰€ä»¥åªå±•ç¤ºæœåŠ¡ç«¯éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ† private ExecutorService executor; public void start() { try { // ç»‘å®šç›‘å¬ç«¯å£ server = new ServerSocket(DEFAULT_PORT); System.out.println(\"[å¯åŠ¨æœåŠ¡å™¨ï¼Œ ç›‘å¬ç«¯å£ \" + DEFAULT_PORT + \"]\"); while (true) { // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ Socket socket = server.accept(); // åˆ›å»ºæ–°çš„çº¿ç¨‹, ç”¨äºå¤„ç†å®¢æˆ·ç«¯æ•°æ® new Thread(new ChatHandler(socket, this)).start(); executor.execute(new ChatHandler(socket, this)); } } catch (IOException e) { e.printStackTrace(); }finally { close(); } } ä¼˜åŒ–3: NIOæœåŠ¡ç«¯public class ChatServer implements NioConstant { private ServerSocketChannel server; private Selector selector; // è¯»å– buffer private ByteBuffer rBuffer = ByteBuffer.allocate(BUFFER); // å†™å…¥ buffer private ByteBuffer wBuffer = ByteBuffer.allocate(BUFFER); private Charset charset = Charset.forName(\"UTF-8\"); // è‡ªå®šä¹‰ç«¯å£ private int port; public ChatServer(){ this(DEFAULT_PORT); } public ChatServer(int port){ this.port = port; } public void start(){ try { // æ‰“å¼€ä¸€ä¸ªServerSocket çš„ Channel server = ServerSocketChannel.open(); // è®¾ç½®éé˜»å¡ server.configureBlocking(false); // å¾—åˆ°ä¸€ä¸ªå…³äºè¯¥ServerSocketChannelçš„ServerSocketã€å¹¶ä¸”ç»‘å®šç«¯å£ server.socket().bind(new InetSocketAddress(port)); // æ‰“å¼€Selector selector = Selector.open(); // æŠŠServerSocketChannelæ³¨å†Œåˆ°Selector ï¼Œ è®¾ç½®ç›‘å¬äº‹ä»¶ä¸ºACCEPT server.register(selector , SelectionKey.OP_ACCEPT); System.out.println(\"å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼š\"+ port +\"...\"); while(true){ // æœ¬èº«æ˜¯é˜»å¡å¼è°ƒç”¨ selector.select(); // è§¦å‘äº‹ä»¶é›† Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); for(SelectionKey key : selectionKeys){ // å¤„ç†è¢«è§¦å‘çš„äº‹ä»¶ handles(key); } // å¤„ç†å®Œæˆåï¼Œæ‰‹åŠ¨æ¸…ç©º selectionKeys.clear(); } } catch (IOException e) { e.printStackTrace(); } finally{ close(selector); } } private boolean readyToQuit(String msg){ return QUIT.equalsIgnoreCase(msg); } private synchronized void close(Closeable closeable){ if(closeable != null){ try { closeable.close(); } catch (IOException e) { e.printStackTrace(); } } } private String receive(SocketChannel client) throws IOException { // å†™æ¨¡å¼ rBuffer.clear(); while((client.read(rBuffer)) &gt; 0); // è¯»æ¨¡å¼ rBuffer.flip(); return String.valueOf(charset.decode(rBuffer)); } private void forwardMessage(SocketChannel client , String fwdMsg) throws IOException { for(SelectionKey key : selector.keys()){ Channel connectedClient = key.channel(); if(connectedClient instanceof ServerSocketChannel){ continue; } if(key.isValid() &amp;&amp; !client.equals(connectedClient)){ // å†™æ¨¡å¼ wBuffer.clear(); wBuffer.put(charset.encode(getClientName(client) +\":\"+fwdMsg)); // è¯»æ¨¡å¼ wBuffer.flip(); while(wBuffer.hasRemaining()){ ((SocketChannel) connectedClient).write(wBuffer); } } } } private String getClientName(SocketChannel client){ return \"å®¢æˆ·ç«¯[\"+client.socket().getPort()+\"]\"; } private void handles(SelectionKey key) throws IOException { // ACCEPTäº‹ä»¶ - å’Œå®¢æˆ·ç«¯å»ºç«‹äº†è¿æ¥ if(key.isAcceptable()){ ServerSocketChannel server = (ServerSocketChannel) key.channel(); SocketChannel client = server.accept(); // è®¾ç½®æˆéé˜»å¡ client.configureBlocking(false); client.register(selector , SelectionKey.OP_READ); System.out.println(getClientName(client)+\"å·²è¿æ¥\"); } // READäº‹ä»¶ - å®¢æˆ·ç«¯å‘é€äº†æ¶ˆæ¯ else if(key.isReadable()){ SocketChannel client = (SocketChannel) key.channel(); String fwdMsg = receive(client); if(fwdMsg.isEmpty()){ // å®¢æˆ·ç«¯å¼‚å¸¸ , ä¸å†ç›‘å¬è¿™ä¸ªäº‹ä»¶ key.cancel(); // æ›´æ–°ç›‘å¬äº‹ä»¶çŠ¶æ€ selector.wakeup(); } else{ forwardMessage(client , fwdMsg); // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‡†å¤‡é€€å‡º if(readyToQuit(fwdMsg)){ key.cancel(); selector.wakeup(); System.out.println(getClientName(client)+\"å·²æ–­å¼€\"); } } } } public static void main(String[] args) { ChatServer server = new ChatServer(); server.start(); } } å®¢æˆ·ç«¯public class ChatClient implements NioConstant { private String host; private int port; private SocketChannel client; private ByteBuffer rBuffer = ByteBuffer.allocate(BUFFER); private ByteBuffer wBuffer = ByteBuffer.allocate(BUFFER); private Selector selector; private Charset charset = Charset.forName(\"UTF-8\"); public ChatClient(){ this(DEFAULT_HOST , DEFAULT_PORT); } public ChatClient(String host , int port){ this.host = host; this.port = port; } // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‡†å¤‡é€€å‡º public boolean readyQuit(String msg){ return QUIT.equalsIgnoreCase(msg); } public void close(Closeable closeable){ if(closeable != null){ try { closeable.close(); } catch (IOException e) { e.printStackTrace(); } } } public void start(){ try { selector = Selector.open(); client = SocketChannel.open(); // è®¾ç½®éé˜»å¡ client.configureBlocking(false); client.register(selector , SelectionKey.OP_CONNECT); client.connect(new InetSocketAddress(host , port)); while(true){ selector.select(); Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); for(SelectionKey key : selectionKeys){ handles(key); } } } catch (IOException e) { e.printStackTrace(); } catch (ClosedSelectorException e){ // ç”¨æˆ·æ­£å¸¸é€€å‡ºï¼Œäº§ç”Ÿçš„å¼‚å¸¸ } finally { close(selector); } } private void handles(SelectionKey key) throws IOException { // CONNECTäº‹ä»¶ - è¿æ¥å°±ç»ªäº‹ä»¶ if(key.isConnectable()){ SocketChannel client = (SocketChannel) key.channel(); if(client.isConnectionPending()){ client.finishConnect(); // å¤„ç†ç”¨æˆ·çš„è¾“å…¥ new Thread(new UserInputHandler(this)).start(); } client.register(selector , SelectionKey.OP_READ); } // READäº‹ä»¶ - æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯ else if(key.isReadable()){ SocketChannel client = (SocketChannel) key.channel(); String msg = receive(client); if(msg.isEmpty()){ // æœåŠ¡å™¨å¼‚å¸¸ close(selector); } else{ System.out.println(msg); } } } private String receive(SocketChannel client) throws IOException { // å†™æ¨¡å¼ rBuffer.clear(); while(client.read(rBuffer) &gt; 0); // å†™æ¨¡å¼ rBuffer.flip(); return String.valueOf(charset.decode(rBuffer)); } public void send(String msg) throws IOException { if(msg.isEmpty()){ return ; } // å†™æ¨¡å¼ wBuffer.clear(); wBuffer.put(charset.encode(msg)); wBuffer.flip(); while(wBuffer.hasRemaining()){ client.write(wBuffer); } // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å‡†å¤‡é€€å‡º if(readyQuit(msg)){ close(selector); } } public static void main(String[] args) { ChatClient client = new ChatClient(); client.start(); } }","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"I/O","slug":"I-O","permalink":"https://winniekun.github.io/tags/I-O/"}]},{"title":"Javaçš„å‡ ç§æ–‡ä»¶æ‹·è´æ–¹å¼","slug":"JavaåŸºç¡€/é¢è¯•36è®²/copy-methods-of-java","date":"2020-05-14T03:18:51.000Z","updated":"2021-09-12T13:35:17.254Z","comments":true,"path":"copy-methods-of-java/","link":"","permalink":"https://winniekun.github.io/copy-methods-of-java/","excerpt":"å‰è¨€","text":"å‰è¨€ Javaä¸­æ–‡ä»¶çš„æ‹·è´æ–¹å¼ï¼Œå¤§ä½“ä¸Šåˆ†ä¸ºä¸¤ä¸ªæ´¾ç³» streamçš„æ–¹å¼å®ç°æ‹·è´ NIOçš„æ–¹å¼å®ç°æ‹·è´ ä»¥ä¸‹ä¸¾ä¾‹å››ä¸ªç»å…¸çš„æ‹·è´æ–¹å¼çš„å®ç°ï¼Œå°½ç®¡Javaä¸­æœ‰è‡ªå·±çš„Copyå®ç°ï¼Œè¿˜æ˜¯æƒ³ä½¿ç”¨BIOæˆ–NIOå®ç°ä¸‹é¢çš„å››ä¸ªæ–¹å¼ å››ç§æ‹·è´æ–¹å¼æ— Bufferçš„è¾“å…¥è¾“å‡ºæµæ‹·è´æ–¹å¼public class NoBufferStreamCopy implements FileCopyRunner { @Override public void copyFile(File source, File target) { try ( InputStream input = new FileInputStream(source); OutputStream output = new FileOutputStream(target); ) { int read; while ((read = input.read())!= -1){ output.write(read); } } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } @Override public String toString() { return \"NoBufferStreamCopy\"; } } æœ‰Bufferçš„è¾“å…¥è¾“å‡ºæµæ‹·è´æ–¹å¼public class BufferStreamCopy implements FileCopyRunner { @Override public void copyFile(File source, File target) { try ( InputStream input = new FileInputStream(source); OutputStream output = new FileOutputStream(target); ) { byte[] buffer = new byte[1024]; int leng; while ((leng = input.read(buffer)) != -1){ output.write(buffer, 0, leng); } } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } @Override public String toString() { return \"BufferStreamCopy\"; } } NIOåŸºç¡€çš„æ‹·è´å®ç°public class NioBufferCopy implements FileCopyRunner { @Override public void copyFile(File source, File target) { try ( FileChannel input = new FileInputStream(source).getChannel(); FileChannel output = new FileOutputStream(target).getChannel(); ) { ByteBuffer buffer = ByteBuffer.allocate(1024); while (input.read(buffer) != -1){ buffer.flip(); while (buffer.hasRemaining()) { output.write(buffer); } buffer.clear(); } } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } @Override public String toString() { return \"NioBufferCopy\"; } } NIO Transferå®ç°æ‹·è´public class NioTransferCopy implements FileCopyRunner { @Override public void copyFile(File source, File target) { try ( FileChannel inputChannel = new FileInputStream(source).getChannel(); FileChannel ouputChannel = new FileOutputStream(target).getChannel(); ) { for (long count = inputChannel.size(); count &gt; 0;) { long transferTo = inputChannel.transferTo(inputChannel.position(), count, ouputChannel); count -= transferTo; } } catch (FileNotFoundException e) { e.printStackTrace(); } catch (IOException e) { e.printStackTrace(); } } @Override public String toString() { return \"NioTransferCopy\"; } } å¯¹æ¯”æµ‹è¯•ç±»public class FileCopyDemo { private static final int ROUNDS = 5; private static final File sourceBig = new File(\"/home/kongweikun/Downloads/test/ccc.txt\"); private static final File sourceMid = new File(\"/home/kongweikun/Downloads/test/bbb.txt\"); private static final File sourceSmal = new File(\"/home/kongweikun/Downloads/test/aaa.txt\"); private static final File target = new File(\"/home/kongweikun/Downloads/test/ddd.txt\"); public static void benchMark(FileCopyRunner test, File source, File target, String name) { long elapsed = 0L; for (int i = 0; i &lt; ROUNDS; i++) { long start = System.currentTimeMillis(); test.copyFile(source, target); elapsed = System.currentTimeMillis() - start; // åˆ é™¤copyä¹‹åçš„æ–‡ä»¶ target.delete(); } System.out.println(test + name + \" : \" + elapsed / ROUNDS + \"æ¯«ç§’\"); } public static void main(String[] args) { FileCopyRunner noBufferStreamCopy = new NoBufferStreamCopy(); FileCopyRunner bufferedStreamCopy = new BufferStreamCopy(); FileCopyRunner nioBufferCopy = new NioBufferCopy(); FileCopyRunner nioTransferCopy = new NioTransferCopy(); // æµ‹è¯• 1 System.out.println(\"-----------------------------------------\"); System.out.println(\"æ— Bufferçš„BIO\"); benchMark(noBufferStreamCopy, sourceBig, target, \"å¤§æ–‡ä»¶\"); benchMark(noBufferStreamCopy, sourceMid, target, \"ä¸­ç­‰æ–‡ä»¶\"); benchMark(noBufferStreamCopy, sourceSmal, target, \"å°æ–‡ä»¶\"); System.out.println(\"-----------------------------------------\"); System.out.println(\"æœ‰Bufferçš„BIO\"); benchMark(bufferedStreamCopy, sourceBig, target, \"å¤§æ–‡ä»¶\"); benchMark(bufferedStreamCopy, sourceMid, target, \"ä¸­ç­‰æ–‡ä»¶\"); benchMark(bufferedStreamCopy, sourceSmal, target, \"å°æ–‡ä»¶\"); // System.out.println(\"-----------------------------------------\"); System.out.println(\"NIOåŸºç¡€\"); benchMark(nioBufferCopy, sourceBig, target, \"å¤§æ–‡ä»¶\"); benchMark(nioBufferCopy, sourceMid, target, \"ä¸­ç­‰æ–‡ä»¶\"); benchMark(noBufferStreamCopy, sourceSmal, target, \"å°æ–‡ä»¶\"); System.out.println(\"-----------------------------------------\"); System.out.println(\"NIOçš„TransferTo\"); benchMark(nioTransferCopy, sourceBig, target, \"å¤§æ–‡ä»¶\"); benchMark(nioTransferCopy, sourceMid, target, \"ä¸­ç­‰æ–‡ä»¶\"); benchMark(nioTransferCopy, sourceSmal, target, \"å°æ–‡ä»¶\"); } } ----------------------------------------- æ— Bufferçš„BIO NoBufferStreamCopyå¤§æ–‡ä»¶ : 614æ¯«ç§’ NoBufferStreamCopyä¸­ç­‰æ–‡ä»¶ : 0æ¯«ç§’ NoBufferStreamCopyå°æ–‡ä»¶ : 0æ¯«ç§’ ----------------------------------------- æœ‰Bufferçš„BIO BufferStreamCopyå¤§æ–‡ä»¶ : 1æ¯«ç§’ BufferStreamCopyä¸­ç­‰æ–‡ä»¶ : 0æ¯«ç§’ BufferStreamCopyå°æ–‡ä»¶ : 0æ¯«ç§’ ----------------------------------------- NIOåŸºç¡€ NioBufferCopyå¤§æ–‡ä»¶ : 1æ¯«ç§’ NioBufferCopyä¸­ç­‰æ–‡ä»¶ : 0æ¯«ç§’ NoBufferStreamCopyå°æ–‡ä»¶ : 0æ¯«ç§’ ----------------------------------------- NIOçš„TransferTo NioTransferCopyå¤§æ–‡ä»¶ : 0æ¯«ç§’ NioTransferCopyä¸­ç­‰æ–‡ä»¶ : 0æ¯«ç§’ NioTransferCopyå°æ–‡ä»¶ : 0æ¯«ç§’ æ€»ç»“å¯¹äº Copy çš„æ•ˆç‡,è¿™ä¸ªå…¶å®ä¸æ“ä½œç³»ç»Ÿå’Œé…ç½®ç­‰æƒ…å†µç›¸å…³,æ€»ä½“ä¸Šæ¥è¯´,NIOtransferTo/From çš„æ–¹å¼å¯èƒ½æ›´å¿«,å› ä¸ºå®ƒæ›´èƒ½åˆ©ç”¨ç°ä»£æ“ä½œç³»ç»Ÿåº•å±‚æœºåˆ¶,é¿å…ä¸å¿…è¦æ‹·è´å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ä¸åŒçš„ copy æ–¹å¼,åº•å±‚æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«?è¿™é‡Œæ¶‰åŠåˆ°äº†ç”¨æˆ·æ€ç©ºé—´å’Œå†…æ ¸æ€ç©ºé—´,è¿™æ˜¯æ“ä½œç³»ç»Ÿå±‚é¢çš„åŸºæœ¬æ¦‚å¿µ,æ“ä½œç³»ç»Ÿå†…æ ¸ã€ç¡¬ä»¶é©±åŠ¨ç­‰è¿è¡Œåœ¨å†…æ ¸æ€ç©ºé—´,å…·æœ‰ç›¸å¯¹é«˜çš„ç‰¹æƒ.è€Œç”¨æˆ·æ€ç©ºé—´,åˆ™æ˜¯ç»™æ™®é€šåº”ç”¨å’ŒæœåŠ¡ä½¿ç”¨. å½“æˆ‘ä»¬ä½¿ç”¨è¾“å…¥è¾“å‡ºæµçš„è¿›è¡Œè¯»å†™çš„æ—¶å€™,å®é™…ä¸Šç»å†äº†å¤šæ¬¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢: åº”ç”¨æ•°æ®çš„è¯»å–: é¦–å…ˆå†…æ ¸æ€å°†æ•°æ®ä»ç£ç›˜è¯»å–åˆ°å†…æ ¸ç¼“å­˜,å†åˆ‡æ¢åˆ°ç”¨æˆ·æ€å°†æ•°æ®ä»å†…æ ¸ç¼“å­˜è¯»å–åˆ°ç”¨æˆ·ç¼“å­˜ ç”¨æˆ·æ€-å†…æ ¸æ€ æ‰€ä»¥,è¿™ç§æ–¹å¼ä¼šå¸¦æ¥ä¸€å®šçš„é¢å¤–å¼€é”€,å¯èƒ½ä¼šé™ä½ IO æ•ˆç‡ã€‚ ä½†æ˜¯NIOçš„transferToçš„å®ç°, ä¼šæ¶‰åŠåˆ°é›¶æ‹·è´, ä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“å¹¶ä¸ä¼šæ¶‰åŠåˆ°ç”¨æˆ·æ€,çœå»äº†ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œä¸å¿…è¦çš„æ‹·è´. transferToçš„ä¼ è¾“è¿‡ç¨‹æ˜¯:","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"},{"name":"é¢è¯•36è®²","slug":"é¢è¯•36è®²","permalink":"https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"}]},{"title":"æ¥å£å’ŒæŠ½è±¡ç±»çš„åŒºåˆ«","slug":"JavaåŸºç¡€/é¢è¯•36è®²/interface-Abstarct-diff","date":"2020-05-13T13:03:31.000Z","updated":"2020-08-30T04:50:22.244Z","comments":true,"path":"interface-Abstarct-diff/","link":"","permalink":"https://winniekun.github.io/interface-Abstarct-diff/","excerpt":"æ¥å£","text":"æ¥å£ æ¥å£æ˜¯ä¸æ˜¯ç±»ï¼Œæ˜¯å¯¹ç±»çš„ä¸€ç»„éœ€æ±‚çš„æè¿°ï¼Œè¿™äº›ç±»è¦éµä»æ¥å£æè¿°çš„åŒä¸€æ ¼å¼è¿›è¡Œå®šä¹‰ï¼ˆå…¶æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ï¼Œæ˜¯æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼‰ã€‚æœ‰ä¸¤ä¸ªæ–¹é¢çš„èŒè´£ï¼š æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼ˆä¸»è¦ï¼‰ å£°æ˜æŸäº›ä¸œè¥¿ï¼ˆMark Interfaceï¼‰ é€šè¿‡æ¥å£ï¼Œå¯ä»¥è¾¾åˆ°APIå’Œå®ç°çš„åˆ†ç¦»ï¼Œè­¬å¦‚MVCä¸­çš„daoå±‚æˆ–serviceå±‚ï¼Œä½†æ˜¯ä¸èƒ½å®ä¾‹åŒ–ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½åŒ…å«ä»»ä½•éå¸¸é‡æˆå‘˜ï¼Œæ‰€ä»¥ï¼Œä¹Ÿéšå«è¡¨æ˜ï¼Œä»»ä½•çš„fieldéƒ½å…·æœ‰public static finalçš„æ„ä¹‰ã€‚åŒæ—¶å¯¹äºæ–¹æ³•æ¥è¯´ï¼Œæ¥å£ä¸­è¦ä¹ˆæ˜¯æŠ½è±¡æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯é™æ€æ–¹æ³•ã€‚å¦‚Collectionæ¡†æ¶ä¸­root interface java.util.Collection ç–‘é—®1ï¼šä¸ºä»€ä¹ˆå¸¸é‡æˆå‘˜é»˜è®¤ä¿®é¥°ä¸ºpublic static final æ¥å£å¿…é¡»è¦å…·ä½“ç±»å®ç°æ‰æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯publicã€‚ æ¥å£ä¸­çš„å±æ€§å¯¹æ‰€æœ‰å®ç°ç±»åªæœ‰ä¸€ä»½ï¼Œæ‰€ä»¥æ˜¯staticã€‚ è¦ä½¿å®ç°ç±»ä¸ºäº†å‘ä¸Šè½¬å‹æˆåŠŸï¼Œæ‰€ä»¥å¿…é¡»æ˜¯finalçš„ã€‚ ç–‘é—®2ï¼šä¸ºä»€ä¹ˆæ–¹æ³•è¦ä¹ˆæ˜¯æŠ½è±¡æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯é™æ€æ–¹æ³• æŠ½è±¡æ–¹æ³•å’Œæ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§åè®®æˆ–è€…è§„èŒƒã€‚æ¯”å¦‚æˆ‘ä»¬æ˜¯è¡Œä¸šçš„è¾¾äººï¼Œéœ€è¦å®šä¹‰è½¦çš„è§„èŒƒï¼Œå®ƒèƒ½å¯åŠ¨ã€è·‘èµ·æ¥ã€åˆ¹è½¦å’Œåœæ­¢ï¼Œè¿™4é¡¹åŠŸèƒ½å°±æ˜¯æŠ½è±¡æ–¹æ³•ã€‚è‡³äºç”¨ä»€ä¹ˆå¼•æ“å¯åŠ¨ã€è·‘åœ°å¤šå¿«ã€æ€ä¹ˆåˆ¹è½¦ï¼Œæˆ‘ä»¬å°±ä¸æƒ³ç®¡äº†ï¼Œä½ çˆ±æ€ä¹ˆå®ç°æ˜¯ä½ çš„äº‹ï¼Œä½†ä½ å¿…é¡»å®ç°æˆ‘ä»¬å®šä¹‰å¥½çš„æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™ä½ ç”Ÿäº§çš„å°±ä¸æ˜¯è½¦å­äº†ã€‚ ä»¥æœ€å¸¸ç”¨çš„java.util.Listä¸ºä¾‹ï¼Œå®ƒçš„ç»§æ‰¿æ ‘åŠå…¶åºå¤§ã€‚ä½†è¿™äº›å®ç°ç±»å’Œç»§æ‰¿ç±»ï¼Œéƒ½æœ‰å…±åŒçš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯Listå®šä¹‰çš„æ–¹æ³•ï¼Œæ¯”å¦‚get/add/remove/sizeã€‚è¿™æ ·å°±ä¿è¯äº†åç»­å­å­™éƒ½æ˜¯ä¸€ä¸ªæ¨¡æ ·çš„ï¼Œä½†æœ‰ä¸ªæ€§ã€‚ List list = new å®ç°ç±»();list.add(obj);list.get(0);int size = list.size();// è¿™è¡Œä»£ç ä¸éœ€è¦ä¿®æ”¹å®ç°ç±»å¯ä»¥æ˜¯ArrayListï¼Œä¹Ÿå¯ä»¥æ˜¯LinkedListï¼Œæˆ–è€…æ˜¯çº¿ç¨‹å®‰å…¨çš„CopyOnWriteArrayListã€‚çˆ±æ¢é‚£ä¸ªæ¢é‚£ä¸ªï¼Œä½†ç¬¬äºŒè¡Œçš„ä»£ç ä¸éœ€è¦ä¿®æ”¹ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨äº†Listçš„è§„èŒƒã€‚ 1ã€æ¥å£æ˜¯ä¸€ç§çº¦æŸå’Œè§„èŒƒï¼Œæ˜¯ä¸€ç§æ›´åŠ æ›´é«˜çº§çš„æŠ½è±¡ç±»ï¼ŒæŠ½è±¡ç±»çš„æ–¹æ³•å¿…é¡»æ˜¯å…¬å¼€çš„ï¼Œå› ä¸ºè¦ç»™äººç»§æ‰¿å’Œä½¿ç”¨å•Šï¼Œä¸ç”¨publicï¼Œåˆ«äººæ€ä¹ˆçœ‹å¾—åˆ°ï¼Œæ‰€ä»¥åœ¨æ¥å£å®ç°æ—¶ï¼Œå®šä¹‰çš„æ–¹æ³•ä¿®é¥°ç¬¦å¿…é¡»æ˜¯publicï¼›å› æ­¤å­ç±»åœ¨å®ç°æ¥å£é‡å†™æ–¹æ³•æ—¶çš„ä¿®é¥°ç¬¦å¿…é¡»æ˜¯publicã€‚2ã€å¦å¤–å†æ‰©å±•ä¸€ä¸‹ï¼Œæ¥å£ä¸­æ²¡æœ‰å˜é‡ï¼ˆæ—¢ç„¶æ˜¯çº¦æŸå’Œè§„èŒƒï¼Œæ€ä¹ˆèƒ½å¤Ÿå®šä¹‰ä¸€ä¸ªå¤§å®¶éƒ½å¯ä»¥æ”¹çš„ä¸œè¥¿å‘¢ï¼Ÿï¼‰ï¼Œåªèƒ½æ˜¯å¸¸é‡ï¼Œæ¥å£ä¸­å®šä¹‰å¸¸é‡é»˜è®¤çš„ä¿®é¥°ç¬¦ä¸ºpublic static finalã€‚ æŠ½è±¡ç±»ç±»ä¼¼äºæ¨¡æ¿ï¼Œä½†åˆä¸åŒï¼Œç›®çš„æ˜¯æé«˜ä»£ç çš„å¤ç”¨ï¼Œå…¶æŠ½å–äº†ç›¸å…³çš„Javaç±»çš„å…±ç”¨æ–¹æ³•ï¼Œæˆ–å…±ç”¨çš„æˆå‘˜å˜é‡ï¼Œé€šè¿‡ç»§æ‰¿çš„æ–¹æ³•è¾¾åˆ°ä»£ç å¤ç”¨ç›®çš„ã€‚è­¬å¦‚Collectionæ¡†æ¶ä¸­çš„å„ç§AbstractXXXç±»ã€‚æŠ½è±¡ç±»é™¤äº†ä¸èƒ½å®ä¾‹åŒ–ï¼Œå½¢å¼ä¸Šå’ŒJavaç±»æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ æ€»ç»“æ¥å£ï¼š åªæœ‰å¸¸é‡ æ–¹æ³•è¦ä¹ˆæ˜¯æŠ½è±¡æ–¹æ³•ã€è¦ä¹ˆæ˜¯é™æ€æ–¹æ³• ä¸èƒ½è¢«å®ä¾‹åŒ– ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ æŠ½è±¡ç±»ï¼š é™¤äº†ä¸èƒ½å®ä¾‹åŒ–ï¼Œå…¶ä»–å’Œæ™®é€šç±»æ²¡å¤ªå¤§åŒºåˆ« ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆJava ä¸æ”¯æŒå¤šç»§æ‰¿ï¼‰ æ ¸å¿ƒåŒºåˆ« è¡Œä¸ºè§„èŒƒ: æ¥å£ é€šç”¨åŠŸèƒ½: æŠ½è±¡ åœ¨ä¸€äº›æƒ…å†µä¸‹å­˜åœ¨ç‰¹å®šåœºæ™¯,éœ€è¦æŠ½è±¡å‡ºä¸å…·ä½“å®ç°ã€å®ä¾‹åŒ–æ— å…³çš„é€šç”¨é€»è¾‘,æˆ–è€…çº¯è°ƒç”¨å…³ç³»çš„é€»è¾‘ï¼Œè¿™æ ·çš„è¯ï¼Œå› ä¸ºJavaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œå°±æ— æ³•ä½¿ç”¨æŠ½è±¡ç±»è¿›è¡Œå®ç°ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯å®ç°ç”±é™æ€æ–¹æ³•æ„æˆçš„å·¥å…·ç±»ï¼Œæ¯”å¦‚java.util.Collections æ¥å£çš„èŒè´£ä¹Ÿä¸ä»…ä»…é™äºæŠ½è±¡æ–¹æ³•çš„é›†åˆ,å…¶å®æœ‰å„ç§ä¸åŒçš„å®è·µã€‚æœ‰ä¸€ç±»æ²¡æœ‰ä»»ä½•æ–¹æ³•çš„æ¥å£,é€šå¸¸å«ä½œ Marker Interface,é¡¾åæ€ä¹‰,å®ƒçš„ç›®çš„å°±æ˜¯ä¸ºäº†å£°æ˜æŸäº›ä¸œè¥¿,æ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„ Cloneableã€Serializable ç­‰ã€‚è¿™ç§ç”¨æ³•,ä¹Ÿå­˜åœ¨äºä¸šç•Œå…¶ä»–çš„ Java äº§å“ä»£ç ä¸­ã€‚ References Javaæ ¸å¿ƒå·I","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"},{"name":"é¢è¯•36è®²","slug":"é¢è¯•36è®²","permalink":"https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"}]},{"title":"JDKæºç åˆ†æè®¡åˆ’","slug":"æºç /jdk-source-analysis","date":"2020-05-13T05:40:58.000Z","updated":"2020-08-30T04:50:22.257Z","comments":true,"path":"jdk-source-analysis/","link":"","permalink":"https://winniekun.github.io/jdk-source-analysis/","excerpt":"å‰è¨€","text":"å‰è¨€ è‡ªå·±ä¹Ÿæ–­æ–­ç»­ç»­çš„è¯»äº†ä¸€äº›JDKçš„æºç äº†ï¼Œå¹¶ä¸”ä¹Ÿå†™äº†æ€»ç»“ï¼Œä½†æ˜¯å°´å°¬çš„æ˜¯ï¼Œè¯¥å¿˜å¾—è¿˜æ˜¯å¿˜äº†ï¼Œæ‰€ä»¥æ‰“ç®—ç³»ç»Ÿçš„ç†ç†ï¼Œç„¶åæ²¡çœ‹å®Œä¸€ä¸ªé™¤äº†æ€»ç»“ï¼Œå†åšä¸ªæ€ç»´å¯¼å›¾ã€‚é˜…è¯»JDKçš„ç›®çš„æœ‰ä¸‰ï¼š å­¦å¥½æ•°æ®ç»“æ„ä»¥åŠç›¸å…³ç®—æ³• æ¯•ç«Ÿæ˜¯å†…åŠŸï¼Œè¯¥ç¡¬å•ƒè¿˜æ˜¯è¦ç¡¬å•ƒ ä¸å¸Œæœ›è‡ªå·±åˆ°æ—¶å€™è¿½æ‚”è«åŠ èƒ½è®©è‡ªå·±çš„Javaçš„ç†è§£å’Œç†Ÿç»ƒåº¦æ›´ä¸Šä¸€å±‚æ¥¼ è«é—®Pythonå˜ï¼Œé—®å°±æ˜¯çˆ±è¿‡ é¢è¯• è¿™ä¹Ÿæ˜¯æ²¡å¾—åŠæ³•ï¼Œæ„Ÿè§‰ç›®å‰é¢è¯•ä¸é—®ä¸ªæºç é—®é¢˜ï¼Œéƒ½ä¸åƒé¢è¯• é¡ºå¸¦æŠŠLeetCodeç›¸å…³çš„ç®—æ³•åˆ·ä¸€éğŸ˜„ æ€»ä½“è¿›ç¨‹ å¸¸ç”¨æ•°æ®ç»“æ„æ‰‹æ’¸ä¸€é ç®—æ³•ç¬¬å››ç‰ˆ æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ é˜…è¯»JDKæºç ï¼Œè®°å½• å‚è€ƒå…¶ä»–å¤§ä½¬çš„æ€»ç»“ï¼ŒæŸ¥ç¼ºè¡¥æ¼ ç›¸å…³LeetCodeé¢˜ç›®åˆ·äº† JDK é›†åˆç±» æ‰€æœ‰é›†åˆ å¤ªå¤æ‚, ç„¶åå»é™¤JUCä¸Šçš„ä¸€äº›å®ç°ç±», å†çœ‹ä¸€ä¸‹ collection-map-ä¸åŒ…å«JUCä¸­çš„ç±» CollectionListListä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„, å¯é‡å¤çš„, ä¸»è¦çš„å®ç°æ–¹å¼æ˜¯åŠ¨æ€æ•°ç»„å’Œé“¾è¡¨ List Javaä¸­æä¾›çš„Listçš„å®ç°ä¸»è¦æœ‰ArrayListã€LinkedListã€CopyOnWriteArrayListï¼Œå¦å¤–è¿˜æœ‰ä¸¤ä¸ªå¤è€çš„ç±»Vectorå’ŒStackã€‚ java.util.LinkedList âœ” java.util.Vector âœ” java.util.Stack âœ” java.util.ArrayListâœ” java.util.concurrent.CopyOnWriteArrayList âœ” Queueé˜Ÿåˆ—æ˜¯éµå¾ªç€ä¸€å®šåŸåˆ™çš„å…¥é˜Ÿå‡ºé˜Ÿæ“ä½œçš„é›†åˆ, å…ˆè¿›å…ˆå‡º, ä¸€èˆ¬æ¥è¯´åœ¨å †å°¾æ·»åŠ å…ƒç´ (å…¥é˜Ÿ), åœ¨é˜Ÿå¤´åˆ é™¤å…ƒç´ (å‡ºé˜Ÿ), ä½†æ˜¯ä¹Ÿä¸ä¸€å®š, ä¸å¦‚ä¼˜å…ˆé˜Ÿåˆ—çš„åŸåˆ™å°±ä¸åŒ Javaä¸­æä¾›çš„Queueçš„å®ç°æœ‰: PriorityQueueã€ArrayBlockingQueueã€LinkedBlockingQueueã€SynchronousQueueã€PriorityBlockingQueueã€LinkedTransferQueueã€DelayQueueã€ConcurrentLinkedQueueã€‚ java.util.PriorityQueue java.util.concurrent.ArrayBlockingQueue java.util.concurrent.LinkedBlockingQueue java.util.concurrent.SynchronousQueue java.util.concurrent.PriorityBlockingQueue java.util.concurrent.LinkedTransferQueue java.util.concurrent.DelayQueue java.util.concurrent.ConcurrentLinkedQueue DequeDequeæ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå®ƒçš„ä¸¤ç«¯éƒ½å¯ä»¥è¿›å‡ºå…ƒç´ ï¼Œæ•…è€Œå¾—ååŒç«¯é˜Ÿåˆ—ï¼ˆDouble Ended Queueï¼‰ã€‚ Deque Javaä¸­æä¾›çš„Dequeçš„å®ç°ä¸»è¦æœ‰ArrayDequeã€LinkedBlockingDequeã€ConcurrentLinkedDequeã€LinkedListã€‚ java.util.Deque java.util.ArrayDeque java.util.concurrent.ConcurrentDeque Set Set Javaä¸­æä¾›çš„Setçš„å®ç°ä¸»è¦æœ‰HashSetã€LinkedHashSetã€TreeSetã€CopyOnWriteArraySetã€ConcurrentSkipListSetã€‚ java.util.HashSet java.util.TreeSet java.util.LinkedHashSet java.util.concurrent.CopyOnWriteArraySet java.util.concurrent.ConcurrentSkipListSet Map Map javaä¸­æä¾›çš„Mapçš„å®ç°ä¸»è¦æœ‰HashMapã€LinkedHashMapã€WeakHashMapã€TreeMapã€ConcurrentHashMapã€ConcurrentSkipListMapï¼Œå¦å¤–è¿˜æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤è€çš„Mapå®ç°HashTableã€Propertiesã€‚ java.util.TreeMap âœ” java.util.WeakHashMap java.util.LinkedHashMap java.util.HashMap âœ” java.util.concurrent.ConcurrentHashMap java.util.concurrent.ConcurrentSkipListMap java.util.Hashtable java.util.Properties é›†åˆç±»æ¦‚è¿°é€›åšå®¢çš„æ—¶å€™ï¼Œå‘ç°ä¸€å¼ ç¥å›¾ java-collection-cheat-sheet Java Collections Framework Cheat Sheet é˜…è¯»å¥—è·¯å¤§ä½“ä¸Šçš„é˜…è¯»æ¡†æ¶å†™å¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»†è‡´çš„ç¡¬å•ƒäº†ï¼Œå¯ä»¥å…ˆä»é¡¶å±‚çš„æ¥å£å¼€å§‹ï¼Œç„¶åæ˜¯Abstactç±»ï¼Œè¿™æ ·æ–¹ä¾¿ç†è§£ä¸åŒçš„å…·ä½“çš„é›†åˆç±»å¿…å¤‡çš„é€šç”¨æ–¹æ³•ç­‰ï¼Œç„¶åå†çœ‹è¿™äº›å…·ä½“ç±»å¯¹è¿™äº›é€šç”¨æ–¹æ³•çš„å…·ä½“å®ç°ã€‚é¡ºåºè¿˜æ˜¯è€æ ·å­ï¼šå¢ã€åˆ ã€æ”¹ã€æŸ¥ï¼Œç„¶åæ˜¯å…¶ä»–çš„ç»†èŠ‚éƒ¨åˆ†ã€‚ References ã€æ­»ç£• Java é›†åˆã€‘â€” æ€»ç»“ç¯‡","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"}]},{"title":"ç½‘ç«™éƒ¨ç½²å®å½•","slug":"é…ç½®/ç½‘ç«™éƒ¨ç½²å®å½•","date":"2020-05-10T12:23:05.000Z","updated":"2021-04-08T12:46:31.070Z","comments":true,"path":"ç½‘ç«™éƒ¨ç½²å®å½•/","link":"","permalink":"https://winniekun.github.io/%E7%BD%91%E7%AB%99%E9%83%A8%E7%BD%B2%E5%AE%9E%E5%BD%95/","excerpt":"å‰è¨€æœ€è¿‘ä¸€ä¸ªæ˜ŸæœŸåœ¨åšè®ºå›å½¢å¼çš„webåº”ç”¨ï¼Œé€»è¾‘è¶Šå†™è¶Šå¤šï¼Œè„‘å­ä¹Ÿæ˜¯è¶Šå†™è¶Šä¹±ï¼Œä¹Ÿè¶Šè¦è¶Šæ„Ÿè§‰SpringBootå’ŒFlaskçš„æ€æƒ³ä¸Šå¥½åƒã€‚ä»Šå¤©ç»ˆäºæ’¸å®Œäº†æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»¥åŠæµ‹è¯•ã€‚å¼€å§‹éƒ¨ç½²ï¼Œä»¥ä¸‹ï¼Œè®°å½•éƒ¨ç½²çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ğŸ˜„","text":"å‰è¨€æœ€è¿‘ä¸€ä¸ªæ˜ŸæœŸåœ¨åšè®ºå›å½¢å¼çš„webåº”ç”¨ï¼Œé€»è¾‘è¶Šå†™è¶Šå¤šï¼Œè„‘å­ä¹Ÿæ˜¯è¶Šå†™è¶Šä¹±ï¼Œä¹Ÿè¶Šè¦è¶Šæ„Ÿè§‰SpringBootå’ŒFlaskçš„æ€æƒ³ä¸Šå¥½åƒã€‚ä»Šå¤©ç»ˆäºæ’¸å®Œäº†æ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»¥åŠæµ‹è¯•ã€‚å¼€å§‹éƒ¨ç½²ï¼Œä»¥ä¸‹ï¼Œè®°å½•éƒ¨ç½²çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ğŸ˜„ ç¯å¢ƒä¾èµ– éƒ¨ç½² é¡¹ç›®ä¸­çš„ç¯å¢ƒä¾èµ–å¦‚ä¸Šå›¾æ‰€è¿°ï¼ŒæŒ‰ç…§æ­¥éª¤æ¥ï¼Œ å…ˆsshé“¾æ¥æœåŠ¡å™¨ï¼Œ ä¹‹åé…ç½®Javaç¯å¢ƒã€MySQLã€Redisã€Kafkaã€Mavenã€‚ä¹‹åé…ç½®Tomcatã€Nginxã€‚æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯Ubuntu18.04LTS SSHå› ä¸ºï¼Œsshé•¿æ—¶é—´ä¸æ“ä½œå°±æ–­å¼€ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦è¿›è¡Œé…ç½®ä¸‹ æœåŠ¡å™¨é…ç½®1ã€ è¿æ¥SSH ssh root@ip 2ã€ç¼–è¾‘sshd_config vim /etc/ssh/sshd_config 3ã€æ‰¾åˆ°ClientAliveIntervalï¼Œå°†å‰é¢çš„#å»æ‰ï¼ˆæ‡’å¾—æ‰¾çš„è¯ï¼Œç›´æ¥åœ¨æœ€åæ·»åŠ å³å¯ï¼‰ # æœåŠ¡å™¨æ¯éš”60ç§’ä¼šç»™å®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ä¿æ´»ä¿¡æ¯åŒ…ç»™å®¢æˆ·ç«¯ï¼Œå¯ä»¥å°†è¿™ä¸ªå€¼è®¾ç½®å¤§ä¸€ç‚¹ ClientAliveInterval 60 4ã€æ‰¾åˆ°ClientAliveCountMaxï¼Œå°†å‰é¢çš„#å»æ‰ï¼ˆåŒç†ï¼‰ # æœåŠ¡å™¨å‘å‡ºçš„è¯·æ±‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰å“åº”ï¼Œåˆ™åˆ¤æ–­è¶…æ—¶1æ¬¡ï¼Œè¿™ä¸ªå‚æ•°æ˜¯è¡¨ç¤ºå…è®¸è¶…æ—¶çš„æ¬¡æ•°ã€‚å¯ä»¥å°†è¿™ä¸ªå€¼è®¾ç½®å¤§ä¸€ç‚¹ã€‚ ClientAliveCountMax 888 Javaç¯å¢ƒoracleå®˜ç½‘ä¸‹è½½JDKï¼Œä¸ªäººä½¿ç”¨çš„æ˜¯JDK8ã€‚ä¹‹åå°†ä¸‹è½½å¥½çš„JDKä¸Šä¼ æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æœåŠ¡å™¨å®‰è£…ï¼Œä¸ªäººæƒ³è¯•è¯•scpå‘½ä»¤ï¼Œè€Œä¸”è‡ªå·±ç³»ç»Ÿä¹Ÿæ˜¯Ubuntuçš„ï¼Œæ‰€æœ‰ä¾èµ–ç¯å¢ƒå‹ç¼©ä¸Šä¼ å³å¯ï¼Œæ›´åŠ æ–¹ä¾¿ scp filepath/filename username@ip:/targetfilepath è­¬å¦‚ï¼Œä¸‹è½½å¥½çš„æœ¬åœ°JDKåœ¨Downloadsæ–‡ä»¶å¤¹ä¸‹ï¼Œæƒ³ä¼ å…¥æœåŠ¡å™¨rootç”¨æˆ·æ ¹ç›®å½•ä¸‹çš„communityç›®å½•ä¸‹ï¼Œæ–¹ä¾¿åŒä¸€ç®¡ç†ï¼Œåç»­çš„æ–‡ä»¶éƒ½ä¼ å…¥communityç›®å½•ä¸‹ scp /Downloads/jdk-8u251-linux-x64.tar.gz root@ip:/community ä¹‹åä½¿ç”¨ç»ˆç«¯ç™»å½•æœåŠ¡å™¨ï¼Œè§£å‹JDKï¼Œé…ç½®ç¯å¢ƒ(/etc/profile) ssh root@ip -p xxx (å¦‚æœæ›´æ”¹sshç«¯å£çš„è¯) vim /etc/profile ï¼ˆé…ç½®ç¯å¢ƒå˜é‡ï¼‰ profileçš„é…ç½®å¦‚ä¸‹ ## java environment export JAVA_HOME=/community/jdk1.8.0_251 export JRE_HOME=$JAVA_HOME/jre export CLASSPATH=.:$JAVA_HOME/lib:$JRE_HOME/lib:$CLASSPATH export PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH ä¹‹åï¼Œæ¿€æ´» source /etc/profile æœ€åï¼Œä½¿ç”¨å‘½ä»¤java -versionæ£€æµ‹æ˜¯å¦é…ç½®æˆåŠŸ java version \"1.8.0_251\" Java(TM) SE Runtime Environment (build 1.8.0_191-b12) Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode) MySQLå®˜ç½‘ä¸‹è½½ï¼Œç‚¹å‡»MySQL APT Repositoryä¸‹è½½å³å¯ MySQL ä¹‹ååŒç†ï¼Œä¼ å…¥æœåŠ¡ï¼Œ scp mysq-apt-config_0.8.15-1_all.deb root@ip:/community ä¹‹åé€šè¿‡ä¹‹å‰sshé“¾æ¥æœåŠ¡å™¨çš„ç»ˆç«¯ï¼Œå®‰è£…MySQL sudo dpkg -i mysq-apt-config_0.8.15-1_all.deb æœŸé—´æœ‰è®©é€‰æ‹©MySQLçš„ç‰ˆæœ¬ï¼Œä¸ªäººé€‰æ‹©çš„æ˜¯5.7çš„ï¼Œå› ä¸ºå¼€å‘çš„æ—¶å€™ç”¨çš„æ˜¯5.7ã€‚ä¹‹åæ›´æ–°source.listï¼Œä¸‹è½½MySQLå³å¯ sudo apt-get update sudo apt-get install mysql-server ç­‰å¾…ç‰‡åˆ»åï¼Œä¼šå¼¹å‡ºmysqlä¸€ä¸ªå°çš„é…ç½®ç¨‹åºç•Œé¢ï¼Œè¦æ±‚ä½ è¾“å…¥ä¸‹rootç”¨æˆ·çš„å¯†ç ï¼ˆè¾“å…¥2æ¬¡ï¼‰ç­‰ç­‰ã€‚å®‰è£…æˆåŠŸä¹‹åï¼Œç™»å½•å°è¯•ä¸‹å³å¯ mysql -u root -p ## è¾“å‡ºä¿¡æ¯ Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 24 Server version: 5.7.30-0ubuntu0.18.04.1 (Ubuntu) Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. mysql&gt; MySQLçš„å¸è½½åœ¨Ubuntu18.04ç³»ç»Ÿä¸‹å½»åº•åˆ é™¤MySQLçš„æ–¹æ³• Redisåœ¨æ­¤ä¹‹å‰å®‰è£… add-apt-respository sudo apt-get update sudo apt-get install software-properties-common æ­¥éª¤ $ sudo add-apt-repository ppa:redislabs/redis $ sudo apt-get update $ sudo apt-get install redis KafkaKafkaå®˜ç½‘ï¼Œä¸ªäººä¸‹è½½çš„æ˜¯ kafka_2.12-2.5.0.tgzï¼Œå‰ç¼€2.12æ˜¯æ”¯æŒçš„Scalaç‰ˆæœ¬ï¼Œæœ¬æœºç”µè„‘å®‰è£…çš„Scalaç‰ˆæœ¬æ˜¯2.12 ä¸‹è½½ä¹‹åï¼Œç›´æ¥ä¸Šä¼ å³å¯ï¼Œ æ²¡æœ‰ç‰¹åˆ«éœ€è¦é…ç½®çš„ä¸œè¥¿ï¼Œä¸ªäººæ›´æ”¹äº†logçš„åœ°å€ï¼Œå› ä¸ºæ˜¯æœåŠ¡å™¨ï¼Œ æ‰€ä»¥éœ€è¦é•¿æœŸçš„è¿è¡Œï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ # zookeeper bin/zookeeper-server-start.sh -daemon config/zookeeper.properties # kafka server nohup bin/kafka-server-start.sh config/server.properties 1&gt;/dev/null 2&gt;&amp;1 &amp; Maven[Maven 3.6.3](https://apache.website-solution.net/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gzï¼Œå› ä¸ºå¢™çš„é—®é¢˜ï¼Œæ‰€ä»¥è‡ªå·±é…ç½®äº†setting.xmlé‡Œé¢çš„`localRepository`å’Œ`mirrors` &lt;localRepository&gt;/home/kongweikun/maven&lt;/localRepository&gt; &lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;uk&lt;/id&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt; &lt;url&gt;http://uk.maven.org/maven2/&lt;/url&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;CN&lt;/id&gt; &lt;name&gt;OSChina Central&lt;/name&gt; &lt;url&gt;http://maven.oschina.net/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; &lt;mirror&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;internal nexus repository&lt;/name&gt; &lt;url&gt;http://repo.maven.apache.org/maven2&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; åŒç†ï¼Œéœ€è¦åœ¨/etc/profileä¸­é…ç½® ## maven export M2_HOME=/community/apache-maven-3.6.3 export PATH=${M2_HOME}/bin:$PATH æ¿€æ´» Tomcattomcat 9.0.34ï¼Œä¸‹è½½ä¹‹åï¼Œä¸Šä¼ æœåŠ¡å™¨å³å¯ï¼Œä¹‹åè§£å‹ï¼Œ/etc/profileé…ç½® ## tomcat export CATALINA_HOME=/community/apache-tomcat-9.0.34 export CLASSPATH=${CLASSPATH}:${CATALINA_HOME}/lib export PATH=${PATH}:${CATALINA_HOME}/bin ä¹‹åï¼Œç»ˆç«¯è¿è¡Œstartup.shï¼Œè¿‡ä¸€ä¼šå„¿ç”¨æµè§ˆå™¨è®¿é—®IP:8080æŸ¥çœ‹æ˜¯å¦èƒ½è®¿é—®ï¼Œä¸èƒ½è®¿é—®çš„è¯ï¼Œæ£€æŸ¥8080ç«¯å£æ˜¯å¦å¼€å‘ netstat -apn | grep 8080 # è§‚å¯Ÿ8080ç«¯å£æ˜¯å¦å¼€æ”¾ netstat -ntpl # æ˜¾ç¤ºç½‘ç»œçŠ¶æ€, å¯æŸ¥çœ‹8080ç«¯å£çŠ¶æ€ ps -ef | grep tomcat # æŸ¥çœ‹tomcatè¿›ç¨‹ Nginxsudo apt-get install nginx å®‰è£…ä¹‹åï¼Œå¯å°†/etc/nginx/sites-available/çš„defaultæ–‡ä»¶åˆ é™¤ï¼Œä½†è®°å¾—åšå¤‡ä»½ã€‚ ä¹‹ååœ¨/etc/nginx/nginx.confä¸­çš„httpä¸­æ·»åŠ å¦‚ä¸‹éƒ¨åˆ†å³å¯ upstream myserver{ server 127.0.0.1:8080 max_fails=3 fail_timeout=30s; } server { listen 80; server_name ip; location / { proxy_pass http://myserver; } } nginxå‘½ä»¤sudo systemctl restart nginx # é‡å¯nginx systemctl status nginx # æ£€æµ‹nginxçŠ¶æ€ éƒ¨ç½²æœ€åï¼Œæ‰€æœ‰çš„ç¯å¢ƒå®‰è£…æˆåŠŸä¹‹åï¼Œå°±æ˜¯æœ€é‡è¦çš„åº”ç”¨ç¨‹åºéƒ¨ç½²äº†ã€‚å› ä¸ºï¼ŒTomcaté»˜è®¤å¯åŠ¨çš„æ˜¯å…¶webappsä¸‹çš„ROOTåº”ç”¨ã€‚å…¶å†…éƒ¨çš„åº”ç”¨ç¨‹åºï¼Œåœ¨è·¯ç”±ä¸Šæ·»åŠ å¯¹åº”çš„åå­—å³å¯ï¼Œä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³ç›´æ¥å°†ipç»‘å®šåˆ°åº”ç”¨ç¨‹åºï¼Œä¸åŠ å‰ç¼€ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å¦‚ä¸‹çš„æ–¹å¼è§£å†³ï¼š å°†è‡ªå·±çš„åº”ç”¨æ‰“åŒ…ä¸ºwaråŒ…ï¼Œå‘½åä¸ºROOTï¼Œæ›¿æ¢ä¸ºTomcatè‡ªå¸¦çš„ROOTåº”ç”¨ã€‚å°†propertiesä¸­çš„server.servlet.context-path = xxx åé¢çš„xxxå»é™¤ï¼Œç„¶ååº”ç”¨ä¸­æ¶‰åŠåˆ°context-pathçš„ä¹Ÿä¿®æ”¹ pom.xml &lt;!--æ‰“æˆwaråŒ…--&gt; &lt;packaging&gt;war&lt;/packaging&gt; &lt;build&gt; &lt;!--æ‰“åŒ…åå­—--&gt; &lt;finalName&gt;ROOT&lt;/finalName&gt; &lt;plugins&gt; xxx &lt;/plugins&gt; &lt;/build&gt; ç¼–å†™CommunityServleInitializerï¼Œç»§æ‰¿SpringBootServletInitializer public class CommunityServleInitializer extends SpringBootServletInitializer { @Override protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) { return builder.sources(CommunityApplication.class); } } å°†è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸Šä¼ æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨mavenæ‰“åŒ… mvn clean package -Dmaven.test.skip=true ä¹‹åå°†targetä¸‹çš„ROOT.warç§»åŠ¨åˆ°Tomcatä¸‹çš„webappsä¸­å³å¯ï¼Œ ç„¶åstartup.sh over éƒ¨ç½²æˆåŠŸå±•ç¤º çœ‹æ¥ï¼Œè¿™å‡ å¹´ç”¨Ubuntuè¿˜æ˜¯æœ‰æˆæœçš„ï¼Œæœ€èµ·ç ï¼ŒæœåŠ¡å™¨ä¸Šéƒ¨ç½²åº”ç”¨ä¸ç”¨å†é‚£ä¹ˆæ¼ç«äº†ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²äº†ã€‚","categories":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/categories/%E9%85%8D%E7%BD%AE/"}],"tags":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/tags/%E9%85%8D%E7%BD%AE/"}]},{"title":"æ­»ç£•ä½è¿ç®—","slug":"LeetCode/stick-to-bit-operation","date":"2020-04-26T10:40:01.000Z","updated":"2021-08-18T08:54:33.166Z","comments":true,"path":"stick-to-bit-operation/","link":"","permalink":"https://winniekun.github.io/stick-to-bit-operation/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—äº”ï¼š ä½è¿ç®— ä½è¿ç®—ï¼Œåœ¨æ€§èƒ½ä¸Šæ˜¯è¶…è¿‡åŠ å‡ä¹˜é™¤çš„ï¼Œåªä¸è¿‡ï¼Œè´¹äº›è„‘ç»†èƒã€‚åŸºç¡€çš„ä¸&amp; æˆ–| å¼‚æˆ–^ è¿ç®—ï¼Œä»¥åŠå·¦ç§»åŠ¨ã€å³ç§»ã€‚","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—äº”ï¼š ä½è¿ç®— ä½è¿ç®—ï¼Œåœ¨æ€§èƒ½ä¸Šæ˜¯è¶…è¿‡åŠ å‡ä¹˜é™¤çš„ï¼Œåªä¸è¿‡ï¼Œè´¹äº›è„‘ç»†èƒã€‚åŸºç¡€çš„ä¸&amp; æˆ–| å¼‚æˆ–^ è¿ç®—ï¼Œä»¥åŠå·¦ç§»åŠ¨ã€å³ç§»ã€‚ å¸¸ç”¨æ“ä½œ&amp;ã€| ã€^ã€&gt;&gt;ã€&lt;&lt;ã€&gt;&gt;&gt;å‡è®¾æ•´æ•°å˜é‡ A çš„å€¼ä¸º 60 å’Œå˜é‡ B çš„å€¼ä¸º 13ï¼š æ“ä½œç¬¦ æè¿° ä¾‹å­ ï¼† å¦‚æœç›¸å¯¹åº”ä½éƒ½æ˜¯1ï¼Œåˆ™ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0 ï¼ˆAï¼†Bï¼‰ï¼Œå¾—åˆ°12ï¼Œå³0000 1100 \\ å¦‚æœç›¸å¯¹åº”ä½éƒ½æ˜¯ 0ï¼Œåˆ™ç»“æœä¸º 0ï¼Œå¦åˆ™ä¸º 1 ï¼ˆA \\ Bï¼‰å¾—åˆ°61ï¼Œå³ 0011 1101 ^ å¦‚æœç›¸å¯¹åº”ä½å€¼ç›¸åŒï¼Œåˆ™ç»“æœä¸º0ï¼Œå¦åˆ™ä¸º1 ï¼ˆA ^ Bï¼‰å¾—åˆ°49ï¼Œå³ 0011 0001 ã€œ æŒ‰ä½å–åè¿ç®—ç¬¦ç¿»è½¬æ“ä½œæ•°çš„æ¯ä¸€ä½ï¼Œå³0å˜æˆ1ï¼Œ1å˜æˆ0ã€‚ ï¼ˆã€œAï¼‰å¾—åˆ°-61ï¼Œå³1100 0011 &lt;&lt; æŒ‰ä½å·¦ç§»è¿ç®—ç¬¦ã€‚å·¦æ“ä½œæ•°æŒ‰ä½å·¦ç§»å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•°ã€‚ A &lt;&lt; 2å¾—åˆ°240ï¼Œå³ 1111 0000 &gt;&gt; æŒ‰ä½å³ç§»è¿ç®—ç¬¦ã€‚å·¦æ“ä½œæ•°æŒ‰ä½å³ç§»å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•°ã€‚ A &gt;&gt; 2å¾—åˆ°15å³ 1111 &gt;&gt;&gt; æŒ‰ä½å³ç§»è¡¥é›¶æ“ä½œç¬¦ã€‚å·¦æ“ä½œæ•°çš„å€¼æŒ‰å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•°å³ç§»ï¼Œç§»åŠ¨å¾—åˆ°çš„ç©ºä½ä»¥é›¶å¡«å……ã€‚ A&gt;&gt;&gt;2å¾—åˆ°15å³0000 1111 å¼‚æˆ– 2 ^ 2 = 0; ä¸ 0 &amp; 1 = 0ï¼› 1 &amp; 1 = 0ï¼› n &amp; (n-1)10000000ï¼› 01111111; &lt;----- binary ----&gt; n n n-1 n&amp;(n-1) -- ---- ---- ------- 0 0000 0111 0000 * 1 0001 0000 0000 * 2 0010 0001 0000 * 3 0011 0010 0010 4 0100 0011 0000 * 5 0101 0100 0100 6 0110 0101 0100 7 0111 0110 0110 8 1000 0111 0000 * 9 1001 1000 1000 10 1010 1001 1000 11 1011 1010 1010 12 1100 1011 1000 13 1101 1100 1100 14 1110 1101 1100 15 1111 1110 1110 å¯ä»¥çœ‹åˆ°ï¼Œå…¶ç¬¬ä¸€ä¸ªæ–¹å¼æ˜¯ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸º2çš„å¹‚æ¬¡ï¼Œn&amp;(n-1)çš„ç»“æœä¸º0çš„è¯ï¼Œåˆ™ä¸º2çš„å¹‚æ¬¡ã€‚ ä»è¿ç®—ç»“æœåˆ†æï¼ˆä»¥12ä¸ºä¾‹ï¼‰ï¼š 12äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š1100ï¼Œå‡å»1ä¹‹åï¼Œä¸º1011ï¼Œå¯ä»¥å‘ç°ï¼Œå‡å»1ä¹‹åï¼Œæ˜¯å°†è¯¥æ•°å­—çš„äºŒè¿›åˆ¶çš„æœ€å³è¾¹çš„1æ”¹ä¸º0ï¼Œn&amp;(n-1)ä¹‹åçš„ç»“æœä¸º1000ï¼Œæ¯”è¾ƒ1100å’Œ1000ï¼Œè¿™ä¸ªæ“ä½œå¯ä»¥æ€»ç»“ä¸ºï¼šå°†å½“å‰æ•°å­—äºŒè¿›åˆ¶æœ€å³è¾¹çš„1å»é™¤ã€‚æœ€å³è¾¹çš„1å·¦è¾¹éƒ¨åˆ†ä¸å˜ã€‚æ‰€ä»¥ï¼Œä¹Ÿå¯å¯ä»¥ç”¨äºç»Ÿè®¡æ•°å­—çš„äºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°é—®é¢˜ã€‚ è¡¥ç ï¼š ~x + 1 æ˜¯ xçš„è¡¥ç ; è¡¥ç  1 + 11111111111111111 = 000000000000000000; 2 + 11111111111111110 = 000000000000000000 (s | 1&lt;&lt;k)s: é›†åˆï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºåŒ…å«çš„å…ƒç´ ï¼‰ é›†åˆå…ƒç´ $s = {1,4,6}$ åˆ™ $s = 1010010{2} = 82{10}$ k: å…ƒç´  å°†å…ƒç´ kæ”¾å…¥é›†åˆsä¸­ ä¸¾ä¾‹è¯´æ˜ å½“å‰$s=82$, æ­¤æ—¶$k=2$ï¼Œå°†$k$æ”¾å…¥é›†åˆ$s$ä¸­ $(1&lt;&lt;k) = 4 = 100_{2}$ $(s | 1&lt;&lt; k) == 1010110{2} == 86{10}$ ç¥å¥‡çš„æ“ä½œï¼Œé€‚ç”¨äºå‹ç¼©çŠ¶æ€dp LeetCode &amp; å‰‘æŒ‡offer ä½è¿ç®—é¢˜ç›®æ•´ç† é¢è¯•é¢˜15ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•° 136 Single Number LeetCode ä½è¿ç®—é¢˜ç›®æ•´ç†é¢è¯•é¢˜15ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°public static int numberOf(int n){ // n &amp; (n - 1) ä¼šæ¶ˆé™¤ n ä¸­æœ€åä¸€ä½ä¸­çš„ 1ã€‚ int res = 0; while (n != 0){ res++; n &amp;= (n-1); } return res; } 136 Single Numberè¿™é¢˜æ˜¯å»é™¤æ•°ç»„ä¸­çš„é‡å¤å…ƒç´ ï¼ˆç»™çš„æµ‹è¯•é›†æ˜¯åªæœ‰ä¸€ä¸ªä¸é‡å¤çš„å…ƒç´ ï¼‰ï¼Œç”¨äº†å¼‚æˆ–è¿ç®—ï¼Œ æ€è·¯ï¼š ç›¸ç­‰çš„æ•°ç›¸å¼‚æˆ–ç»“æœä¸º0ï¼Œ0å’Œä»»ä½•æ•°ç›¸å¼‚æˆ–ç»“æœä¸ºè¿™ä¸ªæ•°æœ¬èº«ã€‚æ ¹æ®è¿™ä¸ªç‰¹ç‚¹ï¼Œå¯ä»¥å…ˆè®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ä¸º0ï¼Œç„¶ååˆ†åˆ«å’Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç›¸å¼‚æˆ–ï¼Œæœ€åä¿ç•™çš„è‚¯å®šä¸ºå”¯ä¸€ä¸€ä¸ªä¸é‡å¤çš„å€¼ã€‚ ç›¸ç­‰çš„å…ƒç´ ç›¸å¼‚æˆ–çš„å€¼ä¸º0ï¼Œä¸æ˜¯ç‰¹æŒ‡ç›¸ç­‰çš„å…ƒç´ å¿…é¡»ç›¸è¿ï¼Œä¹Ÿå¯ä»¥ä¸ç›¸è¿ã€‚ public singleNumber(int[] nums){ int res = 0; for( int i : nums){ res ^= i; } return res; } References n &amp; (n-1) what does this expression do? duplicate","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"https://winniekun.github.io/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"}]},{"title":"åŒˆç‰™åˆ©ç®—æ³•å®ç°","slug":"ç®—æ³•/å®ç°-å›¾è®º/åŒˆç‰™åˆ©ç®—æ³•å®ç°","date":"2020-04-22T02:07:40.000Z","updated":"2020-08-30T04:50:22.260Z","comments":true,"path":"åŒˆç‰™åˆ©ç®—æ³•å®ç°/","link":"","permalink":"https://winniekun.github.io/%E5%8C%88%E7%89%99%E5%88%A9%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0/","excerpt":"TODO","text":"TODO å‰è¨€åŒˆç‰™åˆ©ç®—æ³•è®°å½•ï¼Œå¹¶ä¸”æ·»åŠ äº†å‡ é“å®æˆ˜é¢˜ç›® ç®€ä»‹&amp;æ€è·¯åŒˆç‰™åˆ©ç®—æ³•æ˜¯ä¸€ç§åœ¨å¤šé¡¹å¼æ—¶é—´å†…æ±‚è§£ä»»åŠ¡åˆ†é…é—®é¢˜çš„ç»„åˆä¼˜åŒ–ç®—æ³•ï¼Œå¹¶æ¨åŠ¨äº†åæ¥çš„åŸå§‹å¯¹å¶æ–¹æ³•ã€‚ç¾å›½æ•°å­¦å®¶å“ˆç½—å¾·Â·åº“æ©äº1955å¹´æå‡ºè¯¥ç®—æ³•ã€‚æ­¤ç®—æ³•ä¹‹æ‰€ä»¥è¢«ç§°ä½œåŒˆç‰™åˆ©ç®—æ³•ï¼Œæ˜¯å› ä¸ºç®—æ³•å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯åŸºäºä»¥å‰åŒˆç‰™åˆ©æ•°å­¦å®¶DÃ©nes KÅ‘nigå’ŒJenÅ‘ EgervÃ¡ryçš„å·¥ä½œä¹‹ä¸Šåˆ›å»ºèµ·æ¥çš„ã€‚åŒˆç‰™åˆ©ç®—æ³•æ˜¯åŸºäºHallå®šç†ä¸­å……åˆ†æ€§è¯æ˜çš„æ€æƒ³ï¼Œå®ƒæ˜¯éƒ¨å›¾åŒ¹é…æœ€å¸¸è§çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯å¯»æ‰¾å¢å¹¿è·¯å¾„(æ˜¯æŒ‡ä»Mä¸­æ²¡æœ‰ç”¨åˆ°çš„é¡¶ç‚¹)å¼€å§‹ï¼Œå¹¶ä»Mä¸­æ²¡æœ‰ç”¨åˆ°çš„é¡¶ç‚¹ç»“æŸçš„äº¤æ›¿è·¯å¾„)ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨å¢å¹¿è·¯å¾„æ±‚äºŒåˆ†å›¾æœ€å¤§åŒ¹é…çš„ç®—æ³•ã€‚ æ¦‚å¿µï¼šåŒ¹é…&amp;æœ€å¤§åŒ¹é…&amp;å®Œç¾åŒ¹é… åŒ¹é…ï¼š ä¸€ç§è¾¹çš„é›†åˆï¼Œå…¶ä¸­ä»»æ„ä¸¤æ¡è¾¹æ²¡æœ‰å…¬å…±é¡¶ç‚¹ æœ€å¤§åŒ¹é…: ä¸€ä¸ªå›¾æ‰€æœ‰åŒ¹é…ä¸­ï¼Œæ‰€å«åŒ¹é…è¾¹æ•°æœ€å¤šçš„åŒ¹é…ï¼Œç§°ä¸ºè¿™ä¸ªå›¾çš„æœ€å¤§åŒ¹é…ã€‚ å®Œç¾åŒ¹é…ï¼š å¦‚æœä¸€ä¸ªå›¾çš„æŸä¸ªåŒ¹é…ä¸­ï¼Œæ‰€æœ‰çš„é¡¶ç‚¹éƒ½æ˜¯åŒ¹é…ç‚¹ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå®Œç¾åŒ¹é…ã€‚ äº¤æ›¿è·¯å¾„&amp;å¢å¹¿è·¯å¾„ äº¤æ›¿è·¯ï¼šä»ä¸€ä¸ªæœªåŒ¹é…ç‚¹å‡ºå‘ï¼Œä¾æ¬¡ç»è¿‡éåŒ¹é…è¾¹ã€åŒ¹é…è¾¹ã€éåŒ¹é…è¾¹â€¦å½¢æˆçš„è·¯å¾„å«äº¤æ›¿è·¯ã€‚ å¢å¹¿è·¯ï¼šä»ä¸€ä¸ªæœªåŒ¹é…ç‚¹å‡ºå‘ï¼Œèµ°äº¤æ›¿è·¯ï¼Œå¦‚æœé€”å¾„å¦ä¸€ä¸ªæœªåŒ¹é…ç‚¹ï¼ˆå‡ºå‘çš„ç‚¹ä¸ç®—ï¼‰ï¼Œåˆ™è¿™æ¡äº¤æ›¿è·¯ç§°ä¸ºå¢å¹¿è·¯ã€‚ æ€è·¯&amp;å®ç°è¯¥æ€è·¯å’Œä¸»è¦ä¸ºæœ€ä½³åŒ¹é…é—®é¢˜ï¼Œ é¢˜ç›®References ç»´åŸºç™¾ç§‘ Hungarian Algorithm","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://winniekun.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å›¾è®º","slug":"å›¾è®º","permalink":"https://winniekun.github.io/tags/%E5%9B%BE%E8%AE%BA/"}]},{"title":"Javaå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹","slug":"Javaè¿›é˜¶/å¹¶å‘/Javaå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹","date":"2020-04-21T13:27:00.000Z","updated":"2020-08-30T04:50:22.246Z","comments":true,"path":"Javaå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹/","link":"","permalink":"https://winniekun.github.io/Java%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/","excerpt":"å‰è¨€","text":"å‰è¨€ æœ€è¿‘åœ¨çœ‹çº¿ç¨‹æ± çš„å®ç°åŸç†ï¼Œåé¢åˆçœ‹äº†æºç ï¼Œå‘ç°å…¶å†…éƒ¨æ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œç”¨æˆ·æ˜¯æäº¤çš„ä»»åŠ¡ï¼ˆtaskï¼‰æ˜¯ç”Ÿäº§è€…ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼ˆworkerï¼‰æ˜¯æ¶ˆè´¹è€…ã€‚ ç„¶åæ„Ÿè§‰å¯¹ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„å®ç°ï¼Œç£•ç£•ç»Šç»Šçš„ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹ã€‚ä¸‹é¢ä¼šæ¶‰åŠå¤šç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„å®ç°ï¼Œå¯ä»¥å…ˆæŠ½è±¡å‡ºå…³é”®çš„æ¥å£ï¼Œå¹¶å®ç°ä¸€äº›æŠ½è±¡ç±»ï¼š å‡†å¤‡ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¥å£ç”Ÿäº§è€…æ¥å£public interface Producer { void produce() throws InterruptedException; } æ¶ˆè´¹è€…æ¥å£public interface Consumer { void consume() throws InterruptedException; } ç”Ÿäº§è€…æ¶ˆè´¹è€…æŠ½è±¡ç±»ç”Ÿäº§è€…æŠ½è±¡ç±»abstract class AbstractProducer implements Runnable, Producer { @Override public void run() { while (true){ try{ produce(); }catch (Exception e){ e.printStackTrace(); } } } } æ¶ˆè´¹è€…æŠ½è±¡ç±»abstract class AbstractConsumer implements Consumer, Runnable { @Override public void run() { while (true){ try{ consume(); }catch (Exception e){ e.printStackTrace(); } } } } Modelæ¥å£å¯¹åº”çš„å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸åŒçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…å®ç°æ¨¡å‹éƒ½å®ç°è¯¥æ¥å£ï¼Œ public interface Model { Runnable newRunnableConsumer(); Runnable newRunnableProducer(); } Taskå°†Taskä½œä¸ºç”Ÿäº§å’Œæ¶ˆè´¹çš„åŸºæœ¬å•ä½ public class Task { private int no; public Task(int no){ this.no = no; } public int getNo() { return no; } public void setNo(int no) { this.no = no; } } å®ç°ä¸€ï¼šBlockingQueueBlockingQueueçš„å†™æ³•æœ€ç®€å•ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ï¼ŒæŠŠå¹¶å‘å’Œå®¹é‡æ§åˆ¶å°è£…åœ¨ç¼“å†²åŒºä¸­ã€‚è€ŒBlockingQueueçš„æ€§è´¨å¤©ç”Ÿæ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚ package com.train.concurrent.procon; import java.util.concurrent.BlockingQueue; import java.util.concurrent.LinkedBlockingDeque; import java.util.concurrent.atomic.AtomicInteger; /** * @Time: 2020/4/21ä¸‹åˆ8:54 * @Author: kongwiki * @Email: kongwiki@163.com */ public class BlockingQueueModel implements Model { private BlockingQueue&lt;Task&gt; queue; private final AtomicInteger increTaskNo = new AtomicInteger(0); public BlockingQueueModel(int cap){ this.queue = new LinkedBlockingDeque&lt;&gt;(cap); } @Override public Runnable newRunnableConsumer() { return new ConsumerImpl(); } @Override public Runnable newRunnableProducer() { return new ProducerImpl(); } private class ConsumerImpl extends AbstractConsumer implements Runnable, Consumer{ @Override public void consume() throws InterruptedException { Task task = queue.take(); Thread.sleep(500 + (long) (Math.random() * 500)); System.out.println(\"consume: \" + task.getNo()); } } private class ProducerImpl extends AbstractProducer implements Runnable, Producer{ @Override public void produce() throws InterruptedException { Thread.sleep((long) (500 + (Math.random()) * 1000)); Task task = new Task(increTaskNo.getAndIncrement()); System.out.println(\"produce: \" + task.getNo()); queue.put(task); } } public static void main(String[] args) { Model model = new BlockingQueueModel(3); for (int i = 0; i &lt; 2; i++) { new Thread(model.newRunnableConsumer()).start(); } for (int i = 0; i &lt; 5; i++) { new Thread(model.newRunnableProducer()).start(); } } } å®ç°äºŒï¼šwait&amp;notifypackage com.train.concurrent.procon; import java.util.LinkedList; import java.util.Queue; import java.util.concurrent.atomic.AtomicInteger; /** * @Time: 2020/4/22ä¸Šåˆ7:40 * @Author: kongwiki * @Email: kongwiki@163.com */ public class WaitNotifyModel implements Model { private int integer; private final Object buffer_lock = new Object(); private final Queue&lt;Task&gt; buffer = new LinkedList&lt;&gt;(); private int cap; public WaitNotifyModel(int cap){ this.cap = cap; } @Override public Runnable newRunnableConsumer() { return new ConsumerImpl(); } @Override public Runnable newRunnableProducer() { return new ProducerImpl(); } public class ProducerImpl extends AbstractProducer implements Runnable, Producer{ @Override public void produce() throws InterruptedException { Thread.sleep((long) (500 + (Math.random() * 1000))); synchronized (buffer_lock){ while (buffer.size() == cap){ buffer_lock.wait(); } Task task = new Task(integer++); buffer.add(task); System.out.println(\"produce: \" + task.getNo()); buffer_lock.notifyAll(); } } } public class ConsumerImpl extends AbstractConsumer implements Runnable, Consumer{ @Override public void consume() throws InterruptedException { synchronized (buffer_lock){ while (buffer.size() == 0){ buffer_lock.wait(); } Task task = buffer.poll(); assert task != null; Thread.sleep((long) (500 + (Math.random() * 1000))); System.out.println(\"consume: \" + task.getNo()); buffer_lock.notifyAll(); } } } public static void main(String[] args) { Model model = new WaitNotifyModel(3); for (int i = 0; i &lt; 3; i++) { new Thread(model.newRunnableConsumer()).start(); } for (int i = 0; i &lt; 5; i++) { new Thread(model.newRunnableProducer()).start(); } } } å®ç°ä¸‰ï¼šlock &amp;&amp; conditionpackage com.train.concurrent.procon; import java.util.LinkedList; import java.util.Queue; import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; /** * @Time: 2020/4/22ä¸Šåˆ8:01 * @Author: kongwiki * @Email: kongwiki@163.com */ public class LockConditionModel implements Model { private final Lock BUFFER_LOCK = new ReentrantLock(); private final Condition BUFFER_COND = BUFFER_LOCK.newCondition(); private int integer; private Queue&lt;Task&gt; buffer = new LinkedList&lt;&gt;(); private int cap; public LockConditionModel(int cap){ this.cap = cap; } @Override public Runnable newRunnableConsumer() { return new ConsumerImpl(); } @Override public Runnable newRunnableProducer() { return new ProducerImpl(); } public class ProducerImpl extends AbstractProducer implements Producer, Runnable{ @Override public void produce() throws InterruptedException { Thread.sleep((long) (500 + (Math.random() * 1000))); BUFFER_LOCK.lockInterruptibly(); try{ while (buffer.size() == cap){ BUFFER_COND.await(); } Task task = new Task(integer++); buffer.offer(task); System.out.println(\"produce: \"+ task.getNo()); BUFFER_COND.signalAll(); }catch (Exception e){ e.printStackTrace(); }finally { BUFFER_LOCK.unlock(); } } } public class ConsumerImpl extends AbstractConsumer implements Consumer, Runnable{ @Override public void consume() throws InterruptedException { BUFFER_LOCK.lockInterruptibly(); try{ while (buffer.size() == 0){ BUFFER_COND.await(); } Task task = buffer.poll(); assert task != null; System.out.println(\"consume: \" + task.getNo()); BUFFER_COND.signalAll(); }catch (Exception e){ e.printStackTrace(); }finally { BUFFER_LOCK.unlock(); } } } public static void main(String[] args) { Model model = new LockConditionModel(3); for (int i = 0; i &lt; 3; i++) { new Thread(model.newRunnableConsumer()).start(); } for (int i = 0; i &lt; 5; i++) { new Thread(model.newRunnableProducer()).start(); } } }","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"çº¿ç¨‹æ± ç†è§£","slug":"Javaè¿›é˜¶/å¹¶å‘/çº¿ç¨‹æ± ç†è§£","date":"2020-04-20T12:23:43.000Z","updated":"2021-04-25T07:50:26.859Z","comments":true,"path":"çº¿ç¨‹æ± ç†è§£/","link":"","permalink":"https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/","excerpt":"çº¿ç¨‹æ± çš„æ¦‚è¿°","text":"çº¿ç¨‹æ± çš„æ¦‚è¿° çº¿ç¨‹æ± çš„å†…éƒ¨æ„å»ºäº†ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå°†çº¿ç¨‹å’Œä»»åŠ¡è¿›è¡Œè§£è€¦ï¼Œä»è€Œèƒ½å¤Ÿè‰¯å¥½çš„ç¼“å†²ä»»åŠ¡ï¼Œå¤ç”¨çº¿ç¨‹ã€‚åŒæ—¶çº¿ç¨‹æ± çš„è¿è¡Œä¸»è¦åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šä»»åŠ¡ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€‚ é‚£ä¹ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä½“ç°åœ¨å“ªå„¿ï¼Ÿä»»åŠ¡ç®¡ç†å¯ä»¥è§†ä¸ºç”Ÿäº§è€…ï¼Œçº¿ç¨‹ç®¡ç†è§†ä¸ºæ¶ˆè´¹è€…ã€‚ä»»åŠ¡è¿›å…¥çº¿ç¨‹æ± ä¸­ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­å…¶åç»­çš„æµç¨‹ï¼š ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ ä»»åŠ¡ç¼“å†²è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œ æ‹’ç»è¯¥ä»»åŠ¡ ä»¥ä¸Šå±äºä»»åŠ¡ç®¡ç†ï¼Œçº¿ç¨‹ç®¡ç†ä¸»è¦ä¸ºæ ¹æ®ä»»åŠ¡è¯·æ±‚è¿›è¡Œçº¿ç¨‹çš„åˆ†é…ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œç»§ç»­è·å–æ–°çš„ä»»åŠ¡æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡ï¼Œåˆ°ä¸€å®šæ—¶é—´ä¹‹åï¼Œè¯¥çº¿ç¨‹è¢«å›æ”¶ã€‚ åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ± çš„ä¸»è¦å®ç°ç±»ä¸ºThreadPoolExecutorï¼Œå…¶å®é˜…è¯»å…¶æºç ï¼Œå°±å¯ä»¥ç†è§£çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çš„æ€æƒ³ï¼Œä»¥åŠå¦‚ä½•å®ç°ã€‚é˜…è¯»å¥—è·¯ï¼šæ„é€ æ–¹æ³•â€”-&gt;å…¶ä»–æ–¹æ³•åŠå±æ€§ã€‚ å››ä¸ªæ„é€ æ–¹æ³•ï¼šå…¶å…±æœ‰å››ä¸­æ„é€ æ–¹æ³•ï¼Œå‚æ•°åˆ†åˆ«æœ‰5ã€6ã€6ã€7ä¸ª public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue) { ... } public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory) { ... } public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, RejectedExecutionHandler handler) { ... } public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) { ... } å¿…å¤‡çš„å‚æ•°(5ä¸ª) corePoolSizeï¼šçº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ å¯ä»¥å½¢è±¡ç†è§£ä¸ºé¤é¦†å°±é¤ä¸­çš„é¤æ¡Œï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„é¤æ¡Œæ•°é‡å°±æ˜¯corePoolSizeã€‚ maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ€»æ•°æœ€å¤§å€¼ åŒä¸Šçš„ä¾‹å­ï¼Œæ¯”ä½œä¸ºå°±é¤æ—¶é—´ï¼Œå› ä¸ºäººæµé‡å¤šï¼Œè€æ¿ä»åå¨æ–°åŠ å‡ ä¸ªé¤æ¡Œä¹‹åçš„æ•°é‡ã€‚ åœ¨çº¿ç¨‹æ± ä¸­ï¼Œä»æŸæ–¹é¢å¯ä»¥å°†çº¿ç¨‹åˆ†ä¸ºæ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹ï¼Œæ ¸å¿ƒçº¿ç¨‹é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿ä»€ä¹ˆä¹Ÿä¸å¹²ã€‚æ ¸å¿ƒçº¿ç¨‹æ•°é‡å°±æ˜¯corePoolSizeï¼Œéæ ¸å¿ƒçº¿ç¨‹ï¼Œå¦‚æœé•¿æ—¶é—´é™åˆ¶çš„è¯ï¼Œä¼šè¢«å›æ”¶(è¿™å’Œé¤æ¡Œçš„ä¾‹å­å¾ˆå¥‘åˆå“‡ğŸ˜„)ã€‚æœ€å¤§çº¿ç¨‹æ€»æ•°ï¼ˆmaximumPoolSizeï¼‰= æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼ˆcorePoolSizeï¼‰ + éæ ¸å¿ƒçº¿ç¨‹æ•°é‡ keepAliveTimeï¼šéæ ¸å¿ƒçº¿é—²ç½®è¶…æ—¶æ—¶é•¿ éæ ¸å¿ƒçº¿ç¨‹å¦‚æœå¤„äºé—²ç½®çŠ¶æ€è¶…è¿‡è¯¥å€¼ï¼Œå°±ä¼šè¢«é”€æ¯ã€‚å¦‚æœè®¾ç½®allowCoreThreadTimeOut(true)ï¼Œåˆ™ä¼šä¹Ÿä½œç”¨äºæ ¸å¿ƒçº¿ç¨‹ã€‚ TimeUnit unit æšä¸¾ç±»å‹ï¼š åŒ…å«æœ‰çº³ç§’ã€å¾®å¦™ã€æ¯«ç§’ã€ç§’ã€åˆ†ã€å°æ—¶ã€å¤© BlockingQueue\\ workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºç»´æŠ¤ç­‰å¾…æ‰§è¡Œçš„Runnableä»»åŠ¡å¯¹è±¡ å¸¸ç”¨çš„å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š LinkedBlockingQueue é“¾å¼é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé»˜è®¤å¤§å°æ˜¯Integer.MAX_VALUEï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚ ArrayBlockingQueue æ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ã€‚ SynchronousQueue åŒæ­¥é˜Ÿåˆ—ï¼Œå†…éƒ¨å®¹é‡ä¸º0ï¼Œæ¯ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚ DelayQueue å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´  ã€‚ éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°(2ä¸ª) ThreadFactory threadFactory ç”¨äºè‡ªå®šä¹‰çº¿ç¨‹æ± çš„åå­—ã€ä»¥åŠå…œåº•çš„å¼‚å¸¸å¤„ç†ç­–ç•¥ç­‰ RejectedExecutionHandler handler æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œçº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°å°±ä¼šé‡‡ç”¨æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œå››ç§æ‹’ç»å¤„ç†çš„ç­–ç•¥ä¸º ï¼š ThreadPoolExecutor.AbortPolicyï¼šé»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardPolicyï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚ ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚ ä½¿ç”¨çº¿ç¨‹æ± çš„ä¸»è¦åŸå› æœ‰å¦‚ä¸‹: åˆ›å»º/é”€æ¯çº¿ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ± å¯ä»¥å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹ã€‚ æ§åˆ¶å¹¶å‘çš„æ•°é‡ã€‚å¹¶å‘æ•°é‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œä»è€Œé€ æˆæœåŠ¡å™¨å´©æºƒã€‚ï¼ˆä¸»è¦åŸå› ï¼‰ å¯ä»¥å¯¹çº¿ç¨‹åšç»Ÿä¸€ç®¡ç†ã€‚ çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸçº¿ç¨‹æ± æœ¬èº«æœ‰ä¸€ä¸ªè°ƒåº¦çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯ç”¨äºç®¡ç†å¸ƒæ§æ•´ä¸ªçº¿ç¨‹æ± é‡Œçš„å„ç§ä»»åŠ¡å’Œäº‹åŠ¡ï¼Œä¾‹å¦‚åˆ›å»ºçº¿ç¨‹ã€é”€æ¯çº¿ç¨‹ã€ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ã€çº¿ç¨‹é˜Ÿåˆ—ç®¡ç†ç­‰ç­‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± ä¸­ä¹Ÿæœ‰è‡ªå·±çš„çŠ¶æ€ã€‚é€šè¿‡æºç äº†è§£åˆ°ThreadPoolExecutorç±»ä¸­é€šè¿‡volatile int å®šä¹‰äº†runStateå˜é‡è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€ã€‚ // runState is stored in the high-order bits private static final int RUNNING = -1 &lt;&lt; COUNT_BITS; private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS; private static final int STOP = 1 &lt;&lt; COUNT_BITS; private static final int TIDYING = 2 &lt;&lt; COUNT_BITS; private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; è¿è¡ŒçŠ¶æ€ çŠ¶æ€æè¿° è½¬æ¢æ–¹æ³• RUNNING èƒ½å¤Ÿæ¥å—æ–°çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ çº¿ç¨‹æ± åˆ›å»ºä¹‹å SHUTDOWN ä¸å†æ¥æ”¶æ–°æäº¤çš„ä»»åŠ¡ï¼Œæ¸…é™¤ä¸€äº›ç©ºé—²workerï¼Œä¼šç­‰å¾…é˜»å¡é˜Ÿåˆ—ä¸­å­˜å‚¨çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚ shutdownï¼ˆï¼‰ STOP åœæ­¢æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œçš„ï¼‰ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­ä¸ºæ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨æŠ›å¼ƒï¼Œæ­¤æ—¶poosize = 0, é˜»å¡é˜Ÿåˆ—size = 0; shutdownNow() TIDYING æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ç»ˆæ­¢ï¼ŒworkerCountï¼ˆæœ‰æ•ˆçº¿ç¨‹æ•°é‡ï¼‰æ•°é‡ä¸º0 TERMINATED terminated()æ–¹æ³•æ‰§è¡Œåï¼Œè¿›å…¥è¯¥çŠ¶æ€ ä»»åŠ¡çš„ç®¡ç†æ¦‚è¿°ä¸­å·²ç»æåŠï¼Œçº¿ç¨‹æ± å†…éƒ¨å°±æ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä»»åŠ¡ç®¡ç†è§†ä¸ºç”Ÿäº§è€…ï¼Œçº¿ç¨‹ç®¡ç†è§†ä¸ºæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¯¦ç»†é˜è¿°ä»»åŠ¡ç®¡ç†å’Œçº¿ç¨‹ç®¡ç† ä»»åŠ¡çš„è°ƒåº¦ä»»åŠ¡çš„è°ƒåº¦ï¼Œæ„Ÿè§‰å’Œæ“ä½œç³»ç»Ÿä¸­å¤„ç†æœºçš„è°ƒåº¦ç±»ä¼¼ï¼Œä»»åŠ¡æäº¤ä¹‹åï¼Œè¿›è¡Œåˆ¤æ–­ åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦ä¸ºRUNNINGï¼Œå¦‚ä¸æ‰§è¡Œäº†ï¼Œæ‹’ç»æ¥æ”¶è¯¥ä»»åŠ¡ï¼ˆçº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡ï¼‰ã€‚ å¦‚æœworkerCount &lt; corePoolSize, åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡ã€‚ å¦‚æœworkerCount &gt;= corePoolSize &amp;&amp; é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œå°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚ å¦‚æœworkerCount &gt;=corePoolSize &amp;&amp; é˜»å¡é˜Ÿé‡Œå·²æ»¡&amp;&amp;workerCount &lt; maximumPoolSizeï¼Œåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡ å¦‚æœworkerCount &gt;= maximumPoolSize &amp;&amp; é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œ æ ¹æ®æ‹’ç­–ç•¥è¿›è¡Œæ‹’ç»ï¼Œé»˜è®¤ä½¿ç”¨æ˜¯AbortPolicyï¼Œæ”¾å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ ä»»åŠ¡è°ƒåº¦æµç¨‹å›¾.png ThreadPoolExecutorä¸­ä»»åŠ¡è°ƒåº¦çš„å®ç° public void execute(Runnable command) { if (command == null) throw new NullPointerException(); // è·å–çº¿ç¨‹æ± çŠ¶æ€ int c = ctl.get(); // â‘¡ if (workerCountOf(c) &lt; corePoolSize) { if (addWorker(command, true)) return; c = ctl.get(); } // â‘¢ if (isRunning(c) &amp;&amp; workQueue.offer(command)) { int recheck = ctl.get(); // 3.1 å¦‚æœisRunningè¿”å›false(çŠ¶æ€æ£€æŸ¥)ï¼Œåˆ™removeè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ if (! isRunning(recheck) &amp;&amp; remove(command)) reject(command); // 3.2 çº¿ç¨‹æ± å¤„äºrunningçŠ¶æ€ï¼Œä½†æ˜¯æ²¡æœ‰çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹ else if (workerCountOf(recheck) == 0) addWorker(null, false); } // â‘£å¦‚æœworkerCount &gt;=corePoolSize &amp;&amp; é˜»å¡é˜Ÿé‡Œå·²æ»¡&amp;&amp;workerCount &lt; maximumPoolSizeï¼Œåˆ›å»ºå¹¶å¯ // åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡ else if (!addWorker(command, false)) reject(command); } ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰è¿™æ˜¯çº¿ç¨‹æ± çš„å…³é”®ï¼Œå…¶ç­‰åŒäºç”Ÿäº§è€…-æ¶ˆè´¹è€…ä¸­çš„ç¼“å†²åŒºï¼Œåœ¨çº¿ç¨‹æ± ä¸­ï¼Œæ ¸å¿ƒæ˜¯å¯¹ä»»åŠ¡å’Œçº¿ç¨‹çš„ç®¡ç†ï¼Œä¸Šè¿°ä¹Ÿè®²è¿‡äº†æ ¸å¿ƒå°±æ˜¯ä»»åŠ¡å’Œçº¿ç¨‹çš„è§£è€¦ï¼Œè§£è€¦çš„æ–¹å¼å°±æ˜¯æ·»åŠ ç¼“å†²åŒºã€‚åœ¨çº¿ç¨‹æ± ä¸­é€šè¿‡é˜»å¡é˜Ÿåˆ—å®ç°ç¼“å†²åŒºï¼Œæš‚å­˜ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚ é˜»å¡é˜Ÿåˆ—å¸¸ç”¨ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…åœºæ™¯ï¼Œå…¶é™¤äº†æ”¯æŒå­˜å‚¨ä»»åŠ¡çš„çº¿ç¨‹å­˜å‚¨å…ƒç´ ï¼Œè·å–ä»»åŠ¡çš„çº¿ç¨‹è·å–å…ƒç´ ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªé™„åŠ çš„æ“ä½œï¼ˆè‡ªå·±ç¼–å†™ç”Ÿäº§è€…-æ¶ˆè´¹è€…æœ€éº»çƒ¦çš„åœ°æ–¹ï¼‰ï¼š å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œè·å–ä»»åŠ¡çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—éç©º å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå­˜æ”¾ä»»åŠ¡çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚ è¿™æ ·ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åªç®¡å¾€é‡Œé¢å­˜ã€å–å°±è¡Œï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å­˜ã€å–å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹ï¼Œé˜»å¡é˜Ÿåˆ—ï¼ˆBlockQueueå°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼‰ï¼Œå…¶æä¾›äº†å››ä¸­ä¸åŒæ’å…¥ã€ç§»é™¤ã€æ£€æµ‹å…ƒç´ çš„æ–¹æ³•ï¼š æ–¹æ³• æŠ›å‡ºå¼‚å¸¸ è¿”å›ç‰¹æ®Šå€¼ ä¸€ç›´é˜»å¡ è¶…æ—¶é€€å‡º æ’å…¥ add(e) offer() put(e) offer(e, time , unit) ç§»é™¤ remove() poll() take() poll(time, unit) æ£€æŸ¥ element() peek() BlockingQueueçš„å®ç°ç±»æœ‰å¦‚ä¸‹çš„ä¸€äº› ArrayBlockingQueue LinkedBlockingQueue DelayQueue PriorityBlockingQueue SynchronousQueue åç»­ä¼šçœ‹ç›¸åº”çš„æºç ï¼Œå¹¶æ•´ç†ä¸ºåšå®¢ã€‚ç›®å‰å°±ä¸è¯¦ç»†è§£é‡Šå…¶åŒºåˆ«ã€‚ ä»»åŠ¡çš„ç”³è¯·ç”±ä»»åŠ¡çš„è°ƒåº¦å¯ä»¥æ€»ç»“å‡ºï¼Œä»»åŠ¡çš„æ‰§è¡Œæœ‰ä¸¤ç§å¯èƒ½ ä»»åŠ¡ç›´æ¥ç”±æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ å¤ç”¨çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œæ‰§è¡Œ ç¬¬ä¸€ç§æƒ…å†µå‡ºç°åœ¨çº¿ç¨‹åˆå§‹åˆ›å»ºçš„æ—¶å€™ï¼Œä»¥åŠå‡ºç°å³°å€¼çš„æ—¶å€™ã€‚ç¬¬äºŒç§æ˜¯çº¿ç¨‹è·å–ä»»åŠ¡ç»å¤§å¤šæ•°çš„æƒ…å†µã€‚è¿™é‡Œå¯ä»¥é¡ºä¾¿åˆ†æThreadPoolExecutoræ˜¯å¦‚ä½•å®ç°çº¿ç¨‹çš„å¤ç”¨çš„ã€‚ ç¬¬äºŒç§çš„ä»»åŠ¡çš„ç”³è¯·ä½¿ç”¨çš„æ˜¯çº¿ç¨‹æ± ä¸­çš„getTaskçš„æ–¹æ³• private Runnable getTask() { boolean timedOut = false; // Did the last poll() time out? for (;;) { int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) { decrementWorkerCount(); return null; } int wc = workerCountOf(c); // Are workers subject to culling? // boolean timed = allowCoreThreadTimeOut || wc &gt; corePoolSize; // å¦‚æœè¿è¡Œçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯ç¼“å­˜é˜Ÿåˆ—å·²ç»ç©ºäº†ï¼Œè¿™æ—¶é€’å‡workeræ•°é‡ if ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut)) &amp;&amp; (wc &gt; 1 || workQueue.isEmpty())) { if (compareAndDecrementWorkerCount(c)) return null; continue; } try { Runnable r = timed ? workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) : workQueue.take(); if (r != null) return r; timedOut = true; } catch (InterruptedException retry) { timedOut = false; } } } ä»»åŠ¡çš„æ‹’ç»ä»»åŠ¡æ‹’ç»æ¨¡å—æ˜¯çº¿ç¨‹æ± çš„ä¿æŠ¤éƒ¨åˆ†ï¼Œçº¿ç¨‹æ± æœ‰ä¸€ä¸ªæœ€å¤§çš„å®¹é‡ï¼Œå½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeæ—¶ï¼Œå°±éœ€è¦æ‹’ç»æ‰è¯¥ä»»åŠ¡ï¼Œé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œä¿æŠ¤çº¿ç¨‹æ± ã€‚ å†³ç»ç­–ç•¥åœ¨æ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œå°±å·²ç»è®²è§£äº†ï¼Œå…±å››ç§ï¼š ThreadPoolExecutor.AbortPolicyï¼šé»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardPolicyï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚ ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚ çº¿ç¨‹çš„ç®¡ç†Workerçº¿ç¨‹çº¿ç¨‹æ± ä¸ºäº†æŒæ¡çº¿ç¨‹çš„çŠ¶æ€å¹¶ç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®¾è®¡äº†çº¿ç¨‹æ± å†…çš„å·¥ä½œçº¿ç¨‹Workerã€‚ private final class Worker extends AbstractQueuedSynchronizer implements Runnable{ ... } Workerç»§æ‰¿äº†AbstractQueueSynchronnizerï¼Œå®ç°äº†Runnableæ¥å£ã€‚ æ„é€ æ–¹æ³•Worker(Runnable firstTask) { setState(-1); // inhibit interrupts until runWorker this.firstTask = firstTask; this.thread = getThreadFactory().newThread(this); } é€šè¿‡ThreadFactoryæ–¹æ³•åˆ›å»ºçº¿ç¨‹ï¼ŒfirstTaskå¯ä¸ºç©ºï¼Œä¸ºç©ºçš„æ—¶å€™ï¼Œä¹Ÿå°±å¯¹åº”çº¿ç¨‹å»é˜»å¡é˜Ÿåˆ—ä¸­å»è·å–ä»»åŠ¡ï¼Œè‹¥æ˜¯ä¸ä¸ºç©ºï¼Œå¯¹åº”çš„ä¸ºç›´æ¥æ‰§è¡Œä»»åŠ¡ã€‚ runæ–¹æ³•public void run() { runWorker(this); } Workerçº¿ç¨‹å¢åŠ (æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨)Workerçº¿ç¨‹çš„å¢åŠ æ˜¯é€šè¿‡çº¿ç¨‹æ± ä¸­çš„addWorker()æ–¹æ³• ä¸Šç¯‡private boolean addWorker(Runnable firstTask, boolean core) { // æºç ä¸­çš„ä¸ŠåŠéƒ¨åˆ† retry: for (;;) { int c = ctl.get(); int rs = runStateOf(c); // Check if queue empty only if necessary. if (rs &gt;= SHUTDOWN &amp;&amp; ! (rs == SHUTDOWN &amp;&amp; firstTask == null &amp;&amp; ! workQueue.isEmpty())) return false; for (;;) { // å½“å‰çº¿ç¨‹çš„æ€»æ•° int wc = workerCountOf(c); if (wc &gt;= CAPACITY || // 1.å¦‚æœcoreæ˜¯ture,è¯æ˜éœ€è¦åˆ›å»ºçš„çº¿ç¨‹ä¸ºæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹ // å¦‚æœcoreæ˜¯false,è¯æ˜éœ€è¦åˆ›å»ºçš„æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºæ€»çº¿ç¨‹æ•° // å¦‚æœä¸å°äºï¼Œåˆ™è¿”å›false wc &gt;= (core ? corePoolSize : maximumPoolSize)) return false; if (compareAndIncrementWorkerCount(c)) break retry; c = ctl.get(); // Re-read ctl if (runStateOf(c) != rs) continue retry; // else CAS failed due to workerCount change; retry inner loop } } ä»¥ä¸Šçš„éƒ¨åˆ†ç”¨äºåˆ¤æ–­çº¿ç¨‹æ•°é‡æ˜¯å¦è¶…å‡ºé˜€å€¼ï¼Œè¶…è¿‡äº†å°±è¿”å›ä¸ºfalse ä¸‹ç¯‡boolean workerStarted = false; boolean workerAdded = false; Worker w = null; try { // åˆ›å»ºworkerå¯¹è±¡ w = new Worker(firstTask); // å®ä¾‹åŒ–threadå¯¹è±¡ final Thread t = w.thread; if (t != null) { // å…¨å±€é” final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try { // Recheck while holding lock. // Back out on ThreadFactory failure or if // shut down before lock acquired. int rs = runStateOf(ctl.get()); if (rs &lt; SHUTDOWN || (rs == SHUTDOWN &amp;&amp; firstTask == null)) { if (t.isAlive()) // precheck that t is startable throw new IllegalThreadStateException(); // åŠ å…¥åˆ°workers setä¸­ workers.add(w); int s = workers.size(); if (s &gt; largestPoolSize) largestPoolSize = s; workerAdded = true; } } finally { mainLock.unlock(); } if (workerAdded) { // å¯åŠ¨çº¿ç¨‹ t.start(); workerStarted = true; } } } finally { if (! workerStarted) addWorkerFailed(w); } return workerStarted; åˆ›å»ºworkerå¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ªThreadå¯¹è±¡ï¼Œç„¶åå¯åŠ¨è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚t.start()æ–¹æ³•ä¼šè°ƒç”¨Workerä¸­çš„runæ–¹æ³•ï¼Œrunæ–¹æ³•åˆä½¿ç”¨äº†runWorker()æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡ŒrunWorker()æ–¹æ³•final void runWorker(Worker w) { Thread wt = Thread.currentThread(); Runnable task = w.firstTask; w.firstTask = null; w.unlock(); boolean completedAbruptly = true; try { // Workeræ‰§è¡ŒfirstTaskæˆ–ä»workQueueä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœgetTaskæ–¹æ³•ä¸è¿”å›null,å¾ªç¯ä¸é€€å‡º while (task != null || (task = getTask()) != null) { w.lock(); if ((runStateAtLeast(ctl.get(), STOP) || (Thread.interrupted() &amp;&amp; runStateAtLeast(ctl.get(), STOP))) &amp;&amp; !wt.isInterrupted()) wt.interrupt(); try { beforeExecute(wt, task); Throwable thrown = null; try { // æ‰§è¡Œä»»åŠ¡ task.run(); } catch (RuntimeException x) { thrown = x; throw x; } catch (Error x) { thrown = x; throw x; } catch (Throwable x) { thrown = x; throw new Error(x); } finally { afterExecute(task, thrown); } } finally { task = null; w.completedTasks++; w.unlock(); } } completedAbruptly = false; } finally { processWorkerExit(w, completedAbruptly); } } é¦–å…ˆå»æ‰§è¡Œåˆ›å»ºè¿™ä¸ªworkeræ—¶å°±æœ‰çš„ä»»åŠ¡ï¼Œå½“æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åï¼Œworkerçš„ç”Ÿå‘½å‘¨æœŸå¹¶æ²¡æœ‰ç»“æŸï¼Œåœ¨whileå¾ªç¯ä¸­ï¼Œworkerä¼šä¸æ–­åœ°è°ƒç”¨getTaskæ–¹æ³•ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ç„¶åè°ƒç”¨task.run()æ‰§è¡Œä»»åŠ¡,ä»è€Œè¾¾åˆ°å¤ç”¨çº¿ç¨‹çš„ç›®çš„ã€‚åªè¦getTaskæ–¹æ³•ä¸è¿”å›null,æ­¤çº¿ç¨‹å°±ä¸ä¼šé€€å‡ºã€‚ å¸¸è§çš„çº¿ç¨‹æ± Executorsç±»ä¸­æä¾›çš„å‡ ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚é€šè¿‡å‰é¢çš„ThreadPoolExecutorçš„æ„é€ æ–¹æ³•ï¼Œå°±å¯ä»¥æ˜ç™½è¿™äº›çº¿ç¨‹æ± å…·ä½“å¹²å•¥çš„ï¼Œå¾ˆå¯æƒœï¼Œé˜»å¡é˜Ÿåˆ—çš„å…·ä½“å®ç°è¿˜æ²¡æœ‰çœ‹ï¼Œè€Œä¸”çº¿ç¨‹æ± çš„demoå†™çš„ä¹Ÿä¸å¤šï¼Œè®¤è¯†ä¸æ·±åˆ»ï¼Œæ‰€ä»¥å°±æš‚æ—¶å…ˆä¸å†™ã€‚ newCachedThreadPoolpublic static ExecutorService newCachedThreadPool() { return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;()); } newFixedThreadPoolpublic static ExecutorService newFixedThreadPool(int nThreads) { return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()); } newSingleThreadExecutorpublic static ExecutorService newSingleThreadExecutor() { return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;())); } newScheduledThreadPoolpublic static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) { return new ScheduledThreadPoolExecutor(corePoolSize); } //ScheduledThreadPoolExecutor(): public ScheduledThreadPoolExecutor(int corePoolSize) { super(corePoolSize, Integer.MAX_VALUE, DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS, new DelayedWorkQueue()); } Executoræ¡†æ¶ ThreadExecutorUML.png References çº¿ç¨‹æ± åŸç† æ·±å…¥ç†è§£çº¿ç¨‹æ±  â€”â€” Javaçº¿ç¨‹æ± æ˜¯å¦‚ä½•è¯ç”Ÿçš„ Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"Javaçº¿ç¨‹ä¹‹é—´é€šä¿¡æ–¹å¼","slug":"Javaè¿›é˜¶/å¹¶å‘/Javaçº¿ç¨‹ä¹‹é—´é€šä¿¡æ–¹å¼","date":"2020-04-19T08:49:54.000Z","updated":"2021-04-27T07:42:26.716Z","comments":true,"path":"Javaçº¿ç¨‹ä¹‹é—´é€šä¿¡æ–¹å¼/","link":"","permalink":"https://winniekun.github.io/Java%E7%BA%BF%E7%A8%8B%E4%B9%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/","excerpt":"çº¿ç¨‹é€šä¿¡","text":"çº¿ç¨‹é€šä¿¡ åˆç†çš„ä½¿ç”¨Javaå¤šçº¿ç¨‹å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨æœåŠ¡å™¨èµ„æºã€‚ä¸€èˆ¬æ¥è®²ï¼Œçº¿ç¨‹å†…éƒ¨æœ‰è‡ªå·±ç§æœ‰çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œäº’ä¸å¹²æ‰°ã€‚ä½†æ˜¯å½“æˆ‘ä»¬éœ€è¦å¤šä¸ªçº¿ç¨‹ä¹‹é—´ç›¸äº’åä½œçš„æ—¶å€™ï¼Œå°±éœ€è¦æˆ‘ä»¬æŒæ¡Javaçº¿ç¨‹çš„é€šä¿¡æ–¹å¼ã€‚æœ¬æ–‡å°†ä»‹ç»Javaçº¿ç¨‹ä¹‹é—´çš„å‡ ç§é€šä¿¡åŸç†ã€‚ é”åŒæ­¥æœºåˆ¶ä½¿ç”¨synchronized public class lockSyn { static class ThreadA implements Runnable{ @Override public void run() { synchronized (this) { for (int i = 0; i &lt; 10; i++) { System.out.println(\"ThreadA \" + i); } } } } static class ThreadB implements Runnable{ @Override public void run() { synchronized (this) { for (int i = 0; i &lt; 10; i++) { System.out.println(\"ThreadB \" + i); } } } } public static void main(String[] args) throws InterruptedException { new Thread(new ThreadA()).start(); Thread.sleep(1000); new Thread(new ThreadB()).start(); } } è¿™æ®µç¨‹åºèƒ½å¤Ÿä¿è¯å…ˆæ‰§è¡Œçº¿ç¨‹Aï¼Œä¹‹åå†æ‰§è¡Œçº¿ç¨‹Bã€‚ ç­‰å¾…/é€šçŸ¥æœºåˆ¶ä½¿ç”¨wait()/notify()æœºåˆ¶ public class waitNotify { private static Object lock = new Object(); static class A implements Runnable{ @Override public void run() { synchronized (lock){ for (int i = 0; i &lt; 5; i++) { System.out.println(\"A:\" + i); lock.notify(); try { lock.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } lock.notify(); } } } static class B implements Runnable{ @Override public void run() { synchronized (lock){ for (int i = 0; i &lt; 5; i++) { System.out.println(\"B:\" + i); lock.notify(); try { lock.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } lock.notify(); } } } public static void main(String[] args) throws InterruptedException { new Thread(new A()).start(); Thread.sleep(1000); new Thread(new B()).start(); } } wait(): ä¼šé‡Šæ”¾é”ã€‚ ä¿¡å·é‡æœºåˆ¶ä½¿ç”¨volatileå®šä¹‰ä¿¡å·é‡(æ¶‰åŠJMMâ€”-Javaå†…å­˜æ¨¡å‹) public class semaphore { private static volatile int signal = 0; static class ThreadA implements Runnable{ @Override public void run() { while (signal &lt; 10){ if(signal % 2 == 0){ System.out.println(\"ThreadA: \" + signal); signal++; } } } } static class ThreadB implements Runnable{ @Override public void run() { while (signal &lt; 10){ if(signal % 2 == 1){ System.out.println(\"ThreadB: \"+ signal); signal++; } } } } public static void main(String[] args) throws InterruptedException { new Thread(new ThreadA()).start(); Thread.sleep(1000); new Thread(new ThreadB()).start(); } }","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"TCP/IPé€šè¯†","slug":"ç½‘ç»œ/TCP-IPé€šè¯†","date":"2020-04-17T01:36:34.000Z","updated":"2020-08-30T04:50:22.262Z","comments":true,"path":"TCP-IPé€šè¯†/","link":"","permalink":"https://winniekun.github.io/TCP-IP%E9%80%9A%E8%AF%86/","excerpt":"OSIå‚è€ƒæ¨¡å‹","text":"OSIå‚è€ƒæ¨¡å‹ åºå· å±‚ å¸¸ç”¨åè®® åº”ç”¨ 7 åº”ç”¨å±‚ HTTPã€SMTPã€SSH é’ˆå¯¹ç‰¹å®šåº”ç”¨çš„åè®® 6 è¡¨ç¤ºå±‚ åŒä¸Š è®¾å¤‡å›ºæœ‰æ•°æ®æ ¼å¼å’Œç½‘è·¯æ ‡å‡†æ ¼å¼è½¬åŒ– 5 ä¼šè¯å±‚ åŒä¸Š é€šä¿¡ç®¡ç†ã€‚è´Ÿè´£å»ºç«‹å’Œæ–­å¼€é€šä¿¡é“¾æ¥ 4 ä¼ è¾“å±‚ TCPã€UDPã€UDP-Liteã€SCTPã€DCCP ç®¡ç†ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚ 3 ç½‘ç»œå±‚ IPã€ARPã€IPv4ã€IPv6ã€ICMP åœ°å€ç®¡ç†å’Œè·¯ç”±å™¨é€‰æ‹© 2 æ•°æ®é“¾è·¯å±‚ ä»¥å¤ªç½‘ã€æ— çº¿LANã€PPPâ€¦ äº’è”è®¾å¤‡ä¹‹é—´ä¼ é€å’Œè¯†åˆ«æ•°æ®å¸§ï¼ˆå°†0 ã€1åºåˆ—åˆ’åˆ†ä¸ºå…·æœ‰æ„ä¹‰çš„æ•°æ®å¸§ä¼ é€ç»™ç»ˆç«¯ï¼‰ 1 ç‰©ç†å±‚ åŒä¸Š 0 ã€1æ•°å­—ä¿¡å· TCP/IPçš„å…·ä½“æ„ä¹‰ä»å­—é¢æ„æ€ä¸Šè¯´ï¼ŒTCP/IPæŒ‡çš„å°±æ˜¯TCPã€IPä¸¤ä¸ªåè®®ã€‚è™½ç„¶æœ‰äº›æƒ…å†µä¸‹å°±æ˜¯è¿™ä¸¤ä¸ªåè®®ï¼Œå…¶å®ä¸ç„¶ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯åˆ©ç”¨IPè¿›è¡Œé€šä¿¡æ—¶æ‰€å¿…é¡»ç”¨åˆ°çš„åè®®ç¾¤çš„ç»Ÿç§°ã€‚è­¬å¦‚ï¼šIPæˆ–ICMPã€TCPæˆ–UDPã€TELNETæˆ–FTPã€ä»¥åŠ HTTPéƒ½å±äºTCP/IPåè®®ã€‚TCP/IPæ³›æŒ‡è¿™äº›åè®®ã€‚æœ‰æ—¶ä¹Ÿç»Ÿç§°TCP/IPä¸ºç½‘é™…åè®®æ—ã€‚ TCP/IPåè®®åˆ†å±‚æ¨¡å‹ åºå· å±‚ å¸¸ç”¨åè®® 5 åº”ç”¨å±‚ HTTPã€SMTPã€SSH 4 ä¼ è¾“å±‚ TCPã€UDP 3 ç½‘ç»œå±‚ IPã€ICMPã€ARP 2 æ•°æ®é“¾è·¯å±‚ PPP 1 ç‰©ç†å±‚ OSIæ¨¡å‹å’ŒTCP/IPæ¨¡å‹çš„åŒºåˆ«OSI: æ³¨é‡é€šä¿¡åè®®å¿…è¦çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆ TCP/IP: æ³¨é‡åœ¨è®¡ç®—æœºå®ä¸Šç°åè®®åº”è¯¥å¼€å‘å“ªç§ç¨‹åº ä¸€äº›åè®®ä¹‹é—´çš„åŒºåˆ«IPå’ŒICMPIPåè®®: èƒ½ä½¿å¾—æ•´ä¸ªäº’è”ç½‘éƒ½èƒ½æ”¶åˆ°æ•°æ®çš„åè®®ï¼Œä½¿ç”¨IPåœ°å€ä½œä¸ºä¸»æœºçš„æ ‡è¯†ï¼Œå°†æ•°æ®åŒ…å‘é€ç»™ç›®æ ‡åœ°å€ã€‚ä½†æ˜¯å…¶ä¸å…·æœ‰é‡å‘æœºåˆ¶ï¼Œå³ä½¿å‘é€å¤±è´¥ï¼Œä¹Ÿä¸ä¼šé‡å‘ï¼Œæ‰€ä»¥æ˜¯ä¸€ç§éå¯é æ€§ä¼ è¾“åè®®ã€‚ ICMP: IPæ•°æ®åŒ…å‘é€é€”ä¸­å‡ºç°å¼‚å¸¸è€Œæ— æ³•å‘é€åˆ°ç›®æ ‡åœ°å€ï¼Œè¿™æ—¶ä½¿ç”¨ICMPåè®®ç»™å‘é€è€…å‘é€ä¸€ä¸ªå‘é€å¼‚å¸¸çš„é€šçŸ¥ TCPå’ŒUDPTCPï¼šé¢å‘è¿æ¥çš„å¯é æ€§ä¼ è¾“åè®®ï¼Œå…¶ä¸ºäº†å»ºç«‹å’Œæ–­å¼€é“¾æ¥ï¼Œéœ€è¦è‡³å°‘7æ¬¡çš„å‘åŒ…æ”¶åŒ…ï¼ˆ3æ¬¡æ¡æ‰‹ã€4æ¬¡åˆ†æ‰‹ï¼‰ UDPï¼šé¢å‘æ— è¿æ¥çš„ä¸å¯é æ€§ä¼ è¾“åè®®ï¼Œå…¶ä¸ä¼šå…³æ³¨ç›®æ ‡æ˜¯å¦çœŸçš„æ¥æ”¶åˆ°äº†æ•°æ®åŒ…ï¼ˆå¤šåª’ä½“é¢†åŸŸï¼‰ References å›¾è§£TCP/IPåè®®","categories":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://winniekun.github.io/categories/%E7%BD%91%E7%BB%9C/"}],"tags":[{"name":"ip","slug":"ip","permalink":"https://winniekun.github.io/tags/ip/"},{"name":"tcp","slug":"tcp","permalink":"https://winniekun.github.io/tags/tcp/"}]},{"title":"çŸ©é˜µæ ‘çš„å®šç†","slug":"ç®—æ³•/å®ç°-å›¾è®º/çŸ©é˜µæ ‘çš„å®ç°","date":"2020-04-10T02:07:19.000Z","updated":"2020-08-30T04:50:22.260Z","comments":true,"path":"çŸ©é˜µæ ‘çš„å®ç°/","link":"","permalink":"https://winniekun.github.io/%E7%9F%A9%E9%98%B5%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0/","excerpt":"TODO","text":"TODO å‰è¨€çŸ©é˜µæ ‘å®šç†çš„ç†è§£ï¼Œä¸”ä»£ç å®ç°ã€‚å¹¶ä¸”æ·»åŠ äº†å‡ é“å®æˆ˜é¢˜ç›® ç®€ä»‹&amp;æ€è·¯Kirchhoff çŸ©é˜µæ ‘å®šç†ï¼ˆç®€ç§°çŸ©é˜µæ ‘å®šç†ï¼‰è§£å†³äº†ä¸€å¼ å›¾çš„ç”Ÿæˆæ ‘ä¸ªæ•°è®¡æ•°é—®é¢˜ã€‚ æ— å‘å›¾è®¾$G$æ˜¯ä¸€ä¸ªæœ‰nä¸ªé¡¶ç‚¹çš„æ— å‘å›¾ã€‚å®šä¹‰åº¦æ•°çŸ©é˜µ$D(G)$ä¸ºï¼š $D{ii}(G) = \\mathrm{deg}(i), D{ij} = 0, i\\neq j$ Gçš„é‚»æ¥çŸ©é˜µ$A(G)$ä¸ºï¼š $A{ij}(G) = A{ij}(G)$ å®šä¹‰ Laplace çŸ©é˜µï¼ˆäº¦ç§° Kirchhoff çŸ©é˜µï¼‰$L$ä¸ºï¼š $L(G) = D(G) - A(G)$ $G$çš„æ‰€æœ‰ä¸åŒçš„ç”Ÿæˆæ ‘çš„ä¸ªæ•°ç­‰äºå…¶LaplaceçŸ©é˜µï¼ˆ$L(G)$ï¼‰çš„ä»»ä½•ä¸€ä¸ªn-1ä¸»å­å¼çš„ç»å¯¹å€¼ï¼Œæ‰€è°“ n-1 é˜¶ä¸»å­å¼,å°±æ˜¯å¯¹äº r(1â‰¤râ‰¤n),å°†$G$çš„ç¬¬ r è¡Œã€ç¬¬ r åˆ—åŒæ—¶å»æ‰åå¾—åˆ°çš„æ–°çŸ©é˜µ$G_r$ ä¸¾ä¾‹ï¼š æ— å‘å›¾$G$å¦‚ä¸‹å›¾æ‰€ç¤º åˆ™$A(G)$è¡¨ç¤ºä¸ºï¼š $\\begin{matrix}0 &amp; 1 &amp; 1 &amp; 0\\\\ 1 &amp; 0 &amp; 1 &amp; 1\\\\ 1 &amp; 1 &amp; 0 &amp; 0\\\\ 0 &amp; 1 &amp; 0 &amp; 0\\\\\\end{matrix} $ $D(G)$è¡¨ç¤ºä¸º: $\\begin{matrix}2 &amp; 0 &amp; 0 &amp; 0\\\\ 0 &amp; 3 &amp; 0 &amp; 0\\\\ 0 &amp; 0 &amp; 2 &amp; 0\\\\ 0 &amp; 0 &amp; 0 &amp; 1\\\\\\end{matrix} $ $L(G)$è¡¨ç¤ºä¸ºï¼š $\\begin{matrix}2 &amp; -1 &amp; -1 &amp; 0\\\\ -1 &amp; 3 &amp; -1 &amp; -1\\\\ -1 &amp; -1 &amp; 2 &amp; 0\\\\0&amp;-1&amp;0&amp;1\\\\ \\end{matrix} $ å»é™¤$r$ = 1ä¹‹åå¾—åˆ°ä¸»å­å¼$G_r$çš„ç»å¯¹å€¼å³ä¸ºè¯¥å›¾çš„ç”Ÿæˆæ ‘ä¸ªæ•°ã€‚ $G_r$ = $\\begin{matrix} 3 &amp; -1 &amp; -1 \\\\-1&amp;2&amp;0\\\\-1&amp;0&amp;1\\\\ \\end{matrix} $ æ ¹æ®å…¬å¼è®¡ç®—çš„ $|G_r|$ = 3 æ‰€ä»¥è¯¥å›¾å…±æœ‰ä¸‰ç§ç”Ÿæˆæ ‘ã€‚ ç”Ÿæˆæ ‘ä¸ªæ•°.png æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œ æˆ‘ä¹Ÿè§‰å¾—å¾ˆç¥å¥‡ï¼Œç„¶åå»çœ‹äº†è¯æ˜ï¼Œä¹Ÿå¾ˆç¥å¥‡ğŸ˜‘ æœ‰å‘å›¾åŒç†åŒç† è¡Œåˆ—å¼çš„å˜æ¢ äº¤æ¢ä¸¤è¡Œ/åˆ—ä½ç½®ï¼Œè¡Œåˆ—å¼å–ç›¸åæ•° å¯¹ä¸€è¡Œ/åˆ—ä¹˜ä»¥æŸæ•°ï¼Œè¡Œåˆ—å¼ä¹Ÿä¹˜ä»¥æŸæ•° ç”¨ä¸€è¡Œçš„å€æ•°å‡å»å¦ä¸€è¡Œï¼Œè¡Œåˆ—å¼çš„å€¼ä¸å˜ ä¸€ä¸ªä¸Šä¸‰è§’è¡Œåˆ—å¼çš„å€¼ç­‰äºå¯¹è§’çº¿çš„ä¹˜ç§¯ è½¬ç½®çŸ©é˜µï¼Œè¡Œåˆ—å¼ä¸å˜ ACMçŸ©é˜µè¡Œåˆ—å¼è®¡ç®— å®ç°æŒ‰ç…§æ•°å­¦å…¬å¼è®¡ç®—ä½™å­å¼çš„å€¼çš„è¯ï¼Œå¤æ‚åº¦è¾¾åˆ°$O(N!)*N $ ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡è¡Œåˆ—å¼çš„æ€§è´¨ï¼Œè¿›è¡ŒåŸºç¡€çš„å˜æ¢ä¹‹åå†è®¡ç®—ã€‚ é¢˜ç›® ã€ŒHEOI2015ã€å° Z çš„æˆ¿é—´ ã€ŒFJOI2007ã€è½®çŠ¶ç—…æ¯’ å°Zçš„æˆ¿é—´çŸ©é˜µæ ‘å®šç†çš„è£¸é¢˜ï¼Œé¢˜ç›®ç»™å®šçš„é™åˆ¶ä¸º1â‰¤n,mâ‰¤9 çŸ©é˜µç»´åº¦é™åˆ¶åœ¨äº†ä¸ªä½æ•°ï¼Œç®—æ³•æœ‰å¾…ä¼˜åŒ–ã€‚ #include &lt;cstdio&gt; #include &lt;iostream&gt; #include &lt;cmath&gt; using namespace std; typedef long long LL; const int N = 100; const LL mod = 1e9; int n, m, ed; LL ans = 1; int h[N][N], vis[N]; LL f[N][N]; char s[N]; int main() { scanf(\"%d%d\", &amp;n, &amp;m); for (int i = 1; i &lt;= n; i++) { scanf(\"%s\", s); for (int j = 0; j &lt; m; j++) if (s[j] == '.') h[i][j + 1] = 1; //è®°å½•ä¸‹æˆ¿é—´çš„ä½ç½® else vis[(i - 1) * m + j + 1] = 1; //é‡è¦ï¼ï¼ä¸ºå¢™çš„è¡Œä¸€å®šå…¨ä¸º0ï¼ï¼ } for (int i = 1; i &lt;= n; i++) { for (int j = 1; j &lt;= m; j++) if (h[i][j]) { //è‹¥ä¸ºæˆ¿é—´ ed = 0; //çºªå½•åº¦æ•°çŸ©é˜µ if (h[i][j - 1]) f[(i - 1) * m + j][(i - 1) * m + j - 1] = -1, ed++; //å·¦ if (h[i][j + 1]) f[(i - 1) * m + j][(i - 1) * m + j + 1] = -1, ed++; //å³ if (h[i - 1][j]) f[(i - 1) * m + j][(i - 2) * m + j] = -1, ed++; //ä¸Š if (h[i + 1][j]) f[(i - 1) * m + j][i * m + j] = -1, ed++; //ä¸‹ f[(i - 1) * m + j][(i - 1) * m + j] = ed; //åŠ ä¸Šåº¦æ•°çŸ©é˜µ } } n = n * m - 1; //åˆ å»æœ€åä¸€è¡Œæœ€åä¸€åˆ—ï¼Œå¹¶è®¡ç®—è¡Œåˆ—å¼çš„å¤§å° for (int i = 1; i &lt;= n; i++) if (!vis[i]) { //æ³¨æ„ï¼ éå¢™çš„æ‰ç»§ç»­ for (int j = i + 1; j &lt;= n; j++) if (!vis[j]) //åŒä¸Š while (f[j][i]) { //è¾—è½¬ç›¸é™¤ LL r = f[i][i] / f[j][i]; for (int k = 1; k &lt;= n; k++) f[i][k] = (f[i][k] - f[j][k] * r % mod + mod) % mod, swap(f[i][k], f[j][k]); ans = (mod - ans) % mod; //äº¤æ¢ä¸¤è¡Œï¼Œç­”æ¡ˆå–è´Ÿ } if (f[i][i] == 0) { puts(\"0\"); return 0; } //è‹¥ä¸»å¯¹è§’çº¿æœ‰0ï¼Œåˆ™ç­”æ¡ˆä¸º0 ans = (ans * f[i][i] + mod) % mod; //è®¡ç®—ç­”æ¡ˆ } printf(\"%lld\\n\", ans); } ä¸€ä¸‹æ˜¯æµ‹è¯•ç»“æœ çŸ©é˜µæ ‘å®šç†-å°Zçš„æˆ¿é—´.png è½®çŠ¶ç—…æ¯’æ€»ç»“å¼•ç”¨å‘¨ä¸œè€å¸ˆçš„ç»“æŸè¯­å§ï¼š æ‰å®çš„æ•°å­¦åŠŸåº•æ˜¯è§£å†³é—®é¢˜çš„ä¿è¯,åˆ›é€ æ€§åœ°è”æƒ³æ˜¯è§£å†³é—®é¢˜çš„çµé­‚ã€‚ References ç”Ÿæˆæ ‘çš„è®¡æ•°åŠå…¶åº”ç”¨ â€”- å‘¨ä¸œ","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://winniekun.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å›¾è®º","slug":"å›¾è®º","permalink":"https://winniekun.github.io/tags/%E5%9B%BE%E8%AE%BA/"}]},{"title":"ç¨‹åºå‘˜çš„é­”æ³•---å‘½ä»¤è¡Œ","slug":"æ“ä½œç³»ç»Ÿ/linux/linux-command-lines","date":"2020-04-10T01:13:07.000Z","updated":"2020-08-30T04:50:22.253Z","comments":true,"path":"linux-command-lines/","link":"","permalink":"https://winniekun.github.io/linux-command-lines/","excerpt":"å‰è¨€ä¸çŸ¥ä¸è§‰å·²ç»ä½¿ç”¨Ubuntuå››å¹´äº†ï¼Œç®—æ˜¯ä¸€åªè€ç™½äº†ã€‚å‘½ä»¤è¡Œï¼Œæ„Ÿè§‰å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œç®€ç›´å’Œé­”æ³•ä¸€æ ·ï¼Œè¾“å…¥ä¸€è¡Œå‘½ä»¤ï¼Œç„¶åå°±èƒ½å¾—åˆ°ä½ æƒ³è¦çš„ç»“æœï¼Œæå…¶çš„amazingã€‚å½“ç„¶ï¼Œä¹Ÿå’Œé­”æ³•ä¸€æ ·éš¾ä»¥ä½¿ç”¨ï¼Œå› ä¸ºè¦è®°ä½å¾ˆå¤šå¾ˆå¤šçš„å†…å®¹ã€‚","text":"å‰è¨€ä¸çŸ¥ä¸è§‰å·²ç»ä½¿ç”¨Ubuntuå››å¹´äº†ï¼Œç®—æ˜¯ä¸€åªè€ç™½äº†ã€‚å‘½ä»¤è¡Œï¼Œæ„Ÿè§‰å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œç®€ç›´å’Œé­”æ³•ä¸€æ ·ï¼Œè¾“å…¥ä¸€è¡Œå‘½ä»¤ï¼Œç„¶åå°±èƒ½å¾—åˆ°ä½ æƒ³è¦çš„ç»“æœï¼Œæå…¶çš„amazingã€‚å½“ç„¶ï¼Œä¹Ÿå’Œé­”æ³•ä¸€æ ·éš¾ä»¥ä½¿ç”¨ï¼Œå› ä¸ºè¦è®°ä½å¾ˆå¤šå¾ˆå¤šçš„å†…å®¹ã€‚ å¸¸ç”¨æ“ä½œè‡ªè¨€è‡ªè¯­ echo åœ¨å“ªå„¿ pwd(Print Working Directory) æ¢ä¸ªåœ°æ–¹ cd (change directory) ç…ç… ls ls ls -l æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶ä¿¡æ¯ ls -la åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä»¥.å¼€å¤´çš„éšè—æ–‡ä»¶ ls -lh åšå•ä½æ¢ç®—ï¼Œå°†byteæ¢ç®—æˆKï¼ŒMï¼ŒGç­‰. å¯»æ±‚å¸®åŠ© manï¼ˆmanualï¼‰ã€ xxx -h xxx â€”help æ–‡ä»¶å†…å®¹ æ‰“å°æ–‡ä»¶å†…å®¹ cat(concatenate and print files) cat a.txt å¤´å’Œå°¾ headã€tail head a.txt tail a.txt äº¤äº’æµè§ˆ less less a.txt å†…å®¹æŸ¥æ‰¾ / ã€grep less | grep xxx (grep -n æ˜¾ç¤ºè¡Œæ•°) å•è¯ç»Ÿè®¡ wc ç®¡é“å’Œé‡å®šå‘ é‡å®šå‘: æ”¹å˜è¾“å…¥è¾“å‡ºè®¾å¤‡ æ ‡å‡†è¾“å…¥/ è¾“å‡º: æ§åˆ¶å°/é”®ç›˜ / å±å¹• echo hello &gt; hello.txt hello è¾“å…¥åˆ°hello.txt echo world &gt;&gt; hello.txt world è¿½åŠ è¾“å…¥åˆ°hello.txtçš„ä¸‹ä¸€è¡Œ å†è¿½åŠ è¾“å…¥ä¸‹ä¸€è¡Œä»ç„¶ä½¿ç”¨&gt;&gt; cat &lt; hello.txt å°†hello.txtæ–‡ä»¶è¾“å‡ºåˆ°æ§åˆ¶å° ç®¡é“: å»ºä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„æ ‡å‡†è¾“å‡º man less | grep sim æŸ¥çœ‹lessçš„ç”¨æˆ·æ‰‹å†Œ, ç„¶ååŒ¹é…å‡ºåŒ…å«simçš„è¡Œ man less | grep sim - n | grep That &gt; that.txt æŸ¥çœ‹lessçš„ç”¨æˆ·æ‰‹å†Œ, ç„¶ååŒ¹é…å‡ºåŒ…å«simçš„è¡Œ, ä¹‹åå°†åˆåŒ…å«thatçš„è¡Œå­˜å…¥that.txt æ–‡ä»¶æƒé™(chmod)Change Modeæ”¹å˜æ–‡ä»¶æƒé™, Owner - Group - Others chmod +x foo å¢åŠ å¯æ‰§è¡Œæƒé™/ +w +r chmod -x foo ç§»é™¤å¯æ‰§è¡Œæƒé™/ -w -r chmod 740 foo æŠŠfooçš„æƒé™è®¾ç½®æˆ740 Owner: 7 = 1 + 2 + 4 = å¯æ‰§è¡Œ + å¯å†™ +å¯è¯» Group: 4 = 4 = å¯è¯» Others: 0 = æ²¡æœ‰ä»»ä½•æƒé™ å¸¸è§: -rw-râ€”râ€”r é»˜è®¤(644) -rwxr-xr-x 755 -rwxrwxrwx 777 æ–‡ä»¶åŸºæœ¬æ“ä½œ mv(ç§»åŠ¨æ–‡ä»¶ é‡å‘½å å‰ªåˆ‡+ç²˜è´´) mv éœ€è¦ç§»åŠ¨æ–‡ä»¶ /æŒ‡å®šç›®å½• (ç§»åŠ¨æ–‡ä»¶) mv hwllo.txt hello.txt (é‡å‘½å) cp(å¤åˆ¶æ–‡ä»¶ å¤åˆ¶æ–‡ä»¶å¤¹) cp a.txt a_copy.txt cp -r dir1 dir2 rm(åˆ é™¤æ–‡ä»¶ åˆ é™¤æ–‡ä»¶å¤¹) rm a.txt (åˆ é™¤ä¸€ä¸ªæ–‡ä»¶) rm a.txt b.txt c.txt(åˆ é™¤å¤šä¸ªæ–‡ä»¶ ä¹Ÿå¯ä½¿ç”¨ rm *.txt) rm -r dir (åˆ é™¤æ–‡ä»¶å¤¹) yes: ä¸åœè¾“å‡º è¿›ç¨‹ç®¡ç† top: æ˜¾ç¤ºæˆ–è€…æ›´æ–°æ’åºè¿‡çš„è¿›ç¨‹ä¿¡æ¯ é»˜è®¤æŒ‰ç…§CPUå ç”¨ç‡æ’åº(å¯¼è‡´é£æ‰‡å¾ˆå“çš„é‚£ä¸ªç©æ„å„¿) ps: æ˜¾ç¤ºè¿›ç¨‹çŠ¶æ€(Process Status) é»˜è®¤æ˜¾ç¤ºå½“å‰ç”¨æˆ·æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ ps aux : æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹, åŒ…æ‹¬å…¶ä»–ç”¨æˆ· ps aux | grep idea | wc -l : æŸ¥çœ‹ideaèµ·äº†å¤šå°‘è¿›ç¨‹ kill/killall: æ€è¿›ç¨‹ kill: ç»ˆæ­¢æˆ–è€…ç»™è¿›ç¨‹ä¿¡å· kill -singal_number/-singal_name PID kill PID kill -9/-KILL PID killall: æŒ‰ç…§åå­—ç»ˆæ­¢è¿›ç¨‹","categories":[{"name":"Linux","slug":"Linux","permalink":"https://winniekun.github.io/categories/Linux/"}],"tags":[{"name":"å‘½ä»¤è¡Œ","slug":"å‘½ä»¤è¡Œ","permalink":"https://winniekun.github.io/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"}]},{"title":"JavaIOçš„å‰ä¸–-BIOé˜»å¡æ¨¡å‹","slug":"Javaè¿›é˜¶/IO/java-bio","date":"2020-04-08T02:50:53.000Z","updated":"2020-08-30T04:50:22.244Z","comments":true,"path":"java-bio/","link":"","permalink":"https://winniekun.github.io/java-bio/","excerpt":"æµ","text":"æµ åŸºç¡€ä½¿ç”¨","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"I/O","slug":"I-O","permalink":"https://winniekun.github.io/tags/I-O/"}]},{"title":"JavaIOçš„ä»Šä¸–-NIO","slug":"Javaè¿›é˜¶/IO/java-nio","date":"2020-04-07T06:16:56.000Z","updated":"2020-08-30T04:50:22.245Z","comments":true,"path":"java-nio/","link":"","permalink":"https://winniekun.github.io/java-nio/","excerpt":"Java NIOæ–°çš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ï¼Œå¼¥è¡¥äº†åŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚","text":"Java NIOæ–°çš„è¾“å…¥/è¾“å‡º (NIO) åº“æ˜¯åœ¨ JDK 1.4 ä¸­å¼•å…¥çš„ï¼Œå¼¥è¡¥äº†åŸæ¥çš„ I/O çš„ä¸è¶³ï¼Œæä¾›äº†é«˜é€Ÿçš„ã€é¢å‘å—çš„ I/Oã€‚ BIOå¸¦æ¥çš„æŒ‘æˆ˜BIO(blocking-IO) ä¸ç®¡æ˜¯ç£ç›˜ I/O è¿˜æ˜¯ç½‘ç»œ I/Oï¼Œæ•°æ®åœ¨å†™å…¥ OutputStream æˆ–è€…ä» InputStream è¯»å–æ—¶éƒ½æœ‰å¯èƒ½ä¼šé˜»å¡ã€‚ä¸€æ—¦æœ‰çº¿ç¨‹é˜»å¡å°†ä¼šå¤±å» CPU çš„ä½¿ç”¨æƒï¼Œè¿™åœ¨å½“å‰çš„å¤§è§„æ¨¡è®¿é—®é‡å’Œæœ‰æ€§èƒ½è¦æ±‚æƒ…å†µä¸‹æ˜¯ä¸èƒ½æ¥å—çš„ã€‚è™½ç„¶å½“å‰çš„ç½‘ç»œ I/O æœ‰ä¸€äº›è§£å†³åŠæ³•ï¼Œå¦‚ä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªå¤„ç†çº¿ç¨‹ï¼Œå‡ºç°é˜»å¡æ—¶åªæ˜¯ä¸€ä¸ªçº¿ç¨‹é˜»å¡è€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹å·¥ä½œï¼Œè¿˜æœ‰ä¸ºäº†å‡å°‘ç³»ç»Ÿçº¿ç¨‹çš„å¼€é”€ï¼Œé‡‡ç”¨çº¿ç¨‹æ± çš„åŠæ³•æ¥å‡å°‘çº¿ç¨‹åˆ›å»ºå’Œå›æ”¶çš„æˆæœ¬ï¼Œä½†æ˜¯æœ‰ä¸€äº›ä½¿ç”¨åœºæ™¯ä»ç„¶æ˜¯æ— æ³•è§£å†³çš„ã€‚å¦‚å½“å‰ä¸€äº›éœ€è¦å¤§é‡ HTTP é•¿è¿æ¥çš„æƒ…å†µï¼Œåƒæ·˜å®ç°åœ¨ä½¿ç”¨çš„ Web æ—ºæ—ºé¡¹ç›®ï¼ŒæœåŠ¡ç«¯éœ€è¦åŒæ—¶ä¿æŒå‡ ç™¾ä¸‡çš„ HTTP è¿æ¥ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ¯æ—¶æ¯åˆ»è¿™äº›è¿æ¥éƒ½åœ¨ä¼ è¾“æ•°æ®ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸å¯èƒ½åŒæ—¶åˆ›å»ºè¿™ä¹ˆå¤šçº¿ç¨‹æ¥ä¿æŒè¿æ¥ã€‚å³ä½¿çº¿ç¨‹çš„æ•°é‡ä¸æ˜¯é—®é¢˜ï¼Œä»ç„¶æœ‰ä¸€äº›é—®é¢˜è¿˜æ˜¯æ— æ³•é¿å…çš„ã€‚å¦‚è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æƒ³ç»™æŸäº›å®¢æˆ·ç«¯æ›´é«˜çš„æœåŠ¡ä¼˜å…ˆçº§ï¼Œå¾ˆéš¾é€šè¿‡è®¾è®¡çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¥å®Œæˆï¼Œå¦å¤–ä¸€ç§æƒ…å†µæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è®©æ¯ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœåŠ¡ç«¯å¯èƒ½éœ€è¦è®¿é—®ä¸€äº›ç«äº‰èµ„æºï¼Œç”±äºè¿™äº›å®¢æˆ·ç«¯æ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¸­ï¼Œå› æ­¤éœ€è¦åŒæ­¥ï¼Œè€Œå¾€å¾€è¦å®ç°è¿™äº›åŒæ­¥æ“ä½œè¦è¿œè¿œæ¯”ç”¨å•çº¿ç¨‹å¤æ‚å¾ˆå¤šã€‚ä»¥ä¸Šè¿™äº›æƒ…å†µéƒ½è¯´æ˜ï¼Œæˆ‘ä»¬éœ€è¦å¦å¤–ä¸€ç§æ–°çš„ I/O æ“ä½œæ–¹å¼ã€‚ NIO ç®€ä»‹NIO æ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„ I/O æ¨¡å‹ï¼Œåœ¨ Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel ã€Selectorã€Buffer ç­‰æŠ½è±¡ã€‚ NIOæœ‰ä¸¤ç§è§£é‡Šï¼šä¸€ç§å«éé˜»å¡IOï¼ˆNon-blocking I/Oï¼‰ï¼Œå¦ä¸€ç§å«æ–°çš„IOï¼ˆNew I/Oï¼‰ï¼Œå…¶å®æ˜¯åŒä¸€ä¸ªæ¦‚å¿µã€‚å®ƒæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œä¹Ÿæ˜¯I/Oå¤šè·¯å¤ç”¨çš„åŸºç¡€ï¼Œå·²ç»è¢«è¶Šæ¥è¶Šå¤šåœ°åº”ç”¨åˆ°å¤§å‹åº”ç”¨æœåŠ¡å™¨ï¼Œæˆä¸ºè§£å†³é«˜å¹¶å‘ä¸å¤§é‡è¿æ¥ã€I/Oå¤„ç†é—®é¢˜çš„æœ‰æ•ˆæ–¹å¼ã€‚(åªæœ‰Socket Channel æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼Œè€Œ FileChannel ä¸èƒ½ï¼Œ ä¸º FileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰) NIOæ˜¯ä¸€ç§åŸºäºé€šé“å’Œç¼“å†²åŒºçš„I/Oæ–¹å¼ï¼Œå®ƒå¯ä»¥ä½¿ç”¨Nativeå‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼ˆåŒºåˆ«äºJVMçš„è¿è¡Œæ—¶æ•°æ®åŒºï¼‰ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †é‡Œé¢çš„DirectByteBufferå¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„ç›´æ¥å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨Javaå †å’ŒNativeå †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚ ChannelChannelæ˜¯å¯¹ BIO ä¸­çš„æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å†™æ•°æ®(çœŸæ­£è¯»å†™æ•°æ®çš„æ˜¯Buffer)ï¼Œæ°¸è¿œä¸ä¼šå‡ºç°ç›´æ¥å‘Channelå†™å…¥æ•°æ®æˆ–è€…ç›´æ¥ä»Channelä¸­è¯»å–æ•°æ®çš„æ“ä½œã€‚ é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼š æµæ˜¯å•å‘çš„ - ä¸€ä¸ªæµåªèƒ½å•çº¯çš„è´Ÿè´£è¯»æˆ–å†™ã€‚ é€šé“æ˜¯åŒå‘çš„ - ä¸€ä¸ªé€šé“å¯ä»¥åŒæ—¶ç”¨äºè¯»å†™ã€‚ å› ä¸ºChannelæ˜¯åŒå‘çš„ï¼Œå…¶èƒ½æ›´å¥½çš„ååº”åº•å±‚æ“ä½œç³»ç»Ÿçš„çœŸå®æƒ…å†µï¼ˆå¦‚æ“ä½œç³»ç»Ÿä¸­çš„é€šé“ï¼‰ã€‚åŒæ—¶ChannelåŒ…æ‹¬ä»¥ä¸‹ç±»å‹(æ ‡ç²—çš„æ˜¯å¸¸ç”¨çš„ç±»å‹)ï¼š FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼› DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼› ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚ åŸºæœ¬ä½¿ç”¨ ä»Channelè¿›è¡Œè¯»å–æ•°æ® é¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ªBufferï¼ŒChannelå°†æ•°æ®è¯»å…¥å…¶ä¸­ï¼Œä¹‹ååœ¨Buferä¸­è¯»å–æ•°æ® public static void read() throws IOException { FileInputStream fileInputStream = new FileInputStream(\"aaa.txt\"); FileChannel inputChannel = fileInputStream.getChannel(); ByteBuffer buffer = ByteBuffer.allocate(1024); inputChannel.read(buffer); // åˆ‡æ¢ä¸ºè¯»æ¨¡å¼ buffer.flip(); while (buffer.hasRemaining()){ byte b = buffer.get(); System.out.println(\"Character: \" + (char)b); } buffer.clear(); fileInputStream.close(); } å‘Channelå†™å…¥æ•°æ® åˆ›å»ºBufferï¼Œå¡«å……æ•°æ®ã€‚ä¹‹åChannelå»å†™å‡ºæ•°æ® public static void write() throws IOException { FileOutputStream fileOutputStream = new FileOutputStream(\"bbb.txt\"); FileChannel outChannel = fileOutputStream.getChannel(); ByteBuffer buffer = ByteBuffer.allocate(1024); byte[] msg = \"hello i'm wkk\".getBytes(); buffer.put(msg); buffer.flip(); outChannel.write(buffer); fileOutputStream.close(); } Buffer A buffer is a linear, finite sequence of elements of a specific * primitive type. Aside from its content, the essential properties of a * buffer are its capacity, limit, and position: --- æ‘˜è‡ªBufferæºç  Bufferæœ¬èº«å°±æ˜¯ä¸€å—å†…å­˜ï¼Œåº•å±‚å®ç°ä¸Šï¼Œå®é™…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æ•°æ®çš„è¯»å†™å‡æ˜¯é€šè¿‡Bufferå®ç°ã€‚ public class NioBase { public static void main(String[] args) { // åˆå§‹åŒ–ä¸€ä¸ªBuffer IntBuffer buffer = IntBuffer.allocate(1024); // å‘Bufferä¸­éšæœºå†™å…¥10ä¸ªæ•°å­— for (int i = 0; i &lt; 10; i++) { int randomNumber = new SecureRandom().nextInt(20); buffer.put(randomNumber); } // åˆ‡æ¢ä¸ºè¯»æ¨¡å¼ buffer.flip(); while (buffer.hasRemaining()){ System.out.print(buffer.get() + \" \"); } } } Capacityã€Positionã€Limit * &lt;p&gt; A buffer's &lt;i&gt;capacity&lt;/i&gt; is the number of elements it contains. The * capacity of a buffer is never negative and never changes. &lt;/p&gt; * * &lt;p&gt; A buffer's &lt;i&gt;limit&lt;/i&gt; is the index of the first element that should * not be read or written. A buffer's limit is never negative and is never * greater than its capacity. &lt;/p&gt; * * &lt;p&gt; A buffer's &lt;i&gt;position&lt;/i&gt; is the index of the next element to be * read or written. A buffer's position is never negative and is never * greater than its limit. &lt;/p&gt; åœ¨NIOä¸­ï¼ŒçœŸæ­£å’Œæ•°æ®æ‰“äº¤é“çš„æ˜¯Bufferã€‚å¯ä»¥å°†Bufferç®€å•çš„ç†è§£ä¸ºä¸€ç»„åŸºæœ¬æ•°æ®ç±»å‹çš„å…ƒç´ åˆ—è¡¨ï¼Œå…¶é€šè¿‡ä»¥ä¸‹çš„åŸºæœ¬å˜é‡æ¥ä¿å­˜è¿™ä¸ªæ•°æ®çš„å½“å‰ä½ç½®çŠ¶æ€ï¼Œå…±æœ‰å››ä¸ªç´¢å¼•ï¼ˆmarkç”¨äºè®°å½•ä»¥ä¸‹ä¸‰ä¸ªç´¢å¼•ï¼Œæ‰€ä»¥æ²¡æœ‰è®°å½•ï¼‰ã€‚ ç´¢å¼• è¯´æ˜ capacity ç¼“å†²æ•°ç»„çš„æ€»é•¿åº¦ position ä¸‹ä¸€ä¸ªè¦æ“ä½œçš„æ•°æ®å…ƒç´ çš„ä½ç½® limit ç¼“å†²åŒºæ•°ç»„ä¸å¯æ“ä½œçš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œ limit&lt;=capacity image demopublic static void main(String[] args) { // åˆ›å»ºç¼“å†²åŒº ByteBuffer buffer = ByteBuffer.allocate(1024); //bufferä¸­å››ä¸ªå˜é‡çš„å€¼ System.out.println(\"åˆå§‹æ—¶----&gt;limit----&gt;\" + buffer.limit()); System.out.println(\"åˆå§‹æ—¶----&gt;capacity----&gt;\" + buffer.capacity()); System.out.println(\"åˆå§‹æ—¶----&gt;position----&gt;\" + buffer.position()); System.out.println(\"åˆå§‹æ—¶----&gt;mark----&gt;\" + buffer.mark()); System.out.println(\"--------------------------------\"); //åˆå§‹æ—¶----&gt;limit----&gt;1024 //åˆå§‹æ—¶----&gt;capacity----&gt;1024 //åˆå§‹æ—¶----&gt;position----&gt;0 //åˆå§‹æ—¶----&gt;mark----&gt;java.nio.HeapByteBuffer[pos=0 lim=1024 cap=1024] String s = \"abcd\"; buffer.put(s.getBytes()); //bufferæ·»åŠ æ•°æ®ä¹‹åï¼Œå››ä¸ªå˜é‡çš„å€¼ System.out.println(\"putå®Œä¹‹å----&gt;limit----&gt;\" + buffer.limit()); System.out.println(\"putå®Œä¹‹å----&gt;capacity----&gt;\" + buffer.capacity()); System.out.println(\"putå®Œä¹‹å----&gt;position----&gt;\" + buffer.position()); System.out.println(\"putå®Œä¹‹å----&gt;mark----&gt;\" + buffer.mark()); //putå®Œä¹‹å----&gt;limit----&gt;1024 //putå®Œä¹‹å----&gt;capacity----&gt;1024 //putå®Œä¹‹å----&gt;position----&gt;4 //putå®Œä¹‹å----&gt;mark----&gt;java.nio.HeapByteBuffer[pos=4 lim=1024 cap=1024] buffer.flip(); System.out.println(\"-------------------------------------------\"); System.out.println(\"flip()ä¹‹å----&gt;limit----&gt;\" + buffer.limit()); System.out.println(\"flip()ä¹‹å----&gt;capacity----&gt;\" + buffer.capacity()); System.out.println(\"flip()ä¹‹å----&gt;position----&gt;\" + buffer.position()); System.out.println(\"flip()ä¹‹å----&gt;mark----&gt;\" + buffer.mark()); byte[] bytes = new byte[buffer.limit()]; buffer.get(bytes); System.out.println(new String(bytes, 0, bytes.length)); //flip()ä¹‹å----&gt;limit----&gt;4 //flip()ä¹‹å----&gt;capacity----&gt;1024 //flip()ä¹‹å----&gt;position----&gt;0 //flip()ä¹‹å----&gt;mark----&gt;java.nio.HeapByteBuffer[pos=0 lim=4 cap=1024] //abc System.out.println(\"-------------------------------------------\"); System.out.println(\"è¯»å®Œä¹‹å----&gt;limit----&gt;\" + buffer.limit()); System.out.println(\"è¯»å®Œä¹‹å----&gt;capacity----&gt;\" + buffer.capacity()); System.out.println(\"è¯»å®Œä¹‹å----&gt;position----&gt;\" + buffer.position()); System.out.println(\"è¯»å®Œä¹‹å----&gt;mark----&gt;\" + buffer.mark()); //è¯»å®Œä¹‹å----&gt;limit----&gt;4 //è¯»å®Œä¹‹å----&gt;capacity----&gt;1024 //è¯»å®Œä¹‹å----&gt;position----&gt;3 //è¯»å®Œä¹‹å----&gt;mark----&gt;java.nio.HeapByteBuffer[pos=3 lim=4 cap=1024] System.out.println(\"----------------æ¸…ç©ºç¼“å†²åŒº-------------\"); buffer.clear(); System.out.println(\"æ¸…ç©ºä¹‹å----&gt;limit----&gt;\" + buffer.limit()); System.out.println(\"æ¸…ç©ºä¹‹å----&gt;capacity----&gt;\" + buffer.capacity()); System.out.println(\"æ¸…ç©ºä¹‹å----&gt;position----&gt;\" + buffer.position()); System.out.println(\"æ¸…ç©ºä¹‹å----&gt;mark----&gt;\" + buffer.mark()); //æ¸…ç©ºä¹‹å----&gt;limit----&gt;1024 //æ¸…ç©ºä¹‹å----&gt;capacity----&gt;1024 //æ¸…ç©ºä¹‹å----&gt;position----&gt;0 //æ¸…ç©ºä¹‹å----&gt;mark----&gt;java.nio.HeapByteBuffer[pos=0 lim=1024 cap=1024] } å…³äºè¿™ä¸‰ç§ç´¢å¼•çš„å®é™…å…³ç³»ï¼Œä»¥åŠflip() clear()åœ¨ä¸‹è¿°Bufferçš„è¯»å†™ä¸­ä¼šè¯¦ç»†é˜è¿° Buffer ç±»å‹Bufferå®ç°äº†javaçš„æ‰€æœ‰çš„åŸºç¡€æ•°æ®ç±»å‹ ByteBuffer ShortBuffer IntBuffer LongBuffer FloatBuffer DoubleBuffer CharBuffer MappedByteBuffer ä½¿ç”¨Bufferå¯¹è±¡ä¹‹å‰éœ€è¦å…ˆè¿›è¡Œåˆ†é…ï¼Œæ¯ä¸ªç±»å‹çš„Bufferç±»éƒ½å¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•allocateï¼ˆï¼‰åˆ†é…è¯¥Bufferçš„å®¹é‡å¤§å° è¯»å’Œå†™å‘Bufferä¸­å†™å…¥æ•°æ®ï¼šæœ‰ä¸¤ç§æ–¹å¼ï¼š é€šè¿‡channel.read(buffer)å†™å…¥æ•°æ® RandomAccessFile file = new RandomAccessFile(\"../../Downloads/aaa.txt\", \"rw\"); FileChannel inChannel = file.getChannel(); // åˆ›å»ºç¼“å†²åŒº ByteBuffer buffer = ByteBuffer.allocate(1024); // ä»channelä¸­å†™å…¥æ•°æ® int read = inChannel.read(buffer); ç›´æ¥é€šè¿‡buffer.put()å†™å…¥æ•°æ® // åˆ›å»ºç¼“å†²åŒº ByteBuffer buffer = ByteBuffer.allocate(18); String s = \"abcd\"; buffer.put(s.getBytes()); flip()æ–¹æ³• ä½¿ç”¨è¯¥æ–¹æ³•ä¹‹åï¼Œpositionç´¢å¼•ä¼šæŒ‡å‘0ï¼Œlimitç´¢å¼•ä¼šæŒ‡å‘ç¼“å†²åŒºæ•°ç»„ä¸å¯æ“ä½œçš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼ˆä¹Ÿå¯è¡¨ç¤ºä¸ºå½“å‰ç¼“å†²æ•°ç»„å¯è¯»å…ƒç´ çš„é•¿åº¦ï¼‰ flip__æ–¹æ³•ç´¢å¼•å˜åŒ–.png æ‰€ä»¥ï¼Œflip()æ–¹æ³•ä¹Ÿå¯ä»¥ç†è§£ä¸ºåˆ‡æ¢è¯»æ¨¡å¼ï¼Œè¾“å…¥ä¸€å®šçš„å…ƒç´ ä¹‹åï¼Œæ„Ÿè§‰éœ€è¦è¯»å‡ºæ•°æ®ï¼Œä½¿ç”¨flip()æ–¹æ³•ï¼Œåˆ‡æ¢ä¸ºè¯»çš„æ¨¡å¼ã€‚ ä»Bufferä¸­è¯»å‡ºæ•°æ®åŒç†ï¼Œä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ä»Bufferä¸­è¯»å‡ºæ•°æ® channel.write(buffer) buffer.get() clear()æ–¹æ³•ï¼Œæ“ä½œæ•°æ®çš„ç´¢å¼•é‡å½’åˆå§‹çŠ¶æ€ï¼Œç±»ä¼¼äºæ•°æ®è¢«æ¸…ç©ºï¼Œå¯ä»¥ç†è§£ä¸ºåˆ‡æ¢å†™æ¨¡å¼ Selectorç”¨äºç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿æ¥æ‰“å¼€ï¼Œæ•°æ®åˆ°è¾¾ï¼‰ã€‚å› æ­¤ï¼Œå•ä¸ªçš„çº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªæ•°æ®é€šé“ã€‚å³ç”¨é€‰æ‹©å™¨ï¼Œå€ŸåŠ©å•ä¸€çº¿ç¨‹ï¼Œå°±å¯å¯¹æ•°é‡åºå¤§çš„æ´»åŠ¨I/Oé€šé“å®æ–½ç›‘æ§å’Œç»´æŠ¤ã€‚å…¶å’Œå•ç‰‡æœºä¸­çš„äº‹ä»¶è½®è¯¢æ˜¯ä¸€ä¸ªé“ç†,å¯æƒœæœ¬ç§‘ä¸Šå•ç‰‡æœºçš„æ—¶å€™,å¹¶æ²¡æœ‰å¥½å¥½å¬(å¯¹ä¸èµ·å°é‚¹é‚¹) NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚ NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼ å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚ é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œ å°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚ å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œ å¯¹äº IO å¯†é›†å‹çš„åº”ç”¨å…·æœ‰å¾ˆå¥½åœ°æ€§èƒ½ã€‚ åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰Socketçš„Channel æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼Œè€Œ FileChannel ä¸èƒ½ï¼Œ ä¸º FileChannel é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚ ä½¿ç”¨Selectorçš„ä¼˜ç‚¹: ä½¿ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡, ç›¸æ¯”æ›´å¤šçš„çº¿ç¨‹,é¿å…äº†çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å¼€é”€ å¯ä»¥å°†ä¸Šå›¾åšæ›´ç»†è‡´çš„ç»˜åˆ¶: NIOæ¨¡å‹çš„æœåŠ¡å™¨ç«¯å¦‚ä½•å®ç°éé˜»å¡ï¼ŸæœåŠ¡å™¨ä¸Šæ‰€æœ‰Channeléœ€è¦å‘Selectoræ³¨å†Œï¼Œè€ŒSelectoråˆ™è´Ÿè´£ç›‘è§†è¿™äº›Channelçš„IOçŠ¶æ€(è§‚å¯Ÿè€…)ï¼Œå½“å…¶ä¸­ä»»æ„ä¸€ä¸ªæˆ–è€…å¤šä¸ªChannelå…·æœ‰å¯ç”¨çš„IOæ“ä½œæ—¶ï¼Œè¯¥Selectorçš„select()æ–¹æ³•å°†ä¼šè¿”å›å¤§äº0çš„æ•´æ•°(è¡¨ç¤ºè¯¥Selectorä¸Šæœ‰å¤šå°‘ä¸ªChannelå…·æœ‰å¯ç”¨çš„IOæ“ä½œ)ï¼Œå¹¶æä¾›äº†selectedKeys()æ–¹æ³•æ¥è¿”å›è¿™äº›Channelå¯¹åº”çš„SelectionKeyé›†åˆ(ä¸€ä¸ªSelectionKeyå¯¹åº”ä¸€ä¸ªå°±ç»ªçš„é€šé“)ã€‚æ­£æ˜¯é€šè¿‡Selectorï¼Œä½¿å¾—æœåŠ¡å™¨ç«¯åªéœ€è¦ä¸æ–­åœ°è°ƒç”¨Selectorå®ä¾‹çš„select()ï¼Œå³å¯çŸ¥é“å½“å‰æ‰€æœ‰Channelæ˜¯å¦æœ‰éœ€è¦å¤„ç†çš„IOæ“ä½œã€‚ æ­¥éª¤åˆ›å»ºé€‰æ‹©å™¨Selector selector = Selector.open(); ç»‘å®šç«¯å£,é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨// ç»‘å®šç«¯å£ ServerSocketChannel server = ServerSocketChannel.open(); server.configureBlocking(false); // è®¾ç½®ä¸ºéé˜»å¡ ServerSocket socket = server.socket(); socket.bind(new InetSocketAddress(port)); // å°†é€šé“æ³¨å†Œåˆ°è¯¥çº¿ç¨‹çš„é€‰æ‹©å™¨ server.register(selector, SelectionKey.OP_ACCEPT); é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚ åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š SelectionKey.OP_CONNECT SelectionKey.OP_ACCEPT SelectionKey.OP_READ SelectionKey.OP_WRITE ç›‘å¬äº‹ä»¶selector.select(); ä½¿ç”¨ select() æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚ è·å–å¯è¾¾äº‹ä»¶// å¯è¾¾äº‹ä»¶ Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = selectionKeys.interator(); while(iterator.hasnext()){ SelectionKey key = iterator.next(); if(key.isAcceptable()){ // ... }else if(key.isReadable()){ //... } // removeå·²ç»å¤„ç†çš„äº‹ä»¶ iterator.remove(); } äº‹ä»¶å¾ªç¯å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚ while(true){ // ç›‘å¬äº‹ä»¶ selector.select(); // è·å–å¯è¾¾äº‹ä»¶ Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = selectionKeys.interator(); while(iterator.hasnext()){ SelectionKey key = iterator.next(); if(key.isAcceptable()){ // ... }else if(key.isReadable()){ //... } // removeå·²ç»å¤„ç†çš„äº‹ä»¶ iterator.remove(); } } æ•´åˆpublic void start(){ // 1. åˆ›å»ºé€‰æ‹©å™¨ Selector selector = Selector.open(); // 2. ç»‘å®šç«¯å£ é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ ServerSocketChannel serverChannel = ServerSocketChannel.open(); serverChannel.configureBlocking(false); ServerSocket socket = serverChannel.socket(); socket.bind(new InetSocketAddress(port)); // é€šé“æ³¨å†Œåˆ°selectorä¸Š serverChannel.register(selector, SelectionKey.OP_ACCEPT); // äº‹ä»¶è½®è¯¢ while(true){ // 3 ç›‘å¬äº‹ä»¶ selector.select(); // 4 è·å–å¯è¾¾äº‹ä»¶ Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator(); while(iterator.hasNext()){ SelectionKey key = itrator.next(); if (key.isAcceptable()) { ServerSocketChannel server = (ServerSocketChannel) key.channel(); // æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel SocketChannel client = server.accept(); client.configureBlocking(false); // è¿™ä¸ªæ–°è¿æ¥çš„channelä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ® client.register(selector, SelectionKey.OP_READ); }else if(key.isReadable()){ SocketChannel client = (SocketChannel)key.channel(); // æ•°æ®çš„å¤„ç† ByteBuffer buffer = ByteBuffer.allocate(1024); buffer.clear(); while (channel.read(buffer) &gt; 0); buffer.flip(); channel.write(buffer); } iterator.remove(); } } } åº”ç”¨åˆ›å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯ public static void main(String[] args) throws IOException { // æœåŠ¡ç«¯ç›‘å¬5ä¸ªç«¯å£ int[] ports = new int[5]; int base = 9000; for (int i = 0; i &lt; 5; i++) { ports[i] = base++; } // åˆ›å»ºé€‰æ‹©å™¨ Selector selector = Selector.open(); // ç»‘å®šç«¯å£ é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ for (int port : ports) { ServerSocketChannel server = ServerSocketChannel.open(); server.configureBlocking(false); ServerSocket socket = server.socket(); socket.bind(new InetSocketAddress(port)); server.register(selector, SelectionKey.OP_ACCEPT); System.out.println(\"ç›‘å¬ç«¯å£: \" + port); } // äº‹ä»¶è½®è¯¢ while (true) { // ç›‘å¬äº‹ä»¶ int num = selector.select(); System.out.println(\"numbers: \" + num); // è·å–å¯è¾¾äº‹ä»¶ Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); System.out.println(\"å¯è¾¾äº‹ä»¶é›†æœ‰: \" + selectionKeys.size()); for (SelectionKey selectionKey : selectionKeys) { System.out.println(\"å¯è¾¾äº‹ä»¶é›†ç±»å‹æœ‰: \" + selectionKey); } // äº‹ä»¶å¤„ç† Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator(); while (iterator.hasNext()) { SelectionKey key = iterator.next(); if (key.isAcceptable()) { ServerSocketChannel server = (ServerSocketChannel) key.channel(); SocketChannel client = server.accept(); client.configureBlocking(false); client.register(selector, SelectionKey.OP_READ); System.out.println(\"è·å¾—å®¢æˆ·ç«¯çš„é“¾æ¥\" + client); } else if (key.isReadable()) { SocketChannel channel = (SocketChannel) key.channel(); ByteBuffer buffer = ByteBuffer.allocate(1024); buffer.clear(); while (channel.read(buffer) &gt; 0); buffer.flip(); channel.write(buffer); System.out.println(\"è¯»å–: \" + buffer + \", æ¥è‡ªäº\" + channel); } // è®°å¾—remove iterator.remove(); } } } References Java NIO IBM NIO å…¥é—¨","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"I/O","slug":"I-O","permalink":"https://winniekun.github.io/tags/I-O/"}]},{"title":"å †æ’åº","slug":"ç®—æ³•/æ’åº/å †æ’åº","date":"2020-04-03T13:35:01.000Z","updated":"2020-08-30T04:50:22.261Z","comments":true,"path":"å †æ’åº/","link":"","permalink":"https://winniekun.github.io/%E5%A0%86%E6%8E%92%E5%BA%8F/","excerpt":"å †æ’åº","text":"å †æ’åº å †æ’åºåœ¨ top K é—®é¢˜ä¸­ä½¿ç”¨æ¯”è¾ƒé¢‘ç¹ï¼Œå¹¶ä¸”ç»å¸¸è¢«ç”¨æ¥å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å †æ’åºæ˜¯é‡‡ç”¨äºŒå‰å †çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ï¼Œè™½ç„¶å®è´¨ä¸Šè¿˜æ˜¯ä¸€ç»´æ•°ç»„ã€‚äºŒå‰å †æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘ ã€‚ å †çš„å®šä¹‰å¦‚ä¸‹ï¼š $L(i) \\leq L(2i)$ ä¸” $L(i) \\leq L(2i+1)$ (å°æ ¹å †) $L(i) \\geq L(2i)$ä¸” $L(i) \\geq L(2i+1)$ ï¼ˆå¤§æ ¹å †ï¼‰ å¤§æ ¹å †ç¤ºæ„å›¾.png å †æ’åºçš„å…³é”®æ˜¯æ„é€ åˆå§‹å †ï¼Œå¯¹åˆå§‹åºåˆ—å»ºå †ï¼Œå°±æ˜¯ä¸€ä¸ªåå¤ç­›é€‰çš„è¿‡ç¨‹ï¼Œå› ä¸ºæ˜¯è¿‘ä¼¼äºå®Œå…¨äºŒå‰æ ‘ï¼Œæ‰€ä»¥ä»ç¬¬$\\lfloor n/2 \\rfloor$ä¸ºæ ¹çš„å­æ ‘å¼€å§‹è°ƒæ•´ï¼ˆå¯¹äºå¤§æ ¹å †ï¼Œæ ¹èŠ‚ç‚¹çš„å…³é”®å­—å’Œå…¶å·¦å³å­å¥³ä¸­å…³é”®å­—ç›¸æ¯”è¾ƒå¤§çš„è¿›è¡Œäº¤æ¢ï¼‰ä¹‹åä¾æ¬¡å¯¹å„ä¸ªèŠ‚ç‚¹$\\lfloor n/2 \\rfloor -1 ï½ 1$ä¸ºæ ¹çš„å­æ ‘è¿›è¡Œç­›é€‰ã€‚ å®ä¾‹å¯¹å…³é”®å­—åºåˆ—ï¼š53ã€17ã€ 78ã€ 9ã€ 45ã€ 65ã€ 87 ã€32 æ„å»ºå¤§æ ¹å † å¤§æ ¹å †çš„æ„å»º.png æ’å…¥æ’å…¥æ˜¯ä»å°¾éƒ¨æ’å…¥(å½“å‰å †æœ‰nä¸ªå…ƒç´ ï¼Œåœ¨ç¬¬n+1ä½ç½®ä¸­æ’å…¥)ï¼Œç„¶åè°ƒæ•´ åˆ é™¤åˆ é™¤æ˜¯ä»æ ¹èŠ‚ç‚¹å¼€å§‹åˆ é™¤ï¼Œåˆ é™¤ä¹‹åå†è¿›è¡Œè°ƒæ•´ Javaä»£ç å®ç°public void buildMaxHeap(int[] nums) { int length = (nums.length - 1) / 2; // ä»n/2å¼€å§‹æ„å»ºåˆå§‹å † for (int i = length; i &gt;= 0; i--) { adjustDown(nums, i, nums.length-1); } } private void adjustDown(int[] nums, int k, int len) { nums[0] = nums[k]; // ä»¥ç¬¬kä¸ªèŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘è¿›è¡Œè°ƒæ•´ for (int i = 2 * k; i &lt;= len; i *= 2) { // å¯»æ‰¾å­æ ‘ä¸­çš„æœ€å€¼ if(i &lt; len &amp;&amp; nums[i] &lt; nums[i+1]){ i ++; } if(nums[0] &gt;= nums[i]){ break; } else { nums[k] = nums[i]; k = i; } } nums[k] = nums[0]; }","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[{"name":"é€‰æ‹©","slug":"é€‰æ‹©","permalink":"https://winniekun.github.io/tags/%E9%80%89%E6%8B%A9/"}]},{"title":"AVLæ ‘è¯¦è§£","slug":"æ•°æ®ç»“æ„/AVLæ ‘è¯¦è§£","date":"2020-03-28T02:23:42.000Z","updated":"2020-08-30T04:50:22.253Z","comments":true,"path":"AVLæ ‘è¯¦è§£/","link":"","permalink":"https://winniekun.github.io/AVL%E6%A0%91%E8%AF%A6%E8%A7%A3/","excerpt":"ç®€ä»‹","text":"ç®€ä»‹ AVLæ ‘çš„å¼•å…¥æ˜¯å› ä¸ºBSTåœ¨æç«¯çš„æƒ…å†µä¸‹ï¼Œä¼šé€€åŒ–ä¸ºé“¾è¡¨ï¼Œé‚£ä¹ˆæŸ¥æ‰¾çš„æ—¶é—´ä»$O(logN)$ â€”-&gt; $O(N)$ AVLæ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æ ‘ï¼Œå®šä¹‰å¦‚ä¸‹ BST å·¦ã€å³å­æ ‘é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡1(å¹³è¡¡å› å­Balance Factor)ç©ºæ ‘ã€å·¦å³å­æ ‘éƒ½æ˜¯AVL AVLæ ‘.png æ’å…¥&amp;æ—‹è½¬ä¸‰èŠ‚ç‚¹å•æ—‹è½¬å·¦æ—‹ AVL_å·¦æ—‹.png å³æ—‹ AVL_å³æ—‹.png ä¸‰èŠ‚ç‚¹åŒæ—‹è½¬LRæ—‹è½¬ AVL_LR.png RLæ—‹è½¬åŒç† ä»€ä¹ˆæ—¶å€™éœ€è¦æ—‹è½¬æ’å…¥å…³é”®å­—keyåï¼ŒèŠ‚ç‚¹pçš„å¹³è¡¡å› å­ç”±åŸæ¥çš„1æˆ–è€…-1ï¼Œå˜æˆäº†2æˆ–è€…-2ï¼Œåˆ™éœ€è¦æ—‹è½¬ï¼›åªè€ƒè™‘æ’å…¥keyåˆ°å·¦å­æ ‘leftçš„æƒ…å½¢ï¼Œå³å¹³è¡¡å› å­ä¸º2 æƒ…å†µ1ï¼škey&lt;left.key, å³æ’å…¥åˆ°leftçš„å·¦å­æ ‘ï¼Œéœ€è¦è¿›è¡Œå•æ—‹è½¬ï¼Œå°†èŠ‚ç‚¹på³æ—‹ æƒ…å†µ2ï¼škey&gt;left.key, å³æ’å…¥åˆ°leftçš„å³å­æ ‘ï¼Œéœ€è¦è¿›è¡ŒåŒæ—‹è½¬ï¼Œå…ˆå°†leftå·¦æ—‹ï¼Œå†å°†på³æ—‹ æ’å…¥åˆ°å³å­æ ‘rightã€å¹³è¡¡å› å­ä¸º-2ï¼Œå®Œå…¨å¯¹ç§° æƒ…å†µ1 AVL_æ’å…¥_æƒ…å†µ1.png æƒ…å†µ2 AVL_æ’å…¥_æƒ…å†µ2_1.png åˆ é™¤ç±»ä¼¼æ’å…¥ï¼Œå‡è®¾åˆ é™¤äº†på³å­æ ‘çš„æŸä¸ªèŠ‚ç‚¹ï¼Œå¼•èµ·äº†pçš„å¹³è¡¡å› å­d[p]=2ï¼Œåˆ†æpçš„å·¦å­æ ‘leftï¼Œä¸‰ç§æƒ…å†µå¦‚ä¸‹ï¼š æƒ…å†µ1ï¼šleftçš„å¹³è¡¡å› å­d[left]=1ï¼Œå°†på³æ—‹ æƒ…å†µ2ï¼šleftçš„å¹³è¡¡å› å­d[left]=0ï¼Œå°†på³æ—‹ æƒ…å†µ3ï¼šleftçš„å¹³è¡¡å› å­d[left]= -1ï¼Œå…ˆå·¦æ—‹leftï¼Œå†å³æ—‹p åˆ é™¤å·¦å­æ ‘ï¼Œå³d[p]= -2çš„æƒ…å½¢ï¼Œä¸d[p]=2å¯¹ç§° æƒ…å†µ1 AVL_åˆ é™¤_æƒ…å†µ1.png æƒ…å†µ2 AVL_åˆ é™¤_æƒ…å†µ2.png æƒ…å†µ3 AVL_åˆ é™¤_æƒ…å†µ3.png é¢è¯•æ’åºæ•°ç»„ï¼ˆé“¾è¡¨ï¼‰è½¬AVL108. Convert Sorted Array to Binary Search Tree109. Convert Sorted List to Binary Search Treeåˆ¤æ–­æ˜¯å¦ä¸ºå¹³è¡¡äºŒå‰æ ‘LeetCode 110. Balanced Binary Treeç›¸å…³é¢˜ç›®ä¼šæŒç»­æ·»åŠ  References TreeMapSourceAnalysis","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://winniekun.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"AVLæ ‘","slug":"AVLæ ‘","permalink":"https://winniekun.github.io/tags/AVL%E6%A0%91/"}]},{"title":"2020Flagé›†","slug":"ç¢ç¢å¿µ/2020Flagé›†","date":"2020-03-24T01:58:39.000Z","updated":"2021-05-08T15:45:33.268Z","comments":true,"path":"2020Flagé›†/","link":"","permalink":"https://winniekun.github.io/2020Flag%E9%9B%86/","excerpt":"å‰è¨€æœ€è¿‘åˆ·é¢˜åˆ·çš„ç‰¹åˆ«ä¸§ï¼Œè¢«LeetCodeè™çš„ä½“æ— å®Œè‚¤ï¼Œç„¶ååˆåœ¨ä¸åœåœ°æ„Ÿæ…¨ï¼Œæ¡è‰ï¼Œè¿™æ˜¯äººæƒ³å‡ºæ¥çš„è§£æ³•ã€‚ç¬é—´æ„Ÿè§‰è‡ªå·±å¤ªlowäº†ã€‚éœ€è¦æ‰“ç‚¹é¸¡è¡€ï¼ï¼ï¼","text":"å‰è¨€æœ€è¿‘åˆ·é¢˜åˆ·çš„ç‰¹åˆ«ä¸§ï¼Œè¢«LeetCodeè™çš„ä½“æ— å®Œè‚¤ï¼Œç„¶ååˆåœ¨ä¸åœåœ°æ„Ÿæ…¨ï¼Œæ¡è‰ï¼Œè¿™æ˜¯äººæƒ³å‡ºæ¥çš„è§£æ³•ã€‚ç¬é—´æ„Ÿè§‰è‡ªå·±å¤ªlowäº†ã€‚éœ€è¦æ‰“ç‚¹é¸¡è¡€ï¼ï¼ï¼ Flagä»¬ç¬¬ä¸€æ¬¡flagsğŸ LeetCode400é¢˜ âŒ è™½ç„¶å·²ç»è¿›å…¥åƒé¢˜æ—¶ä»£ï¼Œä¸ªäººè§‰å¾—æŠŠå‰400é¢˜åˆ·å®Œå°±å·²ç»å¾ˆèƒ–èƒ–äº† 5æœˆä¹‹å‰å®Œæˆï¼ˆå¹³å‡ä¸‹æ¥ï¼Œæ¯å¤©è¿˜è¦åˆ·7-8é¢˜ã€‚ã€‚ã€‚ã€‚ï¼‰ è¿™ä¸ªflagä¼šä¸ä¼šæ’çš„å¤ªæ·±äº†ï¼Œ åé¢æ‹”ä¸æ‰ï¼ï¼ï¼ LeetCodeç²¾åˆ·250é¢˜ ğŸ˜• Cspirationä¸Šçœ‹åˆ°çš„ï¼Œä¸ç®¡å…¶ä»–çš„ï¼Œä½†åˆ·é¢˜ï¼Œæˆ‘è§‰å¾—å¾ˆæ£’ å‰‘æŒ‡offer ä¸€åˆ· 3æœˆåº•åˆ·å®Œ ç¬¬äºŒæ¬¡flagsğŸ LeetCode400é¢˜ âœ” å®ä¹ æœŸé—´åˆ·é¢˜å¤ªç´¯äº†ï¼Œæœ‰ç‚¹å„¿æ€€ç–‘åˆ·é¢˜çš„ç›®çš„åœ¨å“ªå„¿äº†ï¼Œå¹¶æ²¡æœ‰æ„Ÿè§‰åˆ°è‡ªå·±çš„ç¼–ç èƒ½åŠ›æœ‰å¤šå°‘æé«˜ ç°åœ¨åªæ±‚ä¸è¦æˆä¸ºæ–æ³¢é‚£å¥‘çŒ¿å°±å¾ˆå¼€å¿ƒäº† 11æœˆ20å· LeetCode500é¢˜âŒ ä¸æƒ³åˆ·äº†ï¼Œæ„Ÿè§‰å¤ªåŠŸåˆ©äº†ï¼Œè€Œä¸”è¶Šåˆ·æ„Ÿè§‰è¶Šæ•ˆæœä¸å¥½ æ€»æ˜¯é™·å…¥è‡ªå·±ç†Ÿç»ƒçš„å†…å®¹ã€‚ã€‚ã€‚ ç¬¬ä¸‰æ¬¡flagsğŸ å¹´å‰çªç ´500å¤§å…³âŒ","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"flag","slug":"flag","permalink":"https://winniekun.github.io/tags/flag/"}]},{"title":"å›¾è®º-æœç´¢ç­–ç•¥","slug":"ç®—æ³•/å®ç°-å›¾è®º/å›¾è®º-æœç´¢ç­–ç•¥","date":"2020-03-20T03:22:56.000Z","updated":"2020-08-30T04:50:22.260Z","comments":true,"path":"å›¾è®º-æœç´¢ç­–ç•¥/","link":"","permalink":"https://winniekun.github.io/%E5%9B%BE%E8%AE%BA-%E6%90%9C%E7%B4%A2%E7%AD%96%E7%95%A5/","excerpt":"å‰è¨€","text":"å‰è¨€ ä»¥ä¸‹ç®—æ³•çš„æ˜¯å®ç°ï¼ŒBFSã€DFSæ˜¯åŸºäºå›¾çš„é‚»æ¥è¡¨å­˜å‚¨æ–¹å¼å®ç°çš„ï¼Œ A*åŸºäºå›¾çš„é‚»æ¥çŸ©é˜µå­˜å‚¨ BFSBFSï¼Œå¹¿åº¦ä¼˜å…ˆéå†ï¼Œå…¶éå†çš„å½¢å¼å¯ä»¥ç†è§£ä¸ºæ ‘çš„å±‚æ¬¡éå†ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶ååœæ­¢ã€‚æ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªé˜Ÿåˆ—æ¥å®ç°è¯¥ç®—æ³•ã€‚ å›¾è®º-bfs.png package com.wkk.utils; import com.wkk.graph.LGraph; import org.omg.CORBA.INTERNAL; import java.util.LinkedList; import java.util.Queue; import java.util.Stack; /** * @Time: 20-3-20ä¸‹åˆ3:16 * @Author: kongwiki * @Email: kongwiki@163.com */ public class BFS { // å›¾ä½¿ç”¨é‚»æ¥è¡¨è¿›è¡Œå­˜å‚¨ private boolean[] marked; private int[] edgeTo; private final int s; public BFS(LGraph graph, int s) { marked = new boolean[graph.V()]; edgeTo = new int[graph.V()]; this.s = s; bfs(graph, s); } private void bfs(LGraph graph, int s) { Queue&lt;Integer&gt; queue = new LinkedList&lt;Integer&gt;(); queue.offer(s); marked[s] = true; while (!queue.isEmpty()){ Integer v = queue.poll(); for (Integer element : graph.adj(v)) { if(!marked[element]){ edgeTo[element] = v; marked[element] = true; queue.offer(element); } } } } // åˆ¤æ–­æ˜¯å¦å­˜åœ¨è·¯å¾„ s ---&gt; v public boolean hasPathTo(int v){ return marked[v]; } // å­˜å‚¨s---&gt;vçš„è·¯å¾„ public Stack&lt;Integer&gt; pathTo(int v){ if (!hasPathTo(v)) {return null;} Stack&lt;Integer&gt; path = new Stack&lt;Integer&gt;(); for (int x = v; x != s; x = edgeTo[x]) { path.push(x); } path.push(s); return path; } } æ€»ç»“BFSç®—æ³•èƒ½å¤Ÿæ‰¾åˆ° s â€”-&gt; vè·¯å¾„ä¸­çš„æœ€ä¼˜è§£ DFSå…³äºdfsï¼Œ å…¶åº”ç”¨èŒƒå›´å¾ˆå¹¿ï¼Œè­¬å¦‚å¯ä»¥è§£å†³æ’åˆ—ç»„åˆé—®é¢˜ç­‰ç­‰ç­‰ã€‚é¦–å…ˆï¼Œä¼šä»å¼€å§‹èŠ‚ç‚¹æœæŸä¸€ä¸ªæ–¹å‘è¿›å‘ï¼Œç›´åˆ°é‡åˆ°è¾¹ç•Œæˆ–è€…éšœç¢ç‰©ï¼Œæ‰å›æº¯ã€‚dfsç®—æ³•éœ€è¦ä¸€ä¸ªæ ˆè¿›è¡Œä»å­˜å‚¨æ‰€æ‰«æè·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€’å½’å…¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ ˆçš„ä½¿ç”¨ï¼Œ æ‰€ä»¥å®Œå…¨å¯ä»¥ä½¿ç”¨é€’å½’å®ç°DFSç®—æ³•ã€‚ å›¾è®º-dfs.png public class DFS { private boolean[] marked; private int count; public DFS(LGraph graph, int v){ marked = new boolean[graph.V()]; dfs(graph, v); } public void dfs(LGraph graph, int v){ marked[v] = true; count++; for (Integer w : graph.adj(v)) { if(!marked[w]){ dfs(graph, w); } } } public boolean marked(int w){ return marked[w]; } public int count(){ return count; } } æ€»ç»“DFSç®—æ³•å­˜åœ¨é—®é¢˜æœ‰ï¼š è·¯å¾„ä¸å¯èƒ½æ˜¯æœ€ä¼˜è§£ å¯»è·¯æ—¶é—´æ¯”è¾ƒé•¿ A*å®˜æ–¹å®šä¹‰A*æœç´¢ç®—æ³•ï¼ˆA* search algorithmï¼‰æ˜¯ä¸€ç§åœ¨å›¾å½¢å¹³é¢ä¸Šï¼Œæœ‰å¤šä¸ªèŠ‚ç‚¹çš„è·¯å¾„ï¼Œæ±‚å‡ºæœ€ä½é€šè¿‡æˆæœ¬çš„ç®—æ³•ã€‚å…¶åº”ç”¨éå¸¸çš„å¹¿ï¼Œä¸»è¦åˆ†ä¸ºä¸¤å¤§åº”ç”¨ï¼Œç¬¬ä¸€å°±æ˜¯æ¸¸æˆä¸­çš„NPCçš„ç§»åŠ¨è®¡ç®—ï¼Œç¬¬äºŒå°±æ˜¯åœ°å›¾å¯¼èˆªçš„åº”ç”¨ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå…¶å°±æ˜¯ä¸€ç§å¯»è·¯ç®—æ³•ã€‚ è¯¥ç®—æ³•ç»¼åˆäº†æœ€è‰¯ä¼˜å…ˆæœç´¢å’ŒDijkstraç®—æ³•çš„ä¼˜ç‚¹ï¼šåœ¨è¿›è¡Œå¯å‘å¼æœç´¢æé«˜ç®—æ³•æ•ˆç‡çš„åŒæ—¶ï¼Œå¯ä»¥ä¿è¯æ‰¾åˆ°ä¸€æ¡æœ€ä¼˜è·¯å¾„ï¼ˆåŸºäºè¯„ä¼°å‡½æ•°ï¼‰ã€‚ Astar_progress_animation.gif A*ç®—æ³•çš„è¯„ä¼°å‡½æ•°ï¼Œå…¶ä¸­$ g(n) $è¡¨ç¤ºä»èµ·ç‚¹åˆ°ä»»æ„é¡¶ç‚¹nçš„å®é™…è·ç¦»ï¼Œ$h(n)$ è¡¨ç¤ºä»»æ„é¡¶ç‚¹$ n$ åˆ°èµ·ç‚¹çš„ä¼°ç®—è·ç¦»ã€‚ $ f(n) = g(n) + h(n) $ è¿™ä¸ªå…¬å¼éµå¾ªä»¥ä¸‹ç‰¹æ€§ï¼š å¦‚æœ$g(n)$ä¸º0ï¼Œå³åªè®¡ç®—ä»»æ„é¡¶ç‚¹$n$åˆ°ç›®æ ‡çš„è¯„ä¼°å‡½æ•°$h(n)$è€Œä¸è®¡ç®—èµ·ç‚¹åˆ°é¡¶ç‚¹$n$çš„è·ç¦»ï¼Œåˆ™ç®—æ³•è½¬åŒ–ä¸ºä½¿ç”¨è´ªå¿ƒç­–ç•¥çš„æœ€è‰¯ä¼˜å…ˆæœç´¢ï¼Œé€Ÿåº¦æœ€å¿«ï¼Œä½†å¯èƒ½å¾—ä¸å‡ºæœ€ä¼˜è§£ï¼› å¦‚æœ$h(n)$ä¸å¤§äºé¡¶ç‚¹$n$åˆ°ç›®æ ‡é¡¶ç‚¹)çš„å®é™…è·ç¦»ï¼Œåˆ™ä¸€å®šå¯ä»¥æ±‚å‡ºæœ€ä¼˜è§£ï¼Œè€Œä¸”$h(n)$è¶Šå°ï¼Œéœ€è¦è®¡ç®—çš„èŠ‚ç‚¹è¶Šå¤šï¼Œç®—æ³•æ•ˆç‡è¶Šä½ï¼Œå¸¸è§çš„è¯„ä¼°å‡½æ•°æœ‰â€”â€”æ¬§å‡ é‡Œå¾—è·ç¦»ã€æ›¼å“ˆé¡¿è·ç¦»ã€åˆ‡æ¯”é›ªå¤«è·ç¦»ï¼› å¦‚æœ$ h(n) $ä¸º0ï¼Œå³åªéœ€æ±‚å‡ºèµ·ç‚¹åˆ°ä»»æ„é¡¶ç‚¹çš„$ n $æœ€çŸ­è·¯å¾„$ g(n) $ï¼Œè€Œä¸è®¡ç®—ä»»ä½•è¯„ä¼°å‡½æ•°$ h(n) $ï¼Œåˆ™è½¬åŒ–ä¸ºå•æºæœ€çŸ­è·¯å¾„é—®é¢˜ï¼Œå³Dijkstraç®—æ³•ï¼Œæ­¤æ—¶éœ€è¦è®¡ç®—æœ€å¤šçš„é¡¶ç‚¹ï¼› ä»¥ä¸Šçš„æ‘˜è‡ªç»´åŸºç™¾ç§‘ï¼Œä¸€äº›åè¯å¯èƒ½æœ‰äº›æŠ½è±¡ï¼Œç°åšä¸¾ä¾‹è¯´æ˜ï¼› å®ä¾‹è®²è§£ å›¾è®º-A* å¯¹äºä¸Šå›¾ï¼Œä»é¡¶ç‚¹så‡ºå‘ï¼Œå‡èµ°äº†ä¸¤æ­¥ï¼Œåˆ†åˆ«åˆ°è¾¾äº†M1å’ŒM2ï¼Œæ¥ä¸‹æ¥åº”è¯¥é€‰æ‹©å“ªæ¡è·¯çº¿åˆ°è¾¾ç»ˆç‚¹Eï¼Œå¾ˆæ˜æ˜¾ï¼Œé€‰æ‹©M1è¿™æ¡è·¯ï¼Œ å› ä¸ºä»M1å‡ºå‘ï¼Œåˆ°Eçš„è·ç¦»ç»ˆäº7æ­¥ï¼Œæ¯”ä»M2å‡ºå‘åˆ°Eçš„è·ç¦»9æ­¥ï¼Œè¦å°‘ã€‚ å›æƒ³åˆšæ‰çš„æ€è·¯ï¼Œå‘ç°ï¼Œæˆ‘ä»¬ä¸ä»…æ€è€ƒäº†ä»èµ·å§‹ç‚¹åˆ°å½“å‰ç‚¹çš„è·ç¦»ï¼Œ è¿˜è€ƒè™‘äº†å½“å‰ç‚¹åˆ°ç»ˆç‚¹çš„è·ç¦»ã€‚è¿™å°±æ˜¯A*ç®—æ³•çš„æ ¸å¿ƒã€‚å…¶ç›¸æ¯”äºBFSç®—æ³•ï¼Œé™¤äº†è€ƒè™‘ä¸­é—´æŸä¸ªç‚¹åˆ°å‡ºå‘ç‚¹çš„è·ç¦»ä»¥å¤–ï¼Œè¿˜è€ƒè™‘äº†è¿™ä¸ªç‚¹åŒç›®æ ‡ç‚¹çš„è·ç¦»ã€‚è¿™å°±æ˜¯A*ç®—æ³•æ¯”å¹¿åº¦ä¼˜å…ˆç®—æ³•æ™ºèƒ½çš„åœ°æ–¹ã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„å¯å‘å¼æœç´¢ã€‚å®ä¾‹ä¸­çš„s åˆ°M1çš„è·ç¦»å°±æ˜¯g(n), M1åˆ°Eçš„è·ç¦»å°±æ˜¯h(n) å¯¹äºä¸Šè¿°çš„å…¬å¼ï¼Œ g(n)æ˜¯å·²çŸ¥çš„ï¼Œä½†æ˜¯h(n)æ˜¯éœ€è¦è¿›è¡Œè®¡ç®—çš„ã€‚ å¯¹äºh(n)çš„ç²¾ç¡®è®¡ç®—ï¼Œå¯ä»¥æŒ‰ç…§åˆšæ‰å®ä¾‹çš„æ–¹å¼ï¼Œä½¿ç”¨æ¨ªå‘è·ç¦»+çºµå‘è·ç¦»çš„æ–¹å¼è¿›è¡Œè®¡ç®—ï¼ˆæ›¼å“ˆé¡¿è·ç¦»ï¼‰ï¼Œç†è®ºä¸Šæ¥è¯´æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯é‡åˆ°å¦‚ä¸‹çš„é—®é¢˜ï¼Œé‚£ä¹ˆä½¿ç”¨åˆšæ‰çš„æ–¹å¼è®¡ç®—h(n)çš„ç²¾ç¡®å€¼å°±æ˜¯é”™è¯¯çš„äº† å›¾è®º-A-star1.png å› ä¸ºæœ‰éšœç¢ç‰©ï¼ŒMåˆ°Eçš„å°±éœ€è¦ç»•è¿‡è¿™ä¸ªéšœç¢ç‰©ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å®Œå…¨æ²¡æœ‰å¿…è¦è®¡ç®—h(n)çš„ç²¾ç¡®çš„å€¼ï¼Œåªéœ€è¦å°½å¯èƒ½æ‰¾é‚£äº›f(n)=g(n)+h(n)å°çš„ç‚¹ï¼ˆå…¶ä¸­h(n)æ˜¯ä¸ªä¼°ç®—å€¼ï¼‰ï¼Œå½“åšæˆ‘ä»¬çš„è·¯å¾„ç»è¿‡ç‚¹ï¼Œå³ä½¿å®é™…çš„h'(n)å€¼å¯èƒ½å’Œh(n)å€¼ä¸ç­‰ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å°±å½“åšä¸€ä¸ªå‚è€ƒï¼ˆæ€»æ¯”å¹¿åº¦ä¼˜å…ˆæœç´¢å¥½ï¼‰ã€‚å¦‚æœé€šè¿‡è¿™ä¸ªä¼°ç®—ï¼Œèƒ½å¹²æ‰å¾ˆå¤šæ˜æ˜¾å¾ˆå·®çš„ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿå°±èŠ‚çœäº†å¾ˆå¤šä¸å¿…è¦çš„èŠ±é”€ã€‚ æ¯”å¦‚ï¼Œä¸Šå›¾ä¸­ï¼Œ Mç‚¹å³ä½¿æ˜¯ç»•è·¯ï¼Œä¹Ÿæ¯”M'ç‚¹è¦å¼ºã€‚åœ¨ä¼°ç®—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†Så·¦è¾¹çš„ç‚¹åŸºæœ¬ä¸Šéƒ½æŠ›å¼ƒæ‰ï¼Œä»è€Œå‡å°‘æˆ‘ä»¬æ‰©å±•çš„ç‚¹æ•°ï¼ŒèŠ‚çº¦è®¡ç®—çš„æ—¶é—´ã€‚ ç»è¿‡ä¸Šè¿°çš„åˆ†æï¼Œæ¥ä¸‹æ¥å°±åªéœ€è¦è§£å†³å¦‚ä¸‹çš„ä¸¤ä¸ªé—®é¢˜ï¼š è¿™ä¸ªä¼°ç®—çš„å‡½æ•°h(M)æ€ä¹ˆæ ·å»è®¡ç®—ï¼Ÿ æ›¼å“ˆé¡¿è·ç¦» æ¬§å¼è·ç¦» åˆ‡æ¯”é›ªå¤«è·ç¦» â€¦ å¯¹äºä¸åŒçš„ä¼°ç®—å‡½æ•°h(M)æ¥è®²ï¼Œå¯¹äºæˆ‘ä»¬çš„æœç´¢ç»“æœä¼šæœ‰ä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿ h'(n) = h(n) ä¹Ÿå°±æ˜¯æ¯æ¬¡æ‰©å±•çš„é‚£ä¸ªç‚¹æˆ‘ä»¬éƒ½å‡†ç¡®çš„çŸ¥é“ï¼Œå¦‚æœé€‰ä»–ä»¥åï¼Œæˆ‘ä»¬çš„è·¯å¾„è·ç¦»æ˜¯å¤šå°‘ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨ä¹±é€‰äº†ï¼Œæ¯æ¬¡éƒ½é€‰æœ€å°çš„é‚£ä¸ªï¼Œä¸€è·¯ä¸‹å»ï¼Œè‚¯å®šå°±æ˜¯æœ€ä¼˜çš„è§£ï¼Œè€Œä¸”åŸºæœ¬ä¸ç”¨æ‰©å±•å…¶ä»–çš„ç‚¹ h'(n) &lt; h(n) æˆ‘ä»¬åˆ°æœ€åä¸€å®šèƒ½æ‰¾åˆ°ä¸€æ¡æœ€çŸ­è·¯å¾„(å¦‚æœå­˜åœ¨å¦å¤–ä¸€æ¡æ›´çŸ­çš„è¯„ä¼°è·¯å¾„ï¼Œå°±ä¼šé€‰æ‹©æ›´å°çš„é‚£ä¸ª)ï¼Œä½†æ˜¯æœ‰å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šæ— æ•ˆçš„ç‚¹ã€‚æç«¯æƒ…å†µï¼Œå½“h==0çš„æ—¶å€™ï¼Œæœ€ç»ˆçš„è·ç¦»å‡½æ•°å°±å˜æˆï¼š f(n)=g(n)+h(n) =&gt; f(n)=g(n)+0 =&gt; f(n)=g(n) è¿™ä¹Ÿå°±æ˜¯BFSç®—æ³•ã€‚ h'(n) &gt; h(n) æœ‰å¯èƒ½å°±å¾ˆå¿«æ‰¾åˆ°ä¸€æ¡é€šå¾€ç›®çš„åœ°çš„è·¯å¾„ï¼Œä½†æ˜¯å´ä¸ä¸€å®šæ˜¯æœ€ä¼˜çš„è§£ã€‚ æ€»ç»“A*ç®—æ³•æœ€åç•™ç»™æˆ‘ä»¬çš„ï¼Œå°±æ˜¯åœ¨æ—¶é—´å’Œè·ç¦»ä¸Šéœ€è¦è€ƒè™‘çš„ä¸€ä¸ªå¹³è¡¡ã€‚å¦‚æœè¦æ±‚æœ€çŸ­è·ç¦»ï¼Œåˆ™ä¸€å®šé€‰æ‹©hå°äºç­‰äºå®é™…è·ç¦»ï¼›å¦‚æœä¸ä¸€å®šæ±‚è§£æœ€ä¼˜è§£ï¼Œè€Œæ˜¯è¦é€Ÿåº¦å¿«ï¼Œåˆ™å¯ä»¥é€‰æ‹©hå¤§äºç­‰äºå®é™…è·ç¦»ã€‚ å®ç°æ€è·¯æ€è·¯(å¦‚æœæœ‰è·¯å¾„)é‡‡ç”¨ç»“ç‚¹ä¸ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼ˆå‰ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ çš„å…³ç³»ä»æœ€ç»ˆç»“ç‚¹å›æº¯åˆ°èµ·ç‚¹ï¼Œå¾—åˆ°è·¯å¾„ã€‚ å®šä¹‰$ f(n) = g(n) + h(n) $çš„å®ç° $g(n)$çš„å®ç°æ–¹å¼ï¼š è®¡ç®—æ–¹å¼æœ‰æŒºå¤šç§çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç”¨è¿™ç§å§ï¼Œå‡è®¾æ¯ä¸ªç»“ç‚¹ä»£è¡¨ä¸€ä¸ªæ­£æ–¹å½¢ï¼Œæ¨ªç«–ç§»åŠ¨è·ç¦»ï¼šæ–œç§»åŠ¨è·ç¦»=1 : 1.4ï¼ˆ$\\sqrt(2)$ï¼‰ï¼Œæˆ‘ä»¬å–ä¸ªæ•´æ•°10å’Œ14å§ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰ç»“ç‚¹Gå€¼=çˆ¶èŠ‚ç‚¹çš„G+ï¼ˆ10æˆ–14ï¼‰ã€‚ $ h(n)$çš„å®ç°æ–¹å¼ï¼š æ›¼å“ˆé¡¿è·ç¦» å›¾è®º-A-starå®ä¾‹.jpeg æ¯ä¸ªæ–¹å—ä»£è¡¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ æ–¹å—ä¸­å·¦ä¸‹è§’ä¸ºg(n) æ–¹å—ä¸­å³ä¸‹è§’ä¸ºh(n) æ–¹å—ä¸­å·¦ä¸Šè§’ä¸ºf(n) è¾…åŠ©è¡¨ï¼šOpenã€Closeåˆ—è¡¨åœ¨Aç®—æ³•ä¸­ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªè¾…åŠ©è¡¨æ¥è®°å½•ç»“ç‚¹ã€‚ ä¸€ä¸ªç”¨äºè®°å½•å¯è¢«è®¿é—®çš„ç»“ç‚¹ï¼Œç§°ä¸ºOpenè¡¨ï¼›ä¸€ä¸ªæ˜¯è®°å½•å·²è®¿é—®è¿‡çš„ç»“ç‚¹ï¼Œç§°ä¸ºCloseè¡¨ã€‚ *è¿™ä¸¤ä¸ªè¡¨å†³å®šäº†ç®—æ³•çš„ç»“æŸï¼šæ¡ä»¶æ˜¯æœ€ç»ˆç»“ç‚¹åœ¨Closeè¡¨ä¸­(æ‰¾åˆ°è·¯å¾„)æˆ–Openè¡¨ä¸ºç©º(æ‰¾ä¸åˆ°äº†è·¯å¾„)ã€‚ ç§»åŠ¨ç»“ç‚¹ã€ç›¸é‚»ç»“ç‚¹çš„å¤„ç†æ¯æ¬¡ä»Openè¡¨ä¸­å–å‡ºFå€¼æœ€å°çš„ç»“ç‚¹å‡ºæ¥ï¼ˆè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ¥å¤„ç†æ¯”è¾ƒå¥½ï¼‰ï¼Œä½œä¸ºå½“å‰ç»“ç‚¹ï¼›ç„¶åå°†å½“å‰ç»“ç‚¹çš„æ‰€æœ‰é‚»ç»“ç‚¹æŒ‰ç…§é‚»ç»“ç‚¹è§„åˆ™åŠ å…¥åˆ°Openè¡¨ä¸­ï¼›æœ€åå°†å½“å‰ç»“ç‚¹æ”¾å…¥Closeè¡¨ä¸­ï¼Œè¿™é‡Œå°±æ˜¯æ¯æ¬¡å¾ªç¯çš„æ‰§è¡Œå†…å®¹ã€‚ é‚»ç»“ç‚¹è§„åˆ™ï¼š å½“é‚»ç»“ç‚¹ä¸åœ¨åœ°å›¾ä¸­ï¼Œä¸åŠ å…¥Openè¡¨ å½“é‚»ç»“ç‚¹æ˜¯éšœç¢ç‰©ï¼Œä¸åŠ å…¥Openè¡¨ å½“é‚»ç»“ç‚¹åœ¨Closeè¡¨ä¸­ï¼Œä¸åŠ å…¥Openè¡¨ å½“é‚»ç»“ç‚¹ä¸åœ¨Openä¸­ï¼ŒåŠ å…¥Openè¡¨ï¼Œè®¾è¯¥é‚»ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºå½“å‰ç»“ç‚¹ å½“é‚»ç»“ç‚¹åœ¨Openè¡¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšä¸ªæ¯”è¾ƒ:å¦‚æœé‚»ç»“ç‚¹çš„Gå€¼&gt;å½“å‰ç»“ç‚¹çš„Gå€¼+å½“å‰ç»“ç‚¹åˆ°è¿™ä¸ªé‚»ç»“ç‚¹çš„ä»£ä»·ï¼ˆ10æˆ–14ï¼‰ï¼Œé‚£ä¹ˆä¿®æ”¹è¯¥é‚»ç»“ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºå½“å‰çš„ç»“ç‚¹(å› ä¸ºåœ¨Openè¡¨ä¸­çš„ç»“ç‚¹é™¤äº†èµ·ç‚¹ï¼Œéƒ½ä¼šæœ‰çˆ¶èŠ‚ç‚¹)ï¼Œä¿®æ”¹Gå€¼=å½“å‰ç»“ç‚¹çš„Gå€¼+å½“å‰ç»“ç‚¹åˆ°è¿™ä¸ªé‚»ç»“ç‚¹çš„ä»£ä»· å¦‚æœé‚»ç»“ç‚¹çš„Gå€¼&lt;å½“å‰ç»“ç‚¹çš„Gå€¼+å½“å‰ç»“ç‚¹åˆ°è¿™ä¸ªé‚»ç»“ç‚¹çš„ä»£ä»·ï¼ˆ10æˆ–14ï¼‰, å¦‚æœæ²¡æœ‰ä¸€æ¡è·¯å¾„å¯ä»¥é€šè¿‡ä½¿ç”¨å½“å‰æ ¼å­å¾—åˆ°æ”¹å–„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åšä»»ä½•æ”¹å˜ã€‚ æ­¥éª¤ æŠŠèµ·å§‹æ ¼æ·»åŠ åˆ°å¼€å¯åˆ—è¡¨ã€‚ é‡å¤å¦‚ä¸‹çš„å·¥ä½œï¼š a) å¯»æ‰¾å¼€å¯åˆ—è¡¨ä¸­Få€¼æœ€ä½çš„æ ¼å­ã€‚æˆ‘ä»¬ç§°å®ƒä¸ºå½“å‰æ ¼ã€‚ b) æŠŠå®ƒåˆ‡æ¢åˆ°å…³é—­åˆ—è¡¨ã€‚ c) å¯¹ç›¸é‚»çš„8æ ¼ä¸­çš„æ¯ä¸€ä¸ªï¼Ÿ å¦‚æœå®ƒä¸å¯é€šè¿‡æˆ–è€…å·²ç»åœ¨å…³é—­åˆ—è¡¨ä¸­ï¼Œç•¥è¿‡å®ƒã€‚åä¹‹å¦‚ä¸‹ã€‚ å¦‚æœå®ƒä¸åœ¨å¼€å¯åˆ—è¡¨ä¸­ï¼ŒæŠŠå®ƒæ·»åŠ è¿›å»ã€‚æŠŠå½“å‰æ ¼ä½œä¸ºè¿™ä¸€æ ¼çš„çˆ¶èŠ‚ç‚¹ã€‚è®°å½•è¿™ä¸€æ ¼çš„F,G,å’ŒHå€¼ã€‚ å¦‚æœå®ƒå·²ç»åœ¨å¼€å¯åˆ—è¡¨ä¸­ï¼Œç”¨Gå€¼ä¸ºå‚è€ƒæ£€æŸ¥æ–°çš„è·¯å¾„æ˜¯å¦æ›´å¥½ã€‚æ›´ä½çš„Gå€¼æ„å‘³ç€æ›´å¥½çš„è·¯å¾„ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œå°±æŠŠè¿™ä¸€æ ¼çš„çˆ¶èŠ‚ç‚¹æ”¹æˆå½“å‰æ ¼ï¼Œå¹¶ä¸”é‡æ–°è®¡ç®—è¿™ä¸€æ ¼çš„Gå’ŒFå€¼ã€‚å¦‚æœä½ ä¿æŒä½ çš„å¼€å¯åˆ—è¡¨æŒ‰Få€¼æ’åºï¼Œæ”¹å˜ä¹‹åä½ å¯èƒ½éœ€è¦é‡æ–°å¯¹å¼€å¯åˆ—è¡¨æ’åºã€‚ d) åœæ­¢ï¼Œå½“ä½  æŠŠç›®æ ‡æ ¼æ·»åŠ è¿›äº†å¼€å¯åˆ—è¡¨ï¼Œè¿™æ—¶å€™è·¯å¾„è¢«æ‰¾åˆ°ï¼Œæˆ–è€… æ²¡æœ‰æ‰¾åˆ°ç›®æ ‡æ ¼ï¼Œå¼€å¯åˆ—è¡¨å·²ç»ç©ºäº†ã€‚è¿™æ—¶å€™ï¼Œè·¯å¾„ä¸å­˜åœ¨ã€‚ ä¿å­˜è·¯å¾„ã€‚ä»ç›®æ ‡æ ¼å¼€å§‹ï¼Œæ²¿ç€æ¯ä¸€æ ¼çš„çˆ¶èŠ‚ç‚¹ç§»åŠ¨ç›´åˆ°å›åˆ°èµ·å§‹æ ¼ã€‚è¿™å°±æ˜¯ä½ çš„è·¯å¾„ã€‚ å®ç°ä»£ç è¾“å…¥æ¶‰åŠæ•°æ®ç»“æ„ï¼š ä»£è¡¨åœ°å›¾äºŒå€¼äºŒç»´æ•°ç»„(0è¡¨ç¤ºå¯é€šè·¯ï¼Œ1è¡¨ç¤ºè·¯éšœ) int[][] maps = { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }, { 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0 }, { 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, }; åæ ‡ç±» public class Coord { /** * åæ ‡åŸç‚¹åœ¨å·¦ä¸Šè§’ æ‰€ä»¥yæ˜¯é«˜ xæ˜¯å®½ * yå‘ä¸‹é€’å¢ xå‘å³é€’å¢ * å°†xå’Œyå°è£…æˆä¸€ä¸ªç±» æ–¹ä¾¿ä¼ å‚ * é‡å†™equalsæ–¹æ³•æ¯”è¾ƒåæ ‡(x,y)æ˜¯ä¸æ˜¯åŒä¸€ä¸ªã€‚ */ public int x; public int y; public Coord(int x, int y) { this.x = x; this.y = y; } @Override public boolean equals(Object obj) { if (obj == null) { return false; } if (obj instanceof Coord) { Coord c = (Coord) obj; return x == c.x &amp;&amp; y == c.y; } return false; } } Nodeç±» public class Node implements Comparable&lt;Node&gt; { // åæ ‡ public Coord coord; // çˆ¶ç»“ç‚¹ public Node parent; // Gï¼šæ˜¯ä¸ªå‡†ç¡®çš„å€¼ï¼Œæ˜¯èµ·ç‚¹åˆ°å½“å‰ç»“ç‚¹çš„ä»£ä»· public int G; // Hï¼šæ˜¯ä¸ªä¼°å€¼ï¼Œå½“å‰ç»“ç‚¹åˆ°ç›®çš„ç»“ç‚¹çš„ä¼°è®¡ä»£ä»· public int H; public Node(int x, int y) { this.coord = new Coord(x, y); } public Node(Coord coord, Node parent, int g, int h) { this.coord = coord; this.parent = parent; G = g; H = h; } // æ–¹ä¾¿ä¼˜å…ˆé˜Ÿåˆ—æ’åºã€‚ public int compareTo(Node o) { if (o == null) { return -1; } if (G + H &gt; o.G + o.H) { return 1; } else if (G + H &lt; o.G + o.H) { return -1; } return 0; } } A*ç®—æ³•è¾“å…¥çš„æ•°æ®ç»“æ„çš„å°è£… package com.wkk.a; /** * @Time: 20-3-21ä¸Šåˆ12:35 * @Author: kongwiki * @Email: kongwiki@163.com */ public class MapInfo { // äºŒç»´æ•°ç»„çš„åœ°å›¾ public int[][] maps; //åœ°å›¾çš„å®½ public int width; // åœ°å›¾çš„é«˜ public int hight; // èµ·å§‹ç»“ç‚¹ public Node start; // æœ€ç»ˆç»“ç‚¹ public Node end; public MapInfo(int[][] maps, int width, int hight, Node start, Node end) { this.maps = maps; this.width = width; this.hight = hight; this.start = start; this.end = end; } } å¤„ç†: å‡ ä¸ªå¸¸é‡ï¼šäºŒç»´æ•°ç»„ä¸­å“ªä¸ªå€¼è¡¨ç¤ºéšœç¢ç‰©ã€äºŒç»´æ•°ç»„ä¸­ç»˜åˆ¶è·¯å¾„çš„ä»£è¡¨å€¼ã€è®¡ç®—Gå€¼éœ€è¦çš„æ¨ªçºµç§»åŠ¨ä»£ä»·å’Œæ–œç§»åŠ¨ä»£ä»·ã€‚ // éšœç¢å€¼ public final static int BAR = 1; // è·¯å¾„ public final static int PATH = 2; // æ¨ªç«–ç§»åŠ¨ä»£ä»· public final static int DIRECT_VALUE = 10; // æ–œç§»åŠ¨ä»£ä»· public final static int OBLIQUE_VALUE = 14; å®šä¹‰ä¸¤ä¸ªè¾…åŠ©è¡¨ï¼šOpenè¡¨å’ŒCloseè¡¨ã€‚Openè¡¨çš„ä½¿ç”¨æ˜¯éœ€è¦å–æœ€å°å€¼ï¼Œä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—PriorityQueueï¼ŒCloseåªæ˜¯ç”¨æ¥ä¿å­˜ç»“ç‚¹ï¼Œæ²¡å…¶ä»–ç‰¹æ®Šç”¨é€”ï¼Œå°±ç”¨ArrayListã€‚ // ä¼˜å…ˆé˜Ÿåˆ—(å‡åº) Queue&lt;Node&gt; openList = new PriorityQueue&lt;Node&gt;() List&lt;Node&gt; closeList = new ArrayList&lt;Node&gt;(); å®šä¹‰å‡ ä¸ªå¸ƒå°”åˆ¤æ–­æ–¹æ³•ï¼šæœ€ç»ˆç»“ç‚¹çš„åˆ¤æ–­ã€ç»“ç‚¹èƒ½å¦åŠ å…¥openè¡¨çš„åˆ¤æ–­ã€ç»“ç‚¹æ˜¯å¦åœ¨Closeè¡¨ä¸­çš„åˆ¤æ–­ã€‚ /** * åˆ¤æ–­ç»“ç‚¹æ˜¯å¦æ˜¯æœ€ç»ˆç»“ç‚¹ */ private boolean isEndNode(Coord end, Coord coord) { return coord != null &amp;&amp; end.equals(coord); } /** * åˆ¤æ–­ç»“ç‚¹èƒ½å¦æ”¾å…¥Openåˆ—è¡¨ */ private boolean canAddNodeToOpen(MapInfo mapInfo, int x, int y) { // æ˜¯å¦åœ¨åœ°å›¾ä¸­ if (x &lt; 0 || x &gt;= mapInfo.width || y &lt; 0 || y &gt;= mapInfo.hight) { return false; } // åˆ¤æ–­æ˜¯å¦æ˜¯ä¸å¯é€šè¿‡çš„ç»“ç‚¹ if (mapInfo.maps[y][x] == BAR) { return false; } // åˆ¤æ–­ç»“ç‚¹æ˜¯å¦å­˜åœ¨closeè¡¨ if (isCoordInClose(x, y)) { return false; } return true; } /** * åˆ¤æ–­åæ ‡æ˜¯å¦åœ¨closeè¡¨ä¸­ */ private boolean isCoordInClose(Coord coord) { return coord != null &amp;&amp; isCoordInClose(coord.x, coord.y); } /** * åˆ¤æ–­åæ ‡æ˜¯å¦åœ¨closeè¡¨ä¸­ */ private boolean isCoordInClose(int x, int y) { if (closeList.isEmpty()) { return false; } for (Node node : closeList) { if (node.coord.x == x &amp;&amp; node.coord.y == y) { return true; } } return false; } å›æº¯ç»˜åˆ¶è·¯å¾„ /** * åœ¨äºŒç»´æ•°ç»„ä¸­ç»˜åˆ¶è·¯å¾„ */ private void drawPath(int[][] maps, Node end) { if (end == null || maps == null) { return; } System.out.println(\"æ€»ä»£ä»·ï¼š\" + end.G); while (end != null) { Coord c = end.coord; maps[c.y][c.x] = PATH; end = end.parent; } } è¿è¡Œç»“æœè‡ªå®šä¹‰Graph int[][] maps = { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }, { 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0 }, { 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, { 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0 }, }; å¼€å§‹èŠ‚ç‚¹ä¸ºï¼šï¼ˆ1,1ï¼‰ ç»“æŸèŠ‚ç‚¹ä¸ºï¼š ï¼ˆ9ï¼Œ 5ï¼‰ è¾“å‡ºç»“æœï¼š æ€»ä»£ä»·ï¼š176 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 2 2 2 2 2 2 2 2 2 2 2 2 0 0 0 0 1 1 0 0 0 0 0 0 1 1 1 2 0 0 0 0 1 0 0 0 0 0 1 1 2 2 0 0 0 0 0 1 1 1 1 1 1 1 2 0 0 0 0 0 0 0 1 0 0 1 0 0 2 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 0 0 0 1 0 0 0 0 1 0 0 0 0 0 0 å¾…ä¼˜åŒ–intç±»å‹ â€”-&gt; æ³›å‹ å¼‚å¸¸æ•°æ®å¤„ç† References ç®—æ³•ç¬¬å››ç‰ˆ A*æœç´¢ç®—æ³• è·¯å¾„è§„åˆ’ä¹‹ A* ç®—æ³• å¯»è·¯ A* Pathfinding é‚£ä¸ªä¼ è¯´ä¸­çš„ç®—æ³•â€”â€”A*ç®—æ³• GraphTree","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://winniekun.github.io/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å›¾è®º","slug":"å›¾è®º","permalink":"https://winniekun.github.io/tags/%E5%9B%BE%E8%AE%BA/"}]},{"title":"HashMapæºç è§£è¯»","slug":"æºç /JDK/map/hashmap-analysis","date":"2020-03-12T13:02:49.000Z","updated":"2021-03-29T23:16:05.822Z","comments":true,"path":"hashmap-analysis/","link":"","permalink":"https://winniekun.github.io/hashmap-analysis/","excerpt":"HashMap æºç è§£è¯»","text":"HashMap æºç è§£è¯» å‰è¨€ hash HashMapç›¸è¾ƒäºä¹‹å‰çš„ArrayListå’ŒLinkedListï¼Œå…¶ç†è§£ä¸Šè¿˜æ˜¯ç¨å¾®æœ‰ä¸€äº›éš¾åº¦ï¼Œå…¶åº•å±‚çš„å®ç°æ˜¯æ•£åˆ—è¡¨, æ•£åˆ—è¡¨å¯¹äºå“ˆå¸Œå†²çªçš„è§£å†³æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§(å¼€æ”¾å¯»å€æ³•, é“¾è¡¨æ³•)ï¼š å¼€æ”¾å¯»å€æ³•ä»¥ä¸‹ä¸ºä¸€äº›å¸¸ç”¨çš„å¼€æ”¾å¯»å€æ³•ã€‚ æœ‰çº¿æ€§æ¢æµ‹æ³•hash(key)+0ã€hash(key)+1ã€hash(key)+2â€¦ äºŒæ¬¡æ¢æµ‹ï¼ˆå¹³æ–¹æ¢æµ‹æ³•ï¼‰hash(key)+0, hash(key)+1^2, hash(key)+2^2â€¦.. åŒé‡æ•£åˆ—ç¬¬ä¸€æ¬¡æ ¹æ®hash()å‡½æ•°è®¡ç®—å¾—åˆ°çš„å­˜å‚¨ä½ç½®å·²ç»è¢«å ç”¨ï¼Œå†ç”¨ç¬¬äºŒä¸ªhash()å‡½æ•°è®¡ç®— é“¾è¡¨æ³•å¯¹äºä¸åŒçš„å…³é”®å­—å¯èƒ½ä¼šé€šè¿‡æ•£åˆ—å‡½æ•°æ˜ å°„åˆ°åŒä¸€ä¸ªåœ°å€ã€‚ä¸ºäº†é¿å…å‘ç”Ÿåˆ†æ­§ï¼Œå°†åŒæ ·çš„å“ˆå¸Œç»“æœï¼Œä½†æ˜¯ä¸åŒå…³é”®å­—çš„å…ƒç´ ï¼Œå¯ä»¥å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸€ä¸ªçº¿æ€§é“¾è¡¨ä¸­ã€‚ HashMapä¸­çš„è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼å°±æ˜¯é“¾è¡¨æ³• æ¦‚è¿°HashMapä¸»è¦ç”¨æ¥å­˜æ”¾é”®å€¼å¯¹, å…¶åŸºäºå“ˆå¸Œè¡¨çš„Mapæ¥å£å®ç°, æ˜¯å¸¸ç”¨çš„Javaé›†åˆä¹‹ä¸€.JDK1.8ä¹‹å‰HashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆ, å…¶ä½¿ç”¨çš„æ˜¯æ•°ç»„è¿›è¡Œå­˜å‚¨, ä¹‹åä½¿ç”¨é“¾æ¥æ³•è§£å†³å“ˆå¸Œå†²çª. JDK1.8ä¹‹åHashMapåœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶, ä¸ä¹‹å‰ä¸åŒçš„æ˜¯, å½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼(é»˜è®¤æ˜¯8), å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘, é¿å…è¿‡é•¿çš„é“¾è¡¨ä»è€Œé™ä½æ€§èƒ½(è¿‡é•¿çš„è¯, å°±ç›¸å½“äºä½¿ç”¨çš„æ˜¯é“¾è¡¨å­˜å‚¨çš„äº†,æ¯æ¬¡çš„æŸ¥æ‰¾éƒ½ä¼šå¯¼è‡´O(n)çš„æ—¶é—´), åŒæ—¶è½¬åŒ–ä¸ºçº¢é»‘æ ‘çš„æ—¶å€™ä¹Ÿä¼šè¿›è¡Œåˆ¤æ–­ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ HashMapçš„æºç ä¸­ï¼Œå……æ–¥ä¸ªå„ç§ä½è¿ç®—ä»£æ›¿å¸¸è§„è¿ç®—çš„åœ°æ–¹ï¼Œä»¥æå‡æ•ˆç‡ï¼š ä¸è¿ç®—æ›¿ä»£æ¨¡è¿ç®—ã€‚ç”¨ hash &amp; (table.length-1) æ›¿ä»£ hash % (table.length) ç”¨if ((e.hash &amp; oldCap) == 0)åˆ¤æ–­æ‰©å®¹åï¼ŒèŠ‚ç‚¹eå¤„äºä½åŒºè¿˜æ˜¯é«˜åŒºã€‚ å½¢è±¡ç†è§£: HashMapçš„åº•å±‚ä¸ºæ•°ç»„, å¯ä»¥å°†å…¶ç§°ä¹‹ä¸ºå“ˆå¸Œæ¡¶ æ¯ä¸ªæ¡¶é‡Œæ”¾çš„æ˜¯é“¾è¡¨. å…¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„å…è®¸keyä¸ºnull, valueä¸ºnulléå†æ—¶æ— åº. HashMap ä¾èµ– HashMapä¾èµ– å®ç°äº†Serializableæ¥å£ å®ç°äº†Cloneableæ¥å£ å®ç°äº†Mapæ¥å£ï¼Œå¹¶ç»§æ‰¿äº†AbstractMapç±» é˜…è¯»å¥—è·¯æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘ï¼Œ é¦–å…ˆåŸºç¡€çš„æ•°æ®æ„é€ , ç„¶åäº†è§£å…¶æ„é€ æ–¹æ³•ï¼Œ ä¹‹åäº†è§£å¸¸ç”¨çš„API(CRUD)æ“ä½œå³å¯ã€‚ [x] å¢ [x] åˆ  [x] æ”¹ [x] æŸ¥ ä»èŠ‚ç‚¹çš„æ„é€ å¼€å§‹HashMapæ•´ä½“çš„æ„é€  HashMapå­˜å‚¨ç»“æ„ åœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™, ä¼šå…ˆæ ¹æ®hashå€¼è®¡ç®—å‡ºå…¶åº”åœ¨çš„ä½ç½®, è‹¥æ˜¯æ²¡æœ‰å†²çª, åˆ™ç›´æ¥æ”¾å…¥, è‹¥æ˜¯æœ‰å†²çª, åˆ™å°†è¯¥å…ƒç´ ä»¥ä¿©è¡¨çš„å½¢å¼æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨ è‹¥æ˜¯é“¾è¡¨çš„é•¿åº¦è¶…è¿‡é˜€å€¼(é»˜è®¤æ˜¯8), åˆ™å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘, æé«˜æ•ˆç‡ æ•°ç»„çš„æŸ¥è¯¢ä¸º$O(1)$ , é“¾è¡¨çš„æŸ¥è¯¢ä¸º$O(k)$, çº¢é»‘æ ‘çš„æŸ¥è¯¢ä¸º$O(logk)$, $k$è¡¨ç¤ºä¸ºæ¡¶ä¸­çš„å…ƒç´ çš„ä¸ªæ•°, æ‰€ä»¥å½“å…ƒç´ å¾ˆå¤šçš„æ—¶å€™, è½¬åŒ–ä¸ºçº¢é»‘æ ‘èƒ½æé«˜æŸ¥è¯¢æ•ˆç‡ å•ä¸ªèŠ‚ç‚¹çš„æ„é€ static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; { final int hash; // å“ˆå¸Œå€¼ final K key; // key V value; // value Node&lt;K,V&gt; next; // é“¾è¡¨ä¸­è¯¥å…ƒç´ æŒ‡å‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ // å•ä¸ªèŠ‚ç‚¹åŒ…å«çš„ä¿¡æ¯ Node(int hash, K key, V value, Node&lt;K,V&gt; next) { this.hash = hash; this.key = key; this.value = value; this.next = next; } public final K getKey() { return key; } public final V getValue() { return value; } public final String toString() { return key + \"=\" + value; } // å“ˆå¸Œå‡½æ•° // ä¸€ä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯å°†keyçš„å“ˆå¸Œå€¼å’Œvalueçš„å“ˆå¸Œå€¼å¼‚æˆ–å¾—åˆ° public final int hashCode() { return Objects.hashCode(key) ^ Objects.hashCode(value); } // è®¾ç½®æ–°çš„value åŒæ—¶è¿”å›æ—§çš„value public final V setValue(V newValue) { V oldValue = value; value = newValue; return oldValue; } public final boolean equals(Object o) { if (o == this) return true; if (o instanceof Map.Entry) { Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; } return false; } } æ€»ç»“: ä¸€ä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯å°†keyçš„å“ˆå¸Œå€¼å’Œvalueçš„å“ˆå¸Œå€¼å¼‚æˆ–å¾—åˆ° å•ä¸ªèŠ‚ç‚¹åŒ…å«çš„ä¿¡æ¯æœ‰ key value hashå€¼ nextæŒ‡é’ˆï¼ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ çº¢é»‘æ ‘èŠ‚ç‚¹çš„æ„é€ static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; { TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; // é»˜è®¤ä¸ºçº¢è‰²ï¼Œ åŸå› ä¸ºçº¢é»‘æ ‘çš„æ€§è´¨å›› TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) { super(hash, key, val, next); } ç±»çš„å±æ€§//åˆå§‹å®¹é‡ä¸º16 æ³¨é‡Šä¸­è¯´æ˜äº† å¿…é¡»ä¸º2çš„å¹‚æ¬¡ static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16 // æœ€å¤§å®¹é‡ 2^30 static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // é»˜è®¤è´Ÿè½½å› å­0.75(è‹¥æ˜¯æ„é€ å‡½æ•°ä¸­æœªè¯´æ˜) static final float DEFAULT_LOAD_FACTOR = 0.75f; // æ¡¶ä¸­çš„èŠ‚ç‚¹æ•°é‡å¤§äº8æ—¶è½¬ä¸ºçº¢é»‘æ ‘ static final int TREEIFY_THRESHOLD = 8; // æ¡¶ä¸­çš„èŠ‚ç‚¹æ•°é‡å°äº6æ—¶ è½¬ä¸ºé“¾è¡¨ static final int UNTREEIFY_THRESHOLD = 6; // æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„tableçš„æœ€å°å¤§å° static final int MIN_TREEIFY_CAPACITY = 64; // å“ˆå¸Œæ¡¶ å­˜æ”¾é“¾è¡¨ æ€»æ˜¯2çš„å€æ•° transient Node&lt;K,V&gt;[] table; // å­˜æ”¾å…·ä½“å…ƒç´ çš„é›† transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet; // å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ã€‚ transient int size; // æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨ transient int modCount; // threshold = å“ˆå¸Œæ¡¶.length * loadFactor; å½“æ¡¶çš„ä½¿ç”¨æ•°é‡æ“ä½œè¯¥å€¼, è¿›è¡Œæ‰©å®¹ int threshold; // è£…è½½å› å­ï¼Œç”¨äºè®¡ç®—å“ˆå¸Œè¡¨å…ƒç´ æ•°é‡çš„é˜ˆå€¼ã€‚ final float loadFactor; æ€»ç»“ï¼šæœ€ä¸ºé‡è¦çš„å±æ€§ä¸ºï¼š tableã€sizeã€thresholdã€loadFactor æ„é€ æ–¹æ³•HashMap()public HashMap() { // é»˜è®¤æ„é€ æ–¹æ³• å°†è´Ÿè½½å› å­è®¾ç½®ä¸ºé»˜è®¤å€¼ 0.75, å…¶ä»–çš„å±æ€§å‡ä¸ºé»˜è®¤ // å‡è®¾é»˜è®¤åˆå§‹åŒ–ç©ºé—´å¤§å°ä¸º16, åˆ™å…ƒç´ æ•°é‡è¾¾åˆ°16*0.75=12æ—¶, ä¼šè¿›è¡Œæ‰©å®¹. this.loadFactor = DEFAULT_LOAD_FACTOR; } è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ„é€ å™¨ï¼Œæ½œåœ¨çš„é—®é¢˜æ˜¯åˆå§‹å®¹é‡16å¤ªå°äº†ï¼Œå¯èƒ½ä¸­é—´éœ€è¦ä¸æ–­æ‰©å®¹çš„é—®é¢˜ï¼Œä¼šå½±å“æ’å…¥çš„æ•ˆç‡ã€‚ HashMap(int)public HashMap(int initialCapacity) { this(initialCapacity, DEFAULT_LOAD_FACTOR); } ç”¨è¿™ç§æ„é€ å‡½æ•°åˆ›å»ºHashMapçš„å¯¹è±¡ï¼Œå¦‚æœçŸ¥é“mapè¦å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šå®¹é‡çš„å¤§å°ï¼Œ å‡é™¤ä¸åœçš„æ‰©å®¹ï¼Œæé«˜æ•ˆç‡ å†…éƒ¨è°ƒç”¨ä¸‹è¿°çš„æ„é€ æ–¹æ³• HashMap(int , float)public HashMap(int initialCapacity, float loadFactor) { // æ£€æŸ¥è¾“å…¥åˆå§‹å®¹é‡æ˜¯å¦åˆæ³• if (initialCapacity &lt; 0) throw new IllegalArgumentException(\"Illegal initial capacity: \" + initialCapacity); // MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // ä¼ å…¥çš„åˆå§‹åŒ–å®¹é‡ &lt;=æœ€å¤§å®¹é‡ if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; // æ£€æŸ¥è¾“å…¥åŠ è½½å› å­æ˜¯å¦åˆæ³• if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(\"Illegal load factor: \" + loadFactor); this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity); } // å–ä¸capæœ€è¿‘çš„ä¸”å¤§äºcapçš„2çš„æ¬¡æ–¹å€¼ static final int tableSizeFor(int cap) { int n = cap - 1; // æ‰§è¡Œæˆ–è¿ç®— n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; } å…ˆæ˜¯å¯¹åˆå§‹åŒ–å®¹é‡ã€è£…è½½å› å­çš„åˆç†æ€§æ£€æµ‹ï¼Œä¹‹åè¿›è¡Œèµ‹å€¼ï¼ŒloadFactor: è‡ªå®šä¹‰å€¼ï¼Œ é»˜è®¤ä¸º0.75ï¼Œthreshold: å–ä¸capæœ€è¿‘çš„ä¸”å¤§äºcapçš„2çš„æ¬¡æ–¹å€¼ æ€»ç»“1. ä¸ºä»€ä¹ˆ threshold è¦è¿”å›å¤§äºç­‰äº initialCapacity çš„æœ€å° 2 çš„ N æ¬¡æ–¹ï¼Ÿ è®¡ç®—å…ƒç´ tableä¸­çš„ä½ç½®çš„æ—¶å€™ï¼Œæ¦‚è¿°ä¸­æœ‰è®²ï¼Œä½¿ç”¨çš„æ˜¯hash &amp; (table.length-1) è€Œä¸æ˜¯æˆ‘ä»¬è®¤ä¸ºçš„ hash % table.lengthï¼Œè€Œè¿™ä¸¤ä¸ªæ–¹å¼åœ¨table.lengthæ˜¯2çš„Næ¬¡æ–¹çš„æ—¶å€™æ˜¯ç­‰ä»·çš„ï¼Œä»æ€§èƒ½ä¸Šè€Œè¨€ï¼Œ&amp;æ€§èƒ½æ›´å¥½ï¼Œæ‰€ä»¥ï¼Œä»…éœ€è¦æ»¡è¶³æ•°ç»„çš„å®¹é‡nå°½å¯èƒ½ä¸º2çš„Næ¬¡æ–¹å³å¯ã€‚ 2. ä¸ºä»€ä¹ˆç»™çš„æ˜¯åˆå§‹åŒ–å®¹é‡ï¼Œ è®¡ç®—çš„å´æ˜¯é˜€å€¼ï¼Œè€Œä¸æ˜¯å®¹é‡ï¼Ÿ 1.8ä¸­ï¼Œ å°†tableçš„åˆå§‹åŒ–æ”¾å…¥äº†resize()ä¸­ï¼Œå¹¶ä¸”åœ¨ç±»å±æ€§ä¸­ä¹Ÿæ³¨æ„åˆ°äº†æ²¡æœ‰capacityè¿™ä¸ªå±æ€§ï¼Œ æ‰€ä»¥è¿™é‡Œåªèƒ½é‡æ–°è®¡ç®—thresholdï¼Œè€Œresize()åé¢å°±ä¼šæ ¹æ®thresholdæ¥é‡æ–°è®¡ç®—capacityï¼Œæ¥è¿›è¡Œ tableæ•°ç»„çš„åˆå§‹åŒ–ï¼Œç„¶åå†é‡æ–°æŒ‰ç…§è£…è½½å› å­è®¡ç®—thresholdã€‚ HashMap(Map&lt;?extends K, ?extends V&gt;)// å°†å·²æœ‰map mé‡Œçš„æ‰€æœ‰å…ƒç´ åŠ å…¥å½“å‰çš„mapä¸­ public HashMap(Map&lt;? extends K, ? extends V&gt; m) { this.loadFactor = DEFAULT_LOAD_FACTOR; // æ ¸å¿ƒ æ‰¹é‡æ·»åŠ åˆ°tableä¸­ putMapEntries(m, false); } putMapEntries(m, false)// å…¶å®å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå–å‡ºmä¸­çš„å…ƒç´ è°ƒç”¨putVal,ä¸€ä¸ªä¸ªæ”¾å…¥tableä¸­çš„è¿‡ç¨‹ã€‚ final void putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) { int s = m.size(); if (s &gt; 0) { // â‘  tableä¸ºç©ºã€‚è¯´æ˜è¿˜æ²¡åˆå§‹åŒ–ï¼Œé€‚åˆåœ¨æ„é€ æ–¹æ³•çš„æƒ…å†µ if (table == null) { // pre-size // +1.0F çš„ç›®çš„ï¼Œæ˜¯å› ä¸ºä¸‹é¢ (int) ç›´æ¥å–æ•´ï¼Œé¿å…ä¸å¤Ÿã€‚ float ft = ((float)s / loadFactor) + 1.0F; // ä¿®æ­£ï¼Œé˜²æ­¢è¶…å‡º int t = ((ft &lt; (float)MAXIMUM_CAPACITY) ? (int)ft : MAXIMUM_CAPACITY); // å¦‚æœè®¡ç®—å‡ºæ¥çš„ t å¤§äºé˜€å€¼ï¼Œåˆ™è®¡ç®—æ–°çš„é˜€å€¼ if (t &gt; threshold) threshold = tableSizeFor(t); } // â‘¡ å¦‚æœ table éç©ºï¼Œè¯´æ˜å·²ç»åˆå§‹åŒ–ï¼Œéœ€è¦ä¸æ–­æ‰©å®¹åˆ°é˜€å€¼è¶…è¿‡ s çš„æ•°é‡ else if (s &gt; threshold) resize(); // â‘¢ æ­£å¸¸æƒ…å†µ for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) { K key = e.getKey(); V value = e.getValue(); // æ·»åŠ å…ƒç´  putVal(hash(key), key, value, false, evict); } } } æ•´ä½“çš„æ„æ€å°±æ˜¯å¿…é¡»ä¿è¯æ–°çš„mapçš„tableå®¹é‡å¤Ÿï¼Œå¦‚ä½•ä¿è¯ï¼Ÿç¡®ä¿åŸmapçš„å…ƒç´ æ•°é‡å°äºæ–°mapçš„thresholdã€‚ æ„é€ æ–¹æ³•æ€»ç»“ è‹¥æ˜¯ä¸çŸ¥é“éœ€è¦åˆ›å»ºçš„mapçš„å®¹é‡å¤§å°ï¼Œä½¿ç”¨é»˜è®¤æ„é€ æ–¹æ³• é»˜è®¤çš„å®¹é‡å¤§å°ä¸º16 è‹¥æ˜¯èƒ½ç¡®å®šmapçš„å®¹é‡å¤§å°ï¼Œå¯ä½¿ç”¨ç¬¬äºŒç§æ„é€ æ–¹æ³• thresholdçš„å€¼ä¸ºæœ€å°çš„å¤§äºè¾“å…¥å®¹é‡çš„2çš„æŒ‡æ•° å°†åŸoldMapæ”¾å…¥å¦ä¸€ä¸ªnewMap è‹¥oldMapä¸ºç©ºï¼ˆæ²¡æœ‰å…ƒç´ ï¼‰ è‹¥æ˜¯oldMapä¸æ˜¯æ–°å»ºçš„ï¼Œå…¶è‡ªèº«æœ‰ä¸€å®šå®¹é‡ ç¡®ä¿newMapèƒ½å¤Ÿå®¹ä¸‹oldMapï¼Œ ä¸è¡Œè¿›è¡Œæ‰©å®¹ å¢ã€æ”¹put(K key, V value)public V put(K key, V value) { return putVal(hash(key), key, value, false, true); } hash(key) static final int hash(Object key) { int h; //ä¸ºäº†ä½¿è®¡ç®—å‡ºçš„hashæ›´åˆ†æ•£ return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); } JDK1.8å“ˆå¸Œè®¡ç®—ï¼Œ å–å¾—keyçš„hashcodeåï¼Œé«˜16ä½ä¸æ•´ä¸ªHashå¼‚æˆ–è¿ç®—é‡æ–°è®¡ç®—hashå€¼ putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict)final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { // å¯¹åº”tableæ•°ç»„ Node&lt;K,V&gt;[] tab; // å¯¹åº”ä½ç½®çš„ Node èŠ‚ç‚¹ Node&lt;K,V&gt; p; // n tableçš„é•¿åº¦ // åŸtabä¸­å¯¹åº”æ”¾å…¥Nodeçš„ä½ç½® int n, i; // å¦‚æœ table æœªåˆå§‹åŒ–ï¼Œæˆ–è€…å®¹é‡ä¸º 0 ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ // (ç¬¬ä¸€æ¬¡è§è¿™ç§èµ‹å€¼å’Œåˆ¤æ–­èåˆçš„æ“ä½œï¼Œå­¦åˆ°äº†å­¦åˆ°äº†) if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // å¦‚æœå¯¹åº”çš„ä½ç½®çš„NodeèŠ‚ç‚¹ä¸ºç©ºï¼Œåˆ™ç›´æ¥åˆ›å»º Node èŠ‚ç‚¹å³å¯ã€‚ // (n-1)&amp;hash è·å–æ‰€åœ¨tableçš„ä½ç½® if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else { // å“ˆå¸Œå†²çªè§£å†³ // key åœ¨ HashMap å¯¹åº”çš„è€èŠ‚ç‚¹ Node&lt;K,V&gt; e; K k; // hashç›¸ç­‰ keyç›¸ç­‰ æ‰§è¡Œè¦†ç›– if (p.hash == hash &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // ä¸ºçº¢é»‘æ ‘çš„èŠ‚ç‚¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // ä¸ºNodeèŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜æ˜¯é“¾è¡¨ï¼Œä¸”ä¸æ˜¯è¦†ç›–æ“ä½œã€‚éœ€è¦éå†æŸ¥æ‰¾ else { // åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¿›è¡Œé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œä»€ä¹ˆæ—¶å€™çº¢é»‘æ ‘è½¬é“¾è¡¨ for (int binCount = 0; ; ++binCount) { // å¦‚æœé“¾è¡¨éå†å®Œäº†éƒ½æ²¡æœ‰æ‰¾åˆ°ç›¸åŒkeyçš„å…ƒç´ ï¼Œè¯´æ˜è¯¥keyå¯¹åº”çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™åœ¨é“¾è¡¨ // æœ€åæ’å…¥ä¸€ä¸ªæ–°èŠ‚ç‚¹ if ((e = p.next) == null) { p.next = newNode(hash, key, value, null); // é“¾è¡¨çš„é•¿åº¦å¦‚æœæ•°é‡è¾¾åˆ° TREEIFY_THRESHOLDï¼ˆ8ï¼‰æ—¶ï¼Œåˆ™è¿›è¡Œæ ‘åŒ–ã€‚ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st treeifyBin(tab, hash); break; } // å¦‚æœå¾…æ’å…¥çš„keyåœ¨é“¾è¡¨ä¸­æ‰¾åˆ°äº†ï¼Œåˆ™é€€å‡ºå¾ªç¯ if (e.hash == hash&amp;&amp;((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; } } // è¦†ç›–æ“ä½œï¼Œ ä¹Ÿå°±æ˜¯ç›¸åŒçš„keyçš„valueè¿›è¡Œè¦†ç›– if (e != null) { // existing mapping for key V oldValue = e.value; // onlyIfAbsentè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¦†ç›–oldValue if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; } } ++modCount; // å¦‚æœè¶…è¿‡é˜€å€¼ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null; } æ€»ç»“ä¸€ä¸‹å›¾ç‰‡ä¸ºputValæ–¹æ³•çš„æ€»ä½“é€»è¾‘ hashmap_put.png æ‘˜è‡ª Hashmapæºç è§£æ putAll(Map&lt;? extends K, ? extends V&gt; m)public void putAll(Map&lt;? extends K, ? extends V&gt; m) { this.putMapEntries(m, true); } putMapEntriesåœ¨æ„é€ æ–¹æ³•å››ä¸­å·²ç»è®²è§£äº†ã€‚ æ‰©å®¹æœºåˆ¶resize()// æ‰©å®¹æ–¹æ³• final Node&lt;K,V&gt;[] resize() { // oldTab è¡¨ç¤ºå½“å‰çš„å“ˆå¸Œæ¡¶ Node&lt;K,V&gt;[] oldTab = table; // oldCapè¡¨ç¤ºå½“å‰å“ˆå¸Œæ¡¶çš„å®¹é‡ length int oldCap = (oldTab == null) ? 0 : oldTab.length; // å½“å‰å“ˆå¸Œæ¡¶çš„é˜€å€¼ int oldThr = threshold; // åˆå§‹åŒ–æ–°çš„å®¹é‡å’Œé˜€å€¼ int newCap, newThr = 0; // 1. å¦‚æœå½“å‰çš„å®¹é‡ä¸ä¸ºç©º if (oldCap &gt; 0) { // å¦‚æœå½“å‰çš„å®¹é‡å·²ç»è¾¾åˆ°äº†ä¸Šé™ if (oldCap &gt;= MAXIMUM_CAPACITY) { // é˜€å€¼ä¸º2^32-1 threshold = Integer.MAX_VALUE; // è¿”å›å½“å‰çš„å“ˆå¸Œæ¡¶ä¸å†æ‰©å®¹ return oldTab; } // å¦è€…æ–°çš„å®¹é‡ä¸ºåŸå…ˆå®¹é‡çš„ä¸¤å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY)// å¦‚æœæ—§çš„å®¹é‡å¤§äºç­‰äºé»˜è®¤çš„åˆå§‹å®¹é‡ 16 // æ–°çš„é˜€å€¼ä¹Ÿä¸ºåŸå…ˆçš„ä¸¤å€ newThr = oldThr &lt;&lt; 1; // double threshold } // 2. å¦‚æœå½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æœ‰é˜ˆå€¼ã€‚ä»£è¡¨æ˜¯åˆå§‹åŒ–æ—¶æŒ‡å®šäº†å®¹é‡ã€é˜ˆå€¼çš„æƒ…å†µ(ä¸Šè¿°çš„ç¬¬ä¸‰ç§æ„é€ æ–¹æ³•) else if (oldThr &gt; 0) // initial capacity was placed in threshold newCap = oldThr; // æ–°çš„å®¹é‡ä¸ºæ—§çš„é˜€å€¼ // 3. æ­¤å¤„çš„åˆ¤æ–­ç”¨äºåˆå§‹åŒ– else { // zero initial threshold signifies using defaults newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); } //å¦‚æœæ–°çš„é˜ˆå€¼æ˜¯0ï¼Œå¯¹åº”çš„æ˜¯ å½“å‰è¡¨æ˜¯ç©ºçš„ï¼Œä½†æ˜¯æœ‰é˜ˆå€¼çš„æƒ…å†µ if (newThr == 0) { //æ ¹æ®æ–°è¡¨å®¹é‡ å’Œ åŠ è½½å› å­ æ±‚å‡ºæ–°çš„é˜ˆå€¼ float ft = (float)newCap * loadFactor; // è¿›è¡Œè¶Šç•Œä¿®å¤ newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); } // æ›´æ–°é˜€å€¼ threshold = newThr; @SuppressWarnings({\"rawtypes\",\"unchecked\"}) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; // æ›´æ–°å“ˆå¸Œæ¡¶çš„å¼•ç”¨ table = newTab; // å¦‚æœä»¥å‰çš„å“ˆå¸Œæ¡¶æœ‰å…ƒç´  // ä»¥ä¸‹æ‰§è¡Œå°†åŸå“ˆå¸Œæ¡¶ä¸­çš„å…ƒç´ è½¬å…¥æ–°çš„å“ˆå¸Œæ¡¶ä¸­ if (oldTab != null) { // éå†è€çš„å“ˆå¸Œæ¡¶ for (int j = 0; j &lt; oldCap; ++j) { // å–å‡ºå½“å‰çš„èŠ‚ç‚¹e Node&lt;K,V&gt; e; // å¦‚æœå½“å‰æ¡¶ä¸­æœ‰å…ƒç´ , åˆ™å°†é“¾è¡¨å¤åˆ¶ç»™e if ((e = oldTab[j]) != null) { // å°†åŸå“ˆå¸Œæ¡¶ç½®ç©ºä»¥ä¾¿GC oldTab[j] = null; // å½“å‰é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ , æ²¡æœ‰å‘ç”Ÿå“ˆå¸Œç¢°æ’ if (e.next == null) //ç›´æ¥å°†è¿™ä¸ªå…ƒç´ æ”¾ç½®åœ¨æ–°çš„å“ˆå¸Œæ¡¶é‡Œã€‚ //æ³¨æ„è¿™é‡Œå–ä¸‹æ ‡ æ˜¯ç”¨ å“ˆå¸Œå€¼ ä¸ æ¡¶çš„é•¿åº¦-1 ã€‚ //ç”±äºæ¡¶çš„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹ï¼Œè¿™ä¹ˆåšå…¶å®æ˜¯ç­‰äº ä¸€ä¸ªæ¨¡è¿ç®—ã€‚ä½†æ˜¯æ•ˆç‡æ›´é«˜ newTab[e.hash &amp; (newCap - 1)] = e; // å‘ç”Ÿç¢°æ’, è€Œä¸”èŠ‚ç‚¹çš„ä¸ªæ•°è¶…è¿‡8, åˆ™è½¬åŒ–ä¸ºçº¢é»‘æ ‘ else if (e instanceof TreeNode) ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); //å‘ç”Ÿç¢°æ’, èŠ‚ç‚¹ä¸ªæ•°ï¼œ8 åˆ™è¿›è¡Œå¤„ç†, ä¾æ¬¡æ”¾å…¥æ–°çš„å“ˆå¸Œæ¡¶å¯¹åº”çš„ä¸‹æ ‡ä½ç½® //å› ä¸ºæ‰©å®¹æ˜¯å®¹é‡ç¿»å€ï¼Œæ‰€ä»¥åŸé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨å¯èƒ½å­˜æ”¾åœ¨åŸæ¥çš„ä¸‹ //æ ‡,å³lowä½ï¼Œ æˆ–è€…æ‰©å®¹åçš„ä¸‹æ ‡ï¼Œå³highä½ã€‚ highä½=lowä½+åŸå“ˆå¸Œæ¡¶å®¹é‡ else { // preserve order //ä½ä½é“¾è¡¨çš„å¤´ç»“ç‚¹ã€å°¾èŠ‚ç‚¹ Node&lt;K,V&gt; loHead = null, loTail = null; //é«˜ä½é“¾è¡¨çš„å¤´ç»“ç‚¹ã€å°¾èŠ‚ç‚¹ Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; // å°†åŒä¸€æ¡¶ä¸­çš„å…ƒç´ æ ¹æ®(e.hash &amp; oldCap)æ˜¯å¦ä¸º0è¿›è¡Œåˆ†å‰²ï¼Œåˆ†æˆé«˜ä½é“¾è¡¨å’Œä½ä½ é“¾è¡¨ä»¥å®Œæˆrehash do { next = e.next; //è¿™é‡Œåˆæ˜¯ä¸€ä¸ªåˆ©ç”¨ä½è¿ç®— ä»£æ›¿å¸¸è§„è¿ç®—çš„é«˜æ•ˆç‚¹ï¼š åˆ©ç”¨å“ˆå¸Œå€¼ä¸æ—§çš„å®¹é‡ï¼Œ //å¯ä»¥å¾—åˆ°å“ˆå¸Œå€¼å–æ¨¡åï¼Œæ˜¯å¤§äºç­‰äºoldCapè¿˜æ˜¯å°äºoldCapï¼Œç­‰äº0ä»£è¡¨å°äº //oldCapï¼Œåº”è¯¥å­˜æ”¾åœ¨ä½ä½ï¼Œå¦åˆ™å­˜æ”¾åœ¨é«˜ä½ if ((e.hash &amp; oldCap) == 0) { if (loTail == null) loHead = e; else loTail.next = e; loTail = e; } else { if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; } } while ((e = next) != null); if (loTail != null) { loTail.next = null; newTab[j] = loHead; } if (hiTail != null) { hiTail.next = null; newTab[j + oldCap] = hiHead; } } } } } return newTab; } æ€»ç»“æ­¥éª¤: å¦‚æœä½¿ç”¨çš„æ˜¯é»˜è®¤æ„é€ æ–¹æ³•, åˆ™ç¬¬ä¸€æ¬¡æ’å…¥å…ƒç´ çš„æ—¶å€™åˆå§‹åŒ–ä¸ºé»˜è®¤çš„å®¹é‡16, æ‰©å®¹é˜€å€¼ä¸º12 å¦‚æœä½¿ç”¨çš„æ˜¯éé»˜è®¤æ–¹æ³•, åˆ™ç¬¬ä¸€æ¬¡æ’å…¥å…ƒç´ æ—¶åˆå§‹åŒ–å®¹é‡ä¸ºæ‰©å®¹é˜€å€¼, æ‰©å®¹çš„é˜€å€¼ä¸ºåˆå§‹åŒ–çš„æ—¶å€™, æ‰©å®¹é—¨æ§›åœ¨æ„é€ æ–¹æ³•é‡Œç­‰äºä¼ å…¥å®¹é‡å‘ä¸Šæœ€è¿‘çš„2çš„næ¬¡æ–¹ å¦‚æœæ—§å®¹é‡ï¼0, åˆ™æ–°å®¹é‡ä¸ºæ—§å®¹é‡çš„2å€, ä½†ä¸è¶…è¿‡æœ€å¤§å®¹é‡($2^{30}$), æ–°çš„æ‰©å®¹é˜€å€¼ä¸ºæ—§çš„æ‰©å®¹é˜€å€¼2å€ åˆ›å»ºæ–°çš„å®¹é‡æ¡¶ æ¬ç§»å…ƒç´ ï¼ŒåŸé“¾è¡¨åˆ†åŒ–æˆä¸¤ä¸ªé“¾è¡¨ï¼Œä½ä½é“¾è¡¨å­˜å‚¨åœ¨åŸæ¥æ¡¶çš„ä½ç½®ï¼Œé«˜ä½é“¾è¡¨æ¬ç§»åˆ°åŸæ¥æ¡¶çš„ä½ç½®åŠ æ—§å®¹é‡çš„ä½ç½® åˆ remove(Object key)public V remove(Object key) { Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value; } final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value, boolean matchValue, boolean movable) { // è¿™äº›å’Œå¢é‡Œé¢æ˜¯å·®ä¸å¤šçš„ // tabï¼šæ¡¶æ•°ç»„ pï¼šå¾…åˆ é™¤èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ n: æ¡¶æ•°ç»„å¤§å° index: æ¡¶æ•°ç»„ç¬¬iä¸ªä½ç½® Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null&amp;&amp;(n = tab.length)&gt;0 &amp;&amp;(p=tab[index=(n-1)&amp;hash])!= null) { // nodeä¸ºéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) { if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else { do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { node = e; break; } p = e; } while ((e = e.next) != null); } } // æ‰¾åˆ°å¯¹åº”çš„keyè¿›è¡Œremoveæ ¸å¿ƒ if (node != null &amp;&amp; (!matchValue || (v = node.value) == value || (value != null &amp;&amp; value.equals(v)))) { if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); // å¦‚æœnode == pï¼Œè¯´æ˜æ˜¯é“¾è¡¨å¤´æ˜¯å¾…åˆ é™¤èŠ‚ç‚¹ else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; } } return null; } é™¤å»å¤æ‚çš„åˆ¤æ–­ï¼Œä¹Ÿå°±æ˜¯å•é“¾è¡¨åˆ é™¤æŒ‡å®šçš„èŠ‚ç‚¹ï¼Œå…±æœ‰ä¸¤ç§æƒ…å†µï¼š 1.åˆ é™¤çš„ä¸ºå¤´ç»“ç‚¹ã€‚2. åˆ é™¤çš„ä¸ºä¸­é—´èŠ‚ç‚¹ remove(Object key, Object value)public boolean remove(Object key, Object value) { return removeNode(hash(key), key, value, true, true) != null; } æŸ¥get(Object key)public V get(Object key) { HashMap.Node e; return (e = this.getNode(hash(key), key)) == null ? null } // æ ¹æ®keyè·å–å¯¹åº”çš„èŠ‚ç‚¹ final HashMap.Node&lt;K, V&gt; getNode(int hash, Object key) { HashMap.Node[] tab; HashMap.Node first; int n; if ((tab = this.table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[n - 1 &amp; hash]) != null) { Object k; if (first.hash == hash &amp;&amp; ((k = first.key) == key || key != null &amp;&amp; key.equals(k))) { return first; } HashMap.Node e; if ((e = first.next) != null) { if (first instanceof HashMap.TreeNode) { return ((HashMap.TreeNode)first).getTreeNode(hash, key); } do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || key != null &amp;&amp; key.equals(k))) { return e; } } while((e = e.next) != null); } } return null; } ä½¿ç”¨first.hash == hash &amp;&amp; ((k = first.key) == key || key != null &amp;&amp; key.equals(k))åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªkey(å› ä¸ºç›¸åŒçš„hashå¯èƒ½å¹¶ä¸æ˜¯åŒä¸€ä¸ªkeyï¼Œå› ä¸ºå…ˆæ˜¯ä½¿ç”¨(n - 1) &amp; hashå¯»æ‰¾æ¡¶çš„ä½ç½®ï¼Œä¹‹åå†ä¾æ¬¡æŸ¥æ‰¾key) Noteè´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º: å–ç»å¯¹å€¼æ±‚äºŒè¿›åˆ¶ è·å¾—åŸç  ä¹‹åå„ä¸ªä½å–åè·å¾—åç  åç åœ¨æœ€åä¸€ä½ï¼‹1è·å¾—è¡¥ç  è¡¥ç æä¸ºè´Ÿæ•°çš„è¡¨ç¤º &gt;&gt;&gt;å’Œ&gt;&gt;çš„åŒºåˆ« &gt;&gt;&gt;é€‚åˆé«˜ä½çš„è¿ç®—ä½ä½è¿ç®—ä¸¤è€…æ— åŒºåˆ« hashCodeä¸equalsçš„æ·±å…¥ç†è§£&gt;&gt; hashCode çš„å¸¸è§„åå®šæ˜¯ï¼šåœ¨ Java åº”ç”¨ç¨‹åºæ‰§è¡ŒæœŸé—´ï¼Œåœ¨åŒä¸€å¯¹è±¡ä¸Šå¤šæ¬¡è°ƒç”¨ hashCode æ–¹æ³•æ—¶ï¼Œå¿…é¡»ä¸€è‡´åœ°è¿”å›ç›¸åŒçš„æ•´æ•°ï¼Œ==å‰ææ˜¯å¯¹è±¡ä¸Š equals æ¯”è¾ƒä¸­æ‰€ç”¨çš„ä¿¡æ¯æ²¡æœ‰è¢«ä¿®æ”¹ã€‚==ä»æŸä¸€åº”ç”¨ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œåˆ°åŒä¸€åº”ç”¨ç¨‹åºçš„å¦ä¸€æ¬¡æ‰§è¡Œï¼Œè¯¥æ•´æ•°æ— éœ€ä¿æŒä¸€è‡´ã€‚==å¦‚æœæ ¹æ® equals(Object) æ–¹æ³•ï¼Œä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆåœ¨ä¸¤ä¸ªå¯¹è±¡ä¸­çš„æ¯ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•éƒ½å¿…é¡»ç”Ÿæˆç›¸åŒçš„æ•´æ•°ç»“æœã€‚==ä»¥ä¸‹æƒ…å†µä¸æ˜¯å¿…éœ€çš„ï¼šå¦‚æœæ ¹æ® equals(java.lang.Object) æ–¹æ³•ï¼Œä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆåœ¨ä¸¤ä¸ªå¯¹è±¡ä¸­çš„ä»»ä¸€å¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•å¿…å®šä¼šç”Ÿæˆä¸åŒçš„æ•´æ•°ç»“æœã€‚ä½†æ˜¯ï¼Œç¨‹åºå‘˜åº”è¯¥çŸ¥é“ï¼Œä¸ºä¸ç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆä¸åŒæ•´æ•°ç»“æœå¯ä»¥æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚å®é™…ä¸Šï¼Œç”± Object ç±»å®šä¹‰çš„ hashCode æ–¹æ³•ç¡®å®ä¼šé’ˆå¯¹ä¸åŒçš„å¯¹è±¡è¿”å›ä¸åŒçš„æ•´æ•°ã€‚ï¼ˆè¿™ä¸€èˆ¬æ˜¯é€šè¿‡å°†è¯¥å¯¹è±¡çš„å†…éƒ¨åœ°å€è½¬æ¢æˆä¸€ä¸ªæ•´æ•°æ¥å®ç°çš„ï¼Œä½†æ˜¯ JavaTM ç¼–ç¨‹è¯­è¨€ä¸éœ€è¦è¿™ç§å®ç°æŠ€å·§ã€‚ï¼‰ ==å½“equalsæ–¹æ³•è¢«é‡å†™æ—¶ï¼Œé€šå¸¸æœ‰å¿…è¦é‡å†™ hashCode æ–¹æ³•ï¼Œä»¥ç»´æŠ¤ hashCode æ–¹æ³•çš„å¸¸è§„åå®šï¼Œè¯¥åå®šå£°æ˜ç›¸ç­‰å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„å“ˆå¸Œç ã€‚== hashCodeçš„å­˜åœ¨ä¸»è¦æ˜¯ç”¨äºæŸ¥æ‰¾çš„å¿«æ·æ€§,å¦‚HashTable, HashMapç­‰. ç”¨æ¥åœ¨æ•£åˆ—å­˜å‚¨æ•°æ®ç»“æ„ä¸­ç¡®å®šå¯¹è±¡çš„å­˜å‚¨åœ°å€çš„. è‹¥æ˜¯ä¸¤ä¸ªå¯¹è±¡ç›¸åŒ,é‚£ä¹ˆequals(java.lang.Object)æ–¹æ³•ä¸ºtrue, é‚£ä¹ˆä¸¤ä¸ªå¯¹è±¡çš„hashCodeå¿…é¡»ç›¸åŒ. å¦‚æœå¯¹è±¡çš„equalsæ–¹æ³•è¢«é‡å†™ï¼Œé‚£ä¹ˆå¯¹è±¡çš„hashCodeä¹Ÿå°½é‡é‡å†™ï¼Œå¹¶ä¸”äº§ç”ŸhashCodeä½¿ç”¨çš„å¯¹è±¡ï¼Œä¸€å®šè¦å’Œequalsæ–¹æ³•ä¸­ä½¿ç”¨çš„ä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šè¿åä¸Šä¸€æ¡. ä¸¤ä¸ªå¯¹è±¡çš„hashCodeç›¸åŒï¼Œå¹¶ä¸ä¸€å®šè¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡å°±ç›¸åŒï¼Œä¹Ÿå°±æ˜¯ä¸ä¸€å®šé€‚ç”¨äºequals(java.lang.Object) æ–¹æ³•ï¼Œåªèƒ½å¤Ÿè¯´æ˜è¿™ä¸¤ä¸ªå¯¹è±¡åœ¨æ•£åˆ—å­˜å‚¨ç»“æ„ä¸­ï¼Œå¦‚Hashtableï¼Œä»–ä»¬â€œå­˜æ”¾åœ¨åŒä¸€ä¸ªç¯®å­é‡Œâ€ã€‚ ==hashCodeæ˜¯ç”¨äºæŸ¥æ‰¾ä½¿ç”¨çš„ï¼Œè€Œequalsæ˜¯ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ˜¯å¦ç›¸ç­‰çš„== åº•å±‚æ•°æ®ç»“æ„åˆ†æä¸€äº›æ“ä½œç¬¦å·è§£æ ^ å¼‚æˆ– &gt;&gt;&gt; å‘å³ç§»åŠ¨xxxä½, æ— è§†ç¬¦å·, é«˜ä½å¡«0ï¼Œä¸èƒ½å·¦ç§» &gt;&gt; åŒç†å³ç§»xxxä½, èƒ½å·¦ç§» æ€»ç»“&amp;é¢è¯•ç›¸å…³é—®é¢˜ HashMapæ˜¯ä¸€ç§æ•£åˆ—è¡¨, ä½¿ç”¨(æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘)çš„ç»“æ„ HashMapçš„é»˜è®¤åˆå§‹å®¹é‡ä¸º16, é»˜è®¤è£…è½½å› å­ä¸º0.75, ä¸”å®¹é‡æ€»æ˜¯$2^n$ æ­£å¸¸æƒ…å†µä¸‹, æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€ æ¡¶çš„é•¿åº¦å°äº64 æ—¶, ä¸ä¼šè¿›è¡Œæ ‘åŒ– æ¡¶çš„é•¿åº¦å¤§äº64ä¸”é“¾è¡¨é•¿åº¦å¤§äº8æ—¶, è¿›è¡Œæ ‘åŒ– å½“å•ä¸ªæ¡¶ä¸­çš„å…ƒç´ å°äº6æ—¶, è¿›è¡Œåæ ‘åŒ–(è½¬åŒ–ä¸ºé“¾è¡¨) æŸ¥è¯¢æ—¶é—´ä¸º$O(1)$ æ·»åŠ æ—¶é—´$O(1)$ 1.åˆ¤æ–­keyï¼Œæ ¹æ®keyç®—å‡ºç´¢å¼•ã€‚2.æ ¹æ®ç´¢å¼•è·å¾—ç´¢å¼•ä½ç½®æ‰€å¯¹åº”çš„é”®å€¼å¯¹é“¾è¡¨ã€‚3.éå†é”®å€¼å¯¹é“¾è¡¨ï¼Œæ ¹æ®keyæ‰¾åˆ°å¯¹åº”çš„Entryé”®å€¼å¯¹ã€‚4.æ‹¿åˆ°valueã€‚åˆ†æï¼šä»¥ä¸Šå››æ­¥è¦ä¿è¯HashMapçš„æ—¶é—´å¤æ‚åº¦O(1)ï¼Œéœ€è¦ä¿è¯æ¯ä¸€æ­¥éƒ½æ˜¯O(1)ï¼Œç°åœ¨çœ‹èµ·æ¥å°±ç¬¬ä¸‰æ­¥å¯¹é“¾è¡¨çš„å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦å½±å“æœ€å¤§ï¼Œé“¾è¡¨æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œä¸é“¾è¡¨é•¿åº¦æœ‰å…³ã€‚æˆ‘ä»¬è¦ä¿è¯é‚£ä¸ªé“¾è¡¨é•¿åº¦ä¸º1ï¼Œæ‰å¯ä»¥è¯´æ—¶é—´å¤æ‚åº¦èƒ½æ»¡è¶³O(1)ã€‚ä½†è¿™ä¹ˆè¯´æ¥åªæœ‰é‚£ä¸ªhashç®—æ³•å°½é‡å‡å°‘å†²çªï¼Œæ‰èƒ½ä½¿é“¾è¡¨é•¿åº¦å°½å¯èƒ½çŸ­ï¼Œç†æƒ³çŠ¶æ€ä¸º1ã€‚å› æ­¤å¯ä»¥å¾—å‡ºç»“è®ºï¼šHashMapçš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦åªæœ‰åœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹æ‰ä¼šä¸ºO(1)ï¼Œ HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ HashMapçš„çº¿ç¨‹ä¸å®‰å…¨åœ¨å“ªå„¿ åœ¨JDK1.7ä¹‹å‰çš„ç‰ˆæœ¬ä¼šå‡ºç°æ­»å¾ªç¯çš„é—®é¢˜ æ•°æ®è¦†ç›–é—®é¢˜ A, Bä¸¤ä¸ªçº¿ç¨‹éƒ½éœ€è¦putæ“ä½œ, ç„¶åå½“A, Bçº¿ç¨‹éƒ½è·å¾—äº†å°¾èŠ‚ç‚¹ä¹‹å, Açš„æ—¶é—´ç‰‡ç”¨å®Œäº†, Bå¼€å§‹æ‰§è¡Œå°¾æ’, ä¹‹åAå†æ‰§è¡Œ, è¿™æ—¶Aè·å–çš„è¿˜æ˜¯æ—§çš„å°¾éƒ¨èŠ‚ç‚¹ , æ‰€ä»¥å°±ä¼šå¯¼è‡´æ•°æ®è¢«è¦†ç›–, Bæ’å…¥çš„æ•°æ®ä¸¢å¤± è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜: Collections.SynchronizedMap() Map&lt;String, Integer&gt; testMap = new HashMap&lt;&gt;(); ... // è½¬ä¸ºçº¿ç¨‹å®‰å…¨çš„map Map&lt;String, Integer&gt; map = Collections.synchronizedMap(testMap); ä½¿ç”¨ConcurrentHashMap references æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾ Java-Guid jdk-source-analysis","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"Map","slug":"Map","permalink":"https://winniekun.github.io/tags/Map/"}]},{"title":"Ubuntuä¸­MySQL5.7æ’å…¥ä¸­æ–‡è®¾ç½®","slug":"é…ç½®/Ubuntuä¸­MySQL5-7æ’å…¥ä¸­æ–‡è®¾ç½®","date":"2020-03-11T09:44:55.000Z","updated":"2020-08-30T04:50:22.263Z","comments":true,"path":"Ubuntuä¸­MySQL5-7æ’å…¥ä¸­æ–‡è®¾ç½®/","link":"","permalink":"https://winniekun.github.io/Ubuntu%E4%B8%ADMySQL5-7%E6%8F%92%E5%85%A5%E4%B8%AD%E6%96%87%E8%AE%BE%E7%BD%AE/","excerpt":"å‰è¨€å…¶å®å…³MySQLä¸­æ’å…¥ä¸­æ–‡,è‡ªå·±å‰å¹´æ˜¯è®¾ç½®è¿‡çš„,ä¹‹åå°±ä¸€ç›´æ²¡æœ‰ç®¡è¿‡,åæ¥ç³»ç»Ÿé‡è£…ä¹‹å,é‡æ–°å®‰è£…é…ç½®å„ç§ç¯å¢ƒä¹‹å,ä»Šå¤©å¼€å§‹ç”¨MySQLçš„æ—¶å€™,æ‰å‘ç°è¿™ä¸ªé—®é¢˜è¿˜æ²¡æœ‰è§£å†³,ç„¶åä¸€æ—¶ä¹Ÿæƒ³ä¸èµ·æ¥æ€ä¹ˆå¼„äº†,å°±é‡æ–°ç½‘ä¸Šæœç´¢æ•™ç¨‹,æœ€åæƒ³äº†ä¸‹è¿˜æ˜¯å†™ä¸€ä¸‹é…ç½®è¿‡ç¨‹å§,ä»¥åå¤‡ç”¨","text":"å‰è¨€å…¶å®å…³MySQLä¸­æ’å…¥ä¸­æ–‡,è‡ªå·±å‰å¹´æ˜¯è®¾ç½®è¿‡çš„,ä¹‹åå°±ä¸€ç›´æ²¡æœ‰ç®¡è¿‡,åæ¥ç³»ç»Ÿé‡è£…ä¹‹å,é‡æ–°å®‰è£…é…ç½®å„ç§ç¯å¢ƒä¹‹å,ä»Šå¤©å¼€å§‹ç”¨MySQLçš„æ—¶å€™,æ‰å‘ç°è¿™ä¸ªé—®é¢˜è¿˜æ²¡æœ‰è§£å†³,ç„¶åä¸€æ—¶ä¹Ÿæƒ³ä¸èµ·æ¥æ€ä¹ˆå¼„äº†,å°±é‡æ–°ç½‘ä¸Šæœç´¢æ•™ç¨‹,æœ€åæƒ³äº†ä¸‹è¿˜æ˜¯å†™ä¸€ä¸‹é…ç½®è¿‡ç¨‹å§,ä»¥åå¤‡ç”¨ ç¬¬ä¸€æ­¥cp /etc/mysql/mysql.conf.d/mysqld.cnf /etc/mysql/my.cnf ç¬¬äºŒæ­¥ä¿®æ”¹/etc/mysql/my.cnfæ–‡ä»¶ï¼Œæ‰¾åˆ°[client]æ ‡è®°ååœ¨ä¸‹æ–¹æ·»åŠ ä¸€è¡Œä»£ç ï¼š default-character-set=utf8 å¦‚æœæ‰¾ä¸åˆ°[client]æ ‡è®°ï¼Œå°±ç›´æ¥åœ¨æ–‡ä»¶æœ«å°¾æ’å…¥ï¼š [client] default-character-set=utf8 ç¬¬ä¸‰æ­¥æ‰¾åˆ°[mysqld]æ ‡è®°ï¼Œåœ¨è¯¥æ ‡è®°ä¸‹æ–¹æ·»åŠ ä¸¤è¡Œ character-set-server=utf8 collation-server=utf8_general_ci æœ€åæ‰§è¡Œé‡å¯mysqlå‘½ä»¤ï¼šsudo service mysql restart æŸ¥çœ‹ä¿®æ”¹ç»“æœè¿›å…¥MySQLï¼Œä¹‹åè¾“å…¥å¦‚ä¸‹å‘½ä»¤ show variables like 'character%';","categories":[{"name":"mysql","slug":"mysql","permalink":"https://winniekun.github.io/categories/mysql/"}],"tags":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/tags/%E9%85%8D%E7%BD%AE/"}]},{"title":"ä¸ªäººåšå®¢äº‹ä»¶","slug":"ç¢ç¢å¿µ/ä¸ªäººåšå®¢äº‹ä»¶","date":"2020-03-11T09:10:30.000Z","updated":"2021-05-16T16:33:27.776Z","comments":true,"path":"ä¸ªäººåšå®¢äº‹ä»¶/","link":"","permalink":"https://winniekun.github.io/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E4%BA%8B%E4%BB%B6/","excerpt":"å‰è¨€è‡ªå·±æ˜¯ä»å¤§äºŒä¸‹å¼€å§‹å†™åšå®¢çš„ï¼ŒæœŸé—´ä½¿ç”¨è¿‡å¾ˆå¤šçš„åšå®¢å¹³å°ï¼šJekyll + GitHub Pages ã€WordPress ã€Typecho Hexo + GitHub Pages è‡ªå·±ä¹Ÿç”¨Django ã€Flaskæ­å»ºè¿‡ï¼Œåšå®¢çš„ç•Œé¢ä¹Ÿæ”¹ç‰ˆäº†ä¸€æ¬¡åˆä¸€æ¬¡ï¼Œæœ€åè¿˜æ˜¯ç¡®å®šä¸‹æ¥ä½¿ç”¨æˆ‘ç›®å‰è¿™ä¸ªäº†","text":"å‰è¨€è‡ªå·±æ˜¯ä»å¤§äºŒä¸‹å¼€å§‹å†™åšå®¢çš„ï¼ŒæœŸé—´ä½¿ç”¨è¿‡å¾ˆå¤šçš„åšå®¢å¹³å°ï¼šJekyll + GitHub Pages ã€WordPress ã€Typecho Hexo + GitHub Pages è‡ªå·±ä¹Ÿç”¨Django ã€Flaskæ­å»ºè¿‡ï¼Œåšå®¢çš„ç•Œé¢ä¹Ÿæ”¹ç‰ˆäº†ä¸€æ¬¡åˆä¸€æ¬¡ï¼Œæœ€åè¿˜æ˜¯ç¡®å®šä¸‹æ¥ä½¿ç”¨æˆ‘ç›®å‰è¿™ä¸ªäº† å°±è¿™æ ·å§ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“è¿™æ¬¡èƒ½åšæŒå¤šä¹…ğŸ™‚ å…³äºä¹‹å‰çš„å†…å®¹å…¨æ²¡äº†ï¼Œç‚¹å„¿éƒ½ä¸å‰©çš„å…¨åˆ äº†ï¼Œæœ‰äº›æ–‡ç« åˆ äº†çš„ç¡®æ˜¯å¾ˆå¯æƒœï¼Œè°¨è®°æ•™è®­ï¼ï¼ï¼è‡ªå·±å¼ºè¡ŒåˆåŠ äº†ä¸€ä¸ª19å¹´çš„ä¹¦å•ï¼Œä¹‹å‰17å¹´ã€18å¹´çš„çœŸçš„æ²¡æ³•è¡¥äº†ï¼Œè®°ä¸ä½æ˜¯å‡ å·å†™çš„äº†ï¼Œä¹Ÿå¿˜äº†éƒ½çœ‹äº†äº›å•¥å­ã€‚","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"}]},{"title":"springboot---é…ç½®","slug":"spring/springboot/springboot-é…ç½®","date":"2020-03-11T03:06:54.000Z","updated":"2020-08-30T04:50:22.252Z","comments":true,"path":"springboot-é…ç½®/","link":"","permalink":"https://winniekun.github.io/springboot-%E9%85%8D%E7%BD%AE/","excerpt":"","text":"","categories":[{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/categories/spring/"}],"tags":[{"name":"springboot","slug":"springboot","permalink":"https://winniekun.github.io/tags/springboot/"}]},{"title":"çº¢é»‘æ ‘","slug":"æºç /JDK/map/rbtree-analysis","date":"2020-03-10T01:39:12.000Z","updated":"2020-08-30T04:50:22.256Z","comments":true,"path":"rbtree-analysis/","link":"","permalink":"https://winniekun.github.io/rbtree-analysis/","excerpt":"çº¢é»‘æ ‘å‰–æ","text":"çº¢é»‘æ ‘å‰–æ BSTéƒ¨åˆ†äºŒå‰æ’åºæ ‘ã€äºŒå‰æœç´¢æ ‘æ€§è´¨ï¼š å®šä¹‰çš„ç©ºæ ‘æ˜¯BST å·¦å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºæ ¹èŠ‚ç‚¹çš„å€¼ å³å­æ ‘æ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºæ ¹èŠ‚ç‚¹çš„å€¼ ä¸­åºéå†åºåˆ—ä¸ºå‡åº å®ç°äºŒæ’æ’åºæ ‘ï¼šèŠ‚ç‚¹å®šä¹‰ã€æ’å…¥ èŠ‚ç‚¹ï¼š AVLEntry å­—å…¸ï¼šAVLMap int compara(K a, K b) æ¯”è¾ƒå…³é”®å­—aå’Œbçš„å¤§å° boolean isEmpty() åˆ¤æ–­mapæ˜¯å¦ä¸ºç©º V put(K key, V value) æ·»åŠ å…ƒç´  è¿­ä»£å™¨ LeetCode173 binary search tree iterator è¦ç‚¹ï¼š åˆ©ç”¨ä¸­åºéå† æ–¹æ¡ˆ1ï¼š é€’å½’æ·»åŠ è¿›å…¥çº¿æ€§é›†åˆï¼Œ è¿­ä»£çº¿æ€§é›†åˆ æ–¹æ¡ˆ2ï¼š éé€’å½’ï¼Œ ä½¿å·¦è·¯å¾„èŠ‚ç‚¹å‹æ ˆ AVLè¿­ä»£å™¨ å±æ€§stack ï¼Œ å­˜å‚¨BSTçš„èŠ‚ç‚¹ hasNext, æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ next ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼ remove çº¿ç¨‹å®‰å…¨é—®é¢˜ AVLMapç»§æ‰¿Iterableï¼Œ å¹¶é‡å†™Iteratoræ–¹æ³•ï¼Œ è¿”å›AVLè¿­ä»£å™¨å³å¯ æŸ¥æ‰¾åŸç†ï¼š è‹¥æ˜¯æ ¹èŠ‚ç‚¹çš„å€¼å°äºkeyï¼Œ é€’å½’ä»å³å­æ ‘æŸ¥æ‰¾ è‹¥æ˜¯æ ¹èŠ‚ç‚¹çš„å€¼å¤§äºkeyï¼Œ é€’å½’ä»å·¦å­æ ‘æŸ¥æ‰¾ å¦‚æ˜¯æ ¹èŠ‚ç‚¹ç­‰äºkeyï¼Œ æˆåŠŸ è‹¥æ˜¯å­æ ‘ä¸ºç©ºï¼Œ å¤±è´¥ å®ç°æ¨¡æ‹ŸTreeMapçš„ä»£ç ç»“æ„ï¼Œ å®ç°ä»¥ä¸‹æ–¹æ³• AVLEntry getEntry(K key) ç§æœ‰æ–¹æ³• ä¸»è¦æŸ¥æ‰¾é€»è¾‘ boolean containsKey(K key) æ˜¯å¦èƒ½æ‰¾åˆ°å…³é”®å­— V get(K key) æ ¹æ®å…³é”®å­—è¿”å›å¯¹åº”çš„value boolean containsValue(V value) èƒ½å¤Ÿæ‰¾åˆ°value åˆ é™¤ï¼ˆé‡ç‚¹ï¼‰åŸç†åˆ é™¤æ“ä½œè¾ƒä¸ºç¹çï¼Œ éœ€è¦è€ƒè™‘æ–­é“¾çš„æƒ…å†µï¼Œä»¥åŠåˆ é™¤ä¹‹åï¼Œ è¿˜éœ€æ»¡è¶³BSTçš„ç‰¹æ€§ å…±åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼Œ å‡è®¾åˆ é™¤çš„èŠ‚ç‚¹ä¸ºpï¼Œ çˆ¶èŠ‚ç‚¹ä¸ºf pä¸ºå¶å­èŠ‚ç‚¹ï¼Œ ç›´æ¥åˆ é™¤ pçš„å·¦å­æ ‘ï¼ˆå³å­æ ‘ï¼‰ä¸ä¸ºç©ºï¼Œåˆ é™¤ä¹‹åï¼Œ å…¶å·¦å­æ ‘ï¼ˆå³å­æ ‘ï¼‰å¡«è¡¥pçš„ç©ºç¼ºä½ç½® pæ—¢æœ‰å·¦å­æ ‘åˆæœ‰å³å­æ ‘ï¼Œ æ‰¾åˆ°å³å­æ ‘çš„æœ€å°å€¼èŠ‚ç‚¹Mï¼ˆå·¦å­æ ‘çš„æœ€å¤§å€¼ï¼‰å°†è¯¥å€¼æ›¿æ¢pçš„å€¼ï¼Œä¹‹åæŒ‰ç…§1ã€2ä¸¤ç§æƒ…å†µåˆ é™¤Må³å¯ å®ç° AVLEntry deleteEntry() é€’å½’å‡½æ•°ï¼ˆä¸»é€»è¾‘ï¼‰ V remote(K key) åˆ é™¤å…³é”®å­—key è¿”å›å¯¹åº”çš„value void levelOrder è¾…åŠ©å‡½æ•° å±‚æ¬¡éå† ç”¨äºè¾“å‡ºè§‚å¯Ÿ é¢è¯•ç»å…¸ï¼š å¯»æ‰¾æœ€å¤§æœ€å°èŠ‚ç‚¹ BSTçš„å‰é©±å’Œ BSTçš„å‰é©±å’Œåç»§èŠ‚ç‚¹å‰é©±ç»“ç‚¹ï¼šèŠ‚ç‚¹valå€¼å°äºè¯¥èŠ‚ç‚¹valå€¼å¹¶ä¸”å€¼æœ€å¤§çš„èŠ‚ç‚¹ åç»§èŠ‚ç‚¹ï¼šèŠ‚ç‚¹valå€¼å¤§äºè¯¥èŠ‚ç‚¹valå€¼å¹¶ä¸”å€¼æœ€å°çš„èŠ‚ç‚¹ å‰é©±èŠ‚ç‚¹ï¼ˆæœ‰çˆ¶æŒ‡é’ˆçš„æƒ…å†µï¼‰ è‹¥ä¸€ä¸ªèŠ‚ç‚¹æœ‰å·¦å­æ ‘ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å…¶å·¦å­æ ‘ä¸­valå€¼æœ€å¤§çš„èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å·¦å­æ ‘ä¸­æ‰€è°“çš„rightMostNodeï¼‰ è‹¥ä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å·¦å­æ ‘ï¼Œé‚£ä¹ˆåˆ¤æ–­è¯¥èŠ‚ç‚¹å’Œå…¶çˆ¶èŠ‚ç‚¹çš„å…³ç³»2.1 è‹¥è¯¥èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å³è¾¹å­©å­ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„å‰é©±ç»“ç‚¹å³ä¸ºå…¶çˆ¶èŠ‚ç‚¹ã€‚2.2 è‹¥è¯¥èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦è¾¹å­©å­ï¼Œé‚£ä¹ˆéœ€è¦æ²¿ç€å…¶çˆ¶äº²èŠ‚ç‚¹ä¸€ç›´å‘æ ‘çš„é¡¶ç«¯å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹Pï¼ŒPèŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹Qçš„å³è¾¹å­©å­ï¼Œé‚£ä¹ˆQå°±æ˜¯è¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ åç»§èŠ‚ç‚¹ï¼ˆæœ‰çˆ¶æŒ‡é’ˆçš„æƒ…å†µï¼‰ è‹¥ä¸€ä¸ªèŠ‚ç‚¹æœ‰å³å­æ ‘ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹æ˜¯å…¶å³å­æ ‘ä¸­valå€¼æœ€å°çš„èŠ‚ç‚¹ï¼ˆä¹Ÿå°±æ˜¯å³å­æ ‘ä¸­æ‰€è°“çš„leftMostNodeï¼‰ è‹¥ä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å³å­æ ‘ï¼Œé‚£ä¹ˆåˆ¤æ–­è¯¥èŠ‚ç‚¹å’Œå…¶çˆ¶èŠ‚ç‚¹çš„å…³ç³»2.1 è‹¥è¯¥èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å·¦è¾¹å­©å­ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„åç»§ç»“ç‚¹å³ä¸ºå…¶çˆ¶èŠ‚ç‚¹2.2 è‹¥è¯¥èŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹çš„å³è¾¹å­©å­ï¼Œé‚£ä¹ˆéœ€è¦æ²¿ç€å…¶çˆ¶äº²èŠ‚ç‚¹ä¸€ç›´å‘æ ‘çš„é¡¶ç«¯å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªèŠ‚ç‚¹Pï¼ŒPèŠ‚ç‚¹æ˜¯å…¶çˆ¶èŠ‚ç‚¹Qçš„å·¦è¾¹å­©å­ï¼Œé‚£ä¹ˆQå°±æ˜¯è¯¥èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ LIntCode 448 Inorder Successor in BST pä¸ºæœ€å¤§èŠ‚ç‚¹ï¼Œ è¿”å›null pæœ‰å³å­æ ‘ pæ²¡æœ‰å³å­æ ‘ è¿›è¡ŒäºŒå‰æŸ¥æ‰¾ï¼Œ å¹¶å‹æ ˆï¼Œ ä¹‹åå¼¹æ ˆ AVLå®šä¹‰BSTå’ŒTreeMapçš„æ•ˆç‡å¯¹æ¯” æƒ…å†µ BST TreeMap å‡åºåºåˆ—ï¼ˆé™åºåºåˆ—ï¼‰ Slow OK éšæœºåºåˆ— OK OK AVLæ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æ ‘ BST å·¦å³å­æ ‘çš„é«˜åº¦å·®ç»å¯¹å€¼&lt;1 ç©ºæ ‘ã€å·¦å³å­æ ‘éƒ½æ˜¯AVL æ—‹è½¬ä¸æ’å…¥æ—‹è½¬ å³æ—‹ å³æ—‹ å…ˆå·¦æ—‹å†å³æ—‹ å·¦æ—‹ åŒç† ä»€ä¹ˆæ—¶å€™éœ€è¦æ—‹è½¬ æ’å…¥å…³é”®å­—keyåï¼ŒèŠ‚ç‚¹pçš„å¹³è¡¡å› å­ç”±åŸæ¥çš„1æˆ–è€…-1ï¼Œå˜æˆäº†2æˆ–è€…-2ï¼Œåˆ™éœ€è¦æ—‹è½¬ï¼›åªè€ƒè™‘æ’å…¥keyåˆ°å·¦å­æ ‘leftçš„æƒ…å½¢ï¼Œå³å¹³è¡¡å› å­ä¸º2 æƒ…å†µ1ï¼škey&lt;left.key, å³æ’å…¥åˆ°leftçš„å·¦å­æ ‘ï¼Œéœ€è¦è¿›è¡Œå•æ—‹è½¬ï¼Œå°†èŠ‚ç‚¹på³æ—‹ æƒ…å†µ2ï¼škey&gt;left.key, å³æ’å…¥åˆ°leftçš„å³å­æ ‘ï¼Œéœ€è¦è¿›è¡ŒåŒæ—‹è½¬ï¼Œå…ˆå°†leftå·¦æ—‹ï¼Œå†å°†på³æ—‹æ’å…¥åˆ°å³å­æ ‘right å¹³è¡¡å› å­ä¸º-2ï¼Œå®Œå…¨å¯¹ç§° å¯¹äºæ£€æµ‹æ˜¯å¦å¹³è¡¡å¹¶æ—‹è½¬çš„è°ƒæ•´è¿‡ç¨‹è‡ªé¡¶å‘ä¸‹ORè‡ªåº•å‘ä¸Š å¯¹äºBSTçš„æ’å…¥ï¼Œ æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼ŒAVLçš„æ’å…¥å’ŒBSTçš„æ’å…¥æ˜¯ä¸€æ ·çš„ä¹Ÿæ˜¯è‡ªé¡¶å‘ä¸‹ åœ¨æ£€æµ‹èŠ‚ç‚¹pæ˜¯å¦å¹³è¡¡ä¹‹å‰ï¼Œå¿…é¡»å…ˆä¿è¯å·¦å³å­æ ‘å·²ç»å¹³è¡¡ å­é—®é¢˜æˆç«‹ â€”-&gt; æ€»é—®é¢˜æˆç«‹ ï¼š ==è‡ªåº•å‘ä¸Š== æœ‰parentæŒ‡é’ˆï¼Œ ç›´æ¥å‘ä¸Šå›æº¯ æ— parentæŒ‡é’ˆï¼Œ åç»­éå†ã€é€’å½’ æ— parentæŒ‡é’ˆï¼Œ æ ˆå®ç°éé€’å½’ LeetCode110. Balanced Binary Tree æ’å…¥ä»£ç å®ç° AVLEnrtyå¢åŠ heightå±æ€§ï¼Œè¡¨ç¤ºæ ‘çš„é«˜åº¦ ==&gt; å¹³è¡¡å› å­å¯ä»¥å®æ—¶è®¡ç®— å•æ—‹è½¬ï¼šå³æ—‹rotateRightã€å·¦æ—‹rotateLeft åŒæ—‹è½¬ï¼šå…ˆå·¦åå³firstLeftThenRightã€å…ˆå³åå·¦firstRightThenLeft è¾…åŠ©æ ˆstackï¼Œå°†æ’å…¥æ—¶å€™æ‰€ç»è¿‡çš„è·¯å¾„å‹æ ˆ æ’å…¥è°ƒæ•´å‡½æ•°fixAfterInsertion è¾…åŠ©å‡½æ•°checkBalanceï¼Œæ–­è¨€AVLæ ‘çš„å¹³è¡¡æ€§ï¼Œæ£€æµ‹ç®—æ³•çš„æ­£ç¡®æ€§ ç®—æ³•æ”¹è¿›&amp;&amp;æ—¶é—´å¤æ‚åº¦åˆ†æå¼¹æ ˆçš„æ—¶å€™ï¼Œä¸€æ—¦å‘ç°æŸä¸ªèŠ‚ç‚¹å¹¶æœªæ”¹å˜ï¼Œåˆ™åœæ­¢å¼¹æ ˆ æŒ‡é’ˆå›æº¯æ¬¡æ•°ï¼šæœ€åä¸ºO(logN)æœ€å¥½ä¸ºO(log1) , å¹³å‡ä¸ºO(logN) æ—‹è½¬æ¬¡æ•°ï¼š æ— éœ€æ—‹è½¬ã€å•æ—‹è½¬ã€åŒæ—‹è½¬ã€ä¸ä¼šè¶…è¿‡ä¸¤æ¬¡ æ—¶é—´å¤æ‚åº¦ï¼š BSTæ’å…¥O(logN)+æŒ‡é’ˆå›æº¯O(logN) + æ—‹è½¬O(1) = O(logN) ç©ºé—´å¤æ‚åº¦ï¼š æœ‰parentæŒ‡é’ˆä¸ºO(1) æ— parentæŒ‡é’ˆä¸ºO(logN) é¢è¯•ç»å…¸ï¼šæ’åºæ•°ç»„è½¬åŒ–ä¸ºAVLå’ŒRBTtreeMapä¸­buildFromSortedå®ç°åŠŸèƒ½ç±»ä¼¼ åˆ é™¤åŸç†ç±»ä¼¼æ’å…¥ï¼Œå‡è®¾åˆ é™¤äº†på³å­æ ‘çš„æŸä¸ªèŠ‚ç‚¹ï¼Œå¼•èµ·äº†pçš„å¹³è¡¡å› å­d[p]=2ï¼Œåˆ†æpçš„å·¦å­æ ‘leftï¼Œä¸‰ç§æƒ…å†µå¦‚ä¸‹ï¼š leftçš„å¹³è¡¡å› å­d[left]=1ï¼Œå°†på³æ—‹ leftçš„å¹³è¡¡å› å­d[left]=0ï¼Œå°†på³æ—‹ leftçš„å¹³è¡¡å› å­d[left]= -1ï¼Œå…ˆå·¦æ—‹leftï¼Œå†å³æ—‹p åˆ é™¤å·¦å­æ ‘ï¼Œå³d[p]= -2çš„æƒ…å½¢ï¼Œä¸d[p]=2å¯¹ç§° å®ç° fixAfterDeletionï¼šè°ƒæ•´æŸä¸ªèŠ‚ç‚¹p deleteEntryç›´æ¥è°ƒç”¨fixAfterDeletion çº¢é»‘æ ‘çº¢é»‘æ ‘å®šä¹‰ ä»»æ„èŠ‚ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œè¦ä¹ˆæ˜¯é»‘è‰² æ ¹èŠ‚ç‚¹ä¸ºé»‘è‰² æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼ˆå¶å­èŠ‚ç‚¹ä¸ºç©ºï¼‰ å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œé‚£ä¹ˆå®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹éƒ½ä¸ºé»‘è‰² ä»»æ„èŠ‚ç‚¹ä»å®ƒå‡ºå‘ï¼Œ åˆ°æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„è·¯å¾„ä¸ŠåŒ…å«ç›¸åŒæ•°é‡çš„é»‘è‰²èŠ‚ç‚¹ ç®€ç§°ä¸ºé»‘é«˜ï¼ˆBlackHeightã€BHï¼‰ ç”±æ­¤è¡ç”Ÿå‡ºçš„æ€§è´¨ï¼š ä»»æ„ä¸€é¢—ä»¥é»‘è‰²èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¹Ÿå¿…å®šæ˜¯ä¸€é¢—çº¢é»‘æ ‘ å·¦ï¼ˆå³ï¼‰å­æ ‘çš„é«˜åº¦æœ€å¤šæ˜¯å³ï¼ˆå·¦ï¼‰å­æ ‘çš„ä¸¤å€ å…¶å¿…å®šæ˜¯ä¸€ä¸ªBST çº¢é»‘æ ‘åœ¨JDKæºç ä¸­çš„å®ç°(TreeMapä¸­çš„fixAfterInsertionå’ŒfixAfterDeletion)ï¼š æ’å…¥æ“ä½œ==è‡ªåº•å‘ä¸Š== RBTä¸­çš„æ’å…¥è°ƒæ•´ï¼š fixAfterInsersion: cast1ã€case2ã€case3 RBTä¸­çš„åˆ é™¤è°ƒæ•´ï¼šfixAfterDeletion: case1ã€case2ã€case3ã€case4 æ’å…¥åŸåˆ™ è‹¥æ’å…¥çš„ä¸ºé»‘è‰²çš„èŠ‚ç‚¹ï¼Œè¿æ³•æ€§è´¨5 åªèƒ½æ’å…¥çº¢è‰²èŠ‚ç‚¹ï¼Œå¯èƒ½è¿åæ€§è´¨4ï¼Œç»§ç»­è°ƒæ•´ from æ’å…¥æ­£ç¡®æ€§è¯æ˜ æ˜¯å¦ä¼šå¼•èµ·å·¦å³å­æ ‘çš„BHä¸ä¸€è‡´ æœ‰æ— ç»§ç»­ç ´åæ€§è´¨4çš„å¯èƒ½ æ’å…¥è°ƒæ•´æ— éœ€è°ƒæ•´çš„æƒ…å†µä¸ºï¼š Xä¸ºæ ¹èŠ‚ç‚¹ï¼Œå°†Xç”±çº¢æŸ“é»‘ï¼Œç®€ç§°rootOver çˆ¶èŠ‚ç‚¹Pä¸ºé»‘è‰²ï¼ŒBlackParentOverï¼Œç®€ç§°bpOver while (x != null &amp;&amp; x != root &amp;&amp; x.parent.color == RED) éœ€è¦è°ƒæ•´çš„æƒ…å†µä¸ºï¼š ä»…ä»…éœ€è¦è€ƒè™‘çˆ¶èŠ‚ç‚¹Pä¸ºçº¢è‰²çš„æƒ…å½¢ï¼Œç”±äºæ€§è´¨4ï¼Œçˆ·çˆ·èŠ‚ç‚¹Gå¿…å®šä¸ºé»‘è‰²ï¼Œåˆ†ä¸ºä¸‰ç§æƒ…å†µï¼šcase1: Yä¸ºçº¢è‰²ï¼ŒXå¯å·¦å¯å³ï¼›Pã€YæŸ“é»‘ï¼ŒGæŸ“çº¢ï¼ŒXå›æº¯è‡³Gcase2: Yä¸ºé»‘è‰²ï¼ŒXä¸ºå³å­©å­ï¼›å·¦æ—‹Pï¼ŒXæŒ‡å‘Pï¼Œè½¬åŒ–ä¸ºcase3case3: Yä¸ºé»‘è‰²ï¼ŒXä¸ºå·¦å­©å­ï¼›PæŸ“é»‘ï¼ŒGæŸ“çº¢ï¼Œå³æ—‹Gï¼Œç»“æŸç»“è®ºï¼šRBTçš„æ’å…¥è°ƒæ•´æœ€å¤šæ—‹è½¬2æ¬¡ case1 æ¡ä»¶Pä¸ºçº¢è‰²ï¼Œä¸ºGçš„å·¦å­©å­ï¼Œ Yä¸ºçº¢è‰²ï¼Œ Xå¯å·¦å¯å³ï¼Œ å¤„ç†æ–¹å¼ï¼š å°†Pã€YæŸ“é»‘ï¼Œ Gç„¶ä¸ºçº¢è‰²ï¼ŒXå›æº¯è‡³Gå³å¯ æ¡ä»¶ç®€ç§°ï¼š çº¢å·¦çˆ¶ã€çº¢å”ã€çº¢å·¦å³å­ å¤„ç†æ–¹å¼ç®€ç§°ï¼š çˆ¶å”å˜é»‘ã€çˆ·å˜çº¢ï¼Œå­å˜çˆ· if (parentOf(x) == leftOf(parentOf(parentOf(x)))) { Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x))); if (colorOf(y) == RED) { setColor(parentOf(x), BLACK); setColor(y, BLACK); setColor(parentOf(parentOf(x)), RED); x = parentOf(parentOf(x)); } } case2 æ¡ä»¶ï¼š Pä¸ºGçš„å·¦å­©å­ï¼ŒYä¸ºé»‘è‰²ï¼ŒXä¸ºå³å­©å­ å¤„ç†æ–¹å¼ï¼šå·¦æ—‹Pï¼ŒXæŒ‡å‘Pï¼Œè½¬åŒ–ä¸ºcase3 æ¡ä»¶ç®€ç§°ï¼šçº¢å·¦çˆ¶ï¼Œé»‘å”ï¼Œçº¢å³å­ å¤„ç†æ–¹å¼ç®€ç§°ï¼šå·¦æ—‹çˆ¶ã€å­å˜çˆ¶ã€å˜ä¸ºcase3 else { if (x == rightOf(parentOf(x))) { x = parentOf(x); // XæŒ‡å‘P rotateLeft(x); // å·¦æ—‹P } case3 æ¡ä»¶ï¼šPä¸ºGçš„å·¦å­©å­ï¼ŒYä¸ºé»‘è‰²ï¼ŒXä¸ºå·¦å­©å­ å¤„ç†æ–¹å¼ï¼šPæŸ“é»‘ï¼ŒGæŸ“çº¢ï¼Œå³æ—‹Gï¼Œç»“æŸ æ¡ä»¶ç®€ç§°ï¼šçº¢å·¦çˆ¶ï¼Œé»‘å”ï¼Œçº¢å·¦å­ å¤„ç†æ–¹å¼ç®€ç§°ï¼šçˆ¶å˜é»‘ã€çˆ·å˜çº¢ã€å³æ—‹çˆ· setColor(parentOf(x), BLACK); // PæŸ“é»‘ setColor(parentOf(parentOf(x)), RED); // G æŸ“çº¢ rotateRight(parentOf(parentOf(x))); // å³æ—‹G å½“Pä¸ºGçš„å³å­©å­ï¼ŒåŒç† rightCase1ï¼šYä¸ºçº¢ï¼ŒXå¯å·¦å¯å³ï¼›Pã€Yå˜é»‘ï¼ŒGå˜çº¢ï¼ŒXå˜GrightCase2ï¼šYä¸ºé»‘ï¼ŒXä¸ºå·¦å­©å­ï¼›å³æ—‹Pï¼ŒXå˜Pï¼Œè½¬case3rightCase3ï¼šYä¸ºé»‘ï¼ŒXä¸ºå³å­©å­ï¼›Gå˜çº¢ï¼ŒPå˜é»‘ï¼Œå·¦æ—‹G åˆ é™¤æ“ä½œäºŒæ’æ’åºæ ‘çš„åˆ é™¤ï¼š ä¸‰ç§æƒ…å†µ AVLæ ‘çš„åˆ é™¤ï¼šä¸¤ç§æƒ…å†µ çº¢é»‘æ ‘çš„åˆ é™¤ï¼š å››ç§æƒ…å†µ åˆ é™¤åŸåˆ™ åˆ é™¤çš„èŠ‚ç‚¹ä¸ºçº¢è‰²ï¼Œåˆ™ç›´æ¥åˆ é™¤ï¼Œå¹¶ä¸å½±å“æ•´ä½“ç»“æœï¼Œéœ€è¦æ³¨æ„é˜²æ­¢æ–­é“¾ åˆ é™¤çš„èŠ‚ç‚¹ä¸ºé»‘è‰²ï¼Œæ‰€åœ¨çš„BHâ€”ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´ åˆ é™¤è°ƒæ•´ from åˆ é™¤æ­£ç¡®æ€§è¯æ˜ æ˜¯å¦è¿åæ€§è´¨äº” Xçš„BHåªèƒ½ä¿æŒæˆ–è€…ä¸å˜ï¼Œå¦è€…Xè¦æ¯”Sçš„BHè¦å° æ˜¯å¦è¿åæ€§è´¨å›› è‹¥è°·è¿åäº†ï¼Œç»§ç»­æŸ“é»‘è¿˜æ˜¯å›æº¯ åˆ é™¤è°ƒæ•´æ— éœ€è°ƒæ•´çš„æƒ…å†µ å½“å‰Xä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ— è®ºrootä¸ºä»€ä¹ˆé¢œè‰²ï¼Œéƒ½å°†rootæŸ“é»‘ï¼Œ rootOver å½“å‰Xä¸ºçº¢è‰²ï¼Œ å°†XæŸ“é»‘ï¼Œ redOver while (x != root &amp;&amp; colorOf(x) == BLACK) åˆ é™¤å·¦å­©å­X å››ç§æƒ…å†µcase1æ¡ä»¶ï¼šSä¸ºçº¢è‰²éšå«æ¡ä»¶ï¼šç”±äºæ€§è´¨4ï¼ŒPã€LNã€RNå¿…å®šéƒ½ä¸ºé»‘è‰²å¤„ç†æ–¹å¼ï¼šSæŸ“é»‘ï¼ŒPæŸ“çº¢ï¼Œå·¦æ—‹Pï¼ŒLNæˆä¸ºæ–°çš„sib if (x == leftOf(parentOf(x))) { Entry&lt;K,V&gt; sib = rightOf(parentOf(x)); if (colorOf(sib) == RED) { setColor(sib, BLACK); setColor(parentOf(x), RED); rotateLeft(parentOf(x)); sib = rightOf(parentOf(x)); } case2æ¡ä»¶ï¼› case2-1æ¡ä»¶ï¼šSã€LNã€RNå‡ä¸ºé»‘è‰²ï¼ŒPä¸ºé»‘è‰² case2-2æ¡ä»¶ï¼šSã€LNã€RNå‡ä¸ºé»‘è‰²ï¼ŒPä¸ºçº¢è‰² éšå«æ¡ä»¶ï¼šç”±äºæ€§è´¨4ï¼ŒPã€LNã€RNå¿…å®šéƒ½ä¸ºé»‘è‰²å¤„ç†æ–¹å¼ï¼šSæŸ“é»‘ï¼ŒPæŸ“çº¢ï¼Œå·¦æ—‹Pï¼ŒLNæˆä¸ºæ–°çš„sibå¤„ç†æ–¹å¼ç›¸åŒï¼šSæŸ“çº¢ï¼ŒXå›æº¯è‡³P case3æ¡ä»¶ï¼šSä¸ºé»‘è‰²ï¼ŒLNä¸ºçº¢è‰²ï¼ŒRNä¸ºé»‘è‰²å¤„ç†æ–¹å¼ï¼šLNæŸ“é»‘ã€SæŸ“çº¢ï¼Œå³æ—‹Sï¼ŒSæŒ‡å‘LNè½¬åŒ–ä¸ºcase4-1ã€case4-2 case4Sä¸ºé»‘è‰²ï¼ŒLNéšæ„ï¼Œçº¢RNï¼›Så˜Pçš„é¢œè‰²ï¼ŒPå’ŒSæŸ“é»‘ï¼Œå·¦æ—‹P Comparableå’ŒComparatorComparableComparableç®€ä»‹Comparableæ˜¯æ’åºæ¥å£ã€‚ è‹¥ä¸€ä¸ªç±»å®ç°äº†Comparableæ¥å£ï¼Œå°±æ„å‘³ç€â€œè¯¥ç±»æ”¯æŒæ’åºâ€ã€‚ å³ç„¶å®ç°Comparableæ¥å£çš„ç±»æ”¯æŒæ’åºï¼Œå‡è®¾ç°åœ¨å­˜åœ¨â€œå®ç°Comparableæ¥å£çš„ç±»çš„å¯¹è±¡çš„Liståˆ—è¡¨(æˆ–æ•°ç»„)â€ï¼Œåˆ™è¯¥Liståˆ—è¡¨(æˆ–æ•°ç»„)å¯ä»¥é€šè¿‡ Collections.sortï¼ˆæˆ– Arrays.sortï¼‰è¿›è¡Œæ’åºã€‚ æ­¤å¤–ï¼Œâ€œå®ç°Comparableæ¥å£çš„ç±»çš„å¯¹è±¡â€å¯ä»¥ç”¨ä½œâ€œæœ‰åºæ˜ å°„(å¦‚TreeMap)â€ä¸­çš„é”®æˆ–â€œæœ‰åºé›†åˆ(TreeSet)â€ä¸­çš„å…ƒç´ ï¼Œè€Œä¸éœ€è¦æŒ‡å®šæ¯”è¾ƒå™¨ã€‚ Comparable å®šä¹‰Comparable æ¥å£ä»…ä»…åªåŒ…æ‹¬ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š package java.lang; import java.util.*; public interface Comparable&lt;T&gt; { public int compareTo(T o); } å‡è®¾æˆ‘ä»¬é€šè¿‡ x.compareTo(y) æ¥â€œæ¯”è¾ƒxå’Œyçš„å¤§å°â€ã€‚è‹¥è¿”å›â€œè´Ÿæ•°â€ï¼Œæ„å‘³ç€â€œxæ¯”yå°â€ï¼›è¿”å›â€œé›¶â€ï¼Œæ„å‘³ç€â€œxç­‰äºyâ€ï¼›è¿”å›â€œæ­£æ•°â€ï¼Œæ„å‘³ç€â€œxå¤§äºyâ€ã€‚ ComparatorComparatorç®€ä»‹Comparator æ˜¯æ¯”è¾ƒå™¨æ¥å£ã€‚ æˆ‘ä»¬è‹¥éœ€è¦æ§åˆ¶æŸä¸ªç±»çš„æ¬¡åºï¼Œè€Œè¯¥ç±»æœ¬èº«ä¸æ”¯æŒæ’åº(å³æ²¡æœ‰å®ç°Comparableæ¥å£)ï¼›é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä¸€ä¸ªâ€œè¯¥ç±»çš„æ¯”è¾ƒå™¨â€æ¥è¿›è¡Œæ’åºã€‚è¿™ä¸ªâ€œæ¯”è¾ƒå™¨â€åªéœ€è¦å®ç°Comparatoræ¥å£å³å¯ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡â€œå®ç°Comparatorç±»æ¥æ–°å»ºä¸€ä¸ªæ¯”è¾ƒå™¨â€ï¼Œç„¶åé€šè¿‡è¯¥æ¯”è¾ƒå™¨å¯¹ç±»è¿›è¡Œæ’åºã€‚ Comparatorå®šä¹‰Comparator æ¥å£ä»…ä»…åªåŒ…æ‹¬ä¸¤ä¸ªä¸ªå‡½æ•°ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š package java.util; public interface Comparator&lt;T&gt; { int compare(T o1, T o2); boolean equals(Object obj); } æ€»ç»“ç›¸åŒ Comparableå’ŒComparatoréƒ½æ˜¯ç”¨æ¥å®ç°å¯¹è±¡çš„æ¯”è¾ƒã€æ’åº è¦æƒ³å¯¹è±¡æ¯”è¾ƒã€æ’åºï¼Œéƒ½éœ€è¦å®ç°Comparableæˆ–Comparatoræ¥å£ Comparableå’ŒComparatoréƒ½æ˜¯Javaçš„æ¥å£ åŒºåˆ« Comparatorä½äºjava.utilåŒ…ä¸‹ï¼Œè€ŒComparableä½äºjava.langåŒ…ä¸‹ Comparableæ¥å£çš„å®ç°æ˜¯åœ¨ç±»çš„å†…éƒ¨ï¼ˆå¦‚ Stringã€Integerå·²ç»å®ç°äº†Comparableæ¥å£ï¼Œè‡ªå·±å°±å¯ä»¥å®Œæˆæ¯”è¾ƒå¤§å°æ“ä½œï¼‰ï¼ŒComparatoræ¥å£çš„å®ç°æ˜¯åœ¨ç±»çš„å¤–éƒ¨ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ˜¯è‡ªå·²å®Œæˆæ¯”è¾ƒï¼Œä¸€ä¸ªæ˜¯å¤–éƒ¨ç¨‹åºå®ç°æ¯”è¾ƒï¼‰ å®ç°Comparableæ¥å£è¦é‡å†™compareToæ–¹æ³•, åœ¨compareToæ–¹æ³•é‡Œé¢å®ç°æ¯”è¾ƒ","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"Map","slug":"Map","permalink":"https://winniekun.github.io/tags/Map/"}]},{"title":"æ­»ç£•å›æº¯","slug":"LeetCode/stick-to-backtrack","date":"2020-02-25T14:18:18.000Z","updated":"2021-02-16T09:33:45.356Z","comments":true,"path":"stick-to-backtrack/","link":"","permalink":"https://winniekun.github.io/stick-to-backtrack/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—å››ï¼š å›æº¯","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—å››ï¼š å›æº¯ ç»„åˆã€æ’åˆ— åˆ‡å‰²é—®é¢˜ å­é›†é—®é¢˜ æ£‹ç›˜é—®é¢˜ å›æº¯å¯æŠ½è±¡ä¸ºæ ‘å½¢ç»“æ„ï¼ˆnå‰æ ‘ï¼‰ forå¾ªç¯åµŒå¥—é€’å½’ ä¼˜åŒ–ï¼š å‰ªææ“ä½œ éœ€è¦æ³¨æ„é¢˜ç›®ä¸­ä¸€æ¬¡çš„ç»“æœä¸­å…ƒç´ èƒ½å¦é‡å¤ï¼Œæ‰€æœ‰ç»“æœä¸­ï¼Œé¡ºåºä¸åŒï¼Œæ˜¯å¦ä¼šé€ æˆä¸€ä¸ªæ–°çš„ç»“æœã€‚ LeetCode å›æº¯é¢˜ç›®æ•´ç†æ’åˆ—ç»„åˆåŒºåˆ†ï¼š æ’åˆ—æœ‰åºï¼Œç›¸åŒå…ƒç´ ä¸åŒé¡ºåºï¼Œåˆ™ä¸åŒ ç»„åˆæ— åºï¼Œç›¸åŒå…ƒç´ ä¸åŒé¡ºåºï¼Œåˆ™ç›¸åŒ(éœ€è¦æ·»åŠ startç´¢å¼•) 77 combine ç»„åˆé—®é¢˜ 78 Subsets ç»„åˆé—®é¢˜ 46 Permutations æ’åˆ—é—®é¢˜ 47 PermutationsII æ’åˆ—é—®é¢˜ 36 Combination Sum ç»„åˆé—®é¢˜ 40 Combination Sum II ç»„åˆé—®é¢˜ 216 Combination Sum III ç»„åˆé—®é¢˜ 90 Subsets II ç»„åˆé—®é¢˜ 60 Permutation Sequence å’ŒPermutationsæ˜¯ä¸€æ ·çš„ï¼Œåªéœ€è¦è¿”å›resultsä¸­ç¬¬kä¸ªå€¼å³å¯ äºŒç»´é—®é¢˜ 79 Word Search ç»å…¸çš„äºŒç»´é—®é¢˜çš„å›æº¯ å‰‘æŒ‡offerç¬¬12é¢˜ é¢˜è§£77 Combine78 Subsetsç»„åˆé—®é¢˜ public static List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums) { List&lt;List&lt;Integer&gt;&gt; results = new LinkedList&lt;&gt;(); List&lt;Integer&gt; out = new LinkedList&lt;&gt;(); backtrack(nums, results, out, 0); return results; } private static void backtrack(int[] nums, List&lt;List&lt;Integer&gt;&gt; results, List&lt;Integer&gt; track, int start) { results.add(new LinkedList&lt;&gt;(track)); for (int i = start; i &lt; nums.length; i++) { track.add(nums[i]); backtrack(nums, results, track, i+1); track.remove(track.size()-1); } } 46 Permutationsæ’åˆ—é—®é¢˜ private List&lt;List&lt;Integer&gt;&gt; results = new LinkedList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) { int k = 3; List&lt;Integer&gt; out = new LinkedList&lt;&gt;(); backtrack(nums, out, k); return results; } private void backtrack(int[] nums, List&lt;Integer&gt; track, int k) if(track.size() == k){ results.add(new LinkedList&lt;&gt;(track)); } for (int i = 0; i &lt; nums.length; i++) { // å‰”é™¤é‡å¤å€¼ if(track.contains(nums[i])){ continue; } track.add(nums[i]); backtrack(nums, track, k); track.remove(track.size()-1); } } 47 PermutationsIIæ’åˆ—é—®é¢˜ private static List&lt;List&lt;Integer&gt;&gt; results = new ArrayList&lt;&gt;(); public static List&lt;List&lt;Integer&gt;&gt; permuteUnique(int[] nums) { Arrays.sort(nums); List&lt;Integer&gt; out = new ArrayList&lt;&gt;(); backtrack(nums, out, new boolean[nums.length]); return results; } private static void backtrack(int[] nums, List&lt;Integer&gt; out, boolean[] visit if (out.size() == nums.length) { results.add(new ArrayList&lt;&gt;(out)); return; } for (int i = 0; i &lt; nums.length; i++) { //é‡å¤å…ƒç´ åªæŒ‰é¡ºåºé€‰æ‹©ï¼Œè‹¥å½“å‰å…ƒç´ æœªè¢«é€‰æ‹©ä¸”å‰ä¸€å…ƒç´ ä¸å½“å‰å…ƒç´ å€¼ç›¸ç­‰ä¹Ÿæœªè¢«é€‰æ‹©åˆ™è·³è¿‡ï¼Œ // è¿™ä¸€å¯èƒ½æƒ…å†µä¸å…ˆé€‰å°åºå·åé€‰å¤§åºå·çš„ç›¸åŒå…ƒç´ ç›¸åŒ if (i &gt; 0 &amp;&amp; nums[i] == nums[i - 1] &amp;&amp; visited[i-1] &amp;&amp;!visited[i] || continue; } out.add(nums[i]); visited[i] = true; backtrack(nums, out, visited); out.remove(out.size() - 1); visited[i] = false; } } 36 Combination Sumç»„åˆé—®é¢˜ å…ƒç´ æ— é‡å¤é¡¹ å¯é‡å¤ä½¿ç”¨ private List&lt;List&lt;Integer&gt;&gt; results = new ArrayList&lt;List&lt;Integer&gt;&gt;(); private List&lt;Integer&gt; curren = new ArrayList&lt;Integer&gt;(); public List&lt;List&lt;Integer&gt;&gt; combinationSum(int[] candidates, int target){ Arrays.sort(candidates); if(candidates == null){ return results; } backtrack(0, candidates, target, curren); return results; } private void backtrack(int start, int[] candidates, int target, List&lt;Integer&gt; out){ if(target &lt; 0){ return; } if(target == 0){ results.add(new ArrayList&lt;&gt;(out)); } for (int i = start; i &lt; candidates.length; i++) { out.add(candidates[i]); backtrack(i, candidates, target-candidates[i], curren); out.remove(out.size()-1); } } 40 Combination Sum IIç»„åˆé—®é¢˜ å…ƒç´ æœ‰é‡å¤é¡¹ ä¸èƒ½é‡å¤é€‰ // æœ‰é‡å¤é¡¹ private List&lt;List&lt;Integer&gt;&gt; results = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; combinationSum2(int[] candidates, int target) { if (candidates == null) { return results; } Arrays.sort(candidates); List&lt;Integer&gt; out = new ArrayList&lt;&gt;(); backtrack(0, out, candidates, target); return results; } private void backtrack(int start, List&lt;Integer&gt; out, int[] candidates, int targe if(target &lt; 0){ return; } if(target == 0){ results.add(new ArrayList&lt;&gt;(out)); } for (int i = start; i &lt; candidates.length; i++) { if(candidates[i] == candidates[i-1] &amp;&amp; i&gt; start){ continue; } out.add(candidates[i]); backtrack(i+1, out, candidates, target-candidates[i]); out.remove(out.size()-1); } } 216 Combination Sum IIIç»„åˆé—®é¢˜ å…ƒç´ æ— é‡å¤é¡¹ï¼Œä½†æ˜¯å€™é€‰é›†æ”¹å˜ private List&lt;List&lt;Integer&gt;&gt; results = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; combinationSum3(int k, int n){ List&lt;Integer&gt; out = new ArrayList&lt;&gt;(); backtrack(1, out, n, k); return results; } private void backtrack(int start, List&lt;Integer&gt; out, int n, int k) { if(out.size() == k &amp;&amp; n==0){ results.add(new ArrayList&lt;&gt;(out)); } for (int i = start; i &lt;= n; i++) { if(i&gt;=10){ continue; } out.add(i); backtrack(i+1, out, n-i, k); out.remove(out.size()-1); } } 90 Subsets IIç»„åˆé—®é¢˜ å…ƒç´ æœ‰é‡å¤é¡¹ private List&lt;List&lt;Integer&gt;&gt; results = new ArrayList&lt;&gt;() public List&lt;List&lt;Integer&gt;&gt; subsetsWithDup(int[] nums) { if(nums == null){ return results; } Arrays.sort(nums); List&lt;Integer&gt; out = new ArrayList&lt;&gt;(); backtrack(nums, out, 0); return results; } private void backtrack(int[] nums, List&lt;Integer&gt; out, i results.add(new ArrayList&lt;&gt;(out)); for (int i = start; i &lt; nums.length; i++) { if(i&gt;start &amp;&amp; nums[i] == nums[i-1]){ continue; } out.add(nums[i]); backtrack(nums, out, i+1); out.remove(out.size()-1); } } 79 Word SearchäºŒç»´å¹³é¢å†…åˆ¤æ–­æ˜¯å¦åŒ…å«æœ‰å­—ç¬¦ä¸²ï¼Œæœ€åŸºç¡€çš„äºŒç»´å›æº¯é—®é¢˜. å’Œä¸€ç»´å›æº¯é—®é¢˜ä¸åŒçš„æ˜¯ï¼Œå›æº¯å‡½æ•°å»é™¤äº†forå¾ªç¯ï¼Œè€Œæ˜¯åˆ¤æ–­å…¶ç›¸é‚»çš„å››ä¸ªæ ¼å­ï¼š (row+1, col) (row-1, col) (row, col+1) (row, col-1) è°ƒç”¨å›æº¯çš„æ–¹æ³•ä½¿ç”¨äº†forå¾ªç¯ï¼Œå› ä¸ºäºŒç»´çš„æ¯ä¸ªä½ç½®éƒ½éœ€è¦è¿›è¡Œæ·±åº¦éå†ã€‚ å›æº¯éƒ¨åˆ†ï¼š éœ€è¦åˆ¤æ–­æ˜¯å¦è¶Šç•Œï¼Œè¶Šç•Œçš„åœ°æ–¹ä¸èµ° ç»ˆæ­¢æ¡ä»¶ï¼š å½“å‰çš„ç¬¬iæ­¥ï¼Œå¯¹åº”çš„å­—ç¬¦åˆšå¥½æ˜¯wordçš„ç¬¬iä¸ªå­—ç¬¦ public boolean exist(char[][] board, String word) { if (board.length == 0 || board[0].length == 0) { return false; } int m = board.length; int n = board[0].length; for (int i = 0; i &lt; m; i++) { for (int j = 0; j &lt; n; j++) { if (search(board, word, 0, i, j)) { return true; } } } return false; } private boolean search(char[][] board, String word, int start, int i, int j) { if (start == word.length()) { return true; } int m = board.length; int n = board[0].length; if (i &lt; 0 || j &lt; 0 || i &gt;= m || j &gt;= n || board[i][j] != word.charAt(start)) { return false; } char c = board[i][j]; board[i][j] = '#'; boolean res = search(board, word, start + 1, i + 1, j) || search(board, word, start + 1, i - 1, j) || search(board, word, start + 1, i, j + 1) || search(board, word, start + 1, i, j - 1); board[i][j] = c; return res; }","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"å›æº¯","slug":"å›æº¯","permalink":"https://winniekun.github.io/tags/%E5%9B%9E%E6%BA%AF/"}]},{"title":"æ­»ç£•DFS","slug":"LeetCode/stick-to-DFS","date":"2020-02-23T11:59:12.000Z","updated":"2020-08-30T04:50:22.249Z","comments":true,"path":"stick-to-DFS/","link":"","permalink":"https://winniekun.github.io/stick-to-DFS/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¸‰ï¼š DFS åˆ·äº†é‚£ä¹ˆå¤šé¢˜ï¼Œ æ„Ÿè§‰DFSåº”ç”¨å¾ˆå¹¿æ³›å“‡ï¼Œé‡åˆ°æ’åˆ—ç»„åˆã€æœç´¢ç­‰é—®é¢˜ï¼Œç†è§£é¢˜æ„ä¹‹åï¼Œç›´æ¥æ— è„‘DFSéƒ½èƒ½è¡Œçš„é€šã€‚","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¸‰ï¼š DFS åˆ·äº†é‚£ä¹ˆå¤šé¢˜ï¼Œ æ„Ÿè§‰DFSåº”ç”¨å¾ˆå¹¿æ³›å“‡ï¼Œé‡åˆ°æ’åˆ—ç»„åˆã€æœç´¢ç­‰é—®é¢˜ï¼Œç†è§£é¢˜æ„ä¹‹åï¼Œç›´æ¥æ— è„‘DFSéƒ½èƒ½è¡Œçš„é€šã€‚ LeetCode DFSé¢˜ç›®æ•´ç† 200 Number of Islands é¢˜è§£200 Number of Islandsæ•°é™†åœ°ï¼Œ å…¶ä¸­1è¡¨ç¤ºé™†åœ°ï¼Œ0è¡¨ç¤ºæ°´ æ€è·¯ï¼š ä½¿ç”¨dfs, ä»ï¼ˆ0,0ï¼‰å¼€å§‹ï¼Œé¡ºåºä¸‹ã€ä¸Šã€å³ã€å·¦ æ¯æ¬¡è®¿é—®åˆ°çš„é™†åœ°éƒ½æ”¹ä¸ºæ°´ã€‚è¿™æ ·å°±ç•¥å»äº†æ ‡è®°ä¸ºæ•°ç»„ï¼Œå‡å°‘ç©ºé—´ private static final int[][] DIRS = new int[][]{{1, 0}, {-1, 0}, {0, 1}, {0, -1}}; private static final char L = '1', W = '0'; public int numIslands(char[][] grid){ int count = 0; for (int i = 0; i &lt; grid.length; i++) { for (int j = 0; j &lt; grid[0].length; j++) { if (grid[i][j] == L) { count++; dfs(grid, i, j); } } } return count; } private void dfs(char[][] grid, int x, int y) { // è¾¹ç•Œåˆ¤æ–­ if (x &lt; 0 || x &gt; grid.length-1 || y &lt; 0 || y &gt; grid[0].length-1) { return; } if(grid[x][y] == L){ grid[x][y] = W; for (int[] dir : DIRS) { dfs(grid, x+dir[0], y+dir[1]); } } }","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"dfs","slug":"dfs","permalink":"https://winniekun.github.io/tags/dfs/"}]},{"title":"æ­»ç£•é“¾è¡¨","slug":"LeetCode/stick-to-linkedlist","date":"2020-02-15T12:42:11.000Z","updated":"2021-07-02T04:06:00.749Z","comments":true,"path":"stick-to-linkedlist/","link":"","permalink":"https://winniekun.github.io/stick-to-linkedlist/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—äºŒï¼š é“¾è¡¨","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—äºŒï¼š é“¾è¡¨ é“¾è¡¨ä½œä¸ºåŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œå°†é“¾è¡¨çš„æ“ä½œæŒæ¡äº†ï¼Œå…¶ä»–çš„ç›¸å…³ç»“æ„ä¸ç®—æ³•ï¼Œç†è®ºä¸Šæ¥è¯´ä¸ºé¢˜ä¸å¤§äº†ã€‚LeetCodeä¸­ï¼Œ é“¾è¡¨çš„æ“ä½œæ˜¯æœ‰è¿¹å¯å¾ªçš„ï¼Œ å½“ç„¶ä¹Ÿå¯å½“åœºç†è§£ï¼Œç„¶åç”»å›¾ï¼Œæ‰¾è§£æ³•ï¼ˆå¥ˆä½•æˆ‘å¤ªç¬¨ï¼Œç¼–ç åŠŸåº•è¿˜ä¸å¤Ÿï¼‰ï¼Œåæ­£é“¾è¡¨çš„æ‰€æœ‰æ“ä½œéƒ½ç¦»ä¸å¼€åŸºç¡€çš„CRUD, è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æ¶‰åŠåˆ°å¤´ç»“ç‚¹çš„æ“ä½œçš„æ—¶å€™ï¼Œæœ€å¥½è®¾ç½®ä¸€ä¸ªdummyèŠ‚ç‚¹æŒ‡å‘å¤´ç»“ç‚¹ï¼Œè¿™æ ·æ–¹ä¾¿ç»Ÿä¸€å¤„ç†ã€‚ åˆ·äº†LeetCodeä¸­æ‰€æœ‰é“¾è¡¨æœ‰å…³çš„é¢˜ç›®ï¼ˆ34é¢˜å…è´¹é¢˜ç›®ï¼‰åšäº†å¦‚ä¸‹æ€»ç»“ CRUDå¢éœ€è¦æ³¨æ„æ„é€ æ–°é“¾è¡¨æ—¶çš„å¤´æ’æ³• å’Œå°¾æ’æ³• å¤´æ’æ³•ï¼š é€†åº å°¾æ’æ³•ï¼š æ­£åº åˆ æ ¹æ®å‰é©±åˆ é™¤ pre.next = pre.next.next; æ ¹æ®å½“å‰èŠ‚ç‚¹åˆ é™¤ ListNode next = cur.next; cur.val = next.val; cur.next = next.next; æ”¹æŸ¥é“¾è¡¨çš„å¸¸ç”¨æ“ä½œ ä¸¤ä¸¤ä¹‹é—´çš„äº¤æ¢ å¤šèŠ‚ç‚¹çš„äº¤æ¢ åè½¬ ç¯ LeetCode é“¾è¡¨é¢˜ç›®æ•´ç† 2 Add Two Numbers 445 Add Two Numbers II é¢˜è§£2. Add Two NumbersExample: Input: (2 -&gt; 4 -&gt; 3) + (5 -&gt; 6 -&gt; 4) Output: 7 -&gt; 0 -&gt; 8 Explanation: 342 + 465 = 807. æ€è·¯ï¼š é“¾è¡¨çš„åè½¬åºåˆ—ä»£è¡¨ä¸€ä¸ªæ•´æ•°ï¼Œç„¶åæ•´æ•°çš„ç›¸åŠ ä¹‹åï¼Œç»“æœç”¨ä¸ªä½--&gt;åä½---&gt;ç™¾ä½çš„é¡ºåºè¡¨ç¤ºã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—å­˜å‚¨ä¸¤ä¸ªé“¾è¡¨ï¼Œç„¶åå¼€å§‹ä¾æ¬¡å¼¹å‡ºï¼Œè¿›è¡Œç›¸åŠ ï¼Œä½¿ç”¨å°¾æ’æ³•æ„é€ è¾“å‡ºé“¾è¡¨ public ListNode addTwoNumbers(ListNode l1, ListNode l2) { Queue&lt;ListNode&gt; queue1 = list2Queue(l1); Queue&lt;ListNode&gt; queue2 = list2Queue(l2); // åº”é¢˜ç›®è¦æ±‚ ä½¿ç”¨å°¾æ’å‘ ListNode dummy = new ListNode(-1); ListNode real = dummy; int carry = 0; while (!queue1.isEmpty() || !queue2.isEmpty()) { int p1 = queue1.isEmpty() ? 0 : queue1.poll().val; int p2 = queue2.isEmpty() ? 0 : queue2.poll().val; int sum = p1 + p2 + carry; int i = sum % 10; // å°¾æ’æ³• ListNode cur = new ListNode(i); real.next = cur; real = cur; carry = sum / 10; } if (carry &gt; 0) { ListNode node = new ListNode(carry); real.next = node; real = node; } return dummy.next; } public Queue&lt;ListNode&gt; list2Queue(ListNode node) { Queue&lt;ListNode&gt; queue = new LinkedList&lt;&gt;(); while (node != null) { queue.offer(node); node = node.next; } return queue; } 445 Add Two Numbers IIæ€è·¯ é“¾è¡¨ä»£è¡¨ä¸€ä¸ªæ•´æ•°ï¼Œä¸¤æ•´æ•°ç›¸åŠ ä¹‹åï¼Œç»“æœç”¨æœ€é«˜ä½---&gt;....---&gt;åä½---&gt;ä¸ªä½é¡ºåºè¡¨ç¤ºã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ ˆå­˜å‚¨ä¸¤ä¸ªé“¾è¡¨ï¼Œç„¶åå¼€å§‹ä¾æ¬¡å¼¹å‡ºï¼Œè¿›è¡Œç›¸åŠ ï¼Œä½¿ç”¨å¤´æ’æ³•æ„é€ è¾“å‡ºé“¾è¡¨ã€‚ public ListNode addTwoNumbersII(ListNode l1, ListNode l2) { if (l1 == null &amp;&amp; l2 == null) { return null; } Stack&lt;ListNode&gt; s1 = new Stack(); while(l1 != null) { s1.push(l1); l1 = l1.next; } Stack&lt;ListNode&gt; s2 = new Stack(); while(l2 != null) { s2.push(l2); l2 = l2.next; } int carry = 0; ListNode resNode = null; while (!s1.isEmpty() || !s2.isEmpty()) { int n1 = s1.isEmpty() ? 0 : s1.pop().val; int n2 = s2.isEmpty() ? 0 : s2.pop().val; int sum = n1 + n2 + carry; ListNode n = new ListNode(sum % 10); // å¤´æ’æ³• n.next = resNode; resNode = n; carry = sum / 10; } // æœ€é«˜ä½ if (carry &gt; 0) { ListNode n = new ListNode(carry); n.next = resNode; resNode = n; } return resNode; } é“¾è¡¨è¡¨ç¤ºæ•´æ•°ï¼Œè¿›è¡ŒåŠ æ³•è®¡ç®—ï¼Œè¿™æ˜¯ä¸¤ä¸ªé“¾è¡¨çš„æ“ä½œï¼Œæ²¡æœ‰æ¶‰åŠé“¾è¡¨çš„å¢åˆ æ”¹æŸ¥ï¼Œå®ç°æ–¹å¼æ•°ç»„ä¸­çš„Add Two NumbersåŒç†ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„é¢˜ç›®è¦æ±‚ï¼Œä¸Šè¿°ä¸¤ä¸ªé¢˜ç›®æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„é¢˜ç›®è¯´æ˜ï¼Œç»™å®šçš„é“¾è¡¨æ˜¯å¦‚ä½•ä»£è¡¨ä¸€ä¸ªæ•´æ•°çš„ï¼Œç„¶åè¾“å‡ºç»“æœæ˜¯å¦‚ä½•è¡¨ç¤ºçš„ï¼Œï¼ˆå› ä¸ºæˆ‘ä»¬çš„ç®—æ³•æ˜¯ä»ä¸ªä½å¼€å§‹è®¡ç®—çš„ï¼‰ æ­£åºè¡¨ç¤ºæ•´æ•° &amp;&amp; ä»ä¸ªä½ä¾æ¬¡è¾“å‡ºä½¿ç”¨æ ˆå­˜å‚¨ï¼Œå°¾æ’æ³•æ„é€ ç»“æœ é€†åºè¡¨ç¤ºæ•´æ•° &amp;&amp; ä»æœ€é«˜ä½ä¾æ¬¡è¾“å‡ºä½¿ç”¨é˜Ÿåˆ—å­˜å‚¨ï¼Œå¤´æ’æ³•æ„é€ ç»“æœ 19. Remove Nth Node From End of ListæŸ¥ã€åˆ  å€’æ•°ç¬¬nä¸ªèŠ‚ç‚¹åˆ é™¤ å…ˆè·å–ç¬¬nä¸ªèŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ï¼Œç„¶åæŒ‰ç…§å‰é©±ç»“ç‚¹åˆ é™¤æ³•åˆ é™¤å³å¯ public static ListNode removeNthFromEnd(ListNode head, int n) { ListNode dummy = new ListNode(-1); dummy.next = head; ListNode preNode = getPreNode(dummy, n); preNode.next = preNode.next.next; return head; } public static ListNode getPreNode(ListNode head, int n){ int count = 0; ListNode p = head; while (p != null){ count ++; p = p.next; } p = head; while ( count-n-1 &gt; 0){ p = p.next; count --; } return p; } // ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ç¬¬äºŒç§åˆ é™¤æ–¹æ³• public ListNode removeNthFromEnd(ListNode head, int n) { ListNode dummy = new ListNode(-1); dummy.next = head; ListNode fast = dummy; ListNode slow = dummy; while(n &gt; 0){ fast = fast.next; n--; } while(fast.next != null){ fast = fast.next; slow = slow.next; } slow.next = slow.next.next; return dummy.next; } 21. Merge Two Sorted Listså¢ã€æŸ¥ public ListNode mergeTwoLists(ListNode l1, ListNode l2) { ListNode dummy = new ListNode(-1); ListNode real = dummy; while (l1 != null &amp;&amp; l2 != null){ if(l1.val &lt;= l2.val){ real.next = l1; l1 = l1.next; }else { real.next = l2; l2 = l2.next; } real= real.next; } if (l1 != null){ real.next = l1; } if (l2 != null) { real.next = l2; } return dummy.next; } 23. Merge k Sorted Listså¢ï¼ŒæŸ¥ æ–¹æ³•ä¸€å¤šé“¾è¡¨ä¹‹é—´æŒ‰ç…§é€’å¢é¡ºåºè¿›è¡Œæ•´åˆã€‚ï¼ˆæ ¹æ®ä¸Šä¸€é¢˜çš„æ€è·¯ï¼Œå…ˆä¸¤ä¸¤åˆå¹¶ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªé“¾è¡¨ï¼‰ public ListNode mergeKLists(ListNode[] lists) { if (lists == null) { return null; } int length = lists.length; while (length &gt; 1) { int k = (length + 1) / 2; for (int i = 0; i &lt; (length / 2); i++) { // mergeTwoä¸º21é¢˜å‡½æ•° lists[i] = mergeTwo(lists[i], lists[i+k]); } length = k; } return lists[0]; } æ–¹æ³•äºŒä½¿ç”¨å°æ ¹å † public ListNode mergeKLists(ListNode[] lists) { PriorityQueue&lt;ListNode&gt; heap = new PriorityQueue&lt;&gt;(new Comparator&lt;ListNode&gt;() { @Override public int compare(ListNode o1, ListNode o2) { return o1.val - o2.val; } }); // å°¾æ’æ³• ListNode dummy = new ListNode(-1); ListNode real = dummy; for (ListNode node : lists) { if (node != null) { heap.offer(node); } } while (!heap.isEmpty()) { real.next = heap.poll(); real = real.next; if (real.next != null) { heap.offer(real.next); } } return dummy.next; } 24. Swap Nodes in Pairsæ”¹ ä¸¤ä¸¤äº¤æ¢ï¼Œ ä¸¤ä¸ªèŠ‚ç‚¹çš„äº¤æ¢ï¼Œ å¿…ç„¶ç‰µå¼•åˆ°å››ä¸ªæŒ‡é’ˆçš„æ”¹å˜ å…·ä½“æ­¥éª¤è§å›¾ï¼š é“¾è¡¨.png public static ListNode swapPairs(ListNode head){ if(head == null){ return head; } ListNode dummy = new ListNode(-1); dummy.next = head; ListNode pre = dummy; while (head!=null &amp;&amp; head.next!=null){ ListNode temp = head.next; head.next = temp.next; temp.next = pre.next; pre.next = temp; pre = head; head = head.next; } return dummy.next; } 25. Reverse Nodes in k-Groupæ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ ·ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„preçš„cur 92. Reverse Linked List IIå’Œä¸Šè¿°åŒç† public static ListNode reverseBetween(ListNode head, int m, int n) { if (head == null || n - m == 0) { return head; } ListNode dummy = new ListNode(-1); dummy.next = head; ListNode pre = dummy; for (int i = 0; i &lt; m-1; i++) { pre = pre.next; } ListNode cur = pre.next; for (int i = m; i &lt; n; i++) { ListNode temp = cur.next; cur.next = temp.next; temp.next = pre.next; pre.next = temp; } return dummy.next; } 206. Reverse Linked Listå¤´æ’æ³•è§£å†³ public ListNode reverseList(ListNode head) { ListNode dummy = new ListNode(-1); while(head != null){ ListNode curr = head.next; head.next = dummy.next; dummy.next = head; head = curr; } return dummy.next; } 61. Rotate ListæŸ¥ å¿«æ…¢æŒ‡é’ˆæ³•ï¼ŒfastæŒ‡é’ˆå…ˆèµ°kæ­¥ï¼Œä¹‹åslowå’Œfastä¸€èµ·èµ°ï¼Œfaståˆ°é“¾è¡¨å°¾éƒ¨ï¼Œç„¶åå°†é“¾è¡¨å¤´å°¾ç›¸è¿ã€‚æ­¤æ—¶slowæŒ‡å‘æ–°çš„å¤´ç»“ç‚¹çš„å‰é©±èŠ‚ç‚¹ï¼Œç„¶åé‡æ–°è®¾ç½®å¤´æŒ‡é’ˆï¼Œæ–­å¼€é“¾è¡¨å³å¯ã€‚ // å¿«æ…¢æŒ‡é’ˆ public static ListNode roateRightII(ListNode head, int k){ if(head == null){ return null; } int length = getLength(head); k %= length; ListNode endNode = getEndNode(head); ListNode fast = head, slow = head; while (k &gt; 0){ fast = fast.next; k--; } while (fast.next != null){ fast = fast.next; slow = slow.next; } // æ„æˆç¯ fast.next = head; // é‡æ–°è®¾ç½® head = slow.next; slow.next = null; return head; } 83. Remove Duplicates from Sorted Liståˆ  åˆ é™¤æœ‰é‡å¤çš„èŠ‚ç‚¹ ä½¿ç”¨å‰é©±èŠ‚ç‚¹åˆ é™¤æ³•ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªpreæŒ‡é’ˆï¼Œå’ŒcuræŒ‡é’ˆã€‚ public ListNode deleteDuplicates(ListNode head) { ListNode pre = head; ListNode cur; while (pre.next != null){ cur = pre.next; // å› ä¸ºæ˜¯å’Œcurçš„å‰é©±æ¯”è¾ƒï¼Œ æ‰€ä»¥ä¸ç”¨åˆ¤æ–­cur.next!=null, è€Œæ˜¯ä½¿ç”¨cur!=null while (cur!=null &amp;&amp; cur.val == pre.val){ cur = cur.next; } if(pre.next != cur){ pre.next = cur; } else { pre = pre.next; } } return head; } 82. Remove Duplicates from Sorted List IIåˆ  åˆ å…‰é‡å¤çš„èŠ‚ç‚¹ ä½¿ç”¨å‰é©±èŠ‚ç‚¹åˆ é™¤æ³•ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªpreæŒ‡é’ˆï¼Œå’ŒcuræŒ‡é’ˆã€‚ å¯èƒ½å­˜åœ¨å¤´ç»“ç‚¹ä¼šå˜æ¢, æ‰€ä»¥è®¾ç½®ä¸€ä¸ªç©ºçš„å¤´ç»“ç‚¹ public ListNode deleteDuplicates(ListNode head) { if (head == null) { return null; } ListNode dummy = new ListNode(-1); dummy.next = head; ListNode cur = null; ListNode pre = dummy; while (pre.next != null) { cur = pre.next; while (cur.next != null &amp;&amp; cur.next.val == cur.val) { cur = cur.next; } if(cur != pre.next){ pre.next = cur.next; } else { pre = pre.next; } } return dummy.next; } 86. Partition List109. Convert Sorted List to Binary Search Tree138. å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨class Solution { public Node copyRandomList(Node head) { if (head == null) { return head; } // key æ—§ã€‚value æ–° Map&lt;Node, Node&gt; map = new HashMap&lt;&gt;(); Node newHead = new Node(head.val); Node oddHead = head; map.put(oddHead, newHead); Node nCur = newHead; Node oCur = head.next; while (oCur != null) { nCur.next = new Node(oCur.val); nCur = nCur.next; map.put(oCur, nCur); oCur = oCur.next; } oCur = head; nCur = newHead; while (oCur != null) { if (oCur.random != null) { // random ï¼ï¼ï¼ï¼ Node ran = map.get(oCur.random); nCur.random = ran; } oCur = oCur.next; nCur = nCur.next; } return newHead; } } 141. Linked List Cycle142. Linked List Cycle II143. Reorder List147. Insertion Sort List148. Sort List160. Intersection of Two Linked Listsè§£æ³•1ï¼šæš´åŠ›æ±‚è§£ è§£æ³•2ï¼š æ„é€ ç¯ 203. ç§»é™¤é“¾è¡¨å…ƒç´ // åŒæŒ‡é’ˆ class Solution { public ListNode removeElements(ListNode head, int val) { if (head == null) { return head; } ListNode dummy = new ListNode(-1); dummy.next = head; ListNode pre = dummy; ListNode cur = head; while (cur != null) { if (cur.val != val) { pre = cur; cur = cur.next; } else { pre.next = cur.next; cur = pre.next; } } return dummy.next; } } 234. å›æ–‡é“¾è¡¨class Solution { public boolean isPalindrome(ListNode head) { if (head == null) { return true; } Map&lt;Integer, ListNode&gt; map = new HashMap&lt;&gt;(); ListNode cur = head; int n = 0; while (cur != null) { map.put(n, cur); n++; cur = cur.next; } cur = head; for (int i = 0; i &lt; n / 2; i++) { System.out.println(cur.val); if (cur.val != map.get(n - i - 1).val) { return false; } cur = cur.next; } return true; } } 237. Delete Node in a Linked List328. å¥‡å¶é“¾è¡¨class Solution { public ListNode oddEvenList(ListNode head) { // æŒ‰ç…§ä½ç½®åˆ†å¥‡å¶ if (head == null) { return head; } ListNode odd = new ListNode(-1); ListNode even = new ListNode(-1); ListNode oddHead = odd; ListNode evenHead = even; int i = 1; while (head != null) { if (i % 2 == 1) { odd.next = head; odd = odd.next; } else { even.next = head; even = even.next; } head = head.next; i++; } // æ–­é“¾ ï¼ˆæ³¨æ„æ³¨æ„æ³¨æ„ï¼‰ odd.next = evenHead.next; even.next = null; return oddHead.next; } } 369. Plus One Linked List379. Design Phone Directory426. Convert Binary Search Tree to Sorted Doubly Linked List430. Flatten a Multilevel Doubly Linked List445. Add Two Numbers II707. Design Linked List708. Insert into a Sorted Circular Linked List725. Split Linked List in Parts817. Linked List Components876. Middle of the Linked List1019. Next Greater Node In Linked List1171. Remove Zero Sum Consecutive Nodes from Linked Liståˆ  å¿«æ…¢æŒ‡é’ˆ å…¶å®æ˜¯å’Œè®¡ç®—ä¸€ä¸ªé“¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨å’Œä¸ºnçš„å­é“¾è¡¨æ˜¯ä¸€æ ·çš„æ„æ€ã€‚ slowè¡¨ç¤ºå½“å‰çš„å…ƒç´ ï¼Œä½¿ç”¨fastä¾æ¬¡éå†å…¶åç»­çš„å…ƒç´ ï¼ŒåŒæ—¶å€¼ç›¸åŠ ï¼Œå¦‚æœç­‰äº0ï¼Œåˆ™slow.next = fast.next,å¦‚æœfastéå†å®Œäº†æ‰€æœ‰çš„å…ƒç´ äº†ï¼Œæ²¡æœ‰ç­‰äº0ï¼Œ åˆ™slowç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´  1290. Convert Binary Number in a Linked List to IntegeræŸ¥ 1369. Linked List in Binary Tree","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"https://winniekun.github.io/tags/%E9%93%BE%E8%A1%A8/"}]},{"title":"æ­»ç£•äºŒå‰æ ‘","slug":"LeetCode/stick-to-binary-tree","date":"2020-02-15T12:40:45.000Z","updated":"2021-03-25T07:14:58.934Z","comments":true,"path":"stick-to-binary-tree/","link":"","permalink":"https://winniekun.github.io/stick-to-binary-tree/","excerpt":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¸€ï¼š äºŒå‰æ ‘","text":"å‰è¨€LeetCodeæ­»ç£•ç³»åˆ—ä¸€ï¼š äºŒå‰æ ‘ äºŒå‰æ ‘å…¶è‡ªèº«å°±å…·æœ‰é€’å½’å±æ€§ï¼Œ æ‰€ä»¥æŒ‰é“ç†ï¼Œç»å¤§å¤šæ•°é¢˜ç›®ç”¨é€’å½’éƒ½æ˜¯å¯ä»¥çš„ ä¸€èˆ¬æƒ…å†µä¸‹:å¦‚æœéœ€è¦æœç´¢æ•´é¢—äºŒå‰æ ‘ï¼Œé‚£ä¹ˆé€’å½’å‡½æ•°å°±ä¸è¦è¿”å›å€¼ï¼Œå¦‚æœè¦æœç´¢å…¶ä¸­ä¸€æ¡ç¬¦åˆæ¡ä»¶çš„è·¯å¾„ï¼Œé€’å½’ å‡½æ•°å°±éœ€è¦è¿”å›å€¼ï¼Œå› ä¸ºé‡åˆ°ç¬¦åˆæ¡ä»¶çš„è·¯å¾„äº†å°±è¦åŠæ—¶è¿”å› å¸¸ç”¨æ“ä½œ éå† å‰åºéå† //é€’å½’å‰åºéå† public void preOrder(TreeNode root) { if (Objects.isNull(root)) { return; } // do something preOrder(root.left); preOrder(root.right); } //é€’å½’å‰åºéå† public void preOrder(TreeNode root) { } //éé€’å½’å‰åºéå† public void preOrderII(TreeNode root) { if (Objects.isNull(root)) { return; } Deque&lt;TreeNode&gt; stack = new ArrayDeque&lt;&gt;(); TreeNode p = root; while (!stack.isEmpty() || p != null) { while (p != null) { // do something stack.push(p); p = p.left; } if (!stack.isEmpty()) { p = stack.pop(); p = p.right; } } } ä¸­åºéå† //é€’å½’ä¸­åºéå† public void inOrder(TreeNode root) { if (Objects.isNull(root)) { return; } inOrder(root.left); // do something inOrder(root.right); } //éé€’å½’ä¸­åºéå† public void inOrderII(TreeNode root) { if (Objects.isNull(root)) { return; } TreeNode p = root; Deque&lt;TreeNode&gt; stack = new ArrayDeque&lt;&gt;(); while (!stack.isEmpty() || p != null) { while (p != null) { stack.push(p); p = p.left; } if (!stack.isEmpty()) { p = stack.pop(); // do something p = p.right; } } } ååºéå† //é€’å½’ååºéå† public void postOrder(TreeNode root) { if (Objects.isNull(root)) { return; } postOrder(root.left); postOrder(root.right); // do something } //éé€’å½’ååºéå† public void postOrderII(TreeNode root) { if (Objects.isNull(root)) { return; } Deque&lt;TreeNode&gt; stack = new ArrayDeque&lt;&gt;(); Deque&lt;TreeNode&gt; list = new ArrayDeque&lt;&gt;(); Deque&lt;TreeNode&gt; reverse = new ArrayDeque&lt;&gt;(); TreeNode p = root; stack.push(p); while (!stack.isEmpty()) { p = stack.pop(); list.push(p); if (p.right != null) { stack.push(p.left); } if (p.left != null) { stack.push(p.left); } } while (!list.isEmpty()) { reverse.add(list.pop()); } } å±‚æ¬¡éå† public void levelOrder(TreeNode root) { if (Objects.isNull(root)) { return; } Deque&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); TreeNode p = root; queue.offer(p); while (!queue.isEmpty()) { int size = queue.size(); for (int i = 0; i &lt; size; i++) { p = queue.poll(); if (p.left != null) { queue.offer(p.left); } if (p.right != null) { queue.offer(p.right); } } } } å…¬å…±ç¥–å…ˆ æ ‘è½¬é“¾è¡¨ é‡æ–°æ„å»ºäºŒå‰æ ‘ è·¯å¾„ä¹‹å’Œ æ·±åº¦å’Œé«˜åº¦ æ±‚äºŒå‰æ ‘æ·±åº¦ å’Œ äºŒå‰æ ‘é«˜åº¦çš„å·®å¼‚ï¼Œæ±‚æ·±åº¦é€‚åˆç”¨å‰åºéå†ï¼Œè€Œæ±‚é«˜åº¦é€‚åˆç”¨ååºéå† å› ä¸ºæ·±åº¦å¯ä»¥ä»ä¸Šåˆ°ä¸‹å»æŸ¥ æ‰€ä»¥éœ€è¦å‰åºéå†(æ ¹å·¦å³)ï¼Œè€Œé«˜åº¦åªèƒ½ä»ä¸‹åˆ°ä¸Šå»æŸ¥ï¼Œæ‰€ä»¥åªèƒ½ååºéå†(å·¦å³æ ¹) LeetCode&amp;å‰‘æŒ‡offer äºŒå‰æ ‘é¢˜ç›®æ•´ç† äºŒå‰æ ‘çš„å‰åºéå† äºŒå‰æ ‘çš„ä¸­åºéå† äºŒå‰æ ‘çš„ååºéå† äºŒå‰æ ‘çš„é«˜åº¦ äºŒå‰æ ‘çš„ç›´å¾„ äºŒå‰æ ‘çš„æ·±åº¦ äºŒå‰æ ‘çš„å±‚æ¬¡éå† å±‚æ¬¡éå†èƒ½è§£å†³å¾ˆå¤šå…³äºäºŒå‰æ ‘çš„é—®é¢˜ï¼Œç›®å‰æ ¹æ®è€ƒç ”ç»éªŒä»¥åŠLeetCodeåˆ·é¢˜æ€»ç»“ï¼Œå…¶ä½œç”¨èŒƒå›´å¤§æ¦‚å¦‚ä¸‹ï¼š äºŒå‰æ ‘çš„æ·±åº¦ æœ€å¤§æ·±åº¦ ä¸€æ¬¡æ­£å¸¸çš„å±‚æ¬¡éå† æœ€å°æ·±åº¦ ç¬¬ä¸€æ¬¡é‡åˆ°å½“å‰èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹æ—¶éå†ç»“æŸ äºŒå‰æ ‘çš„å®½åº¦ æœ€å¤§å®½åº¦ æœ€å°å®½åº¦ ä»¥ä¸Šä¸¤é“é¢˜å¯ä»¥æ„Ÿè§‰å‡ºï¼Œå±‚æ¬¡éå†å°†äºŒå‰æ ‘å®šåœ¨äº†ä¸€ä¸ªäºŒç»´çš„åæ ‡è½´ä¸Šï¼ŒäºŒå‰æ ‘çš„å±‚ä¸ºä¸€ä¸ªæ–¹å‘ï¼Œæ·±åº¦ä¸ºä¸€ä¸ªæ–¹å‘ã€‚åªè¦æ˜¯å’Œå±‚å’Œæ·±åº¦ç›¸å…³çš„å†…å®¹éƒ½å¯ä»¥è€ƒè™‘è¯•è¯•å±‚æ¬¡éå†ã€‚ä»¥ä¸‹çš„å†…å®¹ä¹Ÿéƒ½æ˜¯åœ¨å±‚å’Œæ·±åº¦çš„åŸºç¡€ä¸Šçš„ä¸€äº›å°å˜åŒ–ï¼ˆæœ€ç›´ç™½çš„ç®€å•é¢˜ï¼‰ æ¯ä¸€å±‚çš„å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰ äºŒå‰æ ‘çš„å·¦è§†å›¾ã€å³è§†å›¾ ç›¸å…³å˜ç§é¢˜ç›®ï¼š 102.äºŒå‰æ ‘çš„å±‚åºéå† 107.äºŒå‰æ ‘çš„å±‚æ¬¡éå†II 199.äºŒå‰æ ‘çš„å³è§†å›¾ 637.äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼ 429.Nå‰æ ‘çš„å±‚åºéå† 515.åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼ 116.å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ 117.å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆII 104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦ è§£æ³•ä¸å”¯ä¸€ï¼Œä¹Ÿå¯ä½¿ç”¨ååºéå†è§£å†³ã€‚ 111.äºŒå‰æ ‘çš„æœ€å°æ·±åº¦ å’Œä¸Šä¸€é¢˜ä¸€æ ·çš„æ€è·¯ï¼Œä½†æ˜¯æ¡ä»¶ä¸ä¸€æ · æœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚ 222.å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•° è·¯å¾„é—®é¢˜ æ˜¯å¦æœ‰æ»¡è¶³å’Œä¸ºsumçš„è·¯å¾„ æ±‚æ‰€æœ‰æ…¢ç…®å’Œä¸ºsumçš„è·¯å¾„ æ„é€ äºŒå‰æ ‘ ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ„é€ äºŒå‰æ ‘/æ„å»ºå¹³è¡¡äºŒå‰æ ‘ æ ¹æ®å‰åºä¸­åºã€ååºä¸­åºæ„å»ºäºŒå‰æ ‘ äºŒå‰æ ‘çš„åºåˆ—åŒ– æ ¹æ®æ•°ç»„åˆ¤æ–­æ˜¯å¦ä¸ºäºŒå‰æ’åºæ ‘ å…¬å…±èŠ‚ç‚¹ é¢˜è§£äºŒå‰æ ‘çš„é«˜åº¦æ€è·¯ï¼š é€’å½’ è¾…åŠ©é˜Ÿåˆ— äºŒå‰æ ‘çš„ç›´å¾„æ€è·¯ï¼šæ„Ÿè§‰æ˜¯äºŒå‰æ ‘çš„é«˜åº¦çš„å»¶ä¼¸ï¼Œæ€è·¯æ˜¯å’ŒäºŒå‰æ ‘çš„é«˜åº¦æ˜¯ç±»ä¼¼çš„ã€‚ ç›´å¾„ï¼š ä»¥å½“å‰èŠ‚ç‚¹ä¸ºåŸºç¡€ï¼Œç„¶åä¾æ¬¡è·å–å½“å‰èŠ‚ç‚¹çš„æœ€å¤§å·¦å­æ ‘æ·±åº¦Lå’Œå³å­æ ‘æœ€å¤§æ·±åº¦Rï¼ŒL+R=Då³ä¸ºç»“æœï¼Œç„¶åä»æ¯ä¸ªèŠ‚ç‚¹çš„Dä¸­é€‰å–æœ€å¤§çš„å³å¯ private int ans; public int diameterOfBinaryTree(TreeNode root) { if (Objects.isNull(root)) { return 0; } ans = 0; depth(root); return ans-1; } private int depth(TreeNode root) { if (Objects.isNull(root)) { return 0; } int left = depth(root.left); int right = depth(root.right); ans = Math.max(ans, left+right); return Math.max(left, right) + 1; } äºŒå‰æ ‘çš„å±‚æ¬¡éå†102.äºŒå‰æ ‘çš„å±‚åºéå†å±‚æ¬¡éå†çš„åŸºç¡€æ¨¡æ¿é¢˜ç›® public List&lt;List&lt;Integer&gt;&gt; levelOrderBottom(TreeNode root) { List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;(); List&lt;Integer&gt; out = new ArrayList&lt;&gt;(); if (Objects.isNull(root)) { return result; } Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); TreeNode p = root; queue.offer(p); while (!queue.isEmpty()) { int size = queue.size(); for(int i = 0; i &lt; size; i++) { p = queue.poll(); out.add(p.val); if (p.left != null) { queue.offer(p.left); } if (p.right != null) { queue.offer(p.right); } } result.add(out); out = new ArrayList&lt;&gt;(); } return result; } 107.äºŒå‰æ ‘çš„å±‚æ¬¡éå†IIå±‚æ¬¡éå†çš„ç®€å•å˜å½¢ï¼Œæ ¹æ®listçš„ç‰¹æ€§ï¼Œæ¯æ¬¡æ–°å¢ä¸€å±‚çš„ç»“æœçš„æ—¶ï¼Œéƒ½åœ¨é¦–ä½æ’å…¥ï¼Œå³å¯å®Œæˆé€†åºå­˜å‚¨ public List&lt;List&lt;Integer&gt;&gt; levelOrderBottom(TreeNode root) { List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;(); List&lt;Integer&gt; out = new ArrayList&lt;&gt;(); if (Objects.isNull(root)) { return result; } Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); TreeNode p = root; queue.offer(p); while (!queue.isEmpty()) { int size = queue.size(); for(int i = 0; i &lt; size; i++) { p = queue.poll(); out.add(p.val); if (p.left != null) { queue.offer(p.left); } if (p.right != null) { queue.offer(p.right); } } result.add(0, out); out = new ArrayList&lt;&gt;(); } return result; } 199.äºŒå‰æ ‘çš„å³è§†å›¾ äºŒå‰æ ‘å±‚æ¬¡éå†çš„ç®€å•å˜å½¢ã€‚ æ€è·¯ï¼š æ¯æ¬¡éå†åˆ°å½“å‰å±‚çš„æœ€åä¸€ä¸ªéç©ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œå­˜å…¥åˆ°å³è§†å›¾çš„listä¸­ public List&lt;Integer&gt; rightSideView(TreeNode root) { List&lt;Integer&gt; result = new ArrayList&lt;&gt;(); if (Objects.isNull(root)) { return result; } TreeNode p = root; Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); queue.offer(p); while (!queue.isEmpty()) { int size = queue.size(); for (int i = 0; i &lt; size; i++) { p = queue.poll(); // æ¯ä¸€å±‚çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ if (i == size - 1) { result.add(p.val); } if (p.left != null) { queue.offer(p.left); } if (p.right != null) { queue.offer(p.right); } } } return result; } 637.äºŒå‰æ ‘çš„å±‚å¹³å‡å€¼ äºŒå‰æ ‘å±‚æ¬¡éå†çš„ç®€å•å˜å½¢ã€‚ æ€è·¯ï¼š æ±‚æ¯ä¸€å±‚çš„å¹³å‡å€¼ 429.Nå‰æ ‘çš„å±‚åºéå† 515.åœ¨æ¯ä¸ªæ ‘è¡Œä¸­æ‰¾æœ€å¤§å€¼116.å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ117.å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆII104.äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦æ€è·¯1 å¹¿åº¦éå†(å±‚æ¬¡éå†) public int maxDepth(TreeNode root) { if (Objects.isNull(root)) { return 0; } TreeNode p = root; Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); queue.offer(p); int count = 0; while (!queue.isEmpty()) { int size = queue.size(); count++; for (int i = 0; i &lt; size; i++) { p = queue.poll(); if (p.left != null) { queue.offer(p.left); } if (p.right != null) { queue.offer(p.right); } } } return count; } æ€è·¯2 æ·±åº¦éå†(ååºéå†) public int maxDepth(TreeNode root) { if (Objects.isNull(root)) { return 0; } int left = maxDepthII(root.left); int right = maxDepthII(root.right); return Math.max(left, right) + 1; } 111.äºŒå‰æ ‘çš„æœ€å°æ·±åº¦æœ€å°æ·±åº¦æ˜¯ä»æ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚ image-20210223220242873 /** * æ·±åº¦éå†ï¼ˆååºï¼‰ * @param root * @return */ public int minDepth(TreeNode root) { if (Objects.isNull(root)) { return 0; } int left = minDepth(root.left); int right = minDepth(root.right); if (root.left == null &amp;&amp; root.right != null) { return 1 + right; } else if (root.left != null &amp;&amp; root.right == null) { return 1 + left; } return Math.min(left, right) + 1; } /** * å¹¿åº¦éå†ï¼ˆå±‚æ¬¡ï¼‰ * @param root * @return */ public int minDepthII(TreeNode root) { int count = 0; if (Objects.isNull(root)) { return count; } Queue&lt;TreeNode&gt; queue = new ArrayDeque&lt;&gt;(); TreeNode p = root; queue.offer(p); while (!queue.isEmpty()) { int size = queue.size(); count++; for (int i = 0; i &lt; size; i++) { p = queue.poll(); if (p.left != null) { queue.offer(p.left); } if (p.right != null) { queue.offer(p.right); } if (p.left == null &amp;&amp; p.right == null) { return count; } } } return count; } 222.å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°references ä»£ç éšæƒ³å½•","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"}],"tags":[{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://winniekun.github.io/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"}]},{"title":"LinkedListæºç è§£è¯»","slug":"æºç /JDK/list/linkedlist-analysis","date":"2020-02-11T01:17:29.000Z","updated":"2020-08-30T04:50:22.255Z","comments":true,"path":"linkedlist-analysis/","link":"","permalink":"https://winniekun.github.io/linkedlist-analysis/","excerpt":"LinkedListæºç è§£è¯»æ¦‚è¿°LinkedListåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œæ˜¯å®ç°äº†Listæ¥å£å’ŒDequeæ¥å£çš„åŒç«¯é“¾è¡¨ï¼Œå…¶èƒ½å¤Ÿé«˜æ•ˆçš„å®ç°æ’å…¥åˆ é™¤æ“ä½œ, è€Œä¸”ä¹Ÿæ‹¥æœ‰äº†é˜Ÿåˆ—æ‰€æ‹¥æœ‰çš„ç‰¹æ€§ã€‚å’ŒArrayListç›¸æ¯”ï¼Œå› ä¸ºå…¶æ²¡æœ‰å®ç°RandomAccessï¼Œæ˜¯ä»¥ä¸‹æ ‡è¿›è¡Œè®¿é—®å…ƒç´ ï¼Œ æ‰€ä»¥å¯¹äºå…ƒç´ è®¿é—®ä¸åŠArrayListï¼Œéšæœºè®¿é—®å…ƒç´ æ…¢ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯, LinkedListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦ä½¿ç”¨çš„åˆ«çš„æ–¹å¼å®ç°çº¿ç¨‹å®‰å…¨ã€‚","text":"LinkedListæºç è§£è¯»æ¦‚è¿°LinkedListåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œæ˜¯å®ç°äº†Listæ¥å£å’ŒDequeæ¥å£çš„åŒç«¯é“¾è¡¨ï¼Œå…¶èƒ½å¤Ÿé«˜æ•ˆçš„å®ç°æ’å…¥åˆ é™¤æ“ä½œ, è€Œä¸”ä¹Ÿæ‹¥æœ‰äº†é˜Ÿåˆ—æ‰€æ‹¥æœ‰çš„ç‰¹æ€§ã€‚å’ŒArrayListç›¸æ¯”ï¼Œå› ä¸ºå…¶æ²¡æœ‰å®ç°RandomAccessï¼Œæ˜¯ä»¥ä¸‹æ ‡è¿›è¡Œè®¿é—®å…ƒç´ ï¼Œ æ‰€ä»¥å¯¹äºå…ƒç´ è®¿é—®ä¸åŠArrayListï¼Œéšæœºè®¿é—®å…ƒç´ æ…¢ã€‚åŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯, LinkedListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦ä½¿ç”¨çš„åˆ«çš„æ–¹å¼å®ç°çº¿ç¨‹å®‰å…¨ã€‚ ä¾èµ– image é˜…è¯»å¥—è·¯æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘ï¼Œé¦–å…ˆäº†è§£å…¶æ„é€ æ–¹æ³•ï¼Œ ä¹‹åäº†è§£å¸¸ç”¨çš„API(CRUD)æ“ä½œå³å¯ã€‚ [x] addAll(); [x] add(); [x] remove(); [x] get(); ä»èŠ‚ç‚¹æ•°æ®ç»“æ„å¼€å§‹ image æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘ï¼Œ é¦–å…ˆåŸºç¡€çš„æ•°æ®æ„é€ , ç„¶åäº†è§£å…¶æ„é€ æ–¹æ³•ï¼Œ ä¹‹åäº†è§£å¸¸ç”¨çš„API(CRUD)æ“ä½œå³å¯ã€‚ å…¶å®ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„åŒå‘é“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚ æ„é€ å‡½æ•° ç©ºçš„æ„é€ æ–¹æ³• public LinkedList() { } ç”¨äºæ„é€ ä¸€ä¸ªç©ºçš„é“¾è¡¨ã€‚ç„¶åè‡ªè¡Œå¤„ç† å«æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•(ç”¨å·²æœ‰çš„é›†åˆåˆ›å»ºé“¾è¡¨) public LinkedList(Collection&lt;? extends E&gt; c) { this(); addAll(c); } å°†å·²æœ‰çš„linkedlistæ·»åŠ åˆ°ä¸€ä¸ªæ–°çš„linkedlistä¸­(å°¾æ’æ³•ï¼Œä¸‹æ–‡æœ‰æåŠ)ã€‚å…¶ç±»ä¼¼äºcopy() å¢ï¼šaddç›¸å…³çš„æ–¹æ³•å¯ä»¥çœ‹åˆ°ï¼Œ åˆå§‹åŒ–ä¹‹åï¼Œä½¿ç”¨æ— å‚çš„æ„é€ æ–¹æ³•ï¼Œè¿”å›çš„ä¸ºä¸€ä¸ªç©ºçš„é“¾è¡¨ï¼Œè‹¥æ˜¯ä¸ºå«æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¼šè°ƒç”¨addAll()æ–¹æ³•å°†ä¸€ä¸ªé“¾è¡¨çš„æ‰€æœ‰å…ƒç´ éƒ½æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚ è¿™ä¸ªéƒ¨åˆ†æ¶‰åŠäº†å¤§é‡çš„åŒå‘é“¾è¡¨çš„æ’å…¥åˆ é™¤ï¼Œå¯å…ˆç†è§£äº†åŒå‘é“¾è¡¨çš„æ“ä½œï¼ˆ3ã€ 4æ­¥éª¤çš„æ“ä½œé¡ºåºåœ¨äºé‡‡ç”¨çš„æ˜¯å“ªä¸ªèŠ‚ç‚¹ä½œä¸ºåŸºç¡€èŠ‚ç‚¹ï¼šä¹Ÿå°±æ˜¯é€‰æ‹©å¾…æ’å…¥ä½ç½®çš„èŠ‚ç‚¹è¿˜æ˜¯è¯¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ï¼Œæˆ–è€…æ˜¯ä¸¤ä¸ªéƒ½ä½¿ç”¨ï¼Œè‹¥æ˜¯ä¸¤ä¸ªéƒ½æ˜¯ç”¨åˆ™3ã€ 4æ— é¡ºåºå…ˆåï¼‰ã€‚ addAll() public boolean addAll(Collection&lt;? extends E&gt; c) { // ä»¥sizeä¸ºæ’å…¥ä¸‹æ ‡ï¼Œæ’å…¥é›†åˆcä¸­æ‰€æœ‰å…ƒç´  return addAll(size, c); } public boolean addAll(int index, Collection&lt;? extends E&gt; c) { // åˆ¤æ–­å½“å‰çš„ç´¢å¼•æ˜¯å¦è¶Šç•Œï¼Œ è‹¥æ˜¯è¶Šç•Œï¼Œ checkPositionIndex(index); Object[] a = c.toArray(); int numNew = a.length; if (numNew == 0) return false; // pred: æ’å…¥ä½ç½®å¯¹åº”çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ // succ: æ’å…¥ä½ç½®å¯¹åº”çš„èŠ‚ç‚¹ // ä»¥ä¸‹ä¸ºåŒå‘é“¾è¡¨çš„æ’å…¥æ“ä½œéœ€è¦çš„é¢„å¤‡å·¥ä½œ Node&lt;E&gt; pred, succ; if (index == size) { // åœ¨é“¾è¡¨çš„å°¾éƒ¨æ’å…¥èŠ‚ç‚¹éœ€è¦çš„é¢„å¤‡å·¥ä½œ succ = null; pred = last; } else { // åœ¨é“¾è¡¨ä¸­é—´æ’å…¥èŠ‚ç‚¹éœ€è¦çš„é¢„å¤‡å·¥ä½œ // 1. ç¡®å®šæ’å…¥ä½ç½®çš„èŠ‚ç‚¹ // 2. ç¡®å®šæ’å…¥ä½ç½®çš„èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ succ = node(index); pred = succ.prev; } // æ’å…¥èŠ‚ç‚¹ å¯ç”»å›¾ç†è§£ for (Object o : a) { @SuppressWarnings(\"unchecked\") E e = (E) o; Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null); if (pred == null) first = newNode; else pred.next = newNode; pred = newNode; } if (succ == null) { last = pred; } else { pred.next = succ; succ.prev = pred; } size += numNew; modCount++; return true; } addAll()ä¸»è¦ä¸ºå°±æ˜¯ä¾æ¬¡çš„éå†å·²æœ‰é›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼Œç„¶åä¾æ¬¡è¿›è¡Œæ’å…¥(å°¾æ’æ³•ï¼Œä¿è¯æ’å…¥çš„é¡ºåºä¸ä¼šå’Œæœ€åçš„é¡ºåºä¸å˜) åˆ¤æ–­è¶Šç•Œæ–¹æ³•private void checkPositionIndex(int index) { if (!isPositionIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } private boolean isPositionIndex(int index) { return index &gt;= 0 &amp;&amp; index &lt;= size; } ç›´æ¥åœ¨ifåè·‘å‡ºå¼‚å¸¸ï¼Œå¯ç›´æ¥è·‘å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®è‡ªå·±å®šä¹‰ä¿¡æ¯è·‘å‡ºå¼‚å¸¸ã€‚ add(E e)public boolean add(E e) { linkLast(e); return true; } void linkLast(E e) { // åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥å…ƒç´  final Node&lt;E&gt; l = last; // å®šä¹‰ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹l, æŒ‡å‘å°¾èŠ‚ç‚¹ï¼Œæ–¹ä¾¿åç»­æ’å…¥ final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);// åˆ›å»ºæ’å…¥å…ƒç´ çš„èŠ‚ç‚¹ // ä»¥ä¸‹ä¸ºæ’å…¥æ“ä½œï¼Œå¯ç”»å›¾ç†è§£ last = newNode; if (l == null) // è¯´æ˜åŸé“¾è¡¨ä¸ºç©ºï¼Œæ›´æ–°å¤´èŠ‚ç‚¹ first = newNode; else // åŸé“¾è¡¨ä¸ä¸ºç©ºï¼Œ åœ¨å°¾éƒ¨è¿›è¡Œæ’å…¥æ“ä½œ l.next = newNode; size++; modCount++; } add(int index, E element)public void add(int index, E element) { checkPositionIndex(index); // é“¾è¡¨å°¾éƒ¨æ’å…¥å…ƒç´  if (index == size) linkLast(element); // åœ¨é“¾è¡¨çš„ä¸­é—´éƒ¨åˆ†æ’å…¥å…ƒç´  else linkBefore(element, node(index)); } void linkLast(E e) { // åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥å…ƒç´  final Node&lt;E&gt; l = last; // å®šä¹‰ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹l, æŒ‡å‘å°¾èŠ‚ç‚¹ï¼Œæ–¹ä¾¿åç»­æ’å…¥ final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);// åˆ›å»ºæ’å…¥å…ƒç´ çš„èŠ‚ç‚¹ // ä»¥ä¸‹ä¸ºæ’å…¥æ“ä½œï¼Œå¯ç”»å›¾ç†è§£ last = newNode; if (l == null) // è¯´æ˜åŸé“¾è¡¨ä¸ºç©ºï¼Œæ›´æ–°å¤´èŠ‚ç‚¹ first = newNode; else // åŸé“¾è¡¨ä¸ä¸ºç©ºï¼Œ åœ¨å°¾éƒ¨è¿›è¡Œæ’å…¥æ“ä½œ l.next = newNode; size++; modCount++; } void linkBefore(E e, Node&lt;E&gt; succ) { // assert succ != null; final Node&lt;E&gt; pred = succ.prev; final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ); // ä¸€ä¸‹ä¸ºåŒç«¯é“¾è¡¨çš„æ’å…¥æ“ä½œ succ.prev = newNode; // è‹¥æ˜¯åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å‰æ’å…¥ï¼Œ åˆ™æ’å…¥èŠ‚ç‚¹ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if (pred == null) first = newNode; else pred.next = newNode; size++; modCount++; } Node&lt;E&gt; node(int index) { // assert isElementIndex(index); // æ ¹æ®ç´¢å¼•åˆ›å»ºèŠ‚ç‚¹ // æ­¤å¤„ä¼šæœ‰åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯åœ¨é“¾è¡¨çš„å‰åŠæ®µè¿˜æ˜¯ååŠæ®µ // åŠ å¿«æŸ¥æ‰¾æ•ˆç‡ if (index &lt; (size &gt;&gt; 1)) { Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; } else { Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; } } å°ç»“ é“¾è¡¨æ‰¹é‡å¢åŠ ï¼Œæ˜¯é forå¾ªç¯éå†åŸæ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡Œæ’å…¥èŠ‚ç‚¹æ“ä½œã€‚å¯¹æ¯”ArrayListæ˜¯é€šè¿‡System.arraycopyå®Œæˆæ‰¹é‡å¢åŠ çš„ é€šè¿‡ä¸‹æ ‡è·å–æŸä¸ªnode çš„æ—¶å€™ï¼Œï¼ˆadd selectï¼‰ï¼Œä¼šæ ¹æ®indexå¤„äºå‰åŠæ®µè¿˜æ˜¯ååŠæ®µ è¿›è¡Œä¸€ä¸ªæŠ˜åŠï¼Œä»¥æå‡æŸ¥è¯¢æ•ˆç‡ åˆ ï¼š removeç›¸å…³çš„æ–¹æ³•remove() public E remove() { // é»˜è®¤æ˜¯ä»é“¾è¡¨çš„å¤´éƒ¨å¼€å§‹åˆ é™¤å…ƒç´  return removeFirst(); } public E removeFirst() { final Node&lt;E&gt; f = first; if (f == null) throw new NoSuchElementException(); return unlinkFirst(f); } private E unlinkFirst(Node&lt;E&gt; f) { // assert f == first &amp;&amp; f != null; // åˆ é™¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ final E element = f.item; final Node&lt;E&gt; next = f.next; // é˜²æ­¢åˆ é™¤æ—¶å¯¼è‡´çš„æ–­é“¾ f.item = null; f.next = null; // help GC first = next; if (next == null) last = null; else next.prev = null; size--; modCount++; return element; } remove(int index)ä¸‹å›¾ä¸ºåŒå‘é“¾è¡¨çš„åˆ é™¤æ“ä½œï¼Œä»…åšå‚è€ƒï¼Œå…·ä½“çš„å†™æ³•ä¾æ®ä¸ªäººé‡‡ç”¨åŸºç¡€èŠ‚ç‚¹ã€‚ mage public E remove(int index) { // åˆ¤æ–­æ˜¯å¦è¶Šç•Œ checkElementIndex(index); return unlink(node(index)); } private void checkElementIndex(int index) { if (!isElementIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } private boolean isElementIndex(int index) { return index &gt;= 0 &amp;&amp; index &lt; size; } E unlink(Node&lt;E&gt; x) { // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; // åç»§èŠ‚ç‚¹ final Node&lt;E&gt; prev = x.prev; // å‰é©±èŠ‚ç‚¹ // åˆ é™¤çš„ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if (prev == null) { first = next; } else { prev.next = next; x.prev = null; } // åˆ é™¤çš„ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ if (next == null) { last = prev; } else { next.prev = prev; x.next = null; } x.item = null; size--; modCount++; return element; } åˆ¤æ–­è¶Šç•Œæ–¹æ³•å…¶å®æ˜¯å’Œå¢é‡Œé¢çš„åˆ¤æ–­æ˜¯ä¸€æ ·çš„ private void checkElementIndex(int index) { if (!isElementIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } private boolean isElementIndex(int index) { return index &gt;= 0 &amp;&amp; index &lt; size; } remove(Object o)public boolean remove(Object o) { if (o == null) { for (Node&lt;E&gt; x = first; x != null; x = x.next) { if (x.item == null) { unlink(x); return true; } } } else { for (Node&lt;E&gt; x = first; x != null; x = x.next) { if (o.equals(x.item)) { unlink(x); return true; } } } return false; } E unlink(Node&lt;E&gt; x) { // assert x != null; final E element = x.item; final Node&lt;E&gt; next = x.next; // åç»§èŠ‚ç‚¹ final Node&lt;E&gt; prev = x.prev; // å‰é©±èŠ‚ç‚¹ // åˆ é™¤çš„ä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if (prev == null) { first = next; } else { prev.next = next; x.prev = null; } // åˆ é™¤çš„ä¸ºæœ€åä¸€ä¸ªèŠ‚ç‚¹ if (next == null) { last = prev; } else { next.prev = prev; x.next = null; } x.item = null; size--; modCount++; return element; } å°ç»“åˆ ä¹Ÿä¸€å®šä¼šä¿®æ”¹modCountã€‚ æŒ‰ä¸‹æ ‡åˆ ï¼Œä¹Ÿæ˜¯å…ˆæ ¹æ®indexæ‰¾åˆ°Nodeï¼Œç„¶åå»é“¾è¡¨ä¸Šunlinkæ‰è¿™ä¸ªNodeã€‚ æŒ‰å…ƒç´ åˆ ï¼Œä¼šå…ˆå»éå†é“¾è¡¨å¯»æ‰¾æ˜¯å¦æœ‰è¯¥Nodeï¼Œè€ƒè™‘åˆ°å…è®¸nullå€¼ï¼Œæ‰€ä»¥ä¼šéå†ä¸¤éï¼Œç„¶åå†å»unlinkå®ƒã€‚ æ”¹ï¼šset()ç›¸å…³çš„æ–¹æ³•set(int index, E element) public E set(int index, E element) { checkElementIndex(index); Node&lt;E&gt; x = node(index); E oldVal = x.item; x.item = element; return oldVal; //è¿”å›åŸå…ˆçš„å€¼ } private void checkElementIndex(int index) { if (!isElementIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } private boolean isElementIndex(int index) { return index &gt;= 0 &amp;&amp; index &lt; size; } Node&lt;E&gt; node(int index) { // assert isElementIndex(index); // æ ¹æ®ç´¢å¼•åˆ›å»ºèŠ‚ç‚¹ // æ­¤å¤„ä¼šæœ‰åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯åœ¨é“¾è¡¨çš„å‰åŠæ®µè¿˜æ˜¯ååŠæ®µ // åŠ å¿«æŸ¥æ‰¾æ•ˆç‡ if (index &lt; (size &gt;&gt; 1)) { Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; } else { Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; } } å°ç»“set()ä¹Ÿæ˜¯æ ¹æ®ç´¢å¼•å»å¯»æ‰¾å¯¹åº”Node()ï¼Œä¹‹åæ›¿æ¢ï¼Œä½†æ˜¯ä¸ä¼šä¿®æ”¹modCount æŸ¥ï¼š getç›¸å…³æ–¹æ³•get(int index)public E get(int index) { checkElementIndex(index); return node(index).item; } Node&lt;E&gt; node(int index) { // assert isElementIndex(index); if (index &lt; (size &gt;&gt; 1)) { Node&lt;E&gt; x = first; for (int i = 0; i &lt; index; i++) x = x.next; return x; } else { Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; } } åˆ¤æ–­è¶Šç•Œæ–¹æ³•å…¶å®æ˜¯å’Œå¢é‡Œé¢çš„åˆ¤æ–­æ˜¯ä¸€æ ·çš„ private void checkElementIndex(int index) { if (!isElementIndex(index)) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } private boolean isElementIndex(int index) { return index &gt;= 0 &amp;&amp; index &lt; size; } å°ç»“æŒ‰ç…§ç´¢å¼•æŸ¥æ‰¾å¯¹åº”çš„èŠ‚ç‚¹ï¼Œä¹‹å‰çš„å¢ã€åˆ ã€æ”¹éƒ½ç”¨åˆ°äº† æ€»ç»“LinkedListæ˜¯åŒå‘é“¾è¡¨ é“¾è¡¨çš„æ‰¹é‡æ·»åŠ (addAll())æ˜¯è½¬åŒ–ä¸ºæ•°ç»„ä¹‹åä½¿ç”¨for-eachè¿›è¡Œæ·»åŠ ï¼Œé»˜è®¤åœ¨é“¾è¡¨å°¾éƒ¨æ·»åŠ ï¼Œ ä¼šä¿®æ”¹modCount æ ¹æ®indexè·å–èŠ‚ç‚¹æ—¶ï¼Œä¼šæ ¹æ®indexå¤„äºååŠæ®µè¿˜æ˜¯å‰åŠæ®µè¿›è¡ŒæŸ¥æ‰¾ï¼Œæå‡æŸ¥æ‰¾é€Ÿç‡ æ‰€æœ‰çš„CRUDä¸­éƒ½æœ‰æ¶‰åŠæ ¹æ®indexå»å¯»æ‰¾èŠ‚ç‚¹ LinkedListä¸­è¿˜æœ‰å¾ˆå¤šçš„APIæ²¡æœ‰å†™ï¼Œåªæ˜¯ç®€å•çš„å†™äº†åŸºç¡€çš„CRUD reference JavaGuidâ€”-LinkedList é¢è¯•å¿…å¤‡ï¼šLinkedListæºç è§£è¯»(JDK8) ç‹é“è€ƒç ”æ•°æ®ç»“æ„â€”-é“¾è¡¨ä¸€ç«  è€ƒç ”çš„æ—¶å€™çœ‹çš„ï¼Œå„ç§èŠ±å¼æ’å…¥åˆ é™¤æ•´åˆéªšæ“ä½œã€‚ å¤§è¯æ•°æ®ç»“æ„","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"List","slug":"List","permalink":"https://winniekun.github.io/tags/List/"}]},{"title":"ArrayListæºç è§£è¯»","slug":"æºç /JDK/list/arrayList-analysis","date":"2020-02-10T01:49:19.000Z","updated":"2020-08-30T04:50:22.254Z","comments":true,"path":"arrayList-analysis/","link":"","permalink":"https://winniekun.github.io/arrayList-analysis/","excerpt":"ArrayList æºç è§£è¯»","text":"ArrayList æºç è§£è¯» ä¾èµ– ArrayListä¾èµ– å…³äºä¸ºä»€ä¹ˆArrayListå·²ç»ç»§æ‰¿äº†AbstractListè¿˜è¦å®ç°Listæ¥å£, å¯å‚è€ƒ Why does LinkedHashSet extend HashSet and implement Set StackOverflowè§£é‡Š å¯èƒ½è¿™æ ·å¢åŠ å¯è¯»æ€§å§, æ¥å£çš„ç¬¬äºŒä¸ªåŠŸèƒ½ä¸€æ · å­—æ®µ /** * Default initial capacity. * é»˜è®¤åˆå§‹åŒ–å®¹é‡ */ private static final int DEFAULT_CAPACITY = 10; /** * Shared empty array instance used for empty instances * ç©ºå®ä¾‹çš„å…±äº«æ•°ç»„å®ä¾‹ * è‹¥æ˜¯æ— å‚æ„é€ æ–¹æ³• ä½¿ç”¨ DEFAULTCAPACITY_EMPTY_ELEMENTDATA; * è‹¥æ˜¯å«å‚æ„é€ æ–¹æ³• ä½¿ç”¨ EMPTY_ELEMENTDATA */ private static final Object[] EMPTY_ELEMENTDATA = {}; /** * Shared empty array instance used for default sized empty instances. We * distinguish this from EMPTY_ELEMENTDATA to know how much to inflate when * first element is added. * */ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; /** * The array buffer into which the elements of the ArrayList are stored. * The capacity of the ArrayList is the length of this array buffer. Any * empty ArrayList with elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA * will be expanded to DEFAULT_CAPACITY when the first element is added. */ transient Object[] elementData; // non-private to simplify nested class access /** * The size of the ArrayList (the number of elements it contains). * * @serial */ private int size; /** * The maximum size of array to allocate. * Some VMs reserve some header words in an array. * Attempts to allocate larger arrays may result in * OutOfMemoryError: Requested array size exceeds VM limit * æŸäº› VM ä¿ç•™æ•°ç»„å¤´éƒ¨ç”¨äºå­˜å‚¨ä¸€äº› header words */ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; å¯ä»¥å‘ç°, elementData å’Œ size ä¸¤ä¸ªå˜é‡åœ¨ArrayListçš„è¿è¡Œä¸­ä¼šæœ‰å¾ˆå¤§çš„å˜åŠ¨, å¯ä»¥ä½¿ç”¨åå°„è¿›è¡Œè§‚å¯Ÿ æ„é€ å‡½æ•°ArrayList()/** * æ„é€ å‡½æ•°1: é»˜è®¤æ„é€ å‡½æ•°, * DEFAULTCAPACITY_EMPTY_ELEMENTDATA = 0, * åˆå§‹æ˜¯ä¸€ä¸ªç©ºæ•°ç»„, å½“æ·»åŠ ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™, æ‰©å……ä¸º10(å¦‚ä½•æ‰©å……ä¸º10, è¯¦è§ä¸‹è¿°) * åŸå› è¯¦è§ transient Object[] elementDataä¸Šçš„æ³¨é‡Š */ public ArrayList() { this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; } ä¹Ÿå°±æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰ç«‹åˆ»åˆå§‹åŒ–å®¹å™¨çš„å¤§å°ï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡è°ƒç”¨ add()æ–¹æ³•çš„æ—¶å€™ï¼Œæ‰è¿›è¡Œç¡®å®šã€‚ ArrayList(int initialCapacity)/** * æ„é€ å‡½æ•°2 å¸¦åˆå§‹å®¹é‡å‚æ•°çš„æ„é€ å‡½æ•°, (ç”¨æˆ·è‡ªå·±å®šä¹‰å®¹é‡) */ public ArrayList(int initialCapacity) { if (initialCapacity &gt; 0) { this.elementData = new Object[initialCapacity]; } else if (initialCapacity == 0) { this.elementData = EMPTY_ELEMENTDATA; } else { throw new IllegalArgumentException(\"Illegal Capacity: \"+ initialCapacity); } } åˆå§‹åŒ–å®¹é‡å¤§å°ä¸ºinitialCapactiy ArrayList(Collection&lt;? extends E&gt; c)/** * Constructs a list containing the elements of the specified * collection, in the order they are returned by the collection's * iterator. * * @param c the collection whose elements are to be placed into this list * @throws NullPointerException if the specified collection is null * æ„é€ åŒ…å«æŒ‡å®šcollectionå…ƒç´ çš„åˆ—è¡¨ è¿™äº›å…ƒç´ åˆ©ç”¨è¯¥é›†åˆçš„è¿­ä»£æŒ‰é¡ºåºè¿”å› * å¦‚æœæŒ‡å®šçš„é›†åˆä¸ºnull, æŠ›å‡º NullPointerException */ public ArrayList(Collection&lt;? extends E&gt; c) { elementData = c.toArray(); if ((size = elementData.length) != 0) { // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); } else { // replace with empty array. this.elementData = EMPTY_ELEMENTDATA; } } æ€»ç»“ å¸¸é‡EMPTY_ELEMENTDATAå’ŒDEFAULTCAPACITY_EMPTY_ELEMENTDATAæ˜¯ä¸ºäº†åˆå§‹åŒ–elementDataçš„ã€‚å¦‚æœä¸ºæ— å‚æ„é€ å‡½æ•°ï¼Œä½¿ç”¨DEFAULTCAPACITY_EMPTY_ELEMENTDATAï¼›å¦‚æœä¸ºå«å‚æ„é€ å‡½æ•°ï¼Œä½¿ç”¨EMPTY_ELEMENTDATA ä»¥æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºarraylistæ—¶, å®é™…ä¸Šåˆå§‹åŒ–çš„å€¼æ˜¯ä¸€ä¸ªç©ºæ•°ç»„. æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ æ‰©å®¹ä¸º10 å¦‚æœä½¿ç”¨Collectionå®ä¾‹åˆå§‹åŒ–, ä¸ä¸ºç©ºå°†è°ƒç”¨toArray()æ–¹æ³•åˆå§‹åŒ–elementData, ä¸ºç©ºæ—¶åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„EMPTY_ELEMENTDATA å¢add(E e)public boolean add(E e) { ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true; } åœ¨è°ƒç”¨ add()æ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆè°ƒç”¨ ensureCapacityInternal()æ–¹æ³•æ¥ç¡®å®šæ˜¯å¦è¿˜æœ‰å®¹é‡æ¥å®¹çº³æ–°çš„å€¼ã€‚sizeæ˜¯è¡¨ç¤ºæ•°ç»„çš„åˆå§‹å¤§å°ï¼Œé»˜è®¤ä¸º 0 ã€‚ ArrayList-addæ‰§è¡Œæ­¥éª¤ æŒ‰ç…§æµç¨‹èµ°ä¸€é: ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™: ç¬¬ä¸€æ­¥, å› ä¸ºè¿˜ä¸ºæ·»åŠ æˆåŠŸå…ƒç´ , size = 0 , size + 1 = 1 ç¬¬äºŒæ­¥, é¦–å…ˆæ‰§è¡Œç¬¬ä¸‰æ­¥, ä¼ å…¥ä¸¤ä¸ªå‚æ•°elementDataå’ŒminCapacity ç¬¬ä¸‰æ­¥, æ­¤æ—¶çš„elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAT, ç„¶å minCapaciy==1, è¿”å›DEFAULT_CAPACITY ç¬¬å››æ­¥, æ­¤æ—¶çš„minCapacity==10 , elementData.length = 0 æ‰€ä»¥æ‰§è¡Œifåˆ†æ”¯ ç¬¬äº”æ­¥, oldCapacity==0 ç»è®¡ç®—newCapacity==0 ç„¶ånewCapacity-minCapacity&lt;0, æ‰€ä»¥newCapacity==10 ä¹‹åè¿›è¡Œæ•°æ®çš„å¤åˆ¶ï¼Œè¿™æ—¶ï¼ŒelementDataçš„é•¿åº¦æ˜¯ 10.ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æˆåŠŸçš„æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚ ç¬¬äºŒæ¬¡è°ƒç”¨ ç¬¬ä¸€æ­¥, å› ä¸ºå·²ç»æ·»åŠ æˆåŠŸäº†ä¸€ä¸ªå…ƒç´ , size = 1 , size + 1 = 2 ç¬¬äºŒæ­¥, é¦–å…ˆæ‰§è¡Œç¬¬ä¸‰æ­¥, ä¼ å…¥ä¸¤ä¸ªå‚æ•°elementDataå’ŒminCapacity ç¬¬ä¸‰æ­¥, æ­¤æ—¶çš„elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATAT, ç„¶å minCapaciy==2, ä¸æ‰§è¡Œifåˆ†æ”¯, è¿”å› 2 ç¬¬å››æ­¥, æ­¤æ—¶çš„minCapacity==2 , elementData.length = 10 æ‰€ä»¥ä¸æ‰§è¡Œæ‰§è¡Œifåˆ†æ”¯, ä¹Ÿå°±æ˜¯æ— éœ€æ‰©å®¹ åå¤æ·»åŠ ç›´åˆ°æ·»åŠ ç¬¬11ä¸ªå…ƒç´ çš„æ—¶å€™, å†æ¬¡å‡ºå‘ç¬¬å››æ­¥çš„grow, è¿›è¡Œæ‰©å®¹, æ‰©ä¸ºåŸå…ˆçš„1.5å€. add(int index, E element)public void add(int index, E element) { rangeCheckForAdd(index); ensureCapacityInternal(size + 1); // Increments modCount!! System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++; } ä½¿ç”¨arraycopyæ–¹æ³•, å¯ä»¥çœ‹åšå°†æŒ‡å®šåæ ‡ä½ç½®ä»¥åŠå³ä¾§æ‰€æœ‰å…ƒç´ å‘åç§»åŠ¨ä¸€ä½ï¼Œè…¾å‡ºç©ºé—´å­˜æ”¾æ–°å…ƒç´ ã€‚ addAll(Collection&lt;? extends E&gt; c)public boolean addAll(Collection&lt;? extends E&gt; c) { Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount System.arraycopy(a, 0, elementData, size, numNew); size += numNew; return numNew != 0; } addAll(int index, Collection&lt;? extends E&gt; c)public boolean addAll(int index, Collection&lt;? extends E&gt; c) { rangeCheckForAdd(index); Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount int numMoved = size - index; if (numMoved &gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved); System.arraycopy(a, 0, elementData, index, numNew); size += numNew; return numNew != 0; } æ€»ç»“ å…±å®ç°å››ä¸­æ·»åŠ æ–¹æ³•: æ·»åŠ å•ä¸ªå…ƒç´ (é»˜è®¤åœ¨å°¾éƒ¨æ·»åŠ ) åœ¨æŒ‡å®šä½ç½®æ·»åŠ å•ä¸ªå…ƒç´  æ·»åŠ ä¸€ä¸ªé›†åˆ(é»˜è®¤åœ¨æœ«å°¾) åœ¨æŒ‡å®šä½ç½®æ·»åŠ ä¸€ä¸ªé›†åˆ æ¯æ¬¡æ‰§è¡Œaddæ“ä½œæ—¶éƒ½ä¼šé¦–å…ˆè°ƒç”¨ ensureCapacityInternal()æ–¹æ³•æ¥ç¡®å®šæ˜¯å¦è¿˜æœ‰å®¹é‡æ¥å®¹çº³æ–°çš„å€¼, è‹¥æ˜¯æ²¡æœ‰åˆ™è¿›è¡Œæ‰©å®¹, æœ‰åˆ™ç›´æ¥æ·»åŠ  åˆ remove()æ–¹æ³•ç”¨æ¥ä»é›†åˆä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥åˆ é™¤æŒ‡å®šç´¢å¼•å‡ºçš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…ƒç´ ã€‚ remove(Object o)public boolean remove(Object o) { if (o == null) { for (int index = 0; index &lt; size; index++) if (elementData[index] == null) { fastRemove(index); return true; } } else { for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) { fastRemove(index); return true; } } return false; } // å°†indexä½ç½®åçš„æ‰€æœ‰å…ƒç´ å‰ç§»ä¸€ä½, ä¹‹åsize-1 private void fastRemove(int index) { modCount++; int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work } æµç¨‹èµ°ä¸€é ArrayList&lt;String&gt; arrayList = new ArrayList&lt;&gt;(); arrayList.add(\"a\"); arrayList.add(\"b\"); arrayList.add(\"c\"); arrayList.remove(\"a\"); è¦åˆ é™¤aè¿™ä¸ªå…ƒç´ ï¼ŒæŠŠ aä¼ å…¥åˆ° remove()è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆè¿›è¡Œåˆ¤æ–­æ˜¯å¦ä¸ºnullï¼Œå› ä¸º ArrayListå¯ä»¥å­˜æ”¾ nullï¼Œå¦‚æœä¸º null åˆ™ç”¨==åˆ¤æ–­å…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œå¦åˆ™ç”¨ equals()æ–¹æ³•è¿›è¡Œåˆ¤æ–­ã€‚ ç„¶åå¾ªç¯éå† elementDataè¿™ä¸ªæ•°ç»„ï¼Œsizeä¸ºæ•°ç»„å…ƒç´ ä¸ªæ•°ï¼Œæ‰¾åˆ°å’Œ aç›¸ç­‰çš„å…ƒç´ çš„ç´¢å¼•ï¼Œä¾‹å­ä¸­ index = 0ï¼Œ ç„¶åæŠŠ 0 ä¼ å…¥åˆ° fastRemove()æ–¹æ³•ä¸­ï¼Œä¹‹åè®¡ç®—è¦ç§»åŠ¨çš„å…ƒç´ çš„ä¸ªæ•°ï¼š int numMoved = size - index -1; ä¾‹å­ä¸­ numMoved = 3 - 0 -1 = 2ï¼Œä¹Ÿå°±æ˜¯ä¸€å…±è¦ç§»åŠ¨ä¸¤ä¸ªå…ƒç´ ï¼Œç„¶åæŠŠ aä¹‹åçš„ä¸¤ä¸ªå…ƒç´ å¾€å‰ç§»åŠ¨ï¼Œç„¶åè¿›è¡Œ size-1ï¼ŒæŠŠæœ€åä¸€ä¸ªå…ƒç´ ä½ç½®çš„å€¼è®¾ç½®ä¸º nullã€‚ è¿™æ ·å³å¯åœ¨ArrayListä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚ remove(int index)public E remove(int index) { rangeCheck(index); modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; if (numMoved &gt; 0) System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // clear to let GC do its work return oldValue; } æ€»ç»“æ²¡å•¥å¥½æ€»ç»“çš„ æŸ¥public E get(int index) { // åˆ¤æ–­æŸ¥è¯¢çš„ä½ç½®æ˜¯å¦ç¬¦åˆè¦æ±‚ rangeCheck(index); return elementData(index); } private void rangeCheck(int index) { if (index &gt;= size) throw new IndexOutOfBoundsException(outOfBoundsMsg(index)); } E elementData(int index) { return (E) elementData[index]; } æ²¡å•¥å¥½è¯´çš„, å°±æ˜¯æ­£å¸¸æ•°æ®çš„ä½¿ç”¨ é™„åŠ hugeCapacity æ–¹æ³• private static int hugeCapacity(int minCapacity) { if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; } åªæœ‰newCapacity &gt;MAX_ARRAY_SIZE æ‰å›è°ƒç”¨è¯¥æ–¹æ³•, æ–¹æ³•ä¸­ä½¿ç”¨ä¸‰å…ƒè¿ç®—, æ„æ€æ˜¯è‹¥æœminCapacity&gt; MAX_ARRAY_SIZE åˆ™newCapacityçš„å®¹é‡å¤§å°ä¸ºInteger.MAX_VALUEä¹Ÿå°±æ˜¯2**31æ¬¡æ–¹, è‹¥æ˜¯minCapacity&lt; MAX_ARRAY_SIZE åˆ™newCapacityçš„å®¹é‡å¤§å°ä¸ºInteger.MAX_VALUE-8 ensureCapacityç”¨æ³•Arraylistæºç ä¸­æœ‰ä¸€ä¸ªensureCapacityæ–¹æ³• /*** * å¦‚æœ‰å¿…è¦ï¼Œå¢åŠ æ­¤ ArrayList å®ä¾‹çš„å®¹é‡ï¼Œ * ä»¥ç¡®ä¿å®ƒè‡³å°‘å¯ä»¥å®¹çº³ç”±minimum capacityå‚æ•°æŒ‡å®šçš„å…ƒç´ æ•°ã€‚ */ public void ensureCapacity(int minCapacity) { int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) // any size if not default element table ? 0 // larger than default for default empty table. It's already // supposed to be at default size. : DEFAULT_CAPACITY; if (minCapacity &gt; minExpand) { ensureExplicitCapacity(minCapacity); } } è¯¥æ–¹æ³•é€‚ç”¨äºæ·»åŠ å¤§é‡çš„å…ƒç´ , ä»¥å‡å°‘ä¸Šæ–‡çš„å¢é‡é‡æ–°åˆ†é…çš„æ¬¡æ•° ArrayList&lt;Object&gt; list = new ArrayList&lt;&gt;(); final int N = 10000000; long startTime = System.currentTimeMillis(); for (int i = 0; i &lt; N; i++) { list.add(i); } long endTime = System.currentTimeMillis(); System.out.println(\"ä½¿ç”¨ensureCapaticyæ–¹æ³•ä¹‹å‰: \"+ (endTime - startTime)); list = new ArrayList&lt;&gt;(); list.ensureCapacity(N); startTime = System.currentTimeMillis(); for (int i = 0; i &lt; N; i++) { list.add(i); } endTime = System.currentTimeMillis(); System.out.println(\"ä½¿ç”¨ensureCapaticyæ–¹æ³•ä¹‹å: \"+ (endTime -startTime)); ä½¿ç”¨ensureCapaticyæ–¹æ³•ä¹‹å‰: 3345 ä½¿ç”¨ensureCapaticyæ–¹æ³•ä¹‹å: 257 æ€»ç»“ArrayListé›†åˆåº•å±‚æ˜¯ç”¨ä¸€ä¸ª Object æ•°ç»„æ¥å­˜æ”¾å…ƒç´ çš„ï¼Œå…¶å¯ä»¥å­˜æ”¾ null å€¼ï¼Œå› ä¸ºæ˜¯ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾å…ƒç´ ï¼Œæ‰€ä»¥åœ¨çŸ¥é“ç´¢å¼•çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå…ƒç´ çš„æŸ¥æ‰¾æ˜¯å¾ˆå¿«çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå¦‚æœæ•°ç»„çš„å®¹é‡ä¸èƒ½å¤Ÿå­˜æ”¾æ–°å…ƒç´ çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ•°ç»„çš„æ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°ç»„å…ƒç´ å¤åˆ¶åˆ°ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„ä¸­ï¼Œæ‰€ä»¥å¦‚æœåœ¨ç»å¸¸è¿›è¡Œå…ƒç´ æ·»åŠ å’Œåˆ é™¤æ“ä½œçš„æƒ…å†µä¸‹æ•ˆç‡ä¼šæ¯”è¾ƒä½ã€‚è¿˜æœ‰ä¸€ç‚¹ï¼ŒArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ Vectorä»£æ›¿ã€‚ System.arraycopy(src, srcPos, dest, destPos, length) ä¸ Arrays.copyOf(original, newLength)åŒºåˆ«arraycopy()çš„å‚æ•° src:æºæ•°ç»„; srcPos:æºæ•°ç»„è¦å¤åˆ¶çš„èµ·å§‹ä½ç½®; dest:ç›®çš„æ•°ç»„; destPos:ç›®çš„æ•°ç»„æ”¾ç½®çš„èµ·å§‹ä½ç½®; length:å¤åˆ¶çš„é•¿åº¦. ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼ŒArrays.copyOf()ä¸ä»…ä»…åªæ˜¯æ‹·è´æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œåœ¨æ‹·è´å…ƒç´ æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ã€‚è€ŒSystem.arrayCopyåªæ‹·è´å·²ç»å­˜åœ¨æ•°ç»„å…ƒç´ , æ˜¯å¦åˆ›å»ºæ–°çš„æ•°æ®å¯¹è±¡,æ ¹æ®å†™æ³•è€Œå®š //System.arraycopy,åªæ‹·è´å·²å­˜åœ¨çš„æ•°ç»„å…ƒç´  int[] src = {0, 1, 2}; int[] dest = new int[3]; System.arraycopy(src, 0, dest, 0, src.length); System.out.println(Arrays.toString(dest)); //[0, 1, 2] //Arrays.copyOf,ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ int[] src = {0, 1, 2}; int[] dest = Arrays.copyOf(src, src.length); System.out.println(Arrays.toString(dest)); //[0, 1, 2] å®é™…ä¸ŠArrays.copyOfæ–¹æ³•çš„å†…éƒ¨å®ç°ä¹Ÿæ˜¯é€šè¿‡System.arraycopyæ–¹æ³•å®ç°ï¼Œåœ¨Arraysç±»ä¸­æœ‰å¤šä¸ªcopyOfçš„é‡è½½æ–¹æ³•ï¼Œç°ä»¥æ‹·è´int[]ä¸ºä¾‹ï¼š 1 public static int[] copyOf(int[] original, int newLength) { 2 int[] copy = new int[newLength]; 3 System.arraycopy(original, 0, copy, 0, Math.min(original.length, newLength)); 4 return copy; 5 } References ArrayListæºç  ArrayListæºç åˆ†æ","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"List","slug":"List","permalink":"https://winniekun.github.io/tags/List/"}]},{"title":"Volatileå…³é”®å­—å†…æ¶µ","slug":"Javaè¿›é˜¶/å¹¶å‘/Volatileå…³é”®å­—å†…æ¶µ","date":"2020-01-18T04:35:26.000Z","updated":"2021-05-31T15:43:04.259Z","comments":true,"path":"Volatileå…³é”®å­—å†…æ¶µ/","link":"","permalink":"https://winniekun.github.io/Volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%86%85%E6%B6%B5/","excerpt":"å†…æ¶µä¸è¡¨è±¡","text":"å†…æ¶µä¸è¡¨è±¡ volatileä¸»è¦æœ‰ä¸€ä¸‹çš„åŠŸèƒ½ï¼š ä¿è¯å˜é‡çš„å†…å­˜å¯è§æ€§ å†…å­˜å¯è§æ€§ï¼šé€šä¿—æ¥è¯´å°±æ˜¯ï¼Œçº¿ç¨‹Aå¯¹ä¸€ä¸ªvolatileå˜é‡çš„ä¿®æ”¹ï¼Œå¯¹äºå…¶å®ƒçº¿ç¨‹æ¥è¯´æ˜¯å¯è§çš„ï¼Œå³çº¿ç¨‹æ¯æ¬¡è·å–volatileå˜é‡çš„å€¼éƒ½æ˜¯æœ€æ–°çš„ ç¦æ­¢volatileå˜é‡ä¸æ™®é€šå˜é‡é‡æ’åº å®šä¹‰: Volatileæ˜¯è½»é‡çº§çš„synchronizedã€‚å®ƒåœ¨å¤šå¤„ç†å™¨å¼€å‘è¿‡ç¨‹ä¸­ä¿è¯çš„å…±äº«å˜é‡çš„å¯è§æ€§ã€æœ‰åºæ€§ ä½¿ç”¨volatileçš„ä½¿ç”¨åœºæ™¯ä½†æ˜¯ä½¿ç”¨volatileå¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–å½“å‰å€¼ï¼Œå¦‚å¤šçº¿ç¨‹ä¸‹æ‰§è¡Œa++ï¼Œæ˜¯æ— æ³•é€šè¿‡volatileä¿è¯ç»“æœå‡†ç¡®æ€§çš„ è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶å®ƒå˜é‡çš„ä¸å˜å¼ä¸­(å¦‚ä¸‹ä¾‹å­è§£é‡Š) public class NumberRange { private volatile int lower = 0; private volatile int upper = 10; public int getLower() { return lower; } public int getUpper() { return upper; } public void setLower(int value) { if (value &gt; upper) throw new IllegalArgumentException(...); lower = value; } public void setUpper(int value) { if (value &lt; lower) throw new IllegalArgumentException(...); upper = value; } } è‹¥æ˜¯æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åˆ†åˆ«æ‰§è¡Œäº†setLower(8)å’ŒsetUpper(5) ç„¶å å‡é€šè¿‡äº†åˆ¤æ–­, åˆ™æœ€åçš„èŒƒå›´ä»$[0, 10]$ å˜ä¸ºäº† $[8, 5]$æˆä¸ºäº†ä¸€ä¸ªæ— æ•ˆçš„èŒƒå›´, è¿™æ ·å°±å‡ºç°äº†é—®é¢˜. è¿™ç§åœºæ™¯ä¸‹å°±åªèƒ½ä½¿ç”¨synchronized, åŒä¸€æ—¶é—´åªå…è®¸getLowerå’ŒgetUpperæ–¹æ³•ä¸­å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œ çŠ¶æ€æ ‡è®°é‡public class ServerHandler { private volatile isopen; public void run() { if (isopen) { //ä¿ƒé”€é€»è¾‘ } else { //æ­£å¸¸é€»è¾‘ } } public void setIsopen(boolean isopen) { this.isopen = isopen } } å•ä¾‹æ¨¡å¼çš„double checkå•ä¾‹æ¨¡å¼çš„ä¸€ç§å®ç°æ–¹å¼ï¼Œä½†å¾ˆå¤šäººä¼šå¿½ç•¥volatileå…³é”®å­—ï¼Œå› ä¸ºæ²¡æœ‰è¯¥å…³é”®å­—ï¼Œç¨‹åºä¹Ÿå¯ä»¥å¾ˆå¥½çš„è¿è¡Œï¼Œåªä¸è¿‡ä»£ç çš„ç¨³å®šæ€§æ€»ä¸æ˜¯100%ï¼Œè¯´ä¸å®šåœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»ï¼Œéšè—çš„bugå°±å‡ºæ¥äº†ã€‚ public class Singleton{ private volatile static Singleton instance; public static Singleton getInstance(){ if(instance == null){ sychronized(Singleton.class){ if(instance == null){ instance = new Singleton(); } } } return instance; } } åœ¨JMMä¸­, æœ‰ä¸»å†…å­˜å’Œæœ¬åœ°å†…å­˜, æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªæœ¬åœ°å†…å­˜, ä¸”å…±äº«ä¸»å†…å­˜ä¸­çš„æ•°æ®, æ™®é€šå˜é‡å’Œvolatileå˜é‡çš„åŒºåˆ«å¦‚ä¸‹: æ™®é€šå˜é‡è¿›è¡Œè¯»æ“ä½œçš„æ—¶å€™, é¦–å…ˆä¼šè¯»å–æœ¬åœ°å†…å­˜ä¸­çš„æ•°æ®, è‹¥æ˜¯ä¸å­˜åœ¨, åˆ™å»ä¸»å†…å­˜ä¸­æ‹·è´ä¸€ä»½åœ¨æœ¬åœ°å†…å­˜, å†™æ“ä½œåªä¼šå†™å…¥åˆ°æœ¬åœ°å†…å­˜. è¿™æ ·å…¶ä»–å˜é‡å°±ä¸ä¼šè¯»å–å˜é‡çš„æœ€æ–°å€¼ voaltileéå†è¿›è¡Œè¯»æ“ä½œçš„æ—¶å€™, JMMä¼šå°†æœ¬åœ°å†…å­˜çš„æ•°æ®è®¾ç½®ä¸ºæ— æ•ˆ, è¦æ±‚çº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–æ•°æ®, å†™æ“ä½œæ—¶, JMMä¼šå°†å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­. è¿™æ ·å…¶ä»–éå†å°±èƒ½å¤Ÿè¯»å–å˜é‡çš„æœ€æ–°å€¼ å¯è§æ€§ã€æœ‰åºæ€§å®ç°åŸç†å¯è§æ€§ï¼š volatileä¿®é¥°çš„å˜é‡è¿›è¡Œå†™æ“ä½œè½¬æ¢æˆæ±‡ç¼–è¯­è¨€ï¼Œä¼šæ·»åŠ Lockå‰ç¼€çš„æŒ‡ä»¤ lockå‰ç¼€çš„æŒ‡ä»¤åœ¨å¤šæ ¸å¤„ç†å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šå¼•å‘ä»¥ä¸‹çš„ä¸¤ä¸ªäº‹æƒ…ï¼š ä¼šå°†å½“å‰å¤„ç†å™¨ç¼“å­˜çš„æ•°æ®ï¼Œå†™å›ä¸»å†…å­˜ åŒæ—¶å†™å›å†…å­˜çš„æ“ä½œï¼Œä¼šä½¿å¾—å…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆ å¤šå¤„ç†å™¨ä¸‹ï¼Œä¸ºäº†ç¡®ä¿å¤šå¤„ç†å™¨çš„ç¼“å­˜æ˜¯ä¸€è‡´çš„ï¼Œä¼šå»å®ç°ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªå¤„ç†å™¨é€šè¿‡å—…æ¢åœ¨æ€»çº¿ä¸Šä¼ æ’­çš„æ•°æ®æ¥æ£€æµ‹è‡ªå·±ç¼“å­˜çš„æ•°æ®æ˜¯å¦è¿‡æœŸã€‚å¦‚æœå‘ç°ç¼“å­˜çš„å†…å­˜åœ°å€è¢«ä¿®æ”¹ï¼Œä¼šå°†è‡ªèº«ç¼“å­˜çš„å†…å­˜åœ°å€ç½®ä¸ºæ— æ•ˆï¼Œç„¶åä¸‹æ¬¡æ“ä½œè¯¥æ•°æ®çš„æ—¶å€™ï¼Œé‡æ–°ä»ä¸»å­˜ä¸­å°†æ•°æ®é‡æ–°è¯»å–ç¼“å­˜ æœ‰åºæ€§ç¦æ­¢é‡æ’åºJVMé€šè¿‡å†…å­˜å±éšœæ¥å®ç°é™åˆ¶å¤„ç†å™¨çš„é‡æ’åºã€‚ ä»€ä¹ˆæ˜¯å†…å­˜å±éšœï¼Ÿç¡¬ä»¶å±‚é¢ï¼Œå†…å­˜å±éšœåˆ†ä¸¤ç§ï¼šè¯»å±éšœï¼ˆLoad Barrierï¼‰å’Œå†™å±éšœï¼ˆStore Barrierï¼‰ã€‚å†…å­˜å±éšœæœ‰ä¸¤ä¸ªä½œç”¨ï¼š é˜»æ­¢å±éšœä¸¤ä¾§çš„æŒ‡ä»¤é‡æ’åºï¼› å¼ºåˆ¶æŠŠå†™ç¼“å†²åŒº/é«˜é€Ÿç¼“å­˜ä¸­çš„è„æ•°æ®ç­‰å†™å›ä¸»å†…å­˜ï¼Œæˆ–è€…è®©ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å¤±æ•ˆã€‚ ç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚ç¼–è¯‘å™¨é€‰æ‹©äº†ä¸€ä¸ªæ¯”è¾ƒä¿å®ˆçš„JMMå†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼Œè¿™æ ·å¯ä»¥ä¿è¯åœ¨ä»»ä½•å¤„ç†å™¨å¹³å°ï¼Œä»»ä½•ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„volatileå†…å­˜è¯­ä¹‰ã€‚è¿™ä¸ªç­–ç•¥æ˜¯ï¼š åœ¨æ¯ä¸ªvolatileå†™æ“ä½œå‰æ’å…¥ä¸€ä¸ªStoreStoreå±éšœï¼› åœ¨æ¯ä¸ªvolatileå†™æ“ä½œåæ’å…¥ä¸€ä¸ªStoreLoadå±éšœï¼› åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œåæ’å…¥ä¸€ä¸ªLoadLoadå±éšœï¼› åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œåå†æ’å…¥ä¸€ä¸ªLoadStoreå±éšœã€‚ å¤§æ¦‚ç¤ºæ„å›¾æ˜¯è¿™ä¸ªæ ·å­ï¼š å†…å­˜å±éšœ å†ä»‹ç»ä¸€ä¸‹volatileä¸æ™®é€šå˜é‡çš„é‡æ’åºè§„åˆ™: å¦‚æœç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileè¯»ï¼Œé‚£æ— è®ºç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºï¼› å¦‚æœç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œé‚£æ— è®ºç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºï¼› å¦‚æœç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»ï¼Œé‚£ä¸èƒ½é‡æ’åºã€‚ References Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ æ·±å…¥æµ…å‡ºJavaå¤šçº¿ç¨‹","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"Synchronizeå…³é”®å­—å†…æ¶µ","slug":"Javaè¿›é˜¶/å¹¶å‘/Synchronizeå…³é”®å­—å†…æ¶µ","date":"2020-01-18T04:35:12.000Z","updated":"2021-06-05T08:52:56.318Z","comments":true,"path":"Synchronizeå…³é”®å­—å†…æ¶µ/","link":"","permalink":"https://winniekun.github.io/Synchronize%E5%85%B3%E9%94%AE%E5%AD%97%E5%86%85%E6%B6%B5/","excerpt":"å†…æ¶µä¸è¡¨è±¡","text":"å†…æ¶µä¸è¡¨è±¡ synchronizedå…³é”®å­—çš„è§£é‡Šå¦‚ä¸‹ï¼š Javaè¯­è¨€çš„å…³é”®å­—ï¼Œå½“å®ƒç”¨æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªä»£ç å—çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ®µä»£ç ã€‚ æ ¹æ®å®šä¹‰ï¼Œä¼šè€ƒè™‘ä¸¤ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š synchronizedæ˜¯å¦‚ä½•ä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ®µä»£ç  ä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ®µä»£ç ï¼Œè¿™åˆå¸¦æ¥ä»€ä¹ˆæ„ä¹‰ è€å¸æœºçº§åˆ«çš„è§£é‡Šï¼š Javaä¸­çš„synchronizedï¼Œé€šè¿‡ä½¿ç”¨å†…ç½®é”ï¼Œæ¥å®ç°å¯¹å…±äº«å˜é‡çš„åŒæ­¥æ“ä½œï¼Œè¿›è€Œè§£å†³äº†å¯¹å…±äº«å˜é‡æ“ä½œçš„åŸå­æ€§ã€ä¿è¯äº†å…¶ä»–çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å¯è§æ€§ã€æœ‰åºæ€§ï¼Œä»è€Œç¡®ä¿äº†å¹¶å‘æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚ åŸå­æ€§synchronizedå…³é”®å­—çš„ä¸€ä¸ªä½œç”¨å°±æ˜¯ç¡®ä¿äº†åŸå­æ€§ã€‚ è­¬å¦‚ä½¿ç”¨count++è€Œè¨€ï¼ŒåŸå…ˆå…¶æ‰§è¡Œéœ€è¦ä¸‰ä¸ªæ­¥éª¤ï¼š è¯»å–countå€¼ count+1 å†™å…¥count å€¼ å…¶åŒ…å«äº†ä¸‰ä¸ªæ­¥éª¤ï¼Œä¸”æ¯æ¬¡çš„æ­¥éª¤éƒ½ä¾èµ–äºä¸Šä¸€æ¬¡çš„ç»“æœã€‚æ‰€ä»¥ä¸æ˜¯åŸå­æ€§çš„ synchronized(this){ count++; } ä½¿ç”¨å¦‚ä¸Šçš„æ–¹å¼ï¼Œå°±ç¡®ä¿äº†åŸå­æ€§ã€‚å› ä¸ºåŸå­æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨synchronizeæ¥å®ç°çº¿ç¨‹å®‰å…¨çš„åŸå› ã€‚ å¦‚ä½•å®ç°çš„åŸå­æ€§ï¼Ÿ å› ä¸ºsynchronizedè¢«ç¼–è¯‘ä¹‹åï¼Œä½¿ç”¨çš„æ˜¯monitorenterå’Œmonitroexitä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œè€Œè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤å®è´¨ä¸Šæ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿä¸­çš„äº’æ–¥é”ï¼ˆmutex lockï¼‰å®ç°ã€‚é€šè¿‡äº’æ–¥é”ï¼Œä¿è¯äº†åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¯¥å…±äº«å˜é‡ï¼Œæ‰€ä»¥ç¡®ä¿äº†åŸå­æ€§ å¯è§æ€§ã€æœ‰åºæ€§synchronizeçš„ç¡®ä¿åŸå­æ€§ï¼Œå…¶å®æ˜¯ä»ä½¿ç”¨synchronizeçš„çº¿ç¨‹çš„è§’åº¦æ¥è®²çš„ï¼Œè€Œå¦‚æœæˆ‘ä»¬ä»å…¶ä»–çº¿ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œé‚£ä¹ˆsynchronizeåˆ™æ˜¯å®ç°äº†å¯è§æ€§ã€æœ‰åºæ€§ã€‚ å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ æœ‰åºæ€§ï¼š Javaç¨‹åºä¸­çš„å¤©ç„¶æœ‰åºæ€§æ˜¯æŒ‡ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼Œå¦‚æœåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ å‰åŠå¥æ˜¯æŒ‡çº¿ç¨‹å†…è¡¨ç°ä¸ºä¸²è¡Œçš„è¯­ä¹‰ï¼ˆas-if-serialè§„åˆ™ï¼‰ ååŠå¥æ˜¯æŒ‡æŒ‡ä»¤é‡æ’å’Œå·¥ä½œå†…å­˜å’Œä¸»å†…å­˜åŒæ­¥å»¶è¿Ÿå¯¼è‡´çš„ç°è±¡ synchronziedå¦‚ä½•ä¿è¯å¯è§æ€§ï¼š JMMè§„å®šï¼šä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ã€‚ synchronziedå¦‚ä½•ä¿è¯æœ‰åºæ€§ï¼š é”è‡ªèº«çš„ä½œç”¨æ¥æˆ–è€…è¯´JMMçš„è§„å®šï¼šä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œ å†…ç½®é”åœ¨Javaä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€æŠŠé”ï¼Œæ”¾ç½®äºå¯¹è±¡å¤´ä¸­ï¼Œç”¨äºè®°å½•å½“å‰å¯¹è±¡è¢«å“ªä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚ç›¸å¯¹äºå®ä¾‹æ•°æ®ï¼Œå¯¹è±¡å¤´å±äºé¢å¤–å¼€é”€ï¼Œæ‰€ä»¥è¢«è®¾è®¡çš„æå°æ¥æé«˜æ•ˆç‡ã€‚å¯¹è±¡å¤´ä¸­çš„markwordæ›´åŠ ä½“ç°äº†è¿™ä¸€ç‚¹ï¼Œä¸”æ˜¯éç»“æ„åŒ–çš„ï¼Œè¿™æ ·åœ¨ä¸åŒçš„é”çŠ¶æ€ä¸‹ï¼Œèƒ½å¤Ÿå¤ç”¨ç›¸åŒçš„bitä½ï¼Œmarkwordä¸­å°±æœ‰å­˜å‚¨é”çš„ä¿¡æ¯çš„éƒ¨åˆ†ã€‚ markword æˆ‘ä»¬çŸ¥é“åœ¨Javaä¸­Synchronizedèƒ½å¤Ÿå®ç°çš„çº¿ç¨‹çš„åŒæ­¥ï¼Œsynchronizedè¢«ç¼–è¯‘ä¹‹åä¼šç”Ÿæˆmonirotenterå’Œmonitorexitä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œä¾èµ–è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤å®ç°çº¿ç¨‹åŒæ­¥ã€‚ Monirtorï¼šå¯ä»¥ç†è§£ä¸ºåªèƒ½å®¹çº³ä¸€åå®¢äººçš„æˆ¿é—´ï¼Œè€Œçº¿ç¨‹å¯ä»¥ç­‰æ¯”äºå®¢äººã€‚æ•´ä¸ªçŠ¶æ€çš„æµè½¬å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„äºActiveçŠ¶æ€ã€‚ monitor Every object has an intrinsic lock associated with it. â€”â€” The Javaâ„¢ Tutorials æ™®é€šåŒæ­¥æ–¹æ³• é”çš„æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ é™æ€åŒæ­¥æ–¹æ³• é”çš„æ˜¯è¯¥ç±»çš„Classå¯¹è±¡ åŒæ­¥ä»£ç å—å„¿ é”çš„æ˜¯æ‹¬å·å†…çš„å¯¹è±¡ å› ä¸ºsynchronizedè¢«ç¼–è¯‘ä¹‹åï¼Œä½¿ç”¨çš„æ˜¯monitorenterå’Œmonitroexitä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œè€Œè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤å®è´¨ä¸Šæ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿä¸­çš„äº’æ–¥é”ï¼ˆmutex lockï¼‰å®ç°ï¼ŒåŒæ—¶Javaçº¿ç¨‹å¯ä»¥ç†è§£ä¸ºå¯¹æ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹çš„æ˜ å°„ï¼Œæ‰€ä»¥æ¯å½“æŒ‚èµ·/å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ€å†…å®¹çš„åˆ‡æ¢ã€‚å±äºé‡é‡çº§æ“ä½œï¼Œç”šè‡³æ˜¯æœ‰å¯èƒ½åˆ‡æ¢çš„æ—¶é—´è¿œè¿œè¶…è¿‡äºçº¿ç¨‹æœ¬èº«çš„è¿è¡Œæ—¶é—´ã€‚ä½†æ˜¯ä»Java6å¼€å§‹ï¼Œå¼•å…¥äº†åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”çš„é”ä¼˜åŒ–è¿‡ç¨‹ï¼Œè¿›è€Œä¼˜åŒ–äº†å…¶æ€§èƒ½ã€‚ æ— é”å®šä¹‰ï¼šä¸é”ä½èµ„æºï¼Œå¤šä¸ªçº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªèƒ½ä¿®æ”¹èµ„æºæˆåŠŸï¼Œå…¶ä»–çº¿ç¨‹ä¼šé‡è¯•ï¼Œé€šè¿‡CASå®ç° åå‘é”å®šä¹‰ï¼šåå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚ ä¾æ®ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚==åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚==å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚ ==åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚== åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡é”å®šä¹‰ï¼š å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ è™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚ å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚ å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é” é‡é‡é”äº’æ–¥é” å¯é‡å…¥ï¼špublic class Widget{ public synchronized void doSomething(){ ... } } public class LoggingWidget extends Widget { public synchronized void doSomething(){ sout(\"...\"); super.doSomething(); } } å¦‚æœæ²¡æœ‰å¯é‡å…¥æ€§ï¼Œé‚£ä¹ˆè¯¥ä»£ç ä¼šäº§ç”Ÿæ­»é”ã€‚ å¯é‡å…¥çš„å®šä¹‰ï¼š è‹¥ä¸€ä¸ªç¨‹åºæˆ–å­ç¨‹åºå¯ä»¥â€œåœ¨ä»»æ„æ—¶åˆ»è¢«ä¸­æ–­ç„¶åæ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼Œè¿™æ®µä»£ç åˆè°ƒç”¨äº†è¯¥å­ç¨‹åºä¸ä¼šå‡ºé”™â€ï¼Œåˆ™ç§°å…¶ä¸ºå¯é‡å…¥ï¼ˆreentrantæˆ–re-entrantï¼‰çš„ã€‚å³å½“è¯¥å­ç¨‹åºæ­£åœ¨è¿è¡Œæ—¶ï¼Œæ‰§è¡Œçº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥å¹¶æ‰§è¡Œå®ƒï¼Œä»ç„¶è·å¾—ç¬¦åˆè®¾è®¡æ—¶é¢„æœŸçš„ç»“æœã€‚ä¸å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹å®‰å…¨ä¸åŒï¼Œå¯é‡å…¥å¼ºè°ƒå¯¹å•ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é‡æ–°è¿›å…¥åŒä¸€ä¸ªå­ç¨‹åºä»ç„¶æ˜¯å®‰å…¨çš„ã€‚ â€”- ç»´åŸºç™¾ç§‘ ä»è®¾è®¡ä¸Šè®²ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚ä¸€ä¸ªç”±å…¶ä»–çº¿ç¨‹æŒæœ‰çš„å¯¹è±¡é”æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šé˜»å¡ã€‚å½“çº¿ç¨‹è¯·æ±‚è‡ªå·±æŒæœ‰çš„å¯¹è±¡é”æ—¶ï¼Œå¦‚æœè¯¥çº¿ç¨‹æ˜¯é‡å…¥é”ï¼Œè¯·æ±‚å°±ä¼šæˆåŠŸï¼Œå¦åˆ™é˜»å¡ã€‚ synchronizedæ‹¥æœ‰å¼ºåˆ¶åŸå­æ€§çš„å†…éƒ¨é”æœºåˆ¶ï¼Œæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚å› æ­¤ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨synchronizedæ–¹æ³•æ—¶è°ƒç”¨è¯¥å¯¹è±¡å¦ä¸€ä¸ªsynchronizedæ–¹æ³•æˆ–è°ƒç”¨çˆ¶ç±»çš„synchronizedæ–¹æ³•ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°ä¸€ä¸ªå¯¹è±¡é”åå†æ¬¡è¯·æ±‚è¯¥å¯¹è±¡é”ï¼Œæ˜¯æ°¸è¿œå¯ä»¥æ‹¿åˆ°é”çš„ã€‚ åœ¨Javaå†…éƒ¨ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è‡ªå·±ç±»ä¸­å…¶ä»–synchronizedæ–¹æ³•/å—æ—¶ä¸ä¼šé˜»ç¢è¯¥çº¿ç¨‹çš„æ‰§è¡Œï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå¯¹è±¡é”æ˜¯å¯é‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å–åŒä¸€æŠŠé”å¤šæ¬¡ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¤šæ¬¡é‡å…¥ã€‚åŸå› æ˜¯Javaä¸­çº¿ç¨‹è·å¾—å¯¹è±¡é”çš„æ“ä½œæ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½çš„ï¼Œè€Œä¸æ˜¯ä»¥è°ƒç”¨ä¸ºå•ä½çš„ã€‚ æ€»ç»“ Javaä¸­æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®é”ã€‚ synchronizedä½¿ç”¨å¯¹è±¡è‡ªå¸¦çš„å†…ç½®é”æ¥è¿›è¡ŒåŠ é”ï¼Œä»è€Œä¿è¯åœ¨åŒä¸€æ—¶åˆ»æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä»£ç ã€‚ æ‰€æœ‰çš„åŠ é”è¡Œä¸ºï¼Œéƒ½å¯ä»¥å¸¦æ¥ä¸‰ä¸ªä¸ªä¿éšœâ€”â€”åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚å…¶ä¸­ï¼ŒåŸå­æ€§æ˜¯ç›¸å¯¹é”æ‰€åœ¨çš„çº¿ç¨‹çš„è§’åº¦è€Œè¨€ï¼Œè€Œå¯è§æ€§ã€æœ‰åºæ€§åˆ™æ˜¯ç›¸å¯¹å…¶ä»–çº¿ç¨‹è€Œè¨€ã€‚ é”çš„æŒæœ‰è€…æ˜¯çº¿ç¨‹ï¼Œè€Œä¸æ˜¯è°ƒç”¨ï¼Œè¿™ä¹Ÿæ˜¯é”çš„ä¸ºä»€ä¹ˆæ˜¯å¯é‡å…¥çš„åŸå› ã€‚ References Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ æ·±å…¥æµ…å‡ºJavaå¤šçº¿ç¨‹ Javaå¤šçº¿ç¨‹ï¼šsynchronizedçš„å¯é‡å…¥æ€§","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"}]},{"title":"åœ¨IDEAä¸­æ­å»ºJDK1.8é˜…è¯»ç¯å¢ƒ","slug":"é…ç½®/åœ¨IDEAä¸­æ­å»ºJDK1-8é˜…è¯»ç¯å¢ƒ","date":"2020-01-15T12:27:15.000Z","updated":"2020-08-30T04:50:22.263Z","comments":true,"path":"åœ¨IDEAä¸­æ­å»ºJDK1-8é˜…è¯»ç¯å¢ƒ/","link":"","permalink":"https://winniekun.github.io/%E5%9C%A8IDEA%E4%B8%AD%E6%90%AD%E5%BB%BAJDK1-8%E9%98%85%E8%AF%BB%E7%8E%AF%E5%A2%83/","excerpt":"å‰è¨€è‡ªå·±ä»å»å¹´12æœˆä»½å¼€å§‹çœ‹JDKä¸Šçš„éƒ¨åˆ†æºç ï¼Œä¹‹å‰å› ä¸ºæ˜¯æ‡’ï¼Œè§‰å¾—çœ‹æºç å˜›ï¼Œçœ‹å˜›ï¼Œçªå‡ºçœ‹ã€‚ç›´æ¥å°±æ˜¯é˜…è¯»æºç ï¼Œç„¶åæ¯ä¸ªä»£ç é€»è¾‘éƒ½æ˜¯é è‡ªå·±æ¨æµ‹ï¼Œ è¿˜æœ‰ç†è§£ï¼Œ å¹¶æ²¡æœ‰çœ‹è¾“å‡ºï¼Œ ç°åœ¨æ‰å‘ç°åœ¨IDEAä¸­File | Settings | Build, Execution, Deployment | Debugger | Steppingä¸­å¯ä»¥å°†Do not step into the classeså³å¯ï¼Œå½“ç„¶ï¼Œè‹¥æ˜¯æƒ³ç›´æ¥åœ¨æºç ä¸­æ·»åŠ æ³¨é‡Šï¼Œéœ€è¦è¿›è¡Œä¸€äº›é…ç½®ã€‚","text":"å‰è¨€è‡ªå·±ä»å»å¹´12æœˆä»½å¼€å§‹çœ‹JDKä¸Šçš„éƒ¨åˆ†æºç ï¼Œä¹‹å‰å› ä¸ºæ˜¯æ‡’ï¼Œè§‰å¾—çœ‹æºç å˜›ï¼Œçœ‹å˜›ï¼Œçªå‡ºçœ‹ã€‚ç›´æ¥å°±æ˜¯é˜…è¯»æºç ï¼Œç„¶åæ¯ä¸ªä»£ç é€»è¾‘éƒ½æ˜¯é è‡ªå·±æ¨æµ‹ï¼Œ è¿˜æœ‰ç†è§£ï¼Œ å¹¶æ²¡æœ‰çœ‹è¾“å‡ºï¼Œ ç°åœ¨æ‰å‘ç°åœ¨IDEAä¸­File | Settings | Build, Execution, Deployment | Debugger | Steppingä¸­å¯ä»¥å°†Do not step into the classeså³å¯ï¼Œå½“ç„¶ï¼Œè‹¥æ˜¯æƒ³ç›´æ¥åœ¨æºç ä¸­æ·»åŠ æ³¨é‡Šï¼Œéœ€è¦è¿›è¡Œä¸€äº›é…ç½®ã€‚ JDK1.8åœ¨IDEAä¸­æ­å»ºé˜…è¯»ç¯å¢ƒç¬¬ä¸€æ­¥è§£å‹ç³»ç»ŸJDKæ‰€åœ¨è·¯å¾„ä¸­çš„sc.zip åˆ°è‡ªå®šä¹‰çš„æ–‡ä»¶ä¸­ï¼Œè­¬å¦‚srcä¸­çš„source jdk-é¡¹ç›®ç»“æ„.png ç¬¬äºŒæ­¥å¯¼å…¥åˆ°è‡ªå·±çš„æºç å·¥ç¨‹æ–‡ä»¶ä¸­ ç¬¬ä¸‰æ­¥ä¿®æ”¹å·¥ç¨‹æ–‡ä»¶ä¸­SDKsçš„Sourcepath å°†sc,zipæ›¿æ¢æˆå›¾ä¸€ä¸­sc.zipè§£å‹åˆ°çš„æ–‡ä»¶ã€‚javafx-src.zipä¸åŠ¨ã€‚å¦‚ä¸‹å›¾ï¼š jdk-sdks.png References JDK1.8æºç åˆ†æ03ä¹‹ideaæ­å»ºæºç é˜…è¯»ç¯å¢ƒ ideaä¸­æ­å»ºjdk1.8æºç é˜…è¯»ç¯å¢ƒ","categories":[{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"}],"tags":[{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/tags/%E9%85%8D%E7%BD%AE/"}]},{"title":"2020å¹´ä¹¦å•ã€å¹´ç»ˆæ±‡æ€»ã€‘","slug":"ç¢ç¢å¿µ/2020å¹´ä¹¦å•ã€å¹´æ±‡æ€»ã€‘","date":"2019-12-31T16:00:01.000Z","updated":"2021-02-04T11:48:38.112Z","comments":true,"path":"2020å¹´ä¹¦å•ã€å¹´æ±‡æ€»ã€‘/","link":"","permalink":"https://winniekun.github.io/2020%E5%B9%B4%E4%B9%A6%E5%8D%95%E3%80%90%E5%B9%B4%E6%B1%87%E6%80%BB%E3%80%91/","excerpt":"æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ æ‘˜è‡ªé¶¸é“åœº è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚","text":"æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ æ‘˜è‡ªé¶¸é“åœº è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚ ä¹¦ç±ç›¸å…³ LaTeXå¿«é€Ÿå…¥é—¨ä¸æé«˜ å‰‘æŒ‡Offer Javaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ å›¾è§£å¯†ç å­¦æŠ€æœ¯ Redisè®¾è®¡ä¸å®ç° æ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹• æ·±å…¥ç†è§£JVMè™šæ‹Ÿæœº è®°å¾—åˆšä¹°çš„æ—¶å€™ï¼Œæ˜¯çœŸçš„å®Œå…¨çœ‹ä¸æ‡‚ ç°åœ¨æœ‰ä¸€äº›çŸ¥å…¶ç„¶äº† å›¾è§£HTTP é¢è¯•çš„æ—¶å€™ï¼Œç½‘ç»œå¤ªç³Ÿç³• Mysqlå¿…çŸ¥å¿…ä¼š é«˜æ€§èƒ½MySQL Linux-UNIXç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸Šå†Œï¼‰ Linux-UNIXç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œï¼ˆä¸‹å†Œï¼‰ Java 8å‡½æ•°å¼ç¼–ç¨‹ å¤ªæ¬ºè´Ÿäººäº†ï¼Œæˆ‘å’‹å°±ä¸çŸ¥é“ç”¨å„ç§æµå’Œoptional è®ºæ–‡ å°‘æ•°å†³ï¼šæ›´å®‰å…¨çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•é€‰ä¸¾æœºåˆ¶ æ¬ºè¯ˆæ¸¸æˆçš„åº”ç”¨ï¼Ÿï¼Ÿï¼Ÿ ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡ é»‘é•œ å²¬ç«¥å¤· å¦‚å®é™ˆè¿° æŒºå¥½çœ‹çš„ ä½¿å¾’è¡Œè€… åˆšä¸Šæ˜ çš„æ—¶å€™çœ‹è¿‡äº†, ç„¶ååˆé‡æ–°çœ‹äº†ä¸€é è¿™ç§å…„å¼Ÿæƒ…çœŸçš„æ˜¯å¾ˆæ£’æ£’å“‡!!! åè½¬ä¹Ÿæœ‰ å››å¤§åæ• Iã€IV ç°åœ¨è¿˜è®°å¾—å½“åˆçš„ç‰ˆæƒæ„è¯†æœ‰å¤šå·®ï¼Œå½“åˆå››å¤§åæ•Iä¸€ä¸Šçº¿ï¼Œæˆ‘æ™šä¸Šå°±æœåˆ°äº†é«˜æ¸…èµ„æº äº‘é£ä¸è·¯å¤© ç–«æƒ…å®…å®¶ï¼Œå’Œçˆ¶æ¯ä¸€èµ·çœ‹çš„ è‡´å‘½å¼¯é“ Iã€IIã€IIIã€IV æ¡è‰ï¼Œä¸€éƒ¨æ¯”ä¸€éƒ¨æ¶å¿ƒï¼Œæœ‰ç‚¹å„¿åèƒƒ è°¤æ³• äººä½“èœˆèš£Iã€II æ¡è‰ï¼Œå¤ªå°¼ç›æ¶å¿ƒäº† è‡´å‘½å¼¯é“æ˜¯ç‰©ç†æ”»å‡»çš„è¯ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ˜¯çµé­‚æ”»å‡» æ¡è‰ï¼Œå¤ªæ¶å¿ƒäº† å†³èƒœæ³•åº­ å’Œå¥³æœ‹å‹ä¸€èµ·çœ‹çš„ é’¢ç´å®¶ ä¸€å µå¢™ï¼Œéš”ç»äº†äººæ€§å’Œäººæ€§ï¼›ä¸€å µå¢™ï¼Œå›šç¦ä½æ‰€æœ‰çš„ç†æ€§ã€‚ å½—æ˜Ÿæ¥çš„é‚£ä¸€å¤œ ç‹¼æºª å‘ç°æœ€è¿‘çš„å£å‘³æœ‰äº›é‡å•Šï¼ï¼ï¼ æ—¶ç©ºæ‹æ—…äºº èƒ½ç©¿è¶ŠçœŸå¥½ äº«å—å½“ä¸‹ é¥¥é¥¿ç«™å° å’Œå¥³æœ‹å‹ä¸€èµ·çœ‹çš„ æ³•åŒ»ç§¦æ˜ ç¬¬ä¸€éƒ¨ å›¾ä¸ªä¹å‘— å®‰å®¶ ä¸çŸ¥é“ä¸ºå•¥ï¼Œ çœ‹ç€æŒºè¿‡ç˜¾çš„ğŸ˜„ ä¸€ä¸ªä¸‹åˆåŠ ä¸€ä¸ªæ™šä¸Šåˆ·å®Œäº† æ„Ÿè§‰åé¢çƒ‚å°¾äº† å¤«å¦»çš„ä¸–ç•Œ å“‡ï¼Œæ‰å‘ç°åŸæ¥ç”·å¥³ä¸»ï¼Œéƒ½å·²ç»50å¤šäº† æˆ‘é ï¼Œ å½“æ‚¬ç–‘å‰§æ¥çœ‹çš„ VIP è¯´çœŸçš„ï¼Œè™½ç„¶æˆ‘è¿˜æ²¡æœ‰è¿›å…¥èŒåœº ä½†æ˜¯ï¼Œæ„Ÿè§‰éŸ©å‰§æ‹çš„èŒåœºå‰§æ‰æ˜¯çœŸçš„èŒåœºå‰§ å›½å†…çš„æ€»æ„Ÿè§‰æ˜¯åœ¨ç©å„¿ å¼ å¨œæ‹‰è¿˜æ˜¯é‚£ä¹ˆæ¼‚äº® ä¸€äººä¹‹ä¸‹III æˆ‘é ï¼Œç»ˆäºæ›´æ–°äº† æ„Ÿè§‰æ‰“æ–—åœºé¢å¾ˆæ£’æ£’ åœ¨æˆ‘å¿ƒé‡Œï¼Œå›½ç•ªç¬¬äºŒï¼Œç½—å°é»‘æ°¸è¿œç¬¬ä¸€ï¼ï¼ï¼ æˆ‘é ï¼ŒSBå§ï¼Œæœ‰äº›äººï¼Œå› ä¸ºä¸€ä»¶è¡£æœå¯¼è‡´æ•´æ”¹ï¼ï¼ï¼ æ€ä¹ˆå°±æœ‰é‚£ä¹ˆäº›äººè§ä¸å¾—åˆ«äººå¥½ å¤§ç†å¯ºæ—¥å¿— åˆšå¼€å§‹çœ‹ï¼Œæ„Ÿè§‰å¾ˆä¸é”™ åº†ä½™å¹´ ä¹‹å‰åªæ˜¯è§‰å¾—å¾ˆæç¬‘ï¼Œæ²¡æœ‰çœ‹ï¼Œä½†æ˜¯è¿™å‡ å¤©çœ‹äº†ç²¾å½©å‰ªè¾‘ï¼Œå‘ç°å¾ˆå¥½çœ‹ã€‚ æ„Ÿè§‰å’Œå®‹å¤§å¿—æ˜¯ä¸€ä¸ªç±»å‹çš„ã€‚ 38å¸ˆæœºåŠ¨é˜Ÿ é©¬ä¸œé”¡!!! 38æŒ‡éŸ©å›½ç¨é‡‘å¾æ”¶æ³• è€å¸ˆ å¥½ å“‡, æ‚²æƒ…ç»“å±€å“‡ æ´»ç€ éŸ©å›½çš„ä¸§å¤±æ‹çš„çœŸå¥½ é›¾å±±äº”è¡Œ ORZ !!! çµç¬¼ æ„Ÿè§‰å“ˆï¼Œå•çº¯çš„æ„Ÿè§‰ï¼Œä¸»ä½“æ€æƒ³å› è¯¥æ˜¯å’Œè¿›å‡»çš„å·¨äººå·®ä¸å¤š å¥½çœ‹è¿˜æ˜¯å¥½çœ‹ å…ƒé¾™ ä¿®ä»™çˆ½æ–‡ åé¢åŸ‹ä¼ åœ¨æ±Ÿæ¹–å’Œå®˜åºœçš„è¿™äº›æ©æ€¨çº è‘›ä¸­ï¼Œç™»é”‹å±¥åˆƒã€å†²é”‹é™·é˜µçš„æ°¸è¿œéƒ½æ˜¯æ— è¶³è½»é‡çš„å°äººç‰©ï¼Œåœ¨æ—¢æ˜¯å½“æƒè€…åˆæ˜¯æ–½æš´ç€ç»Ÿæ²»çš„å°å»ºç‹æœä¸­ï¼Œè¿çˆ±æƒ…å’Œè‡ªç”±éƒ½æ— æ³•è·å¾—çš„ä»–ä»¬ï¼Œæ›´ä¸ä¼šæœ‰æ­ç«¿è€Œèµ·ï¼Œæ‹¯æ•‘è‹ç”Ÿï¼Œæ‚¬å£¶æµä¸–çš„è‹±é›„æˆ˜è®°ã€‚æœ‰çš„ä¹Ÿåªä¸è¿‡æ˜¯â€œå¤©åœ°é€é¥ä»»æˆ‘æ¸¸â€çš„æœ€åä¸€ä¸æ…°è—‰ã€‚ æ’çƒå°‘å¹´ æš– æ”¹ç¼–è‡ªè«è¨€çš„å°è¯´ã€Šç™½ç‹—ç§‹åƒæ¶ã€‹ å¯¹äºçˆ±æƒ…ï¼Œå¹´è½»çš„æˆ‘ä»¬éƒ½ä¼šè¿«ä¸åŠå¾…çš„ç”¨å„ç§æ–¹å¼è¡¨è¾¾ç‚½çƒ­å’ŒçœŸå¿ƒï¼Œæ‰¿è¯ºå°±æ˜¯å…¶ä¸­æœ€è½»æ˜“æœ€æœ‰è¡¨ç°åŠ›çš„ä¸€ç§ã€‚ ä¹Ÿå¸Œæœ›èƒ½å¤Ÿæ¸…æ¥šåœ¨æ¯ä¸€ä»½æ‰¿è¯ºçš„é‡é‡ã€‚ åŠŸå¤«æ¢¦ never say never å¥³ç‹çš„æ£‹å±€ å›´æ£‹å°‘å¹´ï¼Ÿï¼Ÿï¼Ÿæ±Ÿæµå„¿ï¼Ÿï¼Ÿï¼Ÿ æ£‹é­‚","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"ä¹¦å•","slug":"ä¹¦å•","permalink":"https://winniekun.github.io/tags/%E4%B9%A6%E5%8D%95/"}]},{"title":"æ³¨è§£å’Œåå°„","slug":"JavaåŸºç¡€/æ³¨è§£å’Œåå°„","date":"2019-12-10T10:51:29.000Z","updated":"2020-08-30T04:50:22.244Z","comments":true,"path":"æ³¨è§£å’Œåå°„/","link":"","permalink":"https://winniekun.github.io/%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/","excerpt":"æ³¨è§£è¿™é‡Œä¸»è¦æ¶‰åŠçš„æ˜¯å››ä¸ªåŸºç¡€çš„å…ƒæ³¨è§£(meta-annotation) Javaä¸­çš„æ³¨è§£ï¼Œæœ‰å››ä¸ªåŸºæœ¬çš„å…ƒæ³¨è§£target Retention Documented Inherited è¿™å››ä¸ªå…ƒæ³¨è§£Documentedå’ŒInheritedä½¿ç”¨ä¸å¤šï¼Œä¸»è¦ä¸ºtarget retentionä¸¤ä¸ªæ³¨è§£","text":"æ³¨è§£è¿™é‡Œä¸»è¦æ¶‰åŠçš„æ˜¯å››ä¸ªåŸºç¡€çš„å…ƒæ³¨è§£(meta-annotation) Javaä¸­çš„æ³¨è§£ï¼Œæœ‰å››ä¸ªåŸºæœ¬çš„å…ƒæ³¨è§£target Retention Documented Inherited è¿™å››ä¸ªå…ƒæ³¨è§£Documentedå’ŒInheritedä½¿ç”¨ä¸å¤šï¼Œä¸»è¦ä¸ºtarget retentionä¸¤ä¸ªæ³¨è§£ Targetæè¿°æ³¨è§£çš„ä½¿ç”¨èŒƒå›´(å³è¢«ä¿®é¥°çš„æ³¨è§£å¯ä»¥ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹). public @interface Target { /** * Returns an array of the kinds of elements an annotation type * can be applied to. * @return an array of the kinds of elements an annotation type * can be applied to */ ElementType[] value(); } ä½¿ç”¨çš„èŒƒå›´ä¹Ÿå°±æ˜¯ElementType[]ä¸­çš„æšä¸¾ç±»å‹æ•°æ® public enum ElementType { /** Class, interface (including annotation type), or enum declaration */ TYPE, // ç±»ã€æ¥å£ã€æšä¸¾ /** Field declaration (includes enum constants) */ FIELD, // æˆå‘˜å˜é‡ /** Method declaration */ METHOD, // æˆå‘˜æ–¹æ³• /** Formal parameter declaration */ PARAMETER, // æ–¹æ³•å‚æ•° /** Constructor declaration */ CONSTRUCTOR, // æ„é€ æ–¹æ³• /** Local variable declaration */ LOCAL_VARIABLE, // å±€éƒ¨å˜é‡ /** Annotation type declaration */ ANNOTATION_TYPE, // æ³¨è§£ç±» /** Package declaration */ PACKAGE, // åŒ… /** * Type parameter declaration * * @since 1.8 */ TYPE_PARAMETER, // ç±»å‹å‚æ•°ï¼ˆæ³›å‹ï¼‰ /** * Use of a type * * @since 1.8 */ TYPE_USE } Retentionæè¿°æ³¨è§£ä¿ç•™çš„æ—¶é—´èŒƒå›´(å³ï¼šè¢«æè¿°çš„æ³¨è§£åœ¨å®ƒæ‰€ä¿®é¥°çš„ç±»ä¸­å¯ä»¥è¢«ä¿ç•™åˆ°ä½•æ—¶). Retenitonæ³¨è§£ç”¨æ¥é™å®šé‚£äº›è¢«å®ƒæ‰€æ³¨è§£çš„æ³¨è§£ç±»åœ¨æ³¨è§£åˆ°å…¶ä»–ç±»ä¸Šä»¥åï¼Œå¯è¢«ä¿ç•™åˆ°ä½•æ—¶ï¼Œä¸€å…±æœ‰ä¸‰ç§ç­–ç•¥ public enum RetentionPolicy { // æºæ–‡ä»¶ä¿ç•™ SOURCE, // ç¼–è¯‘æœŸä¿ç•™ï¼Œé»˜è®¤å€¼ CLASS, // è¿è¡ŒæœŸä¿ç•™ï¼Œå¯é€šè¿‡åå°„å»è·å–æ³¨è§£ä¿¡æ¯ RUNTIME } åå°„æ­£å¸¸æ–¹å¼: å¼•å…¥éœ€è¦çš„åŒ…ç±»åç§° â€”-&gt; é€šè¿‡ newå®ä¾‹åŒ– â€”-&gt; è·å–å®ä¾‹åŒ–å¯¹è±¡ åå°„: å®ä¾‹åŒ–å¯¹è±¡ â€”-&gt; getClass()æ–¹æ³• â€”-&gt; å¾—åˆ°å®Œæ•´çš„åŒ…ç±»åç§° é€šè¿‡åå°„ï¼Œ ä½¿å¾—Javaå…·æœ‰ç±»ä¼¼åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ åå°„æ‰€æä¾›çš„åŠŸèƒ½ åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±» åœ¨è¿è¡Œæ—¶æ„é€ ä»»æ„ä¸€ä¸ªç±»çš„å¯¹è±¡ åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä»»æ„ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³• åœ¨è¿è¡Œæ—¶è°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡å’Œæ–¹æ³• åœ¨è¿è¡Œæ—¶è·å–æ³›å‹ä¿¡æ¯ åœ¨è¿è¡Œæ—¶å¤„ç†æ³¨è§£ ç”ŸæˆåŠ¨æ€ä»£ç† â€¦â€¦ åå°„ä¼˜ç‚¹å’Œç¼ºç‚¹ä¼˜ç‚¹: å¯ä»¥åŠ¨æ€åˆ›å»ºå’Œç¼–è¯‘ï¼Œæœ‰å¾ˆå¤§çš„çµæ´»æ€§ ç¼ºç‚¹: æ…¢äºç›´æ¥æ‰§è¡Œç›¸åŒçš„æ“ä½œ è·å–Classç±»çš„å®ä¾‹ å·²çŸ¥æŸä¸ªç±»çš„å®ä¾‹ User user = new User(); Class&lt;? extends User&gt; aClass1 = user.getClass(); å·²çŸ¥å…·ä½“çš„ç±» Class&lt;User&gt; aClass2 = User.class; å·²çŸ¥ç±»çš„å…¨åç§° Class&lt;?&gt; aClass3 = Class.forName(\"com.xxx.xxx\"); ç±»çš„åŠ è½½è¿‡ç¨‹|â€”â€”â€”â€”â€”â€”â€”â€”â€”| |â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”| |â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”| | ç±»çš„åŠ è½½ | ------&gt; | ç±»çš„é“¾æ¥ | -------&gt; | ç±»çš„åˆå§‹åŒ– | | Load | -----&gt; | Link | -------&gt; | Initialize | |â€”â€”â€”â€”â€”â€”â€”â€”â€”| |â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”| |â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”| è·å–Classå¯¹è±¡ä¹‹åå¯ä»¥åšå†™ä»€ä¹ˆ åˆ›å»ºç±»çš„å¯¹è±¡ aClass.newInstance(); // æœ¬è´¨æ˜¯è°ƒç”¨äº†æ— å‚æ„é€ å™¨ è‹¥æ˜¯æ²¡æœ‰æ— å‚æ„é€ å™¨ï¼Œå¯ä»¥é€šè¿‡æ˜ç¡®è°ƒç”¨å¯¹åº”çš„æ„é€ å™¨ï¼Œç„¶åå°†å‚æ•°ä¼ é€’è¿›å»å³å¯ aClass.getDeclaredConstrutor(Class...parameterTypes) å¯ä»¥è°ƒç”¨ç±»ä¸­çš„æ–¹æ³• User user = (User) aClass.newInstance(); Method setName = aClass.getDeclaredMethod(\"setName\", String.class); // invoke: æ¿€æ´» // (å¯¹è±¡, \"æ–¹æ³•çš„å€¼\") setName.invoke(user, \"ç»´å¤å¤\"); System.out.println(user.getName()); æ“ä½œç±»ä¸­çš„å±æ€§ //åå°„æ“ä½œå±æ€§ User user3 = (User) aClass.newInstance(); Field name = aClass.getDeclaredField(\"name\"); // ä¸èƒ½æ“ä½œç§æœ‰å±æ€§ éœ€è¦å…³é—­å®‰å…¨æ£€æµ‹ name.setAccessible(true); name.set(user3, \"å­”ç»´å¤\"); System.out.println(user3.getName()); æ³¨è§£å’Œåå°„çš„å®é™…åº”ç”¨ç¼–å†™ä¸€ä¸ªæ³¨è§£ï¼Œé€‚ç”¨äºæˆå‘˜æ–¹æ³•ï¼Œç„¶åè¿è¡Œä¿ç•™ @Target(ElementType.METHOD) @Retention(RetentionPolicy.RUNTIME) public @interface AAAA { String value() default \"\"; } é€šè¿‡åå°„è·å–æ³¨è§£ä¸­çš„å†…å®¹ public class ReAno { @AAAA(\"æˆ‘æ˜¯æ–¹æ³•æ³¨è§£\") public void say(int a){ System.out.println(\"wtf \" + a); } public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InstantiationException, InvocationTargetException { // é€šè¿‡åå°„è·å–ç±» Class&lt;ReAno&gt; reAnoClass = ReAno.class; Method say = reAnoClass.getDeclaredMethod(\"say\", int.class); AAAA annotation = say.getAnnotation(AAAA.class); System.out.println(annotation.value()); // è¾“å‡º: æˆ‘æ˜¯æ–¹æ³•æ³¨è§£ } } æ€»ç»“é€šè¿‡åå°„è·å–æ³¨è§£çš„æ–¹å¼å°±æ˜¯æ³¨è§£åº”ç”¨åœ¨ä»€ä¹ˆèŒƒå›´ï¼Œ å°±å…ˆé€šè¿‡åå°„è·å–å¯¹åº”çš„æ–¹æ³•ã€æˆ–è€…æˆå‘˜å˜é‡ï¼Œç„¶åè·å–å…¶æ³¨è§£å³å¯ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"}]},{"title":"å¹¶å‘&I/OåŸºæœ¬æ¦‚å¿µ","slug":"Javaè¿›é˜¶/å¹¶å‘/å¹¶å‘åŸºæœ¬æ¦‚å¿µ","date":"2019-12-06T03:13:58.000Z","updated":"2021-06-05T08:46:59.809Z","comments":true,"path":"å¹¶å‘åŸºæœ¬æ¦‚å¿µ/","link":"","permalink":"https://winniekun.github.io/%E5%B9%B6%E5%8F%91%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/","excerpt":"åŒæ­¥ä¸å¼‚æ­¥","text":"åŒæ­¥ä¸å¼‚æ­¥ åŒæ­¥è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œä¸åŒçš„è¿›ç¨‹ä¹‹é—´ï¼Œå­˜åœ¨ä¸åŒçš„ç›¸äº’åˆ¶çº¦å…³ç³»ã€‚ä¸ºäº†åè°ƒè¿™ç§åˆ¶çº¦å…³ç³»ï¼Œå¼•å…¥äº†åŒæ­¥çš„æ¦‚å¿µã€‚ ä¸¾ä¾‹è¯´æ˜ï¼šç³»ç»Ÿè®¡ç®—1+2Ã—3ã€‚å‡è®¾æœ‰ä¸¤ä¸ªè¿›ç¨‹è¿›è¡Œè®¡ç®—è¯¥å…¬å¼ï¼Œä¸€ä¸ªæ˜¯åŠ æ³•è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ä¹˜æ³•è¿›ç¨‹ã€‚å¦‚æœè¦è®¡ç®—æ­£ç¡®ï¼Œè¦å…ˆæ‰§è¡Œä¹˜æ³•è¿›ç¨‹ï¼Œç„¶åæ‰§è¡ŒåŠ æ³•è¿›ç¨‹ã€‚ä½†æ˜¯å› ä¸ºç³»ç»Ÿçš„å¼‚æ­¥æ€§ï¼ˆå¹¶å‘ã€è™šæ‹Ÿã€å¼‚æ­¥ã€å…±äº«ï¼‰ï¼Œè‹¥æ˜¯ä¸åŠ ä»¥åˆ¶çº¦ï¼Œæ— æ³•ä¿è¯ä¹˜æ³•è¿›ç¨‹åœ¨åŠ æ³•è¿›ç¨‹ä¹‹å‰æ‰§è¡Œçš„ã€‚æ‰€ä»¥è¦åˆ¶å®šä¸€äº›æœºåˆ¶å»çº¦æŸåŠ æ³•è¿›ç¨‹ï¼Œè®©ä»–åœ¨ä¹˜æ³•è¿›ç¨‹å®Œæˆä¹‹åè¿è¡Œã€‚ åŒæ­¥åŒæ­¥ä¹Ÿç§°ä¸ºç›´æ¥åˆ¶çº¦å…³ç³»ï¼Œæ˜¯æŒ‡ä¸€ä¸ªä»»åŠ¡çš„å®Œæˆéœ€è¦ä¾èµ–å¦å¤–ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåªæœ‰ç­‰å¾…è¢«ä¾èµ–çš„ä»»åŠ¡å®Œæˆåï¼Œä¾èµ–çš„ä»»åŠ¡æ‰èƒ½ç®—å®Œæˆï¼Œè¿™æ˜¯ä¸€ç§å¯é çš„ä»»åŠ¡åºåˆ—ã€‚è¦ä¹ˆæˆåŠŸéƒ½æˆåŠŸï¼Œå¤±è´¥éƒ½å¤±è´¥ï¼Œä¸¤ä¸ªä»»åŠ¡çš„çŠ¶æ€å¯ä»¥ä¿æŒä¸€è‡´ã€‚ äº’æ–¥äº’æ–¥ä¹Ÿç§°ä¸ºé—´æ¥åˆ¶çº¦å…³ç³»ï¼Œå½“ä¸ªä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºä½¿ç”¨ä¸´ç•Œèµ„æºçš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ï¼Œå½“å ç”¨ä¸´ç•Œèµ„æºçš„è¿›ç¨‹é€€å‡ºä¸´ç•ŒåŒºä¹‹åï¼Œå¦ä¸€ä¸ªè¿›ç¨‹æ‰å…è®¸è®¿é—®æ­¤ä¸´ç•Œèµ„æº åŒæ—¶ä¸ºäº†ç¦æ­¢ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºï¼ŒåŒæ­¥æœºåˆ¶å› éµå¾ªä¸€ä¸‹çš„åŸåˆ™ï¼š ä¸´ç•ŒåŒºï¼šè¿›ç¨‹è®¿é—®ä¸´ç•Œèµ„æºçš„ä»£ç ï¼Œå®ƒåŒä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¦‚javaä¸­çš„synchronizedå…³é”®å­—åœ¨æ–¹æ³•ä¸Šï¼Œé‚£ä¸´ç•ŒåŒºå°±æ˜¯æ•´ä¸ªæ–¹æ³•å†…éƒ¨ã€‚è€Œå¦‚æœæ˜¯ä½¿ç”¨synchronizedä»£ç å—ï¼Œé‚£ä¸´ç•ŒåŒºå°±æŒ‡çš„æ˜¯ä»£ç å—å†…éƒ¨çš„åŒºåŸŸã€‚ ç©ºé—²è®©è¿›ï¼šä¸´ç•ŒåŒºç©ºé—²æ—¶ï¼Œå¯ä»¥å…è®¸ä¸€ä¸ªè¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒº å¿™åˆ™ç­‰å¾…ï¼šå½“å·²æœ‰è¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå…¶ä»–è¯•å›¾è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹å¿…é¡»ç­‰å¾… æœ‰é™ç­‰å¾…ï¼šå¯¹å·²ç»è¯·æ±‚è¿›å…¥ä¸´ç•ŒåŒºçš„è¿›ç¨‹ï¼Œåº”ä¿è¯å…¶åœ¨æœ‰é™çš„æ—¶é—´è¿›å…¥ä¸´ç•ŒåŒº è®©æƒç­‰å¾…ï¼šå½“è¿›ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œåº”ç«‹å³é‡Šæ”¾å¤„ç†å™¨ï¼Œé˜²æ­¢è¿›ç¨‹å¿™ç­‰ã€‚ ç»å…¸åŒæ­¥é—®é¢˜ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ã€è¯»å†™è€…é—®é¢˜ã€å“²å­¦å®¶å°±é¤é—®é¢˜ å¼‚æ­¥å¼‚æ­¥æ˜¯ä¸éœ€è¦ç­‰å¾…è¢«ä¾èµ–çš„ä»»åŠ¡å®Œæˆï¼Œåªæ˜¯é€šçŸ¥è¢«ä¾èµ–çš„ä»»åŠ¡è¦å®Œæˆä»€ä¹ˆå·¥ä½œï¼Œä¾èµ–çš„ä»»åŠ¡ä¹Ÿç«‹å³æ‰§è¡Œï¼Œåªè¦è‡ªå·±å®Œæˆäº†æ•´ä¸ªä»»åŠ¡å°±ç®—å®Œæˆäº†ã€‚è‡³äºè¢«ä¾èµ–çš„ä»»åŠ¡æœ€ç»ˆæ˜¯å¦çœŸæ­£å®Œæˆï¼Œä¾èµ–å®ƒçš„ä»»åŠ¡æ— æ³•ç¡®å®šï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å¯é çš„ä»»åŠ¡åºåˆ—ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼šå‘çŸ­ä¿¡ï¼ŒAå‘çŸ­ä¿¡ç»™Bï¼Œå‘é€ç»™Bå³å¯ï¼Œå‘é€å®Œä¹‹åï¼Œå¯ä»¥åšå…¶ä»–çš„äº‹æƒ…ï¼ŒçŸ­ä¿¡æ¥äº†ï¼Œæ‰‹æœºä¼šæé†’ é˜»å¡ä¸éé˜»å¡é˜»å¡å’Œéé˜»å¡æ˜¯ä»CPUçš„æ¶ˆè€—è€Œè¨€çš„ã€‚ é˜»å¡ï¼šå°±æ˜¯CPUåœä¸‹æ¥ç­‰å¾…ä¸€ä¸ªæ…¢æ“ä½œå®Œæˆä¹‹åCPUå†ç»§ç»­æ‰§è¡Œå…¶ä»–çš„äº‹æƒ… éé˜»å¡ï¼š åœ¨æ…¢æ“ä½œæ‰§è¡Œçš„æ—¶å€™ï¼ŒCPUä¼šå»æ‰§è¡Œå…¶ä»–çš„äº‹æƒ…ï¼Œç­‰è¿™ä¸ªæ…¢æ“ä½œå®Œæˆä¹‹åï¼ŒCPUç»§ç»­å®Œæˆå…¶åç»­äº‹æƒ… è™½ç„¶è¡¨é¢ä¸Šçœ‹éé˜»å¡çš„æ–¹å¼å¯ä»¥æ˜æ˜¾çš„æé«˜ CPU çš„åˆ©ç”¨ç‡ï¼Œä½†æ˜¯ä¹Ÿå¸¦äº†å¦å¤–ä¸€ç§åæœå°±æ˜¯ç³»ç»Ÿçš„çº¿ç¨‹åˆ‡æ¢å¢åŠ ã€‚å¢åŠ çš„ CPUä½¿ç”¨æ—¶é—´èƒ½ä¸èƒ½è¡¥å¿ç³»ç»Ÿçš„åˆ‡æ¢æˆæœ¬éœ€è¦å¥½å¥½è¯„ä¼°ã€‚ ä»¥ä¸Šä¸¤ç§æ¦‚å¿µçš„èŠ±å¼ç»„åˆè¿™é‡Œä¸»è¦æ˜¯å’ŒI/Oç›¸å…³ æ’åˆ—ç»„åˆä¹‹åï¼Œå…±å››ç§æƒ…å†µï¼šåŒæ­¥é˜»å¡ã€åŒæ­¥éé˜»å¡ã€å¼‚æ­¥é˜»å¡ã€å¼‚æ­¥éé˜»å¡ ç»„åˆæ–¹å¼ æ€§èƒ½ åŒæ­¥é˜»å¡ æœ€å¸¸ç”¨çš„ä¸€ç§ç”¨æ³•ï¼Œä½¿ç”¨ä¹Ÿæ˜¯æœ€ç®€å•çš„ï¼Œä½†æ˜¯ I/O æ€§èƒ½ä¸€èˆ¬å¾ˆå·®ï¼ŒCPU å¤§éƒ¨åˆ†åœ¨ç©ºé—²çŠ¶æ€ã€‚(BIO) åŒæ­¥éé˜»å¡ æå‡ I/O æ€§èƒ½çš„å¸¸ç”¨æ‰‹æ®µï¼Œå°±æ˜¯å°† I/O çš„é˜»å¡æ”¹æˆéé˜»å¡æ–¹å¼ï¼Œå°¤å…¶åœ¨ç½‘ç»œ I/O æ˜¯é•¿è¿æ¥ï¼ŒåŒæ—¶ä¼ è¾“æ•°æ®ä¹Ÿä¸æ˜¯å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œæå‡æ€§èƒ½éå¸¸æœ‰æ•ˆã€‚è¿™ç§æ–¹å¼é€šå¸¸èƒ½æå‡ I/O æ€§èƒ½ï¼Œä½†æ˜¯ä¼šå¢åŠ  CPU æ¶ˆè€—ï¼Œè¦è€ƒè™‘å¢åŠ çš„ I/O æ€§èƒ½èƒ½ä¸èƒ½è¡¥å¿ CPU çš„æ¶ˆè€—ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿçš„ç“¶é¢ˆæ˜¯åœ¨ I/O è¿˜æ˜¯åœ¨ CPU ä¸Šã€‚(NIO) å¼‚æ­¥é˜»å¡ è¿™ç§æ–¹å¼åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­ç»å¸¸ç”¨åˆ°ï¼Œä¾‹å¦‚åœ¨ç½‘ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ä¸­å†™ä¸€æ¡è®°å½•ï¼Œé€šå¸¸ä¼šæœ‰ä¸€ä»½æ˜¯åŒæ­¥é˜»å¡çš„è®°å½•ï¼Œè€Œè¿˜æœ‰ä¸¤è‡³ä¸‰ä»½æ˜¯å¤‡ä»½è®°å½•ä¼šå†™åˆ°å…¶å®ƒæœºå™¨ä¸Šï¼Œè¿™äº›å¤‡ä»½è®°å½•é€šå¸¸éƒ½æ˜¯é‡‡ç”¨å¼‚æ­¥é˜»å¡çš„æ–¹å¼å†™ I/Oã€‚å¼‚æ­¥é˜»å¡å¯¹ç½‘ç»œ I/O èƒ½å¤Ÿæå‡æ•ˆç‡ï¼Œå°¤å…¶åƒä¸Šé¢è¿™ç§åŒæ—¶å†™å¤šä»½ç›¸åŒæ•°æ®çš„æƒ…å†µã€‚ å¼‚æ­¥éé˜»å¡ è¿™ç§ç»„åˆæ–¹å¼ç”¨èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œåªæœ‰åœ¨ä¸€äº›éå¸¸å¤æ‚çš„åˆ†å¸ƒå¼æƒ…å†µä¸‹ä½¿ç”¨ï¼Œåƒé›†ç¾¤ä¹‹é—´çš„æ¶ˆæ¯åŒæ­¥æœºåˆ¶ä¸€èˆ¬ç”¨è¿™ç§ I/O ç»„åˆæ–¹å¼ã€‚å¦‚ Cassandra çš„ Gossip é€šä¿¡æœºåˆ¶å°±æ˜¯é‡‡ç”¨å¼‚æ­¥éé˜»å¡çš„æ–¹å¼ã€‚å®ƒé€‚åˆåŒæ—¶è¦ä¼ å¤šä»½ç›¸åŒçš„æ•°æ®åˆ°é›†ç¾¤ä¸­ä¸åŒçš„æœºå™¨ï¼ŒåŒæ—¶æ•°æ®çš„ä¼ è¾“é‡è™½ç„¶ä¸å¤§ï¼Œä½†æ˜¯å´éå¸¸é¢‘ç¹ã€‚è¿™ç§ç½‘ç»œ I/O ç”¨è¿™ä¸ªæ–¹å¼æ€§èƒ½èƒ½è¾¾åˆ°æœ€é«˜ã€‚(AIO) è™½ç„¶å¼‚æ­¥å’Œéé˜»å¡èƒ½å¤Ÿæå‡ I/O çš„æ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„æ€§èƒ½æˆæœ¬ï¼Œä¾‹å¦‚ä¼šå¢åŠ çº¿ç¨‹æ•°é‡ä»è€Œå¢åŠ  CPU çš„æ¶ˆè€—ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¼è‡´ç¨‹åºè®¾è®¡çš„å¤æ‚åº¦ä¸Šå‡ã€‚å¦‚æœè®¾è®¡çš„ä¸åˆç†çš„è¯åè€Œä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚åœ¨å®é™…è®¾è®¡æ—¶è¦æ ¹æ®åº”ç”¨åœºæ™¯ç»¼åˆè¯„ä¼°ä¸€ä¸‹ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"I/O","slug":"I-O","permalink":"https://winniekun.github.io/tags/I-O/"}]},{"title":"2019çš„æœ€å100å¤©","slug":"ç¢ç¢å¿µ/2019çš„æœ€å100å¤©","date":"2019-10-01T08:53:43.000Z","updated":"2020-08-30T04:50:22.258Z","comments":true,"path":"2019çš„æœ€å100å¤©/","link":"","permalink":"https://winniekun.github.io/2019%E7%9A%84%E6%9C%80%E5%90%8E100%E5%A4%A9/","excerpt":"å‰è¨€æ—¶é—´è¿‡å¾—å¯çœŸå¿«å•Šï¼Œå»å¹´çš„è¿™ä¸ªæ—¶å€™è¿˜åœ¨å¤‡è€ƒï¼Œåˆ·å„ç§é¢˜ï¼Œç°åœ¨å·²ç»åœ¨å®éªŒå®¤åšè‡ªå·±çš„äº‹æƒ…äº†ï¼Œåˆæ˜¯æœ€åçš„100å¤©ï¼Œå¸Œæœ›è‡ªå·±åœ¨2019å¹´çš„æœ€å100å¤©æ‹¼ä¸€æ‹¼ï¼ŒåŠªåŠ›å®Œæˆè‡ªå·±çš„ä»»åŠ¡ã€‚","text":"å‰è¨€æ—¶é—´è¿‡å¾—å¯çœŸå¿«å•Šï¼Œå»å¹´çš„è¿™ä¸ªæ—¶å€™è¿˜åœ¨å¤‡è€ƒï¼Œåˆ·å„ç§é¢˜ï¼Œç°åœ¨å·²ç»åœ¨å®éªŒå®¤åšè‡ªå·±çš„äº‹æƒ…äº†ï¼Œåˆæ˜¯æœ€åçš„100å¤©ï¼Œå¸Œæœ›è‡ªå·±åœ¨2019å¹´çš„æœ€å100å¤©æ‹¼ä¸€æ‹¼ï¼ŒåŠªåŠ›å®Œæˆè‡ªå·±çš„ä»»åŠ¡ã€‚ è®¡åˆ’ JavaåŸºç¡€ æ˜¯çš„ï¼Œæˆ‘åˆå¼€å§‹çœ‹Javaäº†ï¼Œå› ä¸ºå‘ç°è‡ªå·±çš„å¯¹Pythonçš„ç†è§£è²Œä¼¼æ­¢æ­¥ä¸å‰äº†ï¼Œ é‚£å°±æ¢ä¸ªè¯­è¨€å¥½å¥½å­¦å­¦ï¼Œæˆ–è®¸ï¼Œä¼šæœ‰æ›´æ·±åˆ»çš„ç†è§£å‘¢ï½ï½ï½ Springå¤§å®¶æ—å®ç°ä¸€ä¸ªæ¡†æ¶çš„demo Springæ˜¯ä¸€ä¸ªå¾®å‹æ¡†æ¶â€¦ Flaskæºç è§£è¯» è‡ªå·±å…¶å®ä¸€ç›´æƒ³æŠŠflaskçš„æºç ç†è§£äº†ï¼Œä½†æ˜¯è‹¦äºè‡ªå·±æ‡’ç™Œï¼Œä»¥åŠçœ‹çš„æ—¶å€™ç»å¸¸ä¼šå¿˜äº†è‡ªå·±è¯¥å»çœ‹å“ªå„¿äº†ã€‚ è‡ªå·±é˜…è¯»æºç çš„æ–¹å¼è¿˜æœ‰å¾ˆå¤šé—®é¢˜ Pythonè¿›é˜¶ å¹¶å‘æœ€èµ·ç è¦åˆ·å®Œå§ï¼Œè¦ä¸ç„¶ç™½è´¹äº†è‡ªå·±å»å¹´è‹¦å¿ƒæ•´ç†çš„osäº† è¿­ä»£å™¨ã€ç”Ÿæˆå™¨ã€æ–°ç‰¹æ€§ æ•°æ®ç»“æ„æ ‘å’Œå›¾ ä¹‹å‰çš„éƒ½æ˜¯ç†è®ºä¸Šæ˜ç™½äº†ï¼Œ ç°åœ¨éœ€è¦å»è‡ªå·±æ‰‹åŠ¨å®ç°äº†ï¼Œè™½ç„¶å»å¹´ä¸çŸ¥é“æ‰‹å†™å†™åºŸäº†å¤šå°‘æ”¯ç¬” LeetCode 100é¢˜ O(âˆ©_âˆ©)Oå“ˆå“ˆå“ˆ~","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"}]},{"title":"å†’æ³¡æ’åº","slug":"ç®—æ³•/æ’åº/å†’æ³¡æ’åº","date":"2019-09-30T14:47:49.000Z","updated":"2020-08-30T04:50:22.261Z","comments":true,"path":"å†’æ³¡æ’åº/","link":"","permalink":"https://winniekun.github.io/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/","excerpt":"å†’æ³¡æ’åº","text":"å†’æ³¡æ’åº å†’æ³¡æ’åºæ¯æ¬¡æ£€æŸ¥ç›¸é‚»ä¸¤ä¸ªå…ƒç´ ï¼Œä»¥å‡åºä¸ºä¾‹ï¼Œ å¦‚æœå‰é¢çš„å…ƒç´ å¤§äºåé¢çš„å…ƒç´ ï¼Œå°±å°†ç›¸é‚»ä¸¤ä¸ªå…ƒç´ äº¤æ¢ã€‚å½“æ²¡æœ‰ç›¸é‚»çš„å…ƒç´ éœ€è¦äº¤æ¢æ—¶ï¼Œæ’åºå°±å®Œæˆäº†ã€‚ æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$ å†’æ³¡æ’åºæ˜¯ç¨³å®šæ’åº ä¼ªä»£ç $ \\begin{array}{ll} 1 &amp; \\textbf{Input. } \\text{An array } A \\text{ consisting of }n\\text{ elements.} \\newline 2 &amp; \\textbf{Output. } A\\text{ will be sorted in nondecreasing order stably.} \\newline 3 &amp; \\textbf{Method. } \\newline 4 &amp; flag\\gets True \\newline 5 &amp; \\textbf{while }flag\\newline 6 &amp; \\qquad flag\\gets False\\newline 7 &amp; \\qquad\\textbf{for }i\\gets1\\textbf{ to }n-1\\newline 8 &amp; \\qquad\\qquad\\textbf{if }A[i] &gt;A[i + 1]\\newline 9 &amp; \\qquad\\qquad\\qquad flag\\gets True\\newline 10 &amp; \\qquad\\qquad\\qquad \\text{Swap } A[i]\\text{ and }A[i + 1] \\end{array}$ Javaå®ç°public void bubbleSorted(int[] nums){ boolean flag = true; while(flag){ flag = false; for(int i = 0; i&lt; nums.length-1; i++){ if(nums[i] &gt; nums[i+1]){ int temp = nums[i]; nums[i] = nums[i+1]; nums[i+1] = temp; flag = true; } } } }","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[{"name":"äº¤æ¢","slug":"äº¤æ¢","permalink":"https://winniekun.github.io/tags/%E4%BA%A4%E6%8D%A2/"}]},{"title":"æš‘æœŸç”Ÿæ´»","slug":"ç¢ç¢å¿µ/æš‘æœŸç”Ÿæ´»","date":"2019-08-11T08:53:28.000Z","updated":"2020-09-06T11:13:23.491Z","comments":true,"path":"æš‘æœŸç”Ÿæ´»/","link":"","permalink":"https://winniekun.github.io/%E6%9A%91%E6%9C%9F%E7%94%9F%E6%B4%BB/","excerpt":"å‰è¨€ä»Šå¹´æš‘å‡åˆæå‰ç»“æŸäº†ï¼Œè¿˜æœ‰å¾ˆå¤šæƒ³å»åšçš„äº‹æƒ…è¿˜æ²¡æœ‰å®Œæˆï¼Œè­¬å¦‚ï¼šæ•´ç†ç¬”è®°ã€å‡ºå»æ—…æ¸¸ç­‰ã€‚è¿™æ¬¡æš‘å‡åº”è¯¥æ˜¯è‡ªå·±ç›®å‰å›è€å®¶æœ€å¤šæ¬¡çš„ä¸€å›äº†ï¼Œè€Œä¸”ä¹Ÿæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡ä¸€ä¸ªäººå›è€å®¶ã€‚æŒºå¥½ï¼Œè·¯çº¿ç†Ÿæ‚‰ä¹‹åï¼Œä»¥åå°±èƒ½è‡ªå·±åŠäº‹æƒ…äº†ï¼Œä¸ç”¨å†æ‰¾åˆ«äººä»£åŠäº†ã€‚","text":"å‰è¨€ä»Šå¹´æš‘å‡åˆæå‰ç»“æŸäº†ï¼Œè¿˜æœ‰å¾ˆå¤šæƒ³å»åšçš„äº‹æƒ…è¿˜æ²¡æœ‰å®Œæˆï¼Œè­¬å¦‚ï¼šæ•´ç†ç¬”è®°ã€å‡ºå»æ—…æ¸¸ç­‰ã€‚è¿™æ¬¡æš‘å‡åº”è¯¥æ˜¯è‡ªå·±ç›®å‰å›è€å®¶æœ€å¤šæ¬¡çš„ä¸€å›äº†ï¼Œè€Œä¸”ä¹Ÿæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡ä¸€ä¸ªäººå›è€å®¶ã€‚æŒºå¥½ï¼Œè·¯çº¿ç†Ÿæ‚‰ä¹‹åï¼Œä»¥åå°±èƒ½è‡ªå·±åŠäº‹æƒ…äº†ï¼Œä¸ç”¨å†æ‰¾åˆ«äººä»£åŠäº†ã€‚ è€å®¶åŸºæœ¬æ¯å¹´æš‘å‡è€å¦ˆéƒ½ä¼šå¸¦ç€æˆ‘å’Œå¼Ÿå¼Ÿå›è€å®¶ä¸€è¶Ÿï¼Œä¹‹å‰å¾ˆæœŸå¾…å›è€å®¶ï¼Œç°åœ¨ä¹Ÿæ²¡æœ‰é‚£ç§æ¯å¤©å€’è®¡æ—¶å›è€å®¶çš„é‚£ç§æœŸå¾…æ„Ÿäº†ï¼Œé¬¼çŸ¥é“ä»€ä¹ˆæƒ…å†µã€‚ã€‚ã€‚ä¸€ç›´æ„Ÿè§‰è€å¦ˆå¸¦æˆ‘ä»¬å›è€å®¶å°±ä¸¤ä¸ªç›®çš„ï¼š\\1. å¤šé™ªé™ªçˆ·çˆ·å¥¶å¥¶ å¤–å…¬å¤–å©†\\2. ä½“éªŒç”Ÿæ´»ï¼Œåœ¨è€å®¶ç§åœ°çœŸçš„ä¸å®¹æ˜“å½“ç„¶ä»Šå¹´ä¹Ÿä¸ä¾‹å¤–ï¼Œå› ä¸ºè‡ªå·±å¤§äº†ï¼Œå›å»ä¹‹åï¼Œè‚¯å®šæ˜¯è¦å°½å¯èƒ½çš„å¤šå»å¸®å¸®å®¶äººåšä¸€äº›å†œæ´»ã€‚è€Œè€å¼Ÿï¼Œå¯èƒ½å°±æ˜¯è®©ä»–å»ä½“éªŒç”Ÿæ´»å§ï¼Œæœ¬æ¥æ˜¯å¸¦æœ‰æ•™è‚²ç›®çš„çš„ï¼Œä½†æ˜¯æ„Ÿè§‰ä»–ç©å„¿çš„å¾ˆå¼€å¿ƒå“‡ã€‚ã€‚ã€‚ä»¥ä¸‹æ˜¯ä»–å¼€å¿ƒçš„ä½“éªŒç”Ÿæ´»çš„ç…§ç‰‡ã€‚ ã€Šæš‘æœŸç”Ÿæ´»ã€‹ ã€Šæš‘æœŸç”Ÿæ´»ã€‹ è‡ªå·±è¿˜è®°å¾—å’Œè€å¼Ÿä¸€æ ·å¤§çš„æ—¶å€™ï¼Œå¸®çˆ·çˆ·å»ææ£‰èŠ±æï¼Œå…å¾—æ£‰èŠ±é•¿å¾—å¤ªé«˜ï¼Œä»ä¸‹åˆ3ç‚¹å¤šä¸€ç›´å¹²åˆ°6ç‚¹å¤šï¼Œé‚£æ¬¡æŠŠæˆ‘ç´¯æƒ¨äº†ï¼Œåˆç´¯åˆæ¸´ï¼Œå¹²å®Œæ´»ä¹‹åï¼Œè¿˜è¦æ‘˜ä¸€è¢‹è¥¿ç“œå›å®¶ï¼Œè¿˜å¥½èƒ½éª‘ä¸‰è½®è½¦ï¼Œæ¯ä¸ªè¥¿ç“œå·®ä¸å¤šå°±å’Œè¿™ä¸ªé‚£ä¹ˆå¤§ã€‚ä¸è¿‡æˆ‘è®°å¾—æ˜¯åœ†çš„ï¼Œç°åœ¨ç§çš„ç»†é•¿çš„ï¼Œä¸€ä¸ªä¸ªé•¿å¾—è·Ÿä¸ªå†¬ç“œä¸€æ ·ã€‚ã€‚ã€‚ ã€Šæš‘æœŸç”Ÿæ´»ã€‹ ä»Šå¹´å¸è¥¿ç“œã€è£…è¥¿ç“œå¾ˆç´¯ï¼ŒçœŸçš„ç´¯ï¼Œç‰¹åˆ«ç´¯ï¼Œå› ä¸ºå¤©çƒ­ï¼Œæ‰€ä»¥åªèƒ½åœ¨å‡Œæ™¨5ç‚¹å¤šï¼Œæˆ–è€…ä¸‹åˆ5ç‚¹å¤šå†ä¸‹åœ°å»å¸è¥¿ç“œï¼Œå½“ç„¶ä¹Ÿä¸æ˜¯æ¯æ¬¡éƒ½è¿™æ ·ï¼Œå› ä¸ºè¥¿ç“œçš„ä»·é’±ä¸ç¨³å®šï¼Œæ‰€ä»¥å½“æ‰“å¬åˆ°è¥¿ç“œçš„ä»·é’±æ¶¨äº†ï¼Œå°±ä¼šç«‹é©¬ä¸‹åœ°å¸ç“œï¼Œè£…å¥½ä¹‹åæ‹‰å»å–æ‰ã€‚è®°å¾—æœ‰ä¸€æ¬¡ä¸‹åˆ5ç‚¹å¤šå¸ï¼Œè¿˜ä¸‹ç€å°é›¨ï¼Œåé¢åˆšå¸å®Œï¼Œå°±çªç„¶ä¸‹æ¥å¤§æš´é›¨ã€‚ã€‚ã€‚è¿˜å¥½å¤–å©†åŠæ—¶é€æ¥äº†é›¨ä¼ï¼Œè¦ä¸ç„¶å…¨éƒ¨éƒ½è¦æ·‹æˆè½æ±¤é¸¡ã€‚ æ­å·æœ¬ç§‘å­¦æ ¡æ¸…äººæœ€åä¸€å¤©ï¼Œå°±æ‹ç€è¡Œæå›æ­å·äº†ã€‚è™½ç„¶å·²ç»å¯„èµ°äº†ä¸¤å¤§åŒ…ä¸œè¥¿äº†ï¼Œä½†æ˜¯æˆ‘çš„å¤§èŠ±ç®±è¿˜æ˜¯å¡å¾—æ»¡æ»¡çš„ï¼Œè´¼æ²‰ï¼Œæ—©çŸ¥é“å½“åˆå°±ä¸ä¹±ä¹°é‚£ä¹ˆå¤šä¸œè¥¿ã€‚ ã€Šæš‘æœŸç”Ÿæ´»ã€‹ å›æ­å·ä¹‹åï¼Œå¤©å¤©åœ¨å®¶å¾…ç€ï¼Œæœ¬æ¥è®¡åˆ’æ‰¾ä¸ªå…¼èŒåšåšçš„ï¼Œç»“æœéƒ½ä¸è¦ï¼éƒ½ä¸è¦ï¼éƒ½ä¸è¦!!!å¾ˆéš¾å—ï¼Œä¸è¿‡è‡ªå·±çš„å¨è‰ºçªç„¶å¼€çªäº†ï¼Œå¯èƒ½æ˜¯å’Œæ²ˆæ€»æ··ä¹…äº†çš„åŸå› ï¼Œåæ­£åŸºæœ¬æ¯å¤©æ™šé¥­éƒ½æ˜¯æˆ‘æ¥åšã€‚å›¾æ–‡ä¸ç›¸å…³ï¼Œå°±æ˜¯å•çº¯çš„æƒ³æ”¾ä¸ªç…§ç‰‡ ã€Šæš‘æœŸç”Ÿæ´»ã€‹ è¥¿å®‰é©å‘½å°šæœªç»“æŸï¼ŒåŒå¿—ä»éœ€åŠ æ²¹ï¼ï¼ï¼ ã€Šæš‘æœŸç”Ÿæ´»ã€‹","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"}]},{"title":"å¿«é€Ÿæ’åº","slug":"ç®—æ³•/æ’åº/å¿«é€Ÿæ’åº","date":"2019-08-02T01:20:14.000Z","updated":"2020-08-30T04:50:22.261Z","comments":true,"path":"å¿«é€Ÿæ’åº/","link":"","permalink":"https://winniekun.github.io/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/","excerpt":"ç®€ä»‹","text":"ç®€ä»‹ æ—¶é—´å¤æ‚åº¦ï¼š$O(nlogn)$ å¿«é€Ÿæ’åºæ˜¯ä¸ç¨³å®šç®—æ³• æ­¥éª¤åˆ†ä¸ºä¸‰ä¸ªè¿‡ç¨‹ï¼š å°†é›†åˆåˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ˆä¿è¯å¤§å°å…³ç³»å³å¯ï¼Œpartitionå‡½æ•°ï¼‰ é€’å½’çš„åœ¨ä¸¤ä¸ªåˆ’åˆ†å¥½çš„éƒ¨åˆ†åˆ†åˆ«è¿›è¡Œå¿«æ’ ä¸ç”¨åˆå¹¶ï¼Œå› ä¸ºæ­¤æ—¶é›†åˆå·²ç»å®Œå…¨æœ‰åº Javaå®ç°public static void quickSort(int[] data, int low, int high) throws Exception { if(low == high){ return; } if(low &lt; high){ int partition = partition(data, data.length, low, high); quickSort(data, low, partition-1); quickSort(data, partition+1, high); } } private static int partition(int data[], int length, int low, int high) throws Exception { if(data == null || data.length&lt;= 0 || low &lt; 0 || high &gt;= length ){ throw new Exception(\"Invalid Parameters\"); } // é»˜è®¤é€‰æ‹©é¦–ä½ä½œä¸ºæ¢è½´ int position = data[low]; while (low &lt; high){ while (low&lt; high &amp;&amp; data[high] &gt;= position){ high--; } data[low] = data[high]; while (low&lt;high &amp;&amp; data[low] &lt;= position){ low++; } data[high] = data[low]; } data[low] = position; return low; } References å¿«é€Ÿæ’åº ç®—æ³•ç¬¬å››ç‰ˆ","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[{"name":"äº¤æ¢","slug":"äº¤æ¢","permalink":"https://winniekun.github.io/tags/%E4%BA%A4%E6%8D%A2/"}]},{"title":"BSTè¯¦è§£","slug":"æ•°æ®ç»“æ„/BSTè¯¦è§£","date":"2019-07-28T02:24:44.000Z","updated":"2020-08-30T04:50:22.254Z","comments":true,"path":"BSTè¯¦è§£/","link":"","permalink":"https://winniekun.github.io/BST%E8%AF%A6%E8%A7%A3/","excerpt":"ç®€ä»‹","text":"ç®€ä»‹ BSTæœ‰å¾ˆå¤šçš„åå­—ï¼Œå¦‚äºŒå‰æ’åºæ ‘ã€äºŒå‰æœç´¢æ ‘ã€Binary Sort Treeã€Binary Search Treeã€BSTå…¶å…·æœ‰å¦‚ä¸‹æ€§è´¨ï¼š å®šä¹‰ç©ºæ ‘æ˜¯ä¸€ä¸ªBST å·¦å­æ ‘æ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºæ ¹ç»“ç‚¹çš„å€¼ å³å­æ ‘æ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºæ ¹ç»“ç‚¹çš„å€¼ å·¦å³å­æ ‘éƒ½æ˜¯BST(é€’å½’å®šä¹‰) ä¸­åºéå†åºåˆ—ä¸ºå‡åº æŸ¥æ‰¾å‡è®¾æŸ¥æ‰¾å…³é”®å­—key è‹¥æ ¹ç»“ç‚¹çš„å…³é”®å­—å€¼ç­‰äºkeyï¼ŒæˆåŠŸ è‹¥keyå°äºæ ¹ç»“ç‚¹çš„å…³é”®å­—ï¼Œé€’å½’æŸ¥æ‰¾å·¦å­æ ‘ è‹¥keyå¤§äºæ ¹ç»“ç‚¹çš„å…³é”®å­—ï¼Œé€’å½’æŸ¥æ‰¾å³å­æ ‘ è‹¥å­æ ‘ä¸ºç©ºï¼ŒæŸ¥æ‰¾ä¸æˆåŠŸ æ’å…¥æŒ‰ç…§å…ƒç´ çš„å¤§å°è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸æŸ¥æ‰¾ç±»ä¼¼ã€‚ç„¶åæ’å…¥åˆ°å¯¹åº”çš„ä½ç½®ï¼ˆæ’å…¥åˆ°å½“å‰BSTçš„å¶å­èŠ‚ç‚¹ï¼‰ åˆ é™¤å‡è®¾åˆ é™¤èŠ‚ç‚¹pï¼Œå…¶çˆ¶èŠ‚ç‚¹ä¸ºfï¼Œåˆ†å¦‚ä¸‹3ç§æƒ…å†µè¿›è¡Œè®¨è®ºï¼š pæ˜¯å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥åˆ é™¤ påªæœ‰å·¦å­æ ‘left(å³å­æ ‘right)ï¼Œç›´æ¥ç”¨p.left(p.right)æ›¿æ¢p pæ—¢æœ‰å·¦å­æ ‘leftï¼Œåˆæœ‰å³å­æ ‘rightï¼Œæ‰¾åˆ°å³å­æ ‘çš„æœ€å°èŠ‚ç‚¹rightMin(æ‰¾åˆ°leftçš„æœ€å¤§èŠ‚ç‚¹leftMax)ï¼Œç”¨rightMin(leftMax)çš„å€¼æ›¿æ¢pçš„å€¼ï¼Œå†æ ¹æ®ä»¥ä¸Šä¸¤ç§æƒ…å†µåˆ é™¤rightMin(leftMax) Pæ˜¯å¶å­èŠ‚ç‚¹ bst_åˆ é™¤_æƒ…å†µ1.png Påªæœ‰å·¦å­æ ‘æˆ–å³å­æ ‘ bst_åˆ é™¤_æƒ…å†µ2.png Pæ—¢æœ‰å·¦å­æ ‘åˆæœ‰å³å­æ ‘ bst_åˆ é™¤_æƒ…å†µ3.png é¢è¯•æ±‡æ€»ç»™å®šä¸€ä¸ªBSTçš„èŠ‚ç‚¹ï¼Œå¯»æ‰¾ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„æœ€å€¼private static TreeNode getLastEntry(TreeNode node) { while (node.right != null) { node = node.right; } return node; } private static TreeNode getFirstEntry(TreeNode node) { while (node.left != null) { node = node.left; } return node; } ç»™å®šèŠ‚ç‚¹tï¼Œåç»§(å‰é©±)èŠ‚ç‚¹ tä¸ºæœ€å€¼èŠ‚ç‚¹ æ— å‰é©±æˆ–åç»§ å½“tæœ‰å³å­æ ‘ ç›´æ¥å¯»æ‰¾å…¶å³å­æ ‘æœ€å°èŠ‚ç‚¹ï¼ˆå·¦å­æ ‘æœ€å¤§èŠ‚ç‚¹ï¼‰å³å¯ tæ— å³å­æ ‘ å‘ä¸Šå›æº¯ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå­©å­æ˜¯å·¦å­æ ‘å­©å­ï¼ˆå³å­æ ‘å­©å­ï¼‰çš„çˆ¶äº²p å‘ä¸Šå›æº¯ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå…³é”®å­—æ¯”å­©å­å¤§ï¼ˆå°ï¼‰çš„çˆ¶äº²pï¼ˆåˆ©ç”¨BSTç‰¹æ€§ï¼‰ LintCode448. Inorder Successor in BSTä½¿ç”¨æŒ‡é’ˆä»£æ›¿è·¯å¾„æ ˆï¼Œå°†ç©ºé—´å¤æ‚åº¦é™åˆ°O(1) æ ˆæ˜¯è‡ªåº•å‘ä¸Šå¯»æ‰¾ç»“æœï¼ŒæŒ‡é’ˆä¸ºè‡ªé¡¶å‘ä¸‹å¯»æ‰¾ç»“æœ public static TreeNode inorderSuccessor(TreeNode root, TreeNode p) { if (root == null) { return null; } // æƒ…å†µ0: æœ¬èº«å°±æ˜¯æœ€å€¼ if (getLastEntry(root) == p) { return null; } // æƒ…å†µ1: æœ‰å³å­æ ‘ if (p.right != null) { return getFirstEntry(p.right); } // æƒ…å†µ2: æ²¡æœ‰å³å­æ ‘ TreeNode parent = root; // tempæŒ‡é’ˆä»£æ›¿æ ˆ TreeNode temp = root; while (parent != null) { if (parent == p) { break; } else if (parent.val &gt; p.val) { temp = parent; parent = parent.left; } else { parent = parent.right; } } return temp; } private static TreeNode getLastEntry(TreeNode node) { while (node.right != null) { node = node.right; } return node; } private static TreeNode getFirstEntry(TreeNode node) { while (node.left != null) { node = node.left; } return node; } ç›¸å…³é¢˜ç›®ä¼šæŒç»­æ·»åŠ  References TreeMapSourceAnalysis","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://winniekun.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"BST","slug":"BST","permalink":"https://winniekun.github.io/tags/BST/"}]},{"title":"å¤§å››ä¸‹å­¦æœŸæ€»ç»“---å„å¥”ä¸œè¥¿","slug":"æ€»ç»“/å¤§å››ä¸‹å­¦æœŸæ€»ç»“-å„å¥”ä¸œè¥¿","date":"2019-07-26T08:53:13.000Z","updated":"2020-08-30T04:50:22.253Z","comments":true,"path":"å¤§å››ä¸‹å­¦æœŸæ€»ç»“-å„å¥”ä¸œè¥¿/","link":"","permalink":"https://winniekun.github.io/%E5%A4%A7%E5%9B%9B%E4%B8%8B%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93-%E5%90%84%E5%A5%94%E4%B8%9C%E8%A5%BF/","excerpt":"å‰è¨€æœ¬ç§‘æ¯•ä¸šäº†ï¼Œç„¶åä¾‹è¡Œçš„ä¸€å­¦æœŸä¸€æ€»ç»“ä¸€ç›´æ‹–ç€æ²¡æœ‰å†™ï¼Œå…¶å®è‡ªå·±ä¹Ÿä¸çŸ¥é“è¯¥æ€ä¹ˆå»å†™ï¼Œå†™äº›å•¥ï¼Œç„¶åå°±è¿™ä¹ˆæ‹–ç€æ‹–åˆ°äº†7æœˆåº•ã€‚","text":"å‰è¨€æœ¬ç§‘æ¯•ä¸šäº†ï¼Œç„¶åä¾‹è¡Œçš„ä¸€å­¦æœŸä¸€æ€»ç»“ä¸€ç›´æ‹–ç€æ²¡æœ‰å†™ï¼Œå…¶å®è‡ªå·±ä¹Ÿä¸çŸ¥é“è¯¥æ€ä¹ˆå»å†™ï¼Œå†™äº›å•¥ï¼Œç„¶åå°±è¿™ä¹ˆæ‹–ç€æ‹–åˆ°äº†7æœˆåº•ã€‚ å¹²äº†äº›å•¥å¤è¯•æœ€åä¸€å­¦æœŸå¦‚æœæŒ‰ç…§åˆ°æ ¡çš„æ—¶é—´ä½œä¸ºå¼€å­¦çš„ç¬¬ä¸€å¤©çš„è¯ï¼Œé‚£ä¹ˆæˆ‘çš„å¼€å­¦æ—¶é—´æœ‰äº›æ—©ï¼Œç„¶åå°±æ˜¯æ…¢æ…¢æ‚ æ‚ çš„å‡†å¤‡å¤è¯•ï¼Œå…³äºè€ƒç ”çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œä¸ªäººä¸æƒ³å†å¤šå†™äº›å•¥å­ï¼Œæ€»ä¹‹ï¼Œç»å†äº†å°±è¡Œã€‚ç¡®å®šæœ‰ä¹¦è¯»ä¹‹åï¼Œå°±ç›´æ¥å»æ‰¾äº†å·¥ä½œå¹²äº†ã€‚å·¥ä½œå®ä¹ å·¥ä½œæ˜¯ä»4æœˆä¸­æ—¬å¼€å§‹ï¼ŒæœŸé—´å› ä¸ºå…¬å¸ç»Ÿä¸€ä½¿ç”¨çš„æ˜¯Winidowsç³»ç»Ÿï¼Œæ‰€ä»¥è‡ªå·±åˆæ¢äº†ä¸ªç³»ç»Ÿç›˜ï¼Œç„¶åä¸€æ­¥ä¸€æ­¥æŒ‰ç…§å…¬å¸çš„æ–‡æ¡£é…ç½®ç¯å¢ƒï¼Œå®Œå…¨æ˜¯çå­æ‘¸è±¡ï¼Œè‡ªå·±æ…¢æ…¢çš„å»æ‘¸ç´¢ï¼Œå› ä¸ºç®¡çš„ä¸æ˜¯å¾ˆä¸¥ï¼Œæ‰€ä»¥åœ¨ç©ºä½™æ—¶é—´æ·±åŒ–å­¦ä¹ äº†gitï¼Œå°è¯•å»çœ‹äº†flaskçš„æºç ï¼Œæœ¬æ¥è®¡åˆ’å¹²åˆ°6æœˆä»½ï¼Œ5æœˆåˆçš„æ—¶å€™ï¼Œä½•è€å¸ˆå¼€å§‹å‚¬ä¿ƒæˆ‘ä»¬è¦æŠ“ç´§åšæ¯•è®¾äº†ï¼Œå½“åˆè‡ªå·±å®Œå…¨æ²¡æœ‰å¼€å§‹åšï¼Œåªæ˜¯å»äº†è§£äº†è‡ªå·±è§‰å¾—éœ€è¦ç”¨åˆ°çš„æŠ€æœ¯ï¼Œåé¢å‘ç°äº‹æƒ…å¼€å§‹å¤šäº†èµ·æ¥ï¼Œå¦‚æœè‡ªå·±è¿˜ä¸å¼€å§‹å‡†å¤‡çš„è¯ï¼Œå°±è¦å»¶è¿Ÿæ¯•ä¸šäº†ã€‚ç„¶åæœæ–­å’Œleaderæå‡ºäº†è¾èŒï¼Œå¼€å§‹ä¸€å¿ƒå‡†å¤‡è‡ªå·±çš„æ¯•ä¸šè®¾è®¡ã€‚èµ¶æ¯•è®¾æ•´ä¸ªæ¯•è®¾å¦‚æœç®—å…¨éƒ¨éƒ½åœ¨åšçš„æ—¶é—´çš„è¯ï¼Œåº”è¯¥æœ‰ä¸ª240ä¸ªå°æ—¶å·¦å³ï¼Œä¸»è¦æ˜¯è®ºæ–‡ï¼Œç°åœ¨è¿˜è®°å¾—è¢«è®ºæ–‡æ”¯é…ææƒ§ï¼Œä¸€å…±ç»™ä½•è€å¸ˆå‘äº†6ä¸ªç‰ˆæœ¬ï¼Œç¬¬ä¸€ä¸ªç‰ˆæœ¬æ ¼å¼ä¹±çš„æ²¡åŠæ³•çœ‹ï¼Œç¬¬äºŒ-å››ç‰ˆæœ¬ä¸åœçš„æŒ‰ç…§è¦æ±‚æ”¹å†…å®¹ï¼Œç¬¬äº”ç‰ˆæœ¬ï¼Œè€å¸ˆè¯´å¥¹æ„Ÿè§‰è®ºæ–‡å†™çš„å¤ªåƒä¸€ä¸ªæ–‡æ¡£ï¼Œç„¶åæœ€åæˆ‘åˆå¼€å§‹å¤§æ”¹ï¼ŒæœŸé—´è¿˜é€šå®µäº†ä¸‰æ¬¡ï¼Œç»ˆäºåœ¨æˆªæ­¢è®ºæ–‡æäº¤å½“å¤©å®Œæˆäº†è¦æ±‚ã€‚å¯¹äºä¸ªäººçš„æ¯•ä¸šè®¾è®¡ï¼Œæˆ‘è§‰å¾—è‡ªå·±æ ¸å¿ƒçš„å†…å®¹å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œåè€ŒCoookiesæ± å’ŒIpProxyæ± åšçš„å¾ˆå¥½ç­”è¾©6æœˆåˆå¼€å§‹çš„æ¯•ä¸šç­”è¾©ï¼Œå…·ä½“å‡ å·å¿˜äº†ã€‚æˆ‘çš„å·æ¯”è¾ƒé åï¼Œè‡ªå·±å¬äº†ä¸€äº›å‰é¢çš„åŒå­¦çš„ç­”è¾©ï¼Œæ„Ÿè§‰ä¸€èˆ¬ï¼Œè‡ªå·±æœŸé—´å‡†å¤‡äº†ä¸‹è‡ªå·±å¯èƒ½ä¼šè¢«é—®åˆ°çš„é—®é¢˜ï¼Œç„¶åå°±å’Œå¥³æœ‹å‹è¿˜æœ‰åŸºå‹åœ¨é‚£å„¿å¹å£³å­äº†ã€‚ä»¥ä¸‹ä¸ºè‡ªå·±å’Œæ²ˆæ€»äº’æ‹çš„ç­”è¾©ç…§ç‰‡ ã€Šå¤§å››ä¸‹å­¦æœŸæ€»ç»“ --- å„å¥”ä¸œè¥¿ã€‹ ã€Šå¤§å››ä¸‹å­¦æœŸæ€»ç»“ --- å„å¥”ä¸œè¥¿ã€‹ æˆ‘ç°åœ¨è¿˜è®°å¾—è‡ªå·±ç­”è¾©å®Œï¼Œå°ä¸‹ä¸€å¥è¯éƒ½æ²¡æœ‰ï¼Œè€å¸ˆäº†ç­‰äº†è¿‘ä¸€åˆ†é’Ÿæ‰å¼€å§‹é—®é—®é¢˜â€¦.. å¯èƒ½æ˜¯è‡ªå·±åšçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬é‚£ç»„ç­”è¾©è€å¸ˆæ¶‰åŠçš„ä¸å¤šå§ã€‚æœ€åé—®äº†å‡ ä¸ªæ¯”è¾ƒé¶¸çš„é—®é¢˜æ•£ä¼™é¥­å…ˆæ˜¯ç­çº§èšé¤ï¼Œåœ¨å­¦æ ¡å¤–é¢çš„çƒ§çƒ¤åº—ï¼Œæ„Ÿè§‰é‚£æ¬¡æ˜¯æˆ‘ç›®å‰å–é…’å–æœ€å¤šçš„ä¸€æ¬¡äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰é†‰(ï¿£â–½ï¿£â€)æ¥ä¸‹æ¥æ˜¯æˆ‘å’Œæ²ˆæ€»ä¸€èµ·è¯·äº†ä½•è€å¸ˆåƒäº†ä¸€é¡¿é¥­ï¼Œè™½ç„¶è¯´æ˜¯è¯·ï¼Œä½†æ˜¯ç°åœ¨æˆ‘è¿˜æ²¡æœ‰æŠŠé¥­å‰è½¬ç»™æ²ˆæ€»(ãƒ»Ï‰ãƒ»)ï¼Œä½•è€å¸ˆè¿˜å’Œæˆ‘ä»¬è¯´ï¼Œæˆ‘ä»¬ç­”è¾©å°ç»„åŸå®šçš„äº‰ä¼˜ç­”è¾©çš„é‚£ä¸ªåŒå­¦å¼ƒæƒäº†ï¼Œå…¶ä»–è€å¸ˆæƒ³è®©æˆ‘å»äº‰ä¼˜ï¼Œç„¶åä½•è€å¸ˆäº†è§£æˆ‘æ¯•è®¾çš„å…·ä½“æƒ…å†µï¼Œå¸®æˆ‘æ‹’ç»äº†ï¼ŒçœŸæ˜¯è™šæƒŠä¸€åœºå‘¢ã€‚ç„¶åé¢†æ¯•ä¸šè¯çš„æ—¶å€™ï¼Œå…¨å¯å®¤ä¸€èµ·åƒäº†ä¸€é¡¿ç«é”…ã€‚æœ€åï¼Œä¹Ÿå°±æ˜¯22å·é‚£å¤©å§ï¼Œå› ä¸ºä¸€äº›åŸå› ï¼Œè‡ªå·±23å·æ‰å›æ­ï¼Œç„¶åå®¿ç®¡å¤§ä¼¯é€šçŸ¥çš„æ˜¯23å‰æ‰€æœ‰äººè¦æ¬ç¦»å¯å®¤ï¼Œå’Œå¤§ä¼¯è¯´æ˜æƒ…å†µä¹‹åï¼Œè‡ªå·±å¾…åœ¨å¯å®¤äº²çœ¼çœ‹åˆ°äº†æ•´ä¸ªç­çº§çš„åŒå­¦ä¸€ä¸ªä¸€ä¸ªèµ°äº†ï¼Œé‚£ä¸ªæ—¶å€™æ‰æ„Ÿè§‰åˆ°åŸæ¥æœ¬ç§‘çœŸçš„æ¯•ä¸šäº†ã€‚é‚£å¤©æ™šä¸Šæ•´ä¸ªäººéƒ½ä¸å¥½äº†ï¼Œå…¨å¯å®¤æ¥¼å‡ºå¥‡çš„å®‰é™ï¼Œå¾ˆæ¸—äººã€‚ ç»“å°¾æ—¶é—´çœŸçš„æŒºå¿«çš„ï¼Œå›æƒ³è‡ªå·±æœ¬ç§‘çš„ç”Ÿæ´»ï¼Œç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬çš„è¯åº”è¯¥å°±æ˜¯äº«å—ç”Ÿæ´»ã€éšæ—¶å…»è€äº†ï¼Œè´¼å–œæ¬¢å¤§äºŒå¤§ä¸‰æ¯æ¬¡åšé¡¹ç›®å‘é’±äº†ï¼Œæ‹‰ç€æ²ˆæ€»å»æ­£é—¨äº«å—ç”Ÿæ´»ï¼Œæ”¹å–„ä¼™é£Ÿçš„æ—¥å­ï¼Œè™½ç„¶åŸºæœ¬æ¯æ¬¡éƒ½æ˜¯å»åƒç«é”…ï¼Œç„¶ååƒå®Œå‘èª“ä¸‹æ¬¡åšå†³ä¸å†åƒç«é”…ã€‚","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://winniekun.github.io/tags/%E6%80%BB%E7%BB%93/"}]},{"title":"é€‰æ‹©æ’åº","slug":"ç®—æ³•/æ’åº/é€‰æ‹©æ’åº","date":"2019-05-30T12:11:52.000Z","updated":"2020-08-30T04:50:22.261Z","comments":true,"path":"é€‰æ‹©æ’åº/","link":"","permalink":"https://winniekun.github.io/%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/","excerpt":"é€‰æ‹©æ’åº","text":"é€‰æ‹©æ’åº æ¯æ¬¡æ‰¾å‡ºç¬¬$i$å°çš„å…ƒç´ ï¼ˆ$Ai..n$ä¸­æœ€å°çš„å…ƒç´ ï¼‰ï¼Œç„¶åå°†è¿™ä¸ªå…ƒç´ å’Œæ•°ç»„ä¸­ç¬¬$i$ä¸ªå…ƒç´ äº¤æ¢ä½ç½® æ—¶é—´å¤æ‚åº¦ï¼š $O(n^2)$ å› ä¸ºäº¤æ¢æ“ä½œçš„å­˜åœ¨ï¼Œæ‰€ä»¥é€‰æ‹©æ’åºæ˜¯ä¸ç¨³å®šæ’åº ä¼ªä»£ç $ \\begin{array}{ll} 1 &amp; \\textbf{Input. } \\text{An array } A \\text{ consisting of }n\\text{ elements.} \\newline 2 &amp; \\textbf{Output. } A\\text{ will be sorted in nondecreasing order.} \\newline 3 &amp; \\textbf{Method. } \\newline 4 &amp; \\textbf{for } i\\gets 1\\textbf{ to }n-1 \\newline 5 &amp; \\qquad ith\\gets i\\newline 6 &amp; \\qquad \\textbf{for }j\\gets i+1\\textbf{ to }n\\newline 7 &amp; \\qquad\\qquad\\textbf{if }A[j] &lt; A[ith]\\newline 8 &amp; \\qquad\\qquad\\qquad ith\\gets j\\newline 9 &amp; \\qquad \\text{swap }A[i]\\text{ and }A[ith]\\newline \\end{array} $ Javaå®ç°public void selectionSort(int[] nums){ for(int i = 0; i&lt;nums.length; i++){ int ith = i; // è®°å½•å½“å‰éœ€è¦é€‰å–çš„ç¬¬iä¸ªæœ€å°å…ƒç´  for(int j = i+1; j&lt;nums.length; j++){ if(nums[j] &lt; nums[ith]){ ith = j; } } int temp = nums[i]; nums[i] = nums[ith]; nums[ith] = temp; } } over","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[{"name":"é€‰æ‹©","slug":"é€‰æ‹©","permalink":"https://winniekun.github.io/tags/%E9%80%89%E6%8B%A9/"}]},{"title":"Bæ ‘ç³»åˆ—","slug":"æ•°æ®ç»“æ„/Bæ ‘ç³»åˆ—","date":"2019-05-17T11:25:36.000Z","updated":"2020-08-30T04:50:22.254Z","comments":true,"path":"Bæ ‘ç³»åˆ—/","link":"","permalink":"https://winniekun.github.io/B%E6%A0%91%E7%B3%BB%E5%88%97/","excerpt":"Bæ ‘å…±åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œ é¦–å…ˆæ˜¯Bçš„æ€§è´¨ã€Bæ ‘çš„å»ºç«‹ã€æ’å…¥å’Œåˆ é™¤ï¼Œä¹‹åæ˜¯B+æ ‘æ€§è´¨ã€ä»¥åŠç›¸æ¯”äºBæ ‘ï¼ŒåŒºåˆ«åœ¨å“ªå„¿","text":"Bæ ‘å…±åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œ é¦–å…ˆæ˜¯Bçš„æ€§è´¨ã€Bæ ‘çš„å»ºç«‹ã€æ’å…¥å’Œåˆ é™¤ï¼Œä¹‹åæ˜¯B+æ ‘æ€§è´¨ã€ä»¥åŠç›¸æ¯”äºBæ ‘ï¼ŒåŒºåˆ«åœ¨å“ªå„¿ Bæ ‘çš„æ€§è´¨Bæ ‘åˆç§°ä¸ºå¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼ŒBæ ‘ä¸­æ‰€æœ‰ç»“ç‚¹çš„å­©å­ç»“ç‚¹æ•°çš„æœ€å¤§å€¼ç§°ä¸ºBæ ‘çš„é˜¶ã€‚é€šå¸¸ä½¿ç”¨mè¡¨ç¤ºã€‚ ä¸€é¢—mé˜¶Bæ ‘æˆ–ä¸ºç©ºï¼Œæˆ–ä¸ºæ»¡è¶³å¦‚ä¸‹ç‰¹æ€§çš„må‰æ ‘ã€‚ æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹è‡³å¤šæœ‰mé¢—å­æ ‘ï¼ˆm-1å…³é”®å­—ï¼‰ è‹¥æ˜¯æ ¹èŠ‚ç‚¹ä¸æ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼Œè‡³å°‘æœ‰ä¸¤é¢—å­æ ‘ é™¤æ ¹ä»¥å¤–çš„æ‰€æœ‰éå¶å­èŠ‚ç‚¹è‡³å°‘ $\\lceil m/2 \\rceil$ é¢—å­æ ‘ï¼ˆ$\\lceil m/2 \\rceil $ -1 å…³é”®å­—ï¼‰ æ‰€æœ‰çš„éå¶å­ç»“ç‚¹çš„ç»“æ„å¦‚ä¸‹ï¼š æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½å‡ºç°åœ¨åŒä¸€å±‚æ¬¡ä¸Šï¼Œå¹¶ä¸”ä¸å¸¦ä»»ä½•ä¿¡æ¯ bæ ‘ç¤ºä¾‹.png Bæ ‘çš„é«˜åº¦$ n$ : å…³é”®å­—çš„ä¸ªæ•° $h \\le log_\\lceil m/2 \\rceil ((n+1)/2) + 1 $ å…·ä½“çš„è¯æ˜ï¼Œç™¾åº¦ã€‚ã€‚ã€‚ Bæ ‘çš„æŸ¥æ‰¾å› ä¸ºå…¶æ˜¯æœ‰åºçš„ï¼Œå…¶å’ŒäºŒå‰æœç´¢æ ‘çš„æŸ¥æ‰¾ç±»ä¼¼ï¼Œåªä¸è¿‡ä¸åŒçš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹å…¶æœ‰å¤šä¸ªå…³é”®å­—çš„æœ‰åºè¡¨ï¼Œç„¶åæ ¹æ®è¯¥èŠ‚ç‚¹çš„å­æ ‘åšå¤šè·¯åˆ†æ”¯å†³å®šã€‚ åŸºæœ¬æ­¥éª¤ åœ¨Bæ ‘ä¸­æ‰¾åˆ°èŠ‚ç‚¹ åœ¨èŠ‚ç‚¹å†…æ‰¾åˆ°å…³é”®å­— ç”±äºBæ ‘é€šå¸¸æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œ æ‰€æœ‰ç¬¬ä¸€æ¬¡æ˜¯åœ¨ç£ç›˜ä¸Šè¿›è¡Œï¼Œ ä¹‹åç¬¬äºŒæ¬¡åœ¨å†…å­˜ä¸­è¿è¡Œï¼Œå³åœ¨æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ä¹‹åï¼Œå°†å…¶å‚¨å­˜å†…å­˜ä¹‹åï¼Œ ç„¶åä½¿ç”¨é¡ºåºæŸ¥æ‰¾æˆ–è€…æŠ˜åŠæŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾ç­‰äºKçš„å…³é”®å­—ã€‚ Bæ ‘çš„æ’å…¥ã€Bæ ‘çš„åˆ é™¤å¯æ ¹æ®å‚è€ƒä¹¦å’Œå¯è§†åŒ–ç½‘ç«™è¿›è¡Œç†è§£ Bæ ‘æ¯ä¸ªèŠ‚ç‚¹çš„å…³é”®å­—ä¸ªæ•°èŒƒå›´ $[\\lceil m/2 \\rceil -1 , m-1]$ å…¶ä¸­åˆ é™¤çš„æ“ä½œå…±åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œå¹¶ä¸”è¿™ä¸¤ç§æƒ…å†µåˆæœ‰ç»†åˆ† åˆ é™¤å…³é”®å­—kä¸ºéç»ˆç«¯èŠ‚ç‚¹ï¼ˆç»ˆç«¯èŠ‚ç‚¹ != å¶å­èŠ‚ç‚¹ï¼‰å…¶å®å’ŒAVLçš„åˆ é™¤æ˜¯å¦‚å‡ºä¸€è¾™çš„ å°äºkçš„å­æ ‘ä¸­å…³é”®å­—çš„ä¸ªæ•° &gt; $\\lceil m/2 \\rceil -1$ åˆ™æ‰¾å‡ºkçš„å‰é©±kâ€™æ›¿ä»£kï¼Œ å†é€’å½’çš„åˆ é™¤kâ€˜ å¤§äºkçš„å­æ ‘ä¸­å…³é”®å­—çš„ä¸ªæ•° &gt; $\\lceil m/2 \\rceil -1$ åˆ™æ‰¾å‡ºkçš„åç»§kâ€™æ›¿ä»£kï¼Œ å†é€’å½’çš„åˆ é™¤kâ€™ kçš„å·¦å³å­æ ‘çš„å…³é”®å­—ä¸ªæ•° å‡ä¸º $\\lceil m/2 \\rceil-1$ åˆ™è¿›è¡Œåˆå¹¶ä¸¤ä¸ªå­æ ‘ï¼Œç„¶ååˆ é™¤kå³å¯ åˆ é™¤å…³é”®å­—kä¸ºç»ˆç«¯èŠ‚ç‚¹ å¦‚æœkæ‰€åœ¨çš„èŠ‚ç‚¹å…³é”®å­—ä¸ªæ•°&gt; $\\lceil m/2 \\rceil -1$ ç›´æ¥åˆ é™¤ kæ‰€åœ¨çš„èŠ‚ç‚¹å…³é”®å­—ä¸ªæ•°=$\\lceil m/2 \\rceil -1$ å…„å¼Ÿå¤Ÿå€Ÿ å…„å¼Ÿä¸å¤Ÿå€Ÿ B+æ ‘B+æ ‘çš„æ€§è´¨B+æ ‘æ˜¯åº”æ•°æ®åº“çš„æ‰€éœ€ï¼Œ æ‰€å‡ºç°çš„ä¸€ç§Bæ ‘çš„å˜å½¢ ä¸€é¢—mé˜¶çš„B+æ ‘éœ€æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ æ¯ä¸ªåˆ†æ”¯èŠ‚ç‚¹æœ€å¤šæœ‰mé¢—å­æ ‘ éå¶å­çš„æ ¹èŠ‚ç‚¹è‡³å°‘æœ‰ä¸¤é¢—å­æ ‘ï¼Œå…¶ä»–çš„åˆ†æ”¯èŠ‚ç‚¹è‡³å°‘æœ‰$\\lceil m/2 \\rceil $ é¢—å­æ ‘ èŠ‚ç‚¹çš„å­æ ‘ä¸ªæ•°å’Œå…³é”®å­—ä¸ªæ•°ç›¸ç­‰ æ‰€æœ‰å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰å…³é”®å­—åŠæŒ‡å‘ç›¸åº”è®°å½•çš„æŒ‡é’ˆï¼Œå¹¶ä¸”å¶å­èŠ‚ç‚¹å°†å…³é”®å­—æŒ‰å¤§å°é¡ºåºæ’åˆ—ï¼Œå¹¶ä¸”ç›¸é‚»å¶èŠ‚ç‚¹æŒ‰å¤§å°é¡ºåºç›¸äº’é“¾æ¥èµ·æ¥ æ‰€æœ‰åˆ†æ”¯èŠ‚ç‚¹ä¸­ä»…åŒ…å«å®ƒçš„å„ä¸ªå­èŠ‚ç‚¹ä¸­å…³é”®å­—çš„æœ€å¤§å€¼å’ŒæŒ‡å‘è¯¥å­æ ‘çš„æŒ‡é’ˆ B+æ ‘ç»“æ„ç¤ºæ„å›¾ B_æ ‘ç»“æ„ç¤ºæ„å›¾.png B+æ ‘çš„æ€§è´¨IIï¼šæ‰å‘ç°ï¼ŒåŸæ¥å„ç§èµ„æ–™ä¸Šå…³äºB+æ ‘çš„æ€§è´¨ï¼Œä¸ç»ç›¸åŒâ€¦.. ä»¥ä¸‹ä¸ºç»´åŸºç™¾ç§‘çš„å®šä¹‰ å’Œç‹é“çš„å®šä¹‰åŒºåˆ«ä¸å¤§ï¼Œä½†æ˜¯åˆ†æ”¯èŠ‚ç‚¹å…³é”®å­—ä¸ªæ•°æ¯”å­æ ‘ä¸ªæ•°å°1ï¼Œ ä¹Ÿå°±æ˜¯å’ŒBçš„èŠ‚ç‚¹å®šä¹‰ä¸€æ ·ã€‚ 1ï¼‰B+æ ‘åŒ…å«2ç§ç±»å‹çš„ç»“ç‚¹ï¼šå†…éƒ¨ç»“ç‚¹ï¼ˆä¹Ÿç§°ç´¢å¼•ç»“ç‚¹ï¼‰å’Œå¶å­ç»“ç‚¹ã€‚æ ¹ç»“ç‚¹æœ¬èº«å³å¯ä»¥æ˜¯å†…éƒ¨ç»“ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¶å­ç»“ç‚¹ã€‚æ ¹ç»“ç‚¹çš„å…³é”®å­—ä¸ªæ•°æœ€å°‘å¯ä»¥åªæœ‰1ä¸ªã€‚ 2ï¼‰B+æ ‘ä¸Bæ ‘æœ€å¤§çš„ä¸åŒæ˜¯å†…éƒ¨ç»“ç‚¹ä¸ä¿å­˜æ•°æ®ï¼Œåªç”¨äºç´¢å¼•ï¼Œæ‰€æœ‰æ•°æ®ï¼ˆæˆ–è€…è¯´è®°å½•ï¼‰éƒ½ä¿å­˜åœ¨å¶å­ç»“ç‚¹ä¸­ã€‚ 3ï¼‰ mé˜¶B+æ ‘è¡¨ç¤ºäº†å†…éƒ¨ç»“ç‚¹æœ€å¤šæœ‰m-1ä¸ªå…³é”®å­—ï¼ˆæˆ–è€…è¯´å†…éƒ¨ç»“ç‚¹æœ€å¤šæœ‰mä¸ªå­æ ‘ï¼‰ï¼Œé˜¶æ•°måŒæ—¶é™åˆ¶äº†å¶å­ç»“ç‚¹æœ€å¤šå­˜å‚¨m-1ä¸ªè®°å½•ã€‚ 4ï¼‰å†…éƒ¨ç»“ç‚¹ä¸­çš„keyéƒ½æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºæ’åˆ—ï¼Œå¯¹äºå†…éƒ¨ç»“ç‚¹ä¸­çš„ä¸€ä¸ªkeyï¼Œå·¦æ ‘ä¸­çš„æ‰€æœ‰keyéƒ½å°äºå®ƒï¼Œå³å­æ ‘ä¸­çš„keyéƒ½å¤§äºç­‰äºå®ƒã€‚å¶å­ç»“ç‚¹ä¸­çš„è®°å½•ä¹ŸæŒ‰ç…§keyçš„å¤§å°æ’åˆ—ã€‚ 5ï¼‰æ¯ä¸ªå¶å­ç»“ç‚¹éƒ½å­˜æœ‰ç›¸é‚»å¶å­ç»“ç‚¹çš„æŒ‡é’ˆï¼Œå¶å­ç»“ç‚¹æœ¬èº«ä¾å…³é”®å­—çš„å¤§å°è‡ªå°è€Œå¤§é¡ºåºé“¾æ¥ã€‚ B+æ ‘ç»“æ„ç¤ºæ„å›¾IIä¸‹å›¾ä¸ºä¸€ä¸ªä¸‰é˜¶B+æ ‘çš„ç¤ºæ„å›¾ B_æ ‘ç»“æ„ç¤ºæ„å›¾.png Bå’ŒB+åŒºåˆ« B+ trees donâ€™t store data pointer in interior nodes, they are ONLY stored in leaf nodes. This is not optional as in B-Tree. This means that interior nodes can fit more keys on block of memory and thus fan out better. The leaf nodes of B+ trees are linked, so doing a linear scan of all keys will requires just one pass through all the leaf nodes. A B tree, on the other hand, would require a traversal of every level in the tree. This property can be utilized for efficient search as well, since data is stored only in leafs. B+å†…éƒ¨èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨ä¿¡æ¯ï¼ŒBæ ‘æ²¡æœ‰ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ï¼ŒB+æ ‘æ¯”Bæ ‘çš„å†…éƒ¨èŠ‚ç‚¹èƒ½å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ B+æ ‘å¶èŠ‚ç‚¹çš„æ•°æ®æ˜¯é“¾æ¥çš„ï¼Œå¯åšä¸€æ¬¡çº¿æ€§æ‰«æè·å–æ‰€æœ‰çš„æ•°æ®ï¼Œ ä½†æ˜¯Bæ ‘å°±éœ€è¦éå†æ•´ä¸ªBæ ‘ æŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤B+å’ŒBæ ‘ç›¸åŒï¼Œä½†æ˜¯å¯¹äºæŸ¥æ‰¾è€Œè¨€ï¼Œå¦‚æœéå¶å­èŠ‚ç‚¹ä¸Šå…³é”®å­—å€¼ç­‰äºç»™å®šå€¼æ—¶ï¼Œå¹¶ä¸ç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å¶å­èŠ‚ç‚¹ä¸Šçš„è¯¥å…³é”®å­—ä¸ºæ­¢ã€‚æ‰€ä»¥ï¼ŒB+æ ‘çš„æŸ¥æ‰¾ï¼Œæ— è®ºæˆåŠŸä¸å¦ï¼Œæ¯æ¬¡éƒ½æ˜¯ä¸€æ¡ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚ reference ç‹é“æ•°æ®ç»“æ„ B+ tree Bæ ‘å’ŒB+æ ‘çš„æ’å…¥ã€åˆ é™¤å›¾æ–‡è¯¦è§£ Memory locality &amp; the magic of B-Trees!","categories":[{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://winniekun.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}],"tags":[{"name":"Bæ ‘","slug":"Bæ ‘","permalink":"https://winniekun.github.io/tags/B%E6%A0%91/"}]},{"title":"å¤§å››ä¸Šå­¦æœŸæ€»ç»“---æ…¢ç…¨æ…¢ç‚–","slug":"æ€»ç»“/å¤§å››ä¸Šå­¦æœŸæ€»ç»“-æ…¢ç…¨æ…¢ç‚–","date":"2019-04-22T16:00:00.000Z","updated":"2020-08-30T04:50:22.253Z","comments":true,"path":"å¤§å››ä¸Šå­¦æœŸæ€»ç»“-æ…¢ç…¨æ…¢ç‚–/","link":"","permalink":"https://winniekun.github.io/%E5%A4%A7%E5%9B%9B%E4%B8%8A%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93-%E6%85%A2%E7%85%A8%E6%85%A2%E7%82%96/","excerpt":"å‰è¨€è¿™å­¦æœŸéƒ½å·²ç»è¿‡åŠäº†ï¼Œå› ä¸ºå¼€å­¦ä¸€ç›´æœ‰äº‹æƒ…ï¼Œå°±ä¸€ç›´æ‹–åˆ°ç°åœ¨ã€‚","text":"å‰è¨€è¿™å­¦æœŸéƒ½å·²ç»è¿‡åŠäº†ï¼Œå› ä¸ºå¼€å­¦ä¸€ç›´æœ‰äº‹æƒ…ï¼Œå°±ä¸€ç›´æ‹–åˆ°ç°åœ¨ã€‚ æ€»ç»“ å­¦ä¹ ä¸Šä¸Šå­¦æœŸåŸºæœ¬å°±æ˜¯ä¸‰ç‚¹ä¸€çº¿çš„ç”Ÿæ´»ï¼Œå¯å®¤ &lt;â€”-&gt; å›¾ä¹¦é¦† &lt;â€”-&gt; é£Ÿå ‚å…¶å®æ²¡æœ‰å•¥å¥½æ€»ç»“çš„ï¼Œæ„Ÿè§‰çš„è¯ï¼Œè‡ªå·±çš„è®¡ç®—æœºåŸºç¡€çš„ç¡®æ˜¯æ·±åŒ–äº†ï¼Œé‚£å‡ ä¸ªæœˆçš„ç¡® å¾ˆéš¾å—ï¼Œå‘¨å›´çš„æœ‹å‹å®ä¹ çš„å»å®ä¹ äº†ï¼Œä¿ç ”çš„ä¿ç ”äº†ï¼Œè‡ªå·±ä¸€ç›´è¿˜æ²¡æœ‰ç¡®å®šä¸‹æ¥ã€‚ä¸è¿‡å¥½å¤„è¿˜æ˜¯æœ‰çš„ï¼Œè‡ªå·±æ·±åˆ»çš„ä½“ä¼šåˆ°äº†å›¢é˜Ÿçš„é‡è¦æ€§ï¼Œä¹‹å‰ä¸€ç›´è®¤ä¸ºä»»ä½•æ—¶å€™ï¼Œ è‡ªå·±ä¸€ä¸ªäººç»ˆç©¶å¥½æ¯”è¿‡ä¸€å †äººä¸€èµ·ã€‚ä¸ç®¡æ˜¯ä»æ•ˆç‡ä¸Šæ¥è®²è¿˜æ˜¯ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œä½†æ˜¯ ç»è¿‡ä¸Šå­¦æœŸçš„å¤‡è€ƒï¼Œæ„Ÿè§‰åˆ°äº†å½“å¤§å®¶å…±åŒä¸ºä¸€ä¸ªç›®æ ‡åŠªåŠ›çš„æ—¶å€™ï¼Œé‚£ç§æ•ˆç‡å’Œè‡ªæ§ åŠ›æ˜¯å¾ˆé«˜çš„ã€‚ æŠ€æœ¯ä¸Šå¤§æ¦‚æœ‰è¿›åŠå¹´æ²¡æœ‰æ’¸è¿‡ä»£ç å§ï¼Œåšå®¢ä¹Ÿæ²¡æœ‰æ›´æ–°è¿‡äº†ï¼Œç¼–ç èƒ½åŠ›è®²çœŸæ˜¯æœ‰ä¸€å®šçš„é€€æ­¥çš„ï¼Œä½†æ˜¯ç›®å‰çš„æ„Ÿè§‰æ˜¯æ¯”ä¹‹ä¹‹å‰çš„å­¦ä¹ é€Ÿåº¦å¿«äº†ï¼ˆåœ¨è„‘å­ä¿æŒæ¸…é†’çš„æƒ…å†µä¸‹ï¼‰ï¼Œè‡ªå·±ç°åœ¨ä¸æ˜¯å¾ˆçƒ­è¡·äºå»äº†è§£å’ŒæŒæ¡ä¸€äº›æ¡†æ¶çš„ä½¿ç”¨ï¼Œåè€Œå¯¹ä¸€äº›çš„ç®—æ³•çš„ç ”ç©¶æ¯”è¾ƒæ„Ÿå…´è¶£äº†ï¼Œè™½ç„¶çœ‹çš„äº‘é‡Œé›¾é‡Œçš„ã€‚è‡ªå·±åœ¨æå®¢ä¸Šä¹°äº†æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾è¿™ä¸ªè¯¾ç¨‹ï¼Œè§‰å¾—ä½œè€…çš„ç†è§£å¾ˆæ£’ï¼Œå¹¶ä¸æ˜¯ç†è®ºå±‚é¢çš„ï¼Œè€Œæ˜¯ç»“åˆäº†çœŸæ­£çš„å®é™…å¼€å‘ä¸­çš„å„ä¸ªæƒ…å†µï¼Œå¸Œæœ›è‡ªå·±æœ‰æœä¸€æ—¥èƒ½æœ‰å¦‚æ­¤è§è§£ ç”Ÿæ´»ä¸Šæœ‰æ—¶å€™é€‰æ‹©æ¯”åŠªåŠ›æ›´é‡è¦æ²¡æœ‰ä»€ä¹ˆæ‰€è°“çš„happily ever after","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://winniekun.github.io/tags/%E6%80%BB%E7%BB%93/"}]},{"title":"finalã€staticã€thisã€superå…³é”®å­—æ€»ç»“","slug":"JavaåŸºç¡€/finalã€staticã€thisã€superå…³é”®å­—æ€»ç»“","date":"2019-04-10T01:47:33.000Z","updated":"2020-08-30T04:50:22.243Z","comments":true,"path":"finalã€staticã€thisã€superå…³é”®å­—æ€»ç»“/","link":"","permalink":"https://winniekun.github.io/final%E3%80%81static%E3%80%81this%E3%80%81super%E5%85%B3%E9%94%AE%E5%AD%97%E6%80%BB%E7%BB%93/","excerpt":"final static this superå…³é”®å­—æ€»ç»“final å…³é”®å­—ä¸»è¦ç”¨äºä¸‰ä¸ªåœ°æ–¹ï¼šç±»ã€æ–¹æ³•ã€å˜é‡ ç±»ï¼šç”¨finalä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚finalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•ã€‚ æ–¹æ³•ï¼š æ–¹æ³•é”å®šï¼š é˜²æ­¢ä»»ä½•ç»§æ‰¿äº†ç±»ä¿®æ”¹è¯¥æ–¹æ³• æ•ˆç‡ å˜é‡ï¼š å¯¹äºä¸€ä¸ªfinalå˜é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™å…¶æ•°å€¼ä¸€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåˆ™åœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚","text":"final static this superå…³é”®å­—æ€»ç»“final å…³é”®å­—ä¸»è¦ç”¨äºä¸‰ä¸ªåœ°æ–¹ï¼šç±»ã€æ–¹æ³•ã€å˜é‡ ç±»ï¼šç”¨finalä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œè¡¨æ˜è¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚finalç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•éƒ½ä¼šè¢«éšå¼åœ°æŒ‡å®šä¸ºfinalæ–¹æ³•ã€‚ æ–¹æ³•ï¼š æ–¹æ³•é”å®šï¼š é˜²æ­¢ä»»ä½•ç»§æ‰¿äº†ç±»ä¿®æ”¹è¯¥æ–¹æ³• æ•ˆç‡ å˜é‡ï¼š å¯¹äºä¸€ä¸ªfinalå˜é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡ï¼Œåˆ™å…¶æ•°å€¼ä¸€æ—¦åœ¨åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½æ›´æ”¹ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œåˆ™åœ¨å¯¹å…¶åˆå§‹åŒ–ä¹‹åä¾¿ä¸èƒ½å†è®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ã€‚ static å…³é”®å­—ä¸»è¦ä¸ºå››ä¸ªåœ°æ–¹æ”¾ï¼š ä¿®é¥°æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ï¼Œ é™æ€ä»£ç å—ã€é™æ€å†…éƒ¨ç±»ã€é™æ€å¯¼åŒ… ä¿®é¥°é™æ€æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³• è¢« static ä¿®é¥°çš„æˆå‘˜å±äºç±»ï¼Œä¸å±äºå•ä¸ªè¿™ä¸ªç±»çš„æŸä¸ªå¯¹è±¡ï¼Œè¢«ç±»ä¸­æ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œå¯ä»¥å¹¶ä¸”å»ºè®®é€šè¿‡ç±»åè°ƒç”¨ã€‚è¢«static å£°æ˜çš„æˆå‘˜å˜é‡å±äºé™æ€æˆå‘˜å˜é‡ï¼Œé™æ€å˜é‡ å­˜æ”¾åœ¨ Java å†…å­˜åŒºåŸŸçš„æ–¹æ³•åŒºã€‚è°ƒç”¨æ ¼å¼ï¼šç±»å.é™æ€å˜é‡å ç±»å.é™æ€æ–¹æ³•å() é™æ€ä»£ç å— é™æ€ä»£ç å—å®šä¹‰åœ¨ç±»ä¸­æ–¹æ³•å¤–, ==é™æ€ä»£ç å—åœ¨éé™æ€ä»£ç å—ä¹‹å‰æ‰§è¡Œ(é™æ€ä»£ç å—â€”&gt;éé™æ€ä»£ç å—â€”&gt;æ„é€ æ–¹æ³•)ã€‚ è¯¥ç±»ä¸ç®¡åˆ›å»ºå¤šå°‘å¯¹è±¡ï¼Œé™æ€ä»£ç å—åªæ‰§è¡Œä¸€æ¬¡.== é™æ€å†…éƒ¨ç±» é™æ€å†…éƒ¨ç±»ä¸éé™æ€å†…éƒ¨ç±»ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€å¤§çš„åŒºåˆ«: éé™æ€å†…éƒ¨ç±»åœ¨ç¼–è¯‘å®Œæˆä¹‹åä¼šéšå«åœ°ä¿å­˜ç€ä¸€ä¸ªå¼•ç”¨ï¼Œè¯¥å¼•ç”¨æ˜¯æŒ‡å‘åˆ›å»ºå®ƒçš„å¤–å›´ç±»ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å´æ²¡æœ‰ã€‚æ²¡æœ‰è¿™ä¸ªå¼•ç”¨å°±æ„å‘³ç€ï¼š å®ƒçš„åˆ›å»ºæ˜¯ä¸éœ€è¦ä¾èµ–å¤–å›´ç±»çš„åˆ›å»ºã€‚ å®ƒä¸èƒ½ä½¿ç”¨ä»»ä½•å¤–å›´ç±»çš„éstaticæˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚ é™æ€å¯¼åŒ… mport static è¿™ä¸¤ä¸ªå…³é”®å­—è¿ç”¨å¯ä»¥æŒ‡å®šå¯¼å…¥æŸä¸ªç±»ä¸­çš„æŒ‡å®šé™æ€èµ„æºï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨ç±»åè°ƒç”¨ç±»ä¸­é™æ€æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ä¸­é™æ€æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚ ```javaimport static com.train.keywords.Test.*; public class FinalForKnow { // final ç”¨äº ç±» æ–¹æ³• å˜é‡ private static final String a = \"1123\"; public static void main(String[] args) { System.out.println(a); System.out.println(name); System.out.println(age); // 1123 // ç»´å¤å¤ // 0 } } public class Test { public static int age; public static String name = â€œç»´å¤å¤â€; } ### this å…³é”®å­— å¼•ç”¨ç±»çš„å½“å‰å®ä¾‹ ### super å…³é”®å­— ä»å­ç±»è®¿é—®çˆ¶ç±»çš„æ–¹æ³•å’Œå˜é‡ ```java public class Super { protected int number; protected showNumber() { System.out.println(\"number = \" + number); } } public class Sub extends Super { void bar() { super.number = 10; super.showNumber(); } } åœ¨æ„é€ å™¨ä¸­ä½¿ç”¨ superï¼ˆï¼‰ è°ƒç”¨çˆ¶ç±»ä¸­çš„å…¶ä»–æ„é€ æ–¹æ³•æ—¶ï¼Œè¯¥è¯­å¥å¿…é¡»å¤„äºæ„é€ å™¨çš„é¦–è¡Œï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚å¦å¤–ï¼Œthis è°ƒç”¨æœ¬ç±»ä¸­çš„å…¶ä»–æ„é€ æ–¹æ³•æ—¶ï¼Œä¹Ÿè¦æ”¾åœ¨é¦–è¡Œã€‚ thisã€superä¸èƒ½ç”¨åœ¨staticæ–¹æ³•ä¸­ã€‚","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"}]},{"title":"æ’å…¥æ’åº","slug":"ç®—æ³•/æ’åº/æ’å…¥æ’åº","date":"2019-03-11T09:35:45.000Z","updated":"2020-08-30T04:50:22.261Z","comments":true,"path":"æ’å…¥æ’åº/","link":"","permalink":"https://winniekun.github.io/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/","excerpt":"æ’å…¥æ’åº","text":"æ’å…¥æ’åº å‰è¨€æ’å…¥æ’åºçš„æ€æƒ³å¾ˆç›´è§‚ï¼Œå…¶åœ¨æ€§èƒ½ä¸Šä¸å¦‚ä¸€äº›åˆ†æ²»çš„æ’åºç­–ç•¥ï¼Œä¾‹å¦‚å¿«é€Ÿæ’åºï¼Œå½’å¹¶æ’åºã€‚æ’å…¥æ’åºæ˜¯ä¸€ç§åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ã€‚ ç®—æ³•æ€æƒ³å…¶ç±»ä¼¼äºæ‰“ç‰Œçš„æŠ“ç‰Œç¯èŠ‚ï¼ŒæŠ“åˆ°ç‰Œåéƒ½ä¼šæŒ‰ç…§ç‚¹æ•°æ’å…¥åˆ°åˆé€‚çš„ä½ç½®ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ä¿è¯ä¸€ä¸ªå·²æ’åºåŒºé—´ï¼Œå‰©ä¸‹çš„æœªæ’åºåŒºé—´ä¾æ¬¡ä¸å‰é¢çš„å·²æ’åºåŒºé—´è¿›è¡Œæ¯”è¾ƒï¼Œæ’å…¥åˆ°å¯¹åº”çš„ä½ç½®ã€‚ æ’å…¥æœ‰å…³äºæ’å…¥ï¼Œè‹¥æ˜¯åºåˆ—æ˜¯ä½¿ç”¨æ•°ç»„è¿›è¡Œå­˜å‚¨ï¼Œåˆ™å¯ä»¥ä»å³å‘å·¦æ‰«æå·²æ’åºæ•°ç»„ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥åœ¨æ€§èƒ½ä¸Šæœ‰æ‰€ä¼˜åŒ–ã€‚å› ä¸ºå¯¹äºæ•°ç»„çš„æ’å…¥ï¼Œå…¶ä¸åƒé“¾è¡¨ä¸€æ ·ï¼Œåªéœ€è¦æ–­é“¾ï¼Œç„¶åé“¾æ¥ï¼Œå…¶éœ€è¦ç§»åŠ¨å¤§é‡çš„å…ƒç´ ï¼Œæ‰èƒ½å¤Ÿè¿›è¡Œæ’å…¥ï¼Œè‹¥æ˜¯ä»å·¦å‘å³ï¼Œè­¬å¦‚æ•°ç»„çš„é•¿åº¦ä¸ºnï¼Œåœ¨ä½ç½®iæ’å…¥ï¼Œåˆ™éœ€è¦æ‰«æiæ¬¡ï¼Œç„¶åç§»åŠ¨n-i+1æ¬¡ï¼Œæœ€åæ’å…¥æ•°æ®ã€‚è‹¥æ˜¯ä»å³å‘å·¦ï¼Œæœ€å¤šéœ€è¦iæ¬¡æ‰«æï¼Œç„¶åå¯ä»¥è¾¹æ‰«æè¾¹å³ç§»åŠ¨ åŸºæœ¬æ’å…¥ç®—æ³• å¤æ‚åº¦:O(n^2) æ¯”è¾ƒæ¬¡æ•°ï¼ˆæŸ¥æ‰¾ï¼‰: O(n^2) ç§»åŠ¨æ¬¡æ•°ï¼ˆæ’å…¥åå¯¼è‡´çš„ç§»åŠ¨ï¼‰: O(n^2)def insertSort(arraylist): arrayLen = len(arraylist) for i in range(1, arrayLen): current = arraylist[i] j = i - 1 while j &gt; 0 and arraylist[j] &lt; current: arraylist[j+1] = arraylist[j] j = j - 1 arraylist[j+1] = current return arraylist ä¼˜åŒ–ä¸€ï¼š ä½¿ç”¨é¶¸äºŒåˆ†æŸ¥æ‰¾å› ä¸ºå·²ç»ç¡®å®šäº†å‰é¢çš„æ’åºåŒºé—´æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥ç¡®å®šæ’å…¥çš„ä½ç½®ï¼Œè¿™æ ·æŸ¥æ‰¾çš„æ—¶é—´å°±å¾—åˆ°äº†ä¼˜åŒ– å¤æ‚åº¦: O(n^2) æ¯”è¾ƒæ¬¡æ•°: O(nlgn) ç§»åŠ¨æ¬¡æ•°: O(n^2)```pythondef binarySearch(arraylist, key): low = 0 high = len(arraylist) while low &lt; high: mid = (log + hig)//2 if arraylist[mid] == key: return mid elif arraylist[mid] &gt; key: high = mid else: low = mid + 1 return low def insertSort(arraylist): arrayLen = len(arraylist) for i in range(1, arrayLen): current = arraylist[i] position = binarySearch(arraylist[:i], key) for i in range(i, position, -1): arraylist[i] = arraylist[i-1] arraylist[position] = current return arraylist ## ä¼˜åŒ–äºŒï¼š ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–çš„é“¾è¡¨ ä½¿ç”¨é“¾è¡¨ä¹‹åï¼Œæ”¹å˜å…¶æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¼˜åŒ–æ’å…¥çš„æ—¶é—´ï¼Œç”±æœ€åˆçš„O(n)ä¼˜åŒ–åˆ°äº†O(1) + å¤æ‚åº¦: O(n^2) + æ¯”è¾ƒæ¬¡æ•°: O(n^2) + ç§»åŠ¨æ¬¡æ•°: O(1) ```python def insert(arrayList, next, i): j = -1 # print(\"å½“å‰jä¸º{}, next[j]={}ï¼ŒarrayList[next[j]]={} arrayList[i]={}\".format(j, next[j], arrayList[next[j]], arrayList[i])) while next[j] != -1 and arrayList[next[j]] &lt; arrayList[i]: j = next[j] # print(\"ç›®å‰j={}\".format(j)) next[j], next[i] = i, next[j] # print(\"äº¤æ¢åçš„next[j]={}, next[i]={} \\n\".format(next[j], next[i])) def reorder(arrayList, next): i = -1 ys = [] while next[i] != -1: ys.append(arrayList[next[i]]) i = next[i] return ys def insertSortIII(arrayList): arrayLen = len(arrayList) next = [-1]*(arrayLen+1) for i in range(arrayLen): insert(arrayList, next, i) return reorder(arrayList, next) ä¼˜åŒ–ä¸‰ï¼š ç»ˆæè¿›åŒ–ä¹‹äºŒå‰æœç´¢æ ‘å¯¹äºä»¥ä¸Šçš„ä¼˜åŒ–ï¼Œåªèƒ½åœ¨æ’å…¥å’ŒæŸ¥æ‰¾ä¹‹ä¸­äºŒé€‰ä¸€çš„è¿›è¡Œä¼˜åŒ–ã€‚å•ç‹¬æé«˜å…¶ä¸­ä¸€ä¸ªä»ä¼šä½¿æ’å…¥ç®—æ³•ä¿æŒåœ¨O(n^2)ä¸­ï¼Œä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾èƒ½å¤Ÿå°†æŸ¥æ‰¾æ¬¡æ•°é™åˆ°æœ€ä½â€”-O(lgN),å¯¹äºæ’å…¥ï¼Œä¸ºäº†èƒ½å®ç°å¸¸æ•°æ—¶é—´çš„æ’å…¥ï¼Œå¿…å®šéœ€è¦æ”¹å˜å…¶æ•°æ®ç»“æ„ã€‚äºŒå‰æœç´¢æ ‘åˆšå¥½æ»¡è¶³ä»¥ä¸Šçš„æ‰€æœ‰çš„éœ€æ±‚ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªï¼Œåº”è¯¥ä¸ç®—æ˜¯ä¸¥æ ¼æ„ä¹‰çš„æ’å…¥æ’åºäº†ï¼Œåº”æ˜¯æ›´å®½æ³›çš„å®šä½â€”-åŸºäºæ¯”è¾ƒçš„æ’åºã€‚ ç¬¬ä¸€ï¼Œå…¶æœ¬èº«å®šä¹‰å°±æ”¯æŒäºŒåˆ†æŸ¥æ‰¾ã€‚ åŒæ—¶æŸ¥æ‰¾åˆ°å¯¹åº”çš„å€¼ä¹‹åï¼Œå³å¯æ’å…¥ï¼Œæ‰€ä»¥æ’å…¥çš„æ—¶é—´ä¸ºå¸¸æ•°é¡¹O(1)ã€‚ å¯¹äºå…¶é¢‘ç¹çš„æ’å…¥åˆ é™¤å¯¼è‡´çš„æ€§èƒ½é™ä½ï¼Œç›®å‰çš„æ’åºæ¶‰åŠä¸å¤š æ€»ç»“ å¤æ‚åº¦: O(nlgn) ç§»åŠ¨æ¬¡æ•°: O(1) æ¯”è¾ƒæ¬¡æ•° O(lgn) å®ç°é¦–å…ˆå°†æ•°æ®æ„é€ ä¸ºäºŒå‰æœç´¢æ ‘ï¼Œä¹‹åå†è¿›è¡Œä¸­åºéå†å³å¯ã€‚ class TreeNode: def __init__(self, data): self.data = data self.leftChild = None self.rightChild = None def insert(self, newData): \"\"\" æ’å…¥æ•°æ® # edage case: è‹¥æ˜¯valueç›¸åŒå¦‚ä½•è§£å†³ Wordå¤© :param newData: :return: \"\"\" if newData == self.data: return False elif newData &lt; self.data: if self.leftChild == None: self.leftChild = TreeNode(newData) else: self.leftChild.insert(newData) else: if self.rightChild == None: self.rightChild = TreeNode(newData) else: self.rightChild.insert(newData) # ä»¥ä¸‹çš„å‰ä¸­åéå†å‡ä¸ºé€’å½’çš„éå† def preOrder(self): \"\"\" å‰åºéå† æ ¹å·¦å³ :return: \"\"\" print(self.data) if self.leftChild: self.leftChild.preOrder() else: self.rightChild.preOrder() def inOrder(self): \"\"\" ä¸­åºéå† å·¦æ ¹å³ :return: \"\"\" if self.leftChild: self.leftChild.inOrder() print(self.data) if self.rightChild: self.rightChild.inOrder() References ç®—æ³•æ–°è§£ ç®—æ³•ç¬¬å››ç‰ˆ","categories":[{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"}],"tags":[{"name":"æ’å…¥","slug":"æ’å…¥","permalink":"https://winniekun.github.io/tags/%E6%8F%92%E5%85%A5/"}]},{"title":"æ³›å‹","slug":"JavaåŸºç¡€/æ³›å‹","date":"2019-03-10T23:53:55.000Z","updated":"2021-06-03T13:14:19.545Z","comments":true,"path":"æ³›å‹/","link":"","permalink":"https://winniekun.github.io/%E6%B3%9B%E5%9E%8B/","excerpt":"","text":"åºåœ¨Javaä¸­ä¸€ç›´å¼ºè°ƒæ•°æ®ç±»å‹çš„æ¦‚å¿µï¼Œå…¶è‡ªèº«æœ‰8ç§åŸºç¡€çš„æ•°æ®ç±»å‹ï¼ŒåŒæ—¶æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ã€‚æˆ‘ä»¬ç†ŸçŸ¥çš„å®¹å™¨ç±»ï¼Œä¹Ÿæ˜¯åŸºäºæ³›å‹å®ç°çš„ã€‚è¿™æ ·æ‰å®ç°äº†ä¸€ä¸ªå®¹å™¨ç±»ï¼Œé€‚ç”¨äºå„ç§å„æ ·çš„æ•°æ®ç±»å‹ã€‚ é€šè¿‡æ³›å‹ï¼Œä½¿å¾—ç±»ã€æ¥å£ã€æ–¹æ³•èƒ½å¤Ÿé€‚ç”¨äºéå¸¸å¹¿æ³›çš„æ•°æ®ç±»å‹ï¼Œä½¿å¾—å…·ä½“çš„ä»£ç èƒ½å¤Ÿå’Œæ“ä½œçš„å…·ä½“çš„æ•°æ®ç±»å‹ä¸å†å¼ºè¡Œç»‘å®šåˆ°ä¸€èµ·ã€‚åŒä¸€å¥—ä»£ç èƒ½å¤Ÿé€‚ç”¨äºå¤šç§æ•°æ®ç±»å‹ã€‚ä»è€Œè¾¾åˆ°å¤ç”¨ä»£ç ã€é™ä½è€¦åˆåº¦ã€æé«˜ä»£ç çš„å¯è¯»æ€§çš„ç›®çš„ã€‚ ä¼˜ç‚¹ é¿å…ç±»å‹è½¬æ¢ // æœªä½¿ç”¨æ³›å‹ List list = new ArrayList(); list.add(\"hello\"); String s = (String) list.get(0); // ä½¿ç”¨æ³›å‹ List&lt;String&gt; list = new ArrayList&lt;String&gt;(); list.add(\"hello\"); String s = list.get(0); // ä¸éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ ç¼–è¯‘æ—¶å¼ºç±»å‹æ£€æµ‹ æ³›å‹è¦æ±‚åœ¨å£°æ˜æ—¶æŒ‡å®šå®é™…æ•°æ®ç±»å‹ï¼ŒJava ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šå¯¹æ³›å‹ä»£ç åšå¼ºç±»å‹æ£€æŸ¥ï¼Œå¹¶åœ¨ä»£ç è¿åç±»å‹å®‰å…¨æ—¶å‘å‡ºå‘Šè­¦ã€‚æ—©å‘ç°ï¼Œæ—©æ²»ç†ï¼ŒæŠŠéšæ‚£æ‰¼æ€äºæ‘‡ç¯®ï¼Œåœ¨ç¼–è¯‘æ—¶å‘ç°å¹¶ä¿®å¤é”™è¯¯æ‰€ä»˜å‡ºçš„ä»£ä»·è¿œæ¯”åœ¨è¿è¡Œæ—¶å°ã€‚ æ³›å‹ç¼–ç¨‹å¯å®ç°é€šç”¨ç®—æ³• é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥å®ç°é€šç”¨ç®—æ³•ï¼Œè¿™äº›ç®—æ³•å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„é›†åˆï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œå¹¶ä¸”ç±»å‹å®‰å…¨ä¸”æ˜“äºé˜…è¯»ã€‚ æ³›å‹ç±»å‹æ³›å‹ç±»å‹æ˜¯è¢«å‚æ•°åŒ–çš„ç±»æˆ–æ¥å£ æ³›å‹ç±»class name&lt;T1, T2, ... Tn&gt;{} ä¸€èˆ¬å°†æ³›å‹ä¸­çš„ç±»åç§°ä¸ºåŸå‹ï¼Œè€Œå°† &lt;&gt; æŒ‡å®šçš„å‚æ•°ç§°ä¸ºç±»å‹å‚æ•°ã€‚ å•ç±»å‹å‚æ•°ï¼ˆTï¼‰public class SingleInfo&lt;T&gt; { private T value; public T getValue() { return value; } public void setValue(T value) { this.value = value; } @Override public String toString() { return \"SingleInfo{\" + \"value=\" + value + '}'; } } å¤šç±»å‹å‚æ•°ï¼ˆKï¼ŒVï¼‰public class MultiInfo&lt;K, V&gt; { private K key; private V value; public MultiInfo(K key, V value) { this.key = key; this.value = value; } @Override public String toString() { return \"MultiInfo{\" + \"key=\" + key + \", value=\" + value + '}'; } æ³›å‹ç±»çš„åµŒå¥—MultiInfo&lt;Integer, MultiInfo&lt;Integer, String&gt;&gt; multi = new MultiInfo&lt;&gt;(1, new MultiInfo&lt;&gt;(1,\"32\")); System.out.println(multi); // MultiInfo{key=1, value=MultiInfo{key=1, value=32}} æ³›å‹æ¥å£public interface Content&lt;T&gt; { T text(); } å®ç°æ¥å£çš„å­ç±»å‹å£°æ˜å…·ä½“çš„ç±»å‹public class ImplInterface implements MyInterface&lt;Integer&gt; { private int a = 100; public ImplInterface(int a) { this.a = a; } @Override public Integer getT() { return a; } } å®ç°æ¥å£çš„å­ç±»å‹ä¸å£°æ˜å…·ä½“ç±»å‹public class NoImplInterface&lt;T&gt; implements MyInterface&lt;T&gt; { private T text; public NoImplInterface(T text) { this.text = text; } @Override public T getT() { return text; } } æ³›å‹æ–¹æ³•æ³›å‹æ–¹æ³•æ˜¯å¼•å…¥å…¶è‡ªå·±çš„ç±»å‹å‚æ•°çš„æ–¹æ³•ã€‚æ³›å‹æ–¹æ³•å¯ä»¥æ˜¯æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•ä»¥åŠæ„é€ æ–¹æ³•ã€‚ æ³›å‹æ–¹æ³•è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š public &lt;T&gt; T func(T obj) {} // ç±»å‹å˜é‡æ”¾åœ¨ä¿®é¥°ç¬¦ (è¿™é‡Œæ˜¯ public static ) çš„åé¢ , è¿”å›ç±»å‹çš„å‰é¢ æ˜¯å¦æ‹¥æœ‰æ³›å‹æ–¹æ³•ï¼Œä¸å…¶æ‰€åœ¨çš„ç±»æ˜¯å¦æ˜¯æ³›å‹æ²¡æœ‰å…³ç³»ã€‚ public class GenericsMethodDemo01 { public static &lt;T&gt; void printClass(T obj) { System.out.println(obj.getClass().toString()); } public static void main(String[] args) { printClass(\"abc\"); printClass(10); } } // Output: // class java.lang.String // class java.lang.Integer æ³›å‹æ–¹æ³•ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å¯å˜å‚æ•°åˆ—è¡¨ public class GenericVarargsMethodDemo { public static &lt;T&gt; List&lt;T&gt; makeList(T... args) { List&lt;T&gt; result = new ArrayList&lt;T&gt;(); Collections.addAll(result, args); return result; } public static void main(String[] args) { List&lt;String&gt; ls = makeList(\"A\"); System.out.println(ls); ls = makeList(\"A\", \"B\", \"C\"); System.out.println(ls); } } // Output: // [A] // [A, B, C] åŸç†ä¸Šè¿°çš„å®šä¹‰å„ç§æ³›å‹å‚æ•°å…·ä½“ä»€ä¹ˆç±»å˜ï¼Œå…¶å®å°±æ˜¯Objectã€‚å¯¹äºJavaæ–‡ä»¶ï¼Œåœ¨è¢«ä½¿ç”¨ä¹‹å‰éœ€è¦ç»è¿‡ç¼–è¯‘ã€åŠ è½½åˆ°JVMä¸­ä¸¤ä¸ªé˜¶æ®µã€‚ç¼–è¯‘é˜¶æ®µï¼Œç¼–è¯‘å™¨ä¼šæŠŠJavaæ–‡ä»¶è½¬æ¢ä¸º.classæ–‡ä»¶ã€‚å¯¹äºæ³›å‹ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šå°†æ³›å‹ä»£ç è½¬æ¢ä¸ºæ™®é€šçš„éæ³›å‹ä»£ç ã€‚ä½¿ç”¨javapä¹Ÿæ— æ³•ç›´æ¥çœ‹åˆ°ï¼Œå› ä¸ºåœ¨å­—èŠ‚ç é‡Œé¢ä¹Ÿæ˜¯çœ‹ä¸åˆ°æ³›å‹çš„ï¼Œå› ä¸ºå·²ç»è¢«æ“¦é™¤äº†ã€‚å°†ç±»å‹å‚æ•°æ“¦é™¤ä¹‹åï¼Œä¼šä½¿ç”¨Objectè¿›è¡Œæ›¿ä»£ä»¥åŠå¿…è¦çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ç„¶åJavaè™šæ‹Ÿæœºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå·²ç»ä¸çŸ¥é“æ³›å‹çš„äº‹æƒ…äº†ï¼Œåœ¨å…¶çœ¼é‡Œå°±æ˜¯æ™®é€šçš„ç±»ã€‚ ç±»å‹æ“¦é™¤==Javaä¸­çš„æ³›å‹åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ç¼–è¯‘å™¨è¿™ä¸ªå±‚æ¬¡æ¥å®ç°çš„ã€‚== Java è¯­è¨€å¼•å…¥æ³›å‹æ˜¯ä¸ºäº†åœ¨ç¼–è¯‘æ—¶æä¾›æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œå¹¶æ”¯æŒæ³›å‹ç¼–ç¨‹ã€‚ä¸åŒäº C++ çš„æ¨¡æ¿æœºåˆ¶ï¼ŒJava æ³›å‹æ˜¯ä½¿ç”¨ç±»å‹æ“¦é™¤æ¥å®ç°çš„ï¼Œä½¿ç”¨æ³›å‹æ—¶ï¼Œä»»ä½•å…·ä½“çš„ç±»å‹ä¿¡æ¯éƒ½è¢«æ“¦é™¤äº†ã€‚ ==Javaç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶å°½å¯èƒ½çš„å‘ç°å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•é¿å…åœ¨è¿è¡Œæ—¶åˆ»å‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸çš„æƒ…å†µ== ç±»å‹æ“¦é™¤åšäº†ä»¥ä¸‹å·¥ä½œï¼š æŠŠæ³›å‹ä¸­çš„æ‰€æœ‰ç±»å‹å‚æ•°æ›¿æ¢ä¸º Objectï¼Œå¦‚æœæŒ‡å®šç±»å‹è¾¹ç•Œï¼Œåˆ™ä½¿ç”¨ç±»å‹è¾¹ç•Œæ¥æ›¿æ¢ã€‚å› æ­¤ï¼Œç”Ÿæˆçš„å­—èŠ‚ç ä»…åŒ…å«æ™®é€šçš„ç±»ï¼Œæ¥å£å’Œæ–¹æ³•ã€‚ æ“¦é™¤å‡ºç°çš„ç±»å‹å£°æ˜ï¼Œå³å»æ‰ &lt;&gt; çš„å†…å®¹ã€‚æ¯”å¦‚ T get() æ–¹æ³•å£°æ˜å°±å˜æˆäº† Object get() ï¼›List å°±å˜æˆäº† Listã€‚å¦‚æœ‰å¿…è¦ï¼Œæ’å…¥ç±»å‹è½¬æ¢ä»¥ä¿æŒç±»å‹å®‰å…¨ã€‚ ç”Ÿæˆæ¡¥æ¥æ–¹æ³•ä»¥ä¿ç•™æ‰©å±•æ³›å‹ç±»å‹ä¸­çš„å¤šæ€æ€§ã€‚ç±»å‹æ“¦é™¤ç¡®ä¿ä¸ä¸ºå‚æ•°åŒ–ç±»å‹åˆ›å»ºæ–°ç±»ï¼›å› æ­¤ï¼Œæ³›å‹ä¸ä¼šäº§ç”Ÿè¿è¡Œæ—¶å¼€é”€ã€‚ ç¤ºä¾‹ï¼š public class GenericsErasureTypeDemo { public static void main(String[] args) { List&lt;Object&gt; list1 = new ArrayList&lt;Object&gt;(); List&lt;String&gt; list2 = new ArrayList&lt;String&gt;(); System.out.println(list1.getClass()); System.out.println(list2.getClass()); } } // Output: // class java.util.ArrayList // class java.util.ArrayList æ³›å‹å’Œç»§æ‰¿æ³›å‹ä¸èƒ½ç”¨äºæ˜¾å¼åœ°å¼•ç”¨è¿è¡Œæ—¶ç±»å‹çš„æ“ä½œä¹‹ä¸­ï¼Œä¾‹å¦‚ï¼šè½¬å‹ã€instanceof æ“ä½œå’Œ new è¡¨è¾¾å¼ã€‚å› ä¸ºæ‰€æœ‰å…³äºå‚æ•°çš„ç±»å‹ä¿¡æ¯éƒ½ä¸¢å¤±äº†ã€‚ æ³›å‹æ— æ³•å‘ä¸Šè½¬å‹ å‘ä¸Šè½¬å‹æ˜¯æŒ‡ç”¨å­ç±»å®ä¾‹å»åˆå§‹åŒ–çˆ¶ç±»ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡ä¸­å¤šæ€çš„é‡è¦è¡¨ç°ã€‚ è¿™æ˜¯å› ä¸ºï¼Œæ³›å‹ç±»å¹¶æ²¡æœ‰è‡ªå·±ç‹¬æœ‰çš„ Class ç±»å¯¹è±¡ã€‚æ¯”å¦‚ï¼šå¹¶ä¸å­˜åœ¨ List.class æˆ–æ˜¯ List.classï¼ŒJava ç¼–è¯‘å™¨ä¼šå°†äºŒè€…éƒ½è§†ä¸º List.classã€‚ ç±»å‹è¾¹ç•Œæœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶å¯åœ¨å‚æ•°åŒ–ç±»å‹ä¸­ç”¨ä½œç±»å‹å‚æ•°çš„ç±»å‹ã€‚ç±»å‹è¾¹ç•Œå¯ä»¥å¯¹æ³›å‹çš„ç±»å‹å‚æ•°è®¾ç½®é™åˆ¶æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯¹æ•°å­—è¿›è¡Œæ“ä½œçš„æ–¹æ³•å¯èƒ½åªæƒ³æ¥å— Number æˆ–å…¶å­ç±»çš„å®ä¾‹ã€‚ è¦å£°æ˜æœ‰ç•Œç±»å‹å‚æ•°ï¼Œè¯·åˆ—å‡ºç±»å‹å‚æ•°çš„åç§°ï¼Œç„¶åæ˜¯ extends å…³é”®å­—ï¼Œåè·Ÿå…¶é™åˆ¶ç±»æˆ–æ¥å£ã€‚ ç±»å‹è¾¹ç•Œçš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š &lt;T extends XXX&gt; ç±»å‹é€šé…ç¬¦ç±»å‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨ ? ä»£æ›¿å…·ä½“çš„ç±»å‹å‚æ•°ã€‚ä¾‹å¦‚ List åœ¨é€»è¾‘ä¸Šæ˜¯ List ï¼ŒList ç­‰æ‰€æœ‰ List&lt;å…·ä½“ç±»å‹å®å‚&gt; çš„çˆ¶ç±» ä¸Šç•Œé€šé…ç¬¦å¯ä»¥ä½¿ç”¨ä¸Šç•Œé€šé…ç¬¦æ¥ç¼©å°ç±»å‹å‚æ•°çš„ç±»å‹èŒƒå›´ã€‚ å®ƒçš„è¯­æ³•å½¢å¼ä¸ºï¼š&lt;? extends Number&gt; public class GenericsUpperBoundedWildcardDemo { public static double sumOfList(List&lt;? extends Number&gt; list) { double s = 0.0; for (Number n : list) { s += n.doubleValue(); } return s; } public static void main(String[] args) { List&lt;Integer&gt; li = Arrays.asList(1, 2, 3); System.out.println(\"sum = \" + sumOfList(li)); } } // Output: // sum = 6.0 ä¸‹ç•Œé€šé…ç¬¦ä¸‹ç•Œé€šé…ç¬¦å°†æœªçŸ¥ç±»å‹é™åˆ¶ä¸ºè¯¥ç±»å‹çš„ç‰¹å®šç±»å‹æˆ–è¶…ç±»ç±»å‹ã€‚ ğŸ”” æ³¨æ„ï¼šä¸Šç•Œé€šé…ç¬¦å’Œä¸‹ç•Œé€šé…ç¬¦ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ å®ƒçš„è¯­æ³•å½¢å¼ä¸ºï¼š&lt;? super Number&gt; public class GenericsLowerBoundedWildcardDemo { public static void addNumbers(List&lt;? super Integer&gt; list) { for (int i = 1; i &lt;= 5; i++) { list.add(i); } } public static void main(String[] args) { List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); addNumbers(list); System.out.println(Arrays.deepToString(list.toArray())); } } // Output: // [1, 2, 3, 4, 5] æ— ç•Œé€šé…ç¬¦æ— ç•Œé€šé…ç¬¦æœ‰ä¸¤ç§åº”ç”¨åœºæ™¯ï¼š å¯ä»¥ä½¿ç”¨ Object ç±»ä¸­æä¾›çš„åŠŸèƒ½æ¥å®ç°çš„æ–¹æ³•ã€‚ ä½¿ç”¨ä¸ä¾èµ–äºç±»å‹å‚æ•°çš„æ³›å‹ç±»ä¸­çš„æ–¹æ³•ã€‚ é€šé…ç¬¦å’Œå‘ä¸Šè½¬å‹æ³›å‹ä¸èƒ½å‘ä¸Šè½¬å‹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é€šé…ç¬¦æ¥å‘ä¸Šè½¬å‹ã€‚ public class GenericsWildcardDemo { public static void main(String[] args) { List&lt;Integer&gt; intList = new ArrayList&lt;&gt;(); List&lt;Number&gt; numList = intList; // Error List&lt;? extends Integer&gt; intList2 = new ArrayList&lt;&gt;(); List&lt;? extends Number&gt; numList2 = intList2; // OK } } æ³›å‹çº¦æŸRestrictions on Generics æ³›å‹å®è·µæ³›å‹å‘½åæ³›å‹ä¸€äº›çº¦å®šä¿—æˆçš„å‘½åï¼š E - Element K - Key N - Number T - Type V - Value S,U,V etc. - 2nd, 3rd, 4th types","categories":[{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"}],"tags":[{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"}]},{"title":"Springçš„beanæ³¨å…¥æ–¹å¼","slug":"spring/Springçš„beanæ³¨å…¥æ–¹å¼","date":"2019-02-14T11:52:23.000Z","updated":"2020-08-30T04:50:22.252Z","comments":true,"path":"Springçš„beanæ³¨å…¥æ–¹å¼/","link":"","permalink":"https://winniekun.github.io/Spring%E7%9A%84bean%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F/","excerpt":"Beançš„ä¾èµ–æ³¨å…¥æ–¹å¼","text":"Beançš„ä¾èµ–æ³¨å…¥æ–¹å¼ spring-bean.jpg Beané…ç½®ä¿¡æ¯å®šä¹‰äº†Beançš„å®ç°åŠä¾èµ–å…³ç³»ï¼ŒSpringå®¹å™¨æ ¹æ®å„ç§å½¢å¼çš„Beané…ç½®ä¿¡æ¯åœ¨å®¹å™¨å†…éƒ¨å»ºç«‹Beanå®šä¹‰æ³¨å†Œè¡¨ï¼Œç„¶åæ ¹æ®æ³¨å†Œè¡¨åŠ è½½ã€å®ä¾‹åŒ–Beanï¼Œå¹¶å»ºç«‹Beanå’ŒBeançš„ä¾èµ–å…³ç³»ï¼Œæœ€åå°†è¿™äº›å‡†å¤‡å°±ç»ªçš„Beanæ”¾åˆ°Beanç¼“å­˜æ± ä¸­ï¼Œä»¥ä¾›å¤–å±‚çš„åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒç”¨ã€‚ Beançš„æ³¨å…¥æ–¹å¼æœ‰ä¸¤ç§ï¼š XMLä¸­é…ç½® æ„é€ æ–¹æ³•æ³¨å…¥ å±æ€§æ³¨å…¥ å·¥å‚æ–¹æ³•æ³¨å…¥ ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ³¨å…¥ XMLä¸­çš„é…ç½®ä¾èµ–æ³¨å…¥æ„é€ æ–¹æ³•æ³¨å…¥public class UserServiceImpl implements UserService { private UserDao userDao; // åˆ©ç”¨æ„é€ æ–¹æ³•æ³¨å…¥ public UserServiceImpl(UserDao userDao){ this.userDao = userDao; } // //åˆ©ç”¨setè¿›è¡ŒåŠ¨æ€å®ç°å€¼çš„æ³¨å…¥ // public void setUserDao(UserDao userDao) { // this.userDao = userDao; // } public void getUser() { userDao.getUser(); } } bean.xmlé…ç½®&lt;bean id=\"userImpl\" class=\"com.wkk.dao.impl.UserDaoImpl\"/&gt; &lt;!-- collaborators and configuration for this bean go here --&gt; &lt;bean id=\"mysqlImpl\" class=\"com.wkk.dao.impl.UserDaoMysqlImpl\"/&gt; &lt;bean id=\"userServiceImpl\" class=\"com.wkk.service.impl.UserServiceImpl\"&gt; &lt;!--&lt;property name=\"userDao\" ref=\"mysqlImpl\"/&gt;--&gt; &lt;constructor-arg ref=\"mysqlImpl\"/&gt; &lt;/bean&gt; å±æ€§æ³¨å…¥(setteræ–¹æ³•)public class UserServiceImpl implements UserService { private UserDao userDao; // åˆ©ç”¨setè¿›è¡ŒåŠ¨æ€å®ç°å€¼çš„æ³¨å…¥ public void setUserDao(UserDao userDao) { this.userDao = userDao; } public void getUser() { // System.out.println(\"UserServiceå®ç°ç±»: å¯¹ç”¨æˆ·æ•°æ®çš„é€»è¾‘æ“ä½œ(ç”¨æˆ·è§’åº¦)\"); userDao.getUser(); } } bean.xmlé…ç½®&lt;bean id=\"userImpl\" class=\"com.wkk.dao.impl.UserDaoImpl\"/&gt; &lt;!-- collaborators and configuration for this bean go here --&gt; &lt;bean id=\"mysqlImpl\" class=\"com.wkk.dao.impl.UserDaoMysqlImpl\"/&gt; &lt;bean id=\"userServiceImpl\" class=\"com.wkk.service.impl.UserServiceImpl\"&gt; &lt;property name=\"userDao\" ref=\"mysqlImpl\"/&gt; &lt;/bean&gt; å·¥å‚æ–¹å¼æ³¨å…¥ä¸å†™äº†ï¼Œæ–‡æ¡£ä¸Šæ²¡é‡åˆ°ï¼Œ ç„¶åå¹³æ—¶æ„Ÿè§‰ä¹Ÿæ²¡æ€ä¹ˆé‡åˆ°è¿‡ã€‚åé¢é‡åˆ°å†å†™ ä½¿ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥ä½¿ç”¨@Autowiredè‡ªåŠ¨æ³¨å…¥@Component public class UserService { @Autowired @Qualifier(\"userDaoImpl2\") private UserDao userDao; public void say(){ userDao.say(); } } @Component public class UserDaoImpl1 implements UserDao { public void say() { System.out.println(\"è¿™æ˜¯UserDaoçš„ç¬¬ä¸€ç§å®ç°æ–¹å¼\"); } } @Component public class UserDaoImpl2 implements UserDao { public void say() { System.out.println(\"è¿™æ˜¯UserDaoçš„ç¬¬äºŒç§å®ç°æ–¹å¼\"); } } æµ‹è¯•@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration(classes = JavaConfig.class) public class UserServiceTest { @Autowired UserService userService; @Test public void say() { Assert.assertNotNull(userService); } } @Autowiredä¸ä»…èƒ½å¯¹å±æ€§è¿›è¡Œæ³¨è§£ï¼Œè¿˜å¯ä»¥å¯¹æ–¹æ³•ã€æ„é€ å‡½æ•°ç­‰ã€‚@Autowiredç±»ä¼¼ä¸xmlä¸­ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æˆ–å±æ€§æ³¨å…¥ &lt;property name=\"userDao\" ref=\"mysqlImpl\"/&gt; or &lt;constructor-arg ref=\"mysqlImpl\"/&gt; å¦‚æœä½¿ç”¨äº†@Autowiredæˆ–è€…Resourceç­‰ï¼Œå°±ä¸éœ€è¦åœ¨å®šä¹‰Beanæ—¶ä½¿ç”¨å±æ€§æ³¨å…¥å’Œæ„é€ æ–¹æ³•æ³¨å…¥äº†ã€‚æ„æ€å°±æ˜¯ä½¿ç”¨æ³¨è§£ï¼Œå¯ä»¥çœç•¥ç¹æ‚çš„xmlçš„é…ç½®ã€‚ @Autowiredæ³¨è§£åœ¨setteræ–¹æ³•ä¸Šå’Œå±æ€§æ³¨å…¥çš„åŒºåˆ«å°±æ˜¯ï¼š setteræ–¹æ³•æ³¨å…¥æ˜¯setteræ–¹æ³•+bean.xmlé…ç½®ï¼Œ@Autowiredæ–¹å¼çœå»äº†bean.xmlçš„é…ç½® References Springå®˜æ–¹æ–‡æ¡£","categories":[{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/tags/spring/"}]},{"title":"Springä¸­beançš„å‡ ç§è£…é…æ–¹å¼æ€»ç»“","slug":"spring/Springä¸­beançš„å‡ ç§è£…é…æ–¹å¼æ€»ç»“","date":"2019-01-14T11:50:54.000Z","updated":"2020-08-30T04:50:22.252Z","comments":true,"path":"Springä¸­beançš„å‡ ç§è£…é…æ–¹å¼æ€»ç»“/","link":"","permalink":"https://winniekun.github.io/Spring%E4%B8%ADbean%E7%9A%84%E5%87%A0%E7%A7%8D%E8%A3%85%E9%85%8D%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/","excerpt":"Beançš„è£…é…","text":"Beançš„è£…é… è£…é…: åˆ›å»ºåº”ç”¨å¯¹è±¡ä¹‹é—´çš„åä½œå…³ç³»çš„è¡Œä¸ºï¼Œ ä¹Ÿæ˜¯DIçš„æœ¬è´¨ Javaè£…é…ï¼ˆæ˜¾å¼ï¼‰XMLè£…é…ï¼ˆæ˜¾å¼ï¼‰è‡ªåŠ¨åŒ–è£…é…ï¼ˆéšå¼ï¼‰ä»ä»¥ä¸‹ä¸¤ä¸ªè§’åº¦æ¥å®ç°è‡ªåŠ¨åŒ–è£…é… ç»„ä»¶æ‰«æ Springä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„bean è‡ªåŠ¨è£…é… Springä¼šè‡ªåŠ¨æ»¡è¶³beanä¹‹é—´çš„ä¾èµ–ä½¿ç”¨@Componentæ³¨è§£ï¼Œå‘Šè¯‰Springéœ€è¦ä¸ºæ­¤ç±»åˆ›å»ºbeanï¼Œ å› ä¸ºSpringé»˜è®¤æ˜¯ä¸å¼€å¯ç»„ä»¶æ‰«æçš„ï¼Œæ‰€ä»¥éœ€è¦ç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ç”¨ç»„ä»¶æ‰«æï¼ˆ@ComponentScanï¼‰ ç»„ä»¶æ‰«æç»„ä»¶æ‰«æçš„beanå‘½åSpringä¼šæ ¹æ®ç±»åæŒ‡å®šIDï¼ˆç±»åé¦–å­—æ¯å°å†™ï¼‰åŒæ—¶ä¹Ÿå¯é€šè¿‡@Component(xxx)è®¾ç½®IDã€‚ ç»„ä»¶æ‰«æçš„åŸºç¡€åŒ…é»˜è®¤ä¼šæŠŠä½¿ç”¨@ComponentScançš„åŒ…ä½œä¸ºåŸºç¡€åŒ…ï¼Œå¯ä»¥ä½¿ç”¨@ComponentScan(xxx)è®¾ç½®å¯¹åº”çš„åŸºç¡€åŒ…å½“å°†æ‰€æœ‰çš„é…ç½®æ–‡ä»¶ç»Ÿä¸€æ”¾åœ¨åŒä¸€ä¸ªåŒ…é‡Œé¢çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šåŸºç¡€åŒ… å¦‚æœï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–ï¼Œé‚£ä¹ˆåªéœ€è¦ç»„ä»¶æ‰«æå³å¯ã€‚ä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¾ˆå¤šå¯¹è±¡éƒ½ä¼šä¾èµ–å…¶ä»–å¯¹è±¡æ‰èƒ½å®Œæˆä»»åŠ¡ï¼Œæ‰€ä»¥å°±éœ€è¦ç”¨åˆ°è‡ªåŠ¨è£…é… è‡ªåŠ¨è£…é…è‡ªåŠ¨è£…é…å°±æ˜¯è®©Springè‡ªåŠ¨æ»¡è¶³beanä¾èµ–çš„ä¸€ç§æ–¹æ³•ã€‚æ»¡è¶³ä¾èµ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šåœ¨springä¸Šä¸‹æ–‡ä¸­å¯»æ‰¾æŸä¸ªbeanéœ€æ±‚çš„å…¶ä»–beanã€‚ @Autowired@Autowiredå°†å½“å‰beanä¾èµ–çš„beanæ³¨å…¥è¿›æ¥ï¼Œæ³¨å…¥æ–¹å¼å¯ä»¥æœ‰æ„é€ å™¨æ³¨å…¥ï¼Œä¹Ÿå¯ä»¥æ˜¯setteræ³¨å…¥ï¼Œçœ‹@Autowiredæ³¨è§£åœ¨å“ªå„¿ã€‚è¿™æ ·å°±å¯ä»¥çœå»åœ¨xmlä¸­çš„è£…é… References Springå®æˆ˜ç¬¬å››ç‰ˆ","categories":[{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/categories/spring/"}],"tags":[{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/tags/spring/"}]},{"title":"2019å¹´ä¹¦å•ã€å¹´ç»ˆæ±‡æ€»ã€‘","slug":"ç¢ç¢å¿µ/2019å¹´ä¹¦å•ã€å¹´ç»ˆæ±‡æ€»ã€‘","date":"2018-12-31T16:00:00.000Z","updated":"2020-08-30T04:50:22.257Z","comments":true,"path":"2019å¹´ä¹¦å•ã€å¹´ç»ˆæ±‡æ€»ã€‘/","link":"","permalink":"https://winniekun.github.io/2019%E5%B9%B4%E4%B9%A6%E5%8D%95%E3%80%90%E5%B9%B4%E7%BB%88%E6%B1%87%E6%80%BB%E3%80%91/","excerpt":"æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ æ‘˜è‡ªé¶¸é“åœº è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚","text":"æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ æ‘˜è‡ªé¶¸é“åœº è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚ ä¹¦ç±ç›¸å…³ ç»Ÿè®¡å­¦ä¹ æ–¹æ³• ç®—æ³•æ–°è§£ Python3å­¦ä¹ ç¬”è®° Pythonç¼–ç¨‹å¯¼è®º Fluent Python Flask Webå¼€å‘å®æˆ˜å…¥é—¨ã€è¿›é˜¶ä¸åŸç†è§£æ é»‘å®¢ä¸ç”»å®¶ Vue.jså®æˆ˜ MySQLå¿…çŸ¥å¿…ä¼š ç¼–ç¨‹ç ç‘ åªèƒ½è¯´æ˜¯ç¥ä¹¦äº†ï¼Œå¤ªå¤šçš„ç®—æ³•ä¹¦éƒ½æˆ–å¤šæˆ–å°‘çš„å¼•ç”¨ä¸Šé¢çš„ä¾‹å­ é¢å‘æœºå™¨å­¦ä¹ çš„ç‰¹å¾å·¥ç¨‹ ç›®å‰è¿˜æ²¡çœ‹å®Œï¼Œå› ä¸ºè§‰å¾—ç‰¹å¾å·¥ç¨‹è‡ªå·±æ²¡æœ‰ç³»ç»Ÿçš„å¼„è¿‡ï¼Œæ‰€ä»¥æ‰“ç®—å¥½å¥½çœ‹çœ‹ Fluent Python åŸå…ˆè§‰å¾—å¯ä»¥è·³ç€çœ‹ï¼Œçœ‹è‡ªå·±æœ‰æ¬ ç¼ºçš„åœ°æ–¹ï¼Œç„¶åå¼€å§‹çœ‹çš„æ—¶å€™ï¼Œå‘ç°ï¼Œå“¦ï½ åŸæ¥è¿˜æœ‰å…¶ä»–åœ°æ–¹ä¹Ÿæ˜¯æ¬ ç¼ºçš„ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯ä¹–ä¹–ä»ç« èŠ‚çš„åˆå§‹éƒ¨åˆ†çœ‹ Javaå¹¶å‘ç¼–ç¨‹ ç›®å‰çœ‹äº†ä¸¤ç«  ç®—æ³• æŠŠæ— å‘å›¾çœ‹å®Œäº† Effective Java æ„Ÿè§‰è¿™ç§ç±»å‹çš„ä¹¦ï¼Œæ²¡æœ‰çœ‹æ²¡çœ‹å®Œä¸€è¯´ï¼Œæ¯æ¬¡çœ‹éƒ½æœ‰æ–°çš„ç†è§£ï¼Œå…¥é—¨æ—¶å¼€å§‹çœ‹ï¼Œå“¦ï½ åŸæ¥æ˜¯è¿™æ ·ï¼Œ æœ€è¿‘å†çœ‹ï¼Œå“¦ï¼åŸæ¥æ˜¯è¿™æ · ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡ æ— åŒ æˆ‘ä¸æ˜¯è¯ç¥ çµèƒ½ç™¾åˆ†ç™¾II ç´«ç½—å…°çš„æ°¸æ’èŠ±å›­ ä¸€æ‹³è¶…äººII é—»é¦™è¯†å¥³äºº åº”è¯¥æ˜¯æˆ‘ç›®å‰æ„Ÿè§¦æœ€æ·±çš„ä¸€éƒ¨äº† é©¯é¾™é«˜æ‰‹III ç»“æŸäº† ç²¾çµæ—…ç¤¾III ä¹Ÿç»“æŸäº†ï¼Œå›æƒ³èµ·æ¥ï¼Œè¿™ä¸¤éƒ¨ç”µå½±éƒ½æ˜¯æˆ‘ä»é«˜ä¸­å¼€å§‹è¿½çš„ï¼Œç°åœ¨éƒ½å·²ç»è¯»ç ”äº†ã€‚ hiï¼Œå®¤å‹ ç‹å½¦éœ–æ˜¯çœŸçš„é€—ï¼Œä¸çŸ¥é“æ˜¯èŠ‚ç›®æ•ˆæœè¿˜æ˜¯å•¥ï¼Œå®‹å°å®é‚£ä¸€æœŸæ˜¯çœŸçš„ç¥å¥‡ï¼Œæ„Ÿè§‰åŸºæœ¬çš„å¾…å®¢ä¹‹é“éƒ½æ²¡æœ‰ å‘å¾€çš„ç”Ÿæ´»III ä¸€ç›´æ˜¯å½“ç¾é£Ÿç¯‡æ¥çœ‹çš„ ç ´å†°è¡ŒåŠ¨ æš´é›ªå°†è‡³ å®³æ€•æˆä¸ºè¿™æ ·çš„ æ²™èµ å¥½å°¼ç›æ™ºéšœå•Š å¤è”IV é“äººèµ°çš„æ—¶å€™ï¼Œå¿ƒé‡Œè¿˜æ˜¯å“½äº†ä¸€ä¸‹ï¼Œè¿˜æœ‰æˆ‘æœ€å–œæ¬¢çš„å¯¡å§ä¹Ÿèµ°äº†ã€‚ æœ€å¥½çš„æˆ‘ä»¬(ç”µå½±ç‰ˆ) æ²¡å•¥å¥½è¯„ä»·çš„ï¼Œæ„Ÿè§‰å’ŒäºŒç†Šå†™çš„ä¸å¤ªä¸€æ ·äº† å“ªå’ä¹‹é­”ç«¥é™ä¸– æŒºå¥½çœ‹çš„ å°±æ˜¯å‰§æƒ…å¤ªä¸­è§„ä¸­çŸ©äº† æ²‰é»˜çš„è¯äºº å¥½å·®åŠ²å•Š è¥¿è¡Œè®° å±äºé‚£ç§çœ‹å¤šäº†ä¼šè…»çš„ ä½¿å¾’è¡Œè€…II æ€ä¹ˆè¿™ä¸¤å¤©çœ‹çš„æ¸¯ç‰‡è´¨é‡éƒ½è¿™ä¹ˆå·® è¿˜ä¸åŠç¬¬ä¸€éƒ¨çš„ä¸€åŠâ€¦ å¯„ç”Ÿè™« ä»Šå¹´çš„æˆ›çº³ç”µå½±æœ€ç«çš„é‡‘æ£•æ¦ˆç”µå½± æœ‰å¾ˆå¤šçš„éšå–»ï¼Œå¯æƒœçš„æ˜¯è‡ªå·±æ˜¯è·³ç€çœ‹çš„ï¼Œé”™è¿‡äº†å¾ˆå¤šçš„ç»†èŠ‚ çœŸçš„å¾ˆå¥½çœ‹ äººç”Ÿä¸€ä¸²II ä¸€å¦‚æ—¢å¾€çš„å¥½çœ‹ æ¶äººä¼  æœ€è¿‘è¿·ä¸Šäº†é©¬ä¸œé”¡çš„ç”µå½± çœ‹ç€çœŸçš„å¾ˆçˆ½ çº¢è¾£æ¤’ è½¬åŒ–çš„å¾ˆæ£’ æµ·ä¸Šé’¢ç´å¸ˆ ç½—å°é»‘æˆ˜è®° å¾ˆå¥½çœ‹ï¼Œç»ˆäºæ›´æ–°äº† è¿™ä¸ªå’Œå“ªå’çš„åŒºåˆ«å°±æ˜¯ï¼Œçœ‹å“ªå’çš„æ—¶å€™ï¼ŒçŸ¥é“åé¢ä¼šå‘ç”Ÿå•¥ï¼Œä½†æ˜¯è¿˜æ˜¯ä¹æ„å»çœ‹ï¼Œ è¿™ä¸ªæ˜¯ä¸ç¡®å®šåé¢ä¼šå‘ç”Ÿå•¥ï¼Œæƒ³è®©å®ƒä¸€ç›´æ’­ï¼Œä¸è¦åœ çƒˆç«è‹±é›„ å¾ˆä¸»æ—‹å¾‹ï¼Œä½†ä¹Ÿå¾ˆæ„Ÿäºº è¯›ä»™I æ­£å¸¸çš„å•†ä¸šç”µå½±å§ é¬¼ç­ä¹‹åˆƒ å¾ˆå¥½çœ‹ï¼Œå¥½å¥½çœ‹ å¤šç½—ç½— æœ€é•¿ä¸€æª ä¸­å›½æœºé•¿ æ•¬ç• å…¨èŒé«˜æ‰‹ å¤§ç”µå½± ä¸è¯„ä»·äº†ï¼Œ å°±è¿™æ ·å§ï¼Œ å¥½åå‚åŠï¼Œä½†æ˜¯åå å¤§å¤šæ•° å°‘å¹´çš„ä½  ä¸çŸ¥é“ä¸ºå•¥ä¼šæœ‰å–·çš„,æˆ‘è§‰å¾—å¾ˆæ£’å“‡ åˆºå®¢ä¼å…­ä¸ƒII ä¸çŸ¥é“ä¸ºå•¥,æ„Ÿè§‰æ²¡æœ‰ç¬¬ä¸€å­£é‚£ä¹ˆå¥½çœ‹ é•‡é­‚è¡— æ¼«ç”» æˆ‘å’Œæˆ‘çš„ç¥–å›½ ä¸»æ—‹å¾‹è¿˜æ˜¯é€‚åˆåœ¨å½±é™¢çœ‹,æœ‰æ°›å›´ ä¸­å›½æœºé•¿ æ¬§è±ªå¾ˆé“å“‡ åå®¶ä¼™ä»¬I å› é©¬ä¸œé”¡åœ¨å½±è§†ä¸­æ‰“è¿‡åƒµå°¸, æ‰“è¿‡åäºº, æ‰€ä»¥è¢«ç§°ä¸ºç¥é©¬ä¸œé”¡â€¦. åå®¶ä¼™ä»¬II ä»–äººå³åœ°ç‹± å¾ˆé˜´æ£® å›šçŠ¯åŒ»ç”Ÿ å°±æ˜¯çˆ½, çœ‹ç€ ç§˜å¯†æ£®æ— åè½¬çœŸçš„æ˜¯å¤ªå¤§äº† è¢«å‘Šäºº å¥½çœ‹ çˆ±åƒæ‹‰é¢çš„å°æ³‰åŒå­¦ å¾ˆå¥½åƒ å·®é¦† è¯ç©·ï¼Œæ²¡æœ‰å†™ä¸å‡ºæ¥ï¼Œ åæ­£å°±æ˜¯æ„Ÿæ…¨å¾ˆå¤š å¶é—®IV åˆæ˜¯ä¸€ä¸ªåå¹´ï¼Œ è¿™ä¸ªç³»åˆ—ä¹Ÿç»“æŸäº†ï¼Œ çªç„¶å‘ç°å¥½å¤šä»åˆé«˜ä¸­è¿½çš„å±€éƒ½ç»“æŸäº†ï¼Œ æ—¶é—´çœŸæ˜¯ä¸ªç¥å¥‡çš„ä¸œè¥¿ é•‡é­‚è¡—II ç”»é£æ›´å¥½äº†ï¼Ÿï¼Ÿ æ„Ÿè§‰å´©äº† ä¸€äººä¹‹ä¸‹Iã€II å¿ƒä¸­çš„å›½ç•ªç¬¬äºŒ","categories":[{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"}],"tags":[{"name":"ä¹¦å•","slug":"ä¹¦å•","permalink":"https://winniekun.github.io/tags/%E4%B9%A6%E5%8D%95/"}]}],"categories":[{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://winniekun.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://winniekun.github.io/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"},{"name":"dubbo","slug":"dubbo","permalink":"https://winniekun.github.io/categories/dubbo/"},{"name":"kafka","slug":"kafka","permalink":"https://winniekun.github.io/categories/kafka/"},{"name":"æºç ","slug":"æºç ","permalink":"https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"},{"name":"ä¸­é—´ä»¶","slug":"ä¸­é—´ä»¶","permalink":"https://winniekun.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"},{"name":"leetcode","slug":"leetcode","permalink":"https://winniekun.github.io/categories/leetcode/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://winniekun.github.io/categories/%E7%BD%91%E7%BB%9C/"},{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/categories/spring/"},{"name":"æ’åº","slug":"æ’åº","permalink":"https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"},{"name":"LeetCode","slug":"LeetCode","permalink":"https://winniekun.github.io/categories/LeetCode/"},{"name":"concurrency","slug":"concurrency","permalink":"https://winniekun.github.io/categories/concurrency/"},{"name":"ç¢ç¢å¿µ","slug":"ç¢ç¢å¿µ","permalink":"https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"},{"name":"ä»£ç è´¨é‡","slug":"ä»£ç è´¨é‡","permalink":"https://winniekun.github.io/categories/%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F/"},{"name":"java","slug":"java","permalink":"https://winniekun.github.io/categories/java/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://winniekun.github.io/categories/%E7%AE%97%E6%B3%95/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://winniekun.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://winniekun.github.io/categories/%E5%89%91%E6%8C%87offer/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/categories/%E9%85%8D%E7%BD%AE/"},{"name":"Linux","slug":"Linux","permalink":"https://winniekun.github.io/categories/Linux/"},{"name":"æ•°æ®ç»“æ„","slug":"æ•°æ®ç»“æ„","permalink":"https://winniekun.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"mysql","slug":"mysql","permalink":"https://winniekun.github.io/categories/mysql/"}],"tags":[{"name":"é”","slug":"é”","permalink":"https://winniekun.github.io/tags/%E9%94%81/"},{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"https://winniekun.github.io/tags/%E5%9F%BA%E7%A1%80/"},{"name":"rpc","slug":"rpc","permalink":"https://winniekun.github.io/tags/rpc/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"https://winniekun.github.io/tags/%E9%85%8D%E7%BD%AE/"},{"name":"å†…å­˜ç®¡ç†","slug":"å†…å­˜ç®¡ç†","permalink":"https://winniekun.github.io/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"},{"name":"jdk","slug":"jdk","permalink":"https://winniekun.github.io/tags/jdk/"},{"name":"kafka","slug":"kafka","permalink":"https://winniekun.github.io/tags/kafka/"},{"name":"JDKæºç ","slug":"JDKæºç ","permalink":"https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"},{"name":"lang","slug":"lang","permalink":"https://winniekun.github.io/tags/lang/"},{"name":"åŒæŒ‡é’ˆ","slug":"åŒæŒ‡é’ˆ","permalink":"https://winniekun.github.io/tags/%E5%8F%8C%E6%8C%87%E9%92%88/"},{"name":"Queue","slug":"Queue","permalink":"https://winniekun.github.io/tags/Queue/"},{"name":"åº”ç”¨å±‚","slug":"åº”ç”¨å±‚","permalink":"https://winniekun.github.io/tags/%E5%BA%94%E7%94%A8%E5%B1%82/"},{"name":"ioc","slug":"ioc","permalink":"https://winniekun.github.io/tags/ioc/"},{"name":"å½’å¹¶æ’åº","slug":"å½’å¹¶æ’åº","permalink":"https://winniekun.github.io/tags/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"},{"name":"æ­»ç£•ç³»åˆ—","slug":"æ­»ç£•ç³»åˆ—","permalink":"https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"},{"name":"æ•°å­¦åŸºç¡€","slug":"æ•°å­¦åŸºç¡€","permalink":"https://winniekun.github.io/tags/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/"},{"name":"SQL","slug":"SQL","permalink":"https://winniekun.github.io/tags/SQL/"},{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","permalink":"https://winniekun.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"},{"name":"æ‚è°ˆ","slug":"æ‚è°ˆ","permalink":"https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"},{"name":"ä¹¦å•","slug":"ä¹¦å•","permalink":"https://winniekun.github.io/tags/%E4%B9%A6%E5%8D%95/"},{"name":"if-elseä¼˜åŒ–","slug":"if-elseä¼˜åŒ–","permalink":"https://winniekun.github.io/tags/if-else%E4%BC%98%E5%8C%96/"},{"name":"dfs","slug":"dfs","permalink":"https://winniekun.github.io/tags/dfs/"},{"name":"bfs","slug":"bfs","permalink":"https://winniekun.github.io/tags/bfs/"},{"name":"trie","slug":"trie","permalink":"https://winniekun.github.io/tags/trie/"},{"name":"http","slug":"http","permalink":"https://winniekun.github.io/tags/http/"},{"name":"åˆ›å»ºå‹æ¨¡å¼","slug":"åˆ›å»ºå‹æ¨¡å¼","permalink":"https://winniekun.github.io/tags/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/"},{"name":"javaåŸºç¡€","slug":"javaåŸºç¡€","permalink":"https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"},{"name":"é¢è¯•36è®²","slug":"é¢è¯•36è®²","permalink":"https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"},{"name":"List","slug":"List","permalink":"https://winniekun.github.io/tags/List/"},{"name":"JUC","slug":"JUC","permalink":"https://winniekun.github.io/tags/JUC/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"https://winniekun.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"å•è°ƒæ ˆ","slug":"å•è°ƒæ ˆ","permalink":"https://winniekun.github.io/tags/%E5%8D%95%E8%B0%83%E6%A0%88/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://winniekun.github.io/tags/%E5%B9%B6%E5%8F%91/"},{"name":"å‰‘æŒ‡offer","slug":"å‰‘æŒ‡offer","permalink":"https://winniekun.github.io/tags/%E5%89%91%E6%8C%87offer/"},{"name":"äºŒåˆ†æœç´¢","slug":"äºŒåˆ†æœç´¢","permalink":"https://winniekun.github.io/tags/%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2/"},{"name":"I/O","slug":"I-O","permalink":"https://winniekun.github.io/tags/I-O/"},{"name":"ä½è¿ç®—","slug":"ä½è¿ç®—","permalink":"https://winniekun.github.io/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"},{"name":"å›¾è®º","slug":"å›¾è®º","permalink":"https://winniekun.github.io/tags/%E5%9B%BE%E8%AE%BA/"},{"name":"ip","slug":"ip","permalink":"https://winniekun.github.io/tags/ip/"},{"name":"tcp","slug":"tcp","permalink":"https://winniekun.github.io/tags/tcp/"},{"name":"å‘½ä»¤è¡Œ","slug":"å‘½ä»¤è¡Œ","permalink":"https://winniekun.github.io/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/"},{"name":"é€‰æ‹©","slug":"é€‰æ‹©","permalink":"https://winniekun.github.io/tags/%E9%80%89%E6%8B%A9/"},{"name":"AVLæ ‘","slug":"AVLæ ‘","permalink":"https://winniekun.github.io/tags/AVL%E6%A0%91/"},{"name":"flag","slug":"flag","permalink":"https://winniekun.github.io/tags/flag/"},{"name":"Map","slug":"Map","permalink":"https://winniekun.github.io/tags/Map/"},{"name":"springboot","slug":"springboot","permalink":"https://winniekun.github.io/tags/springboot/"},{"name":"å›æº¯","slug":"å›æº¯","permalink":"https://winniekun.github.io/tags/%E5%9B%9E%E6%BA%AF/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"https://winniekun.github.io/tags/%E9%93%BE%E8%A1%A8/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"https://winniekun.github.io/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"äº¤æ¢","slug":"äº¤æ¢","permalink":"https://winniekun.github.io/tags/%E4%BA%A4%E6%8D%A2/"},{"name":"BST","slug":"BST","permalink":"https://winniekun.github.io/tags/BST/"},{"name":"æ€»ç»“","slug":"æ€»ç»“","permalink":"https://winniekun.github.io/tags/%E6%80%BB%E7%BB%93/"},{"name":"Bæ ‘","slug":"Bæ ‘","permalink":"https://winniekun.github.io/tags/B%E6%A0%91/"},{"name":"æ’å…¥","slug":"æ’å…¥","permalink":"https://winniekun.github.io/tags/%E6%8F%92%E5%85%A5/"},{"name":"spring","slug":"spring","permalink":"https://winniekun.github.io/tags/spring/"}]}