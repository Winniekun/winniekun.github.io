<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>çº¿ç¨‹æ± ç†è§£ | Wkkã®ç¬”è®° | å¥½è®°æ€§ä¸å¦‚çƒ‚é”®ç›˜</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="å¹¶å‘">
    <meta name="description" content="çº¿ç¨‹æ± çš„æ¦‚è¿°">
<meta property="og:type" content="article">
<meta property="og:title" content="çº¿ç¨‹æ± ç†è§£">
<meta property="og:url" content="https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/index.html">
<meta property="og:site_name" content="Wkkã®ç¬”è®°">
<meta property="og:description" content="çº¿ç¨‹æ± çš„æ¦‚è¿°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8">
<meta property="og:image" content="https://i.loli.net/2020/04/22/NCxD9UavwYpfo4O.png">
<meta property="og:image" content="https://i.loli.net/2020/04/21/yuWbBpA62HE9FT4.png">
<meta property="og:image" content="https://i.loli.net/2020/04/21/qDyksotYTvRE56m.png">
<meta property="article:published_time" content="2020-04-20T12:23:43.000Z">
<meta property="article:modified_time" content="2021-04-25T07:50:26.859Z">
<meta property="article:author" content="weikunkun">
<meta property="article:tag" content="å¹¶å‘">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8">
    
        <link rel="alternate" type="application/atom+xml" title="Wkkã®ç¬”è®°" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.1">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://avatars.githubusercontent.com/u/19886738?v=4">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">weikunkun</h5>
          <a href="mailto:kongwiki5@gmail.com" title="kongwiki5@gmail.com" class="mail">kongwiki5@gmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                ä¸»é¡µ
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-user-md"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/Winniekun" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">çº¿ç¨‹æ± ç†è§£</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="è¾“å…¥æ„Ÿå…´è¶£çš„å…³é”®å­—">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">çº¿ç¨‹æ± ç†è§£</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-04-20T12:23:43.000Z" itemprop="datePublished" class="page-time">
  2020-04-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/java/">java</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#çº¿ç¨‹æ± çš„æ¦‚è¿°"><span class="post-toc-number">1.</span> <span class="post-toc-text">çº¿ç¨‹æ± çš„æ¦‚è¿°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#å››ä¸ªæ„é€ æ–¹æ³•ï¼š"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">å››ä¸ªæ„é€ æ–¹æ³•ï¼š</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#å¿…å¤‡çš„å‚æ•°-5ä¸ª"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">å¿…å¤‡çš„å‚æ•°(5ä¸ª)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°-2ä¸ª"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°(2ä¸ª)</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ"><span class="post-toc-number">2.</span> <span class="post-toc-text">çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ä»»åŠ¡çš„ç®¡ç†"><span class="post-toc-number">3.</span> <span class="post-toc-text">ä»»åŠ¡çš„ç®¡ç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä»»åŠ¡çš„è°ƒåº¦"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">ä»»åŠ¡çš„è°ƒåº¦</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä»»åŠ¡çš„ç”³è¯·"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">ä»»åŠ¡çš„ç”³è¯·</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ä»»åŠ¡çš„æ‹’ç»"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">ä»»åŠ¡çš„æ‹’ç»</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#çº¿ç¨‹çš„ç®¡ç†"><span class="post-toc-number">4.</span> <span class="post-toc-text">çº¿ç¨‹çš„ç®¡ç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Workerçº¿ç¨‹"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">Workerçº¿ç¨‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#æ„é€ æ–¹æ³•"><span class="post-toc-number">4.1.1.</span> <span class="post-toc-text">æ„é€ æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#runæ–¹æ³•"><span class="post-toc-number">4.1.2.</span> <span class="post-toc-text">runæ–¹æ³•</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Workerçº¿ç¨‹å¢åŠ -æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">Workerçº¿ç¨‹å¢åŠ (æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä¸Šç¯‡"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">ä¸Šç¯‡</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#ä¸‹ç¯‡"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">ä¸‹ç¯‡</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#runWorker-æ–¹æ³•"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">runWorker()æ–¹æ³•</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#å¸¸è§çš„çº¿ç¨‹æ± "><span class="post-toc-number">5.</span> <span class="post-toc-text">å¸¸è§çš„çº¿ç¨‹æ± </span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#newCachedThreadPool"><span class="post-toc-number">5.0.1.</span> <span class="post-toc-text">newCachedThreadPool</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#newFixedThreadPool"><span class="post-toc-number">5.0.2.</span> <span class="post-toc-text">newFixedThreadPool</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#newSingleThreadExecutor"><span class="post-toc-number">5.0.3.</span> <span class="post-toc-text">newSingleThreadExecutor</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#newScheduledThreadPool"><span class="post-toc-number">5.0.4.</span> <span class="post-toc-text">newScheduledThreadPool</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Executoræ¡†æ¶"><span class="post-toc-number">6.</span> <span class="post-toc-text">Executoræ¡†æ¶</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#References"><span class="post-toc-number">7.</span> <span class="post-toc-text">References</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Javaè¿›é˜¶/å¹¶å‘/çº¿ç¨‹æ± ç†è§£"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">çº¿ç¨‹æ± ç†è§£</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-04-20 20:23:43" datetime="2020-04-20T12:23:43.000Z"  itemprop="datePublished">2020-04-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/java/">java</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="æ–‡ç« æ€»é˜…è¯»é‡" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="çº¿ç¨‹æ± çš„æ¦‚è¿°"><a href="#çº¿ç¨‹æ± çš„æ¦‚è¿°" class="headerlink" title="çº¿ç¨‹æ± çš„æ¦‚è¿°"></a>çº¿ç¨‹æ± çš„æ¦‚è¿°</h2><a id="more"></a>

<blockquote>
<p>çº¿ç¨‹æ± çš„å†…éƒ¨æ„å»ºäº†ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå°†çº¿ç¨‹å’Œä»»åŠ¡è¿›è¡Œè§£è€¦ï¼Œä»è€Œèƒ½å¤Ÿè‰¯å¥½çš„ç¼“å†²ä»»åŠ¡ï¼Œå¤ç”¨çº¿ç¨‹ã€‚åŒæ—¶çº¿ç¨‹æ± çš„è¿è¡Œä¸»è¦åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šä»»åŠ¡ç®¡ç†ã€çº¿ç¨‹ç®¡ç†ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ä½“ç°åœ¨å“ªå„¿ï¼Ÿ<code>ä»»åŠ¡ç®¡ç†</code>å¯ä»¥è§†ä¸º<code>ç”Ÿäº§è€…</code>ï¼Œ<code>çº¿ç¨‹ç®¡ç†</code>è§†ä¸º<code>æ¶ˆè´¹è€…</code>ã€‚ä»»åŠ¡è¿›å…¥çº¿ç¨‹æ± ä¸­ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­å…¶åç»­çš„æµç¨‹ï¼š</p>
<ol>
<li>ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</li>
<li>ä»»åŠ¡ç¼“å†²è¿›å…¥é˜»å¡é˜Ÿåˆ—ï¼Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œ</li>
<li>æ‹’ç»è¯¥ä»»åŠ¡</li>
</ol>
<p>ä»¥ä¸Šå±äº<code>ä»»åŠ¡ç®¡ç†</code>ï¼Œ<code>çº¿ç¨‹ç®¡ç†</code>ä¸»è¦ä¸ºæ ¹æ®ä»»åŠ¡è¯·æ±‚è¿›è¡Œçº¿ç¨‹çš„åˆ†é…ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œä¹‹åï¼Œç»§ç»­è·å–æ–°çš„ä»»åŠ¡æ‰§è¡Œï¼Œæœ€åçº¿ç¨‹è·å–ä¸åˆ°ä»»åŠ¡ï¼Œåˆ°ä¸€å®šæ—¶é—´ä¹‹åï¼Œè¯¥çº¿ç¨‹è¢«å›æ”¶ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œçº¿ç¨‹æ± çš„ä¸»è¦å®ç°ç±»ä¸º<code>ThreadPoolExecutor</code>ï¼Œå…¶å®é˜…è¯»å…¶æºç ï¼Œå°±å¯ä»¥ç†è§£çº¿ç¨‹æ± ä¸­çš„æ‰€æœ‰çš„æ€æƒ³ï¼Œä»¥åŠå¦‚ä½•å®ç°ã€‚é˜…è¯»å¥—è·¯ï¼šæ„é€ æ–¹æ³•â€”&gt;å…¶ä»–æ–¹æ³•åŠå±æ€§ã€‚</p>
<h3 id="å››ä¸ªæ„é€ æ–¹æ³•ï¼š"><a href="#å››ä¸ªæ„é€ æ–¹æ³•ï¼š" class="headerlink" title="å››ä¸ªæ„é€ æ–¹æ³•ï¼š"></a>å››ä¸ªæ„é€ æ–¹æ³•ï¼š</h3><p>å…¶å…±æœ‰å››ä¸­æ„é€ æ–¹æ³•ï¼Œå‚æ•°åˆ†åˆ«æœ‰5ã€6ã€6ã€7ä¸ª </p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="å¿…å¤‡çš„å‚æ•°-5ä¸ª"><a href="#å¿…å¤‡çš„å‚æ•°-5ä¸ª" class="headerlink" title="å¿…å¤‡çš„å‚æ•°(5ä¸ª)"></a>å¿…å¤‡çš„å‚æ•°(5ä¸ª)</h4><ol>
<li><p>corePoolSizeï¼šçº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡</p>
<blockquote>
<p>å¯ä»¥å½¢è±¡ç†è§£ä¸ºé¤é¦†å°±é¤ä¸­çš„é¤æ¡Œï¼Œæ­£å¸¸æƒ…å†µä¸‹çš„é¤æ¡Œæ•°é‡å°±æ˜¯corePoolSizeã€‚</p>
</blockquote>
</li>
<li><p>maximumPoolSizeï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ€»æ•°æœ€å¤§å€¼</p>
<blockquote>
<p>åŒä¸Šçš„ä¾‹å­ï¼Œæ¯”ä½œä¸ºå°±é¤æ—¶é—´ï¼Œå› ä¸ºäººæµé‡å¤šï¼Œè€æ¿ä»åå¨æ–°åŠ å‡ ä¸ªé¤æ¡Œä¹‹åçš„æ•°é‡ã€‚</p>
<p>åœ¨çº¿ç¨‹æ± ä¸­ï¼Œä»æŸæ–¹é¢å¯ä»¥å°†çº¿ç¨‹åˆ†ä¸ºæ ¸å¿ƒçº¿ç¨‹å’Œéæ ¸å¿ƒçº¿ç¨‹ï¼Œæ ¸å¿ƒçº¿ç¨‹é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨åœ¨çº¿ç¨‹æ± ä¸­ï¼Œå³ä½¿ä»€ä¹ˆä¹Ÿä¸å¹²ã€‚æ ¸å¿ƒçº¿ç¨‹æ•°é‡å°±æ˜¯corePoolSizeï¼Œéæ ¸å¿ƒçº¿ç¨‹ï¼Œå¦‚æœé•¿æ—¶é—´é™åˆ¶çš„è¯ï¼Œä¼šè¢«å›æ”¶(è¿™å’Œé¤æ¡Œçš„ä¾‹å­å¾ˆå¥‘åˆå“‡<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>)ã€‚æœ€å¤§çº¿ç¨‹æ€»æ•°ï¼ˆmaximumPoolSizeï¼‰= æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼ˆcorePoolSizeï¼‰ + éæ ¸å¿ƒçº¿ç¨‹æ•°é‡</p>
</blockquote>
</li>
<li><p>keepAliveTimeï¼šéæ ¸å¿ƒçº¿é—²ç½®è¶…æ—¶æ—¶é•¿</p>
<blockquote>
<p>éæ ¸å¿ƒçº¿ç¨‹å¦‚æœå¤„äºé—²ç½®çŠ¶æ€è¶…è¿‡è¯¥å€¼ï¼Œå°±ä¼šè¢«é”€æ¯ã€‚å¦‚æœè®¾ç½®allowCoreThreadTimeOut(true)ï¼Œåˆ™ä¼šä¹Ÿä½œç”¨äºæ ¸å¿ƒçº¿ç¨‹ã€‚</p>
</blockquote>
</li>
<li><p>TimeUnit unit</p>
<blockquote>
<p>æšä¸¾ç±»å‹ï¼š åŒ…å«æœ‰çº³ç§’ã€å¾®å¦™ã€æ¯«ç§’ã€ç§’ã€åˆ†ã€å°æ—¶ã€å¤©</p>
</blockquote>
</li>
<li><p>BlockingQueue&lt;Runnable&gt; workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºç»´æŠ¤ç­‰å¾…æ‰§è¡Œçš„Runnableä»»åŠ¡å¯¹è±¡</p>
<p>å¸¸ç”¨çš„å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ï¼š</p>
<ol>
<li><p><strong>LinkedBlockingQueue</strong></p>
<p>é“¾å¼é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œé»˜è®¤å¤§å°æ˜¯<code>Integer.MAX_VALUE</code>ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå¤§å°ã€‚</p>
</li>
<li><p><strong>ArrayBlockingQueue</strong></p>
<p>æ•°ç»„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯æ•°ç»„ï¼Œéœ€è¦æŒ‡å®šé˜Ÿåˆ—çš„å¤§å°ã€‚</p>
</li>
<li><p><strong>SynchronousQueue</strong></p>
<p>åŒæ­¥é˜Ÿåˆ—ï¼Œå†…éƒ¨å®¹é‡ä¸º0ï¼Œæ¯ä¸ªputæ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ªtakeæ“ä½œï¼Œåä¹‹äº¦ç„¶ã€‚</p>
</li>
<li><p><strong>DelayQueue</strong></p>
<p>å»¶è¿Ÿé˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´  ã€‚</p>
</li>
</ol>
</li>
</ol>
<h4 id="éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°-2ä¸ª"><a href="#éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°-2ä¸ª" class="headerlink" title="éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°(2ä¸ª)"></a>éå¿…å¤‡çš„æ ¸å¿ƒå‚æ•°(2ä¸ª)</h4><ol>
<li><p>ThreadFactory threadFactory</p>
<ol>
<li>ç”¨äºè‡ªå®šä¹‰çº¿ç¨‹æ± çš„åå­—ã€ä»¥åŠå…œåº•çš„å¼‚å¸¸å¤„ç†ç­–ç•¥ç­‰</li>
</ol>
</li>
<li><p>RejectedExecutionHandler handler</p>
<p><strong>æ‹’ç»å¤„ç†ç­–ç•¥</strong>ï¼Œçº¿ç¨‹æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°å°±ä¼šé‡‡ç”¨æ‹’ç»å¤„ç†ç­–ç•¥ï¼Œå››ç§æ‹’ç»å¤„ç†çš„ç­–ç•¥ä¸º ï¼š</p>
<ol>
<li><strong>ThreadPoolExecutor.AbortPolicy</strong>ï¼š<strong>é»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥</strong>ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚</li>
<li><strong>ThreadPoolExecutor.DiscardPolicy</strong>ï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><strong>ThreadPoolExecutor.DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚</li>
<li><strong>ThreadPoolExecutor.CallerRunsPolicy</strong>ï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚</li>
</ol>
</li>
</ol>
<p>ä½¿ç”¨çº¿ç¨‹æ± çš„ä¸»è¦åŸå› æœ‰å¦‚ä¸‹:</p>
<ol>
<li>åˆ›å»º/é”€æ¯çº¿ç¨‹éœ€è¦æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œçº¿ç¨‹æ± å¯ä»¥<strong>å¤ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹</strong>ã€‚</li>
<li><strong>æ§åˆ¶å¹¶å‘çš„æ•°é‡</strong>ã€‚å¹¶å‘æ•°é‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œä»è€Œé€ æˆæœåŠ¡å™¨å´©æºƒã€‚<strong>ï¼ˆä¸»è¦åŸå› ï¼‰</strong></li>
<li><strong>å¯ä»¥å¯¹çº¿ç¨‹åšç»Ÿä¸€ç®¡ç†</strong>ã€‚</li>
</ol>
<h2 id="çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ"></a>çº¿ç¨‹æ± çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>çº¿ç¨‹æ± æœ¬èº«æœ‰ä¸€ä¸ªè°ƒåº¦çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å°±æ˜¯ç”¨äºç®¡ç†å¸ƒæ§æ•´ä¸ªçº¿ç¨‹æ± é‡Œçš„å„ç§ä»»åŠ¡å’Œäº‹åŠ¡ï¼Œä¾‹å¦‚åˆ›å»ºçº¿ç¨‹ã€é”€æ¯çº¿ç¨‹ã€ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ã€çº¿ç¨‹é˜Ÿåˆ—ç®¡ç†ç­‰ç­‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± ä¸­ä¹Ÿæœ‰è‡ªå·±çš„çŠ¶æ€ã€‚é€šè¿‡æºç äº†è§£åˆ°<code>ThreadPoolExecutor</code>ç±»ä¸­é€šè¿‡volatile int å®šä¹‰äº†runStateå˜é‡è¡¨ç¤ºçº¿ç¨‹æ± çš„çŠ¶æ€ã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// runState is stored in the high-order bits</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RUNNING    = -<span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHUTDOWN   =  <span class="number">0</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STOP       =  <span class="number">1</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIDYING    =  <span class="number">2</span> &lt;&lt; COUNT_BITS;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TERMINATED =  <span class="number">3</span> &lt;&lt; COUNT_BITS;</span><br></pre></td></tr></tbody></table></figure>

<table>
<thead>
<tr>
<th>è¿è¡ŒçŠ¶æ€</th>
<th>çŠ¶æ€æè¿°</th>
<th>è½¬æ¢æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>RUNNING</td>
<td>èƒ½å¤Ÿæ¥å—æ–°çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td>
<td>çº¿ç¨‹æ± åˆ›å»ºä¹‹å</td>
</tr>
<tr>
<td>SHUTDOWN</td>
<td>ä¸å†æ¥æ”¶æ–°æäº¤çš„ä»»åŠ¡ï¼Œæ¸…é™¤ä¸€äº›ç©ºé—²workerï¼Œä¼šç­‰å¾…é˜»å¡é˜Ÿåˆ—ä¸­å­˜å‚¨çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆã€‚</td>
<td>shutdownï¼ˆï¼‰</td>
</tr>
<tr>
<td>STOP</td>
<td>åœæ­¢æ¥å—æ–°çš„ä»»åŠ¡ï¼Œä¸­æ–­æ‰€æœ‰çº¿ç¨‹ï¼ˆåŒ…æ‹¬æ­£åœ¨æ‰§è¡Œçš„ï¼‰ï¼Œé˜»å¡é˜Ÿåˆ—ä¸­ä¸ºæ‰§è¡Œçš„ä»»åŠ¡å…¨éƒ¨æŠ›å¼ƒï¼Œæ­¤æ—¶poosize = 0, é˜»å¡é˜Ÿåˆ—size = 0;</td>
<td>shutdownNow()</td>
</tr>
<tr>
<td>TIDYING</td>
<td>æ‰€æœ‰çš„ä»»åŠ¡å·²ç»ç»ˆæ­¢ï¼ŒworkerCountï¼ˆæœ‰æ•ˆçº¿ç¨‹æ•°é‡ï¼‰æ•°é‡ä¸º0</td>
<td></td>
</tr>
<tr>
<td>TERMINATED</td>
<td>terminated()æ–¹æ³•æ‰§è¡Œåï¼Œè¿›å…¥è¯¥çŠ¶æ€</td>
<td></td>
</tr>
</tbody></table>
<p><img src="https://i.loli.net/2020/04/22/NCxD9UavwYpfo4O.png" alt="çº¿ç¨‹æ± -ç”Ÿå‘½å‘¨æœŸ.png"></p>
<h2 id="ä»»åŠ¡çš„ç®¡ç†"><a href="#ä»»åŠ¡çš„ç®¡ç†" class="headerlink" title="ä»»åŠ¡çš„ç®¡ç†"></a>ä»»åŠ¡çš„ç®¡ç†</h2><p>æ¦‚è¿°ä¸­å·²ç»æåŠï¼Œçº¿ç¨‹æ± å†…éƒ¨å°±æ˜¯ä¸€ä¸ª<code>ç”Ÿäº§è€…-æ¶ˆè´¹è€…</code>æ¨¡å‹ï¼Œ<code>ä»»åŠ¡ç®¡ç†</code>è§†ä¸º<code>ç”Ÿäº§è€…</code>ï¼Œ<code>çº¿ç¨‹ç®¡ç†</code>è§†ä¸º<code>æ¶ˆè´¹è€…</code>ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¯¦ç»†é˜è¿°<code>ä»»åŠ¡ç®¡ç†</code>å’Œ<code>çº¿ç¨‹ç®¡ç†</code></p>
<h3 id="ä»»åŠ¡çš„è°ƒåº¦"><a href="#ä»»åŠ¡çš„è°ƒåº¦" class="headerlink" title="ä»»åŠ¡çš„è°ƒåº¦"></a>ä»»åŠ¡çš„è°ƒåº¦</h3><p>ä»»åŠ¡çš„è°ƒåº¦ï¼Œæ„Ÿè§‰å’Œæ“ä½œç³»ç»Ÿä¸­å¤„ç†æœºçš„è°ƒåº¦ç±»ä¼¼ï¼Œä»»åŠ¡æäº¤ä¹‹åï¼Œè¿›è¡Œåˆ¤æ–­</p>
<ol>
<li>åˆ¤æ–­çº¿ç¨‹æ± çš„çŠ¶æ€æ˜¯å¦ä¸º<strong>RUNNING</strong>ï¼Œå¦‚ä¸æ‰§è¡Œäº†ï¼Œæ‹’ç»æ¥æ”¶è¯¥ä»»åŠ¡ï¼ˆ<strong>çº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡</strong>ï¼‰ã€‚</li>
<li>å¦‚æœworkerCount &lt; corePoolSize, åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</li>
<li>å¦‚æœworkerCount &gt;= corePoolSize &amp;&amp; é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œå°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚</li>
<li>å¦‚æœworkerCount &gt;=corePoolSize &amp;&amp; é˜»å¡é˜Ÿé‡Œå·²æ»¡&amp;&amp;workerCount &lt; maximumPoolSizeï¼Œåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡</li>
<li>å¦‚æœworkerCount &gt;= maximumPoolSize &amp;&amp; é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œ æ ¹æ®æ‹’ç­–ç•¥è¿›è¡Œæ‹’ç»ï¼Œé»˜è®¤ä½¿ç”¨æ˜¯<code>AbortPolicy</code>ï¼Œæ”¾å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2020/04/21/yuWbBpA62HE9FT4.png" alt="ä»»åŠ¡è°ƒåº¦æµç¨‹å›¾.png" title="">
                </div>
                <div class="image-caption">ä»»åŠ¡è°ƒåº¦æµç¨‹å›¾.png</div>
            </figure>

<p>ThreadPoolExecutorä¸­ä»»åŠ¡è°ƒåº¦çš„å®ç°</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable command)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (command == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">// è·å–çº¿ç¨‹æ± çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">    <span class="comment">// â‘¡</span></span><br><span class="line">    <span class="keyword">if</span> (workerCountOf(c) &lt; corePoolSize) {</span><br><span class="line">        <span class="keyword">if</span> (addWorker(command, <span class="keyword">true</span>))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        c = ctl.get();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// â‘¢</span></span><br><span class="line">    <span class="keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) {</span><br><span class="line">        <span class="keyword">int</span> recheck = ctl.get();</span><br><span class="line">        <span class="comment">// 3.1 å¦‚æœisRunningè¿”å›false(çŠ¶æ€æ£€æŸ¥)ï¼Œåˆ™removeè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))</span><br><span class="line">            reject(command);</span><br><span class="line">         <span class="comment">// 3.2 çº¿ç¨‹æ± å¤„äºrunningçŠ¶æ€ï¼Œä½†æ˜¯æ²¡æœ‰çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (workerCountOf(recheck) == <span class="number">0</span>)</span><br><span class="line">            addWorker(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// â‘£å¦‚æœworkerCount &gt;=corePoolSize &amp;&amp; é˜»å¡é˜Ÿé‡Œå·²æ»¡&amp;&amp;workerCount &lt; maximumPoolSizeï¼Œåˆ›å»ºå¹¶å¯     // åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œè¯¥ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!addWorker(command, <span class="keyword">false</span>))</span><br><span class="line">        reject(command);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>





<h3 id="ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰"><a href="#ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰" class="headerlink" title="ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰"></a>ä»»åŠ¡çš„ç¼“å†²ï¼ˆBlockingQueueï¼‰</h3><p>è¿™æ˜¯çº¿ç¨‹æ± çš„å…³é”®ï¼Œå…¶ç­‰åŒäº<code>ç”Ÿäº§è€…-æ¶ˆè´¹è€…</code>ä¸­çš„ç¼“å†²åŒºï¼Œåœ¨çº¿ç¨‹æ± ä¸­ï¼Œæ ¸å¿ƒæ˜¯å¯¹ä»»åŠ¡å’Œçº¿ç¨‹çš„ç®¡ç†ï¼Œä¸Šè¿°ä¹Ÿè®²è¿‡äº†æ ¸å¿ƒå°±æ˜¯ä»»åŠ¡å’Œçº¿ç¨‹çš„è§£è€¦ï¼Œè§£è€¦çš„æ–¹å¼å°±æ˜¯æ·»åŠ ç¼“å†²åŒºã€‚åœ¨çº¿ç¨‹æ± ä¸­é€šè¿‡é˜»å¡é˜Ÿåˆ—å®ç°ç¼“å†²åŒºï¼Œæš‚å­˜ä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚</p>
<p>é˜»å¡é˜Ÿåˆ—å¸¸ç”¨ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…åœºæ™¯ï¼Œå…¶é™¤äº†æ”¯æŒå­˜å‚¨ä»»åŠ¡çš„çº¿ç¨‹å­˜å‚¨å…ƒç´ ï¼Œè·å–ä»»åŠ¡çš„çº¿ç¨‹è·å–å…ƒç´ ä¹‹å¤–ï¼Œè¿˜æœ‰<strong>ä¸¤ä¸ªé™„åŠ çš„æ“ä½œ</strong>ï¼ˆè‡ªå·±ç¼–å†™ç”Ÿäº§è€…-æ¶ˆè´¹è€…æœ€éº»çƒ¦çš„åœ°æ–¹ï¼‰ï¼š </p>
<ol>
<li>å½“é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ï¼Œè·å–ä»»åŠ¡çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—éç©º</li>
<li>å½“é˜Ÿåˆ—æ»¡çš„æ—¶å€™ï¼Œå­˜æ”¾ä»»åŠ¡çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚</li>
</ol>
<p>è¿™æ ·ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åªç®¡å¾€é‡Œé¢å­˜ã€å–å°±è¡Œï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å­˜ã€å–å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹ï¼Œé˜»å¡é˜Ÿåˆ—ï¼ˆBlockQueueå°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼‰ï¼Œå…¶æä¾›äº†å››ä¸­ä¸åŒ<code>æ’å…¥</code>ã€<code>ç§»é™¤</code>ã€<code>æ£€æµ‹å…ƒç´ </code>çš„æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æŠ›å‡ºå¼‚å¸¸</th>
<th>è¿”å›ç‰¹æ®Šå€¼</th>
<th>ä¸€ç›´é˜»å¡</th>
<th>è¶…æ—¶é€€å‡º</th>
</tr>
</thead>
<tbody><tr>
<td>æ’å…¥</td>
<td>add(e)</td>
<td>offer()</td>
<td>put(e)</td>
<td>offer(e, time , unit)</td>
</tr>
<tr>
<td>ç§»é™¤</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td>æ£€æŸ¥</td>
<td>element()</td>
<td>peek()</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>BlockingQueueçš„å®ç°ç±»æœ‰å¦‚ä¸‹çš„ä¸€äº›</p>
<ol>
<li><p>ArrayBlockingQueue</p>
</li>
<li><p>LinkedBlockingQueue</p>
</li>
<li><p>DelayQueue</p>
</li>
<li><p>PriorityBlockingQueue</p>
</li>
<li><p>SynchronousQueue</p>
</li>
</ol>
<p><strong>åç»­ä¼šçœ‹ç›¸åº”çš„æºç ï¼Œå¹¶æ•´ç†ä¸ºåšå®¢ã€‚ç›®å‰å°±ä¸è¯¦ç»†è§£é‡Šå…¶åŒºåˆ«ã€‚</strong></p>
<h3 id="ä»»åŠ¡çš„ç”³è¯·"><a href="#ä»»åŠ¡çš„ç”³è¯·" class="headerlink" title="ä»»åŠ¡çš„ç”³è¯·"></a>ä»»åŠ¡çš„ç”³è¯·</h3><p>ç”±ä»»åŠ¡çš„è°ƒåº¦å¯ä»¥æ€»ç»“å‡ºï¼Œä»»åŠ¡çš„æ‰§è¡Œæœ‰ä¸¤ç§å¯èƒ½</p>
<ol>
<li>ä»»åŠ¡ç›´æ¥ç”±æ–°åˆ›å»ºçš„çº¿ç¨‹æ‰§è¡Œ</li>
<li>å¤ç”¨çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ï¼Œæ‰§è¡Œ</li>
</ol>
<p>ç¬¬ä¸€ç§æƒ…å†µå‡ºç°åœ¨çº¿ç¨‹åˆå§‹åˆ›å»ºçš„æ—¶å€™ï¼Œä»¥åŠå‡ºç°å³°å€¼çš„æ—¶å€™ã€‚ç¬¬äºŒç§æ˜¯çº¿ç¨‹è·å–ä»»åŠ¡ç»å¤§å¤šæ•°çš„æƒ…å†µã€‚è¿™é‡Œå¯ä»¥é¡ºä¾¿åˆ†æ<code>ThreadPoolExecutor</code>æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹çš„å¤ç”¨çš„ã€‚</p>
<p>ç¬¬äºŒç§çš„ä»»åŠ¡çš„ç”³è¯·ä½¿ç”¨çš„æ˜¯çº¿ç¨‹æ± ä¸­çš„<code>getTask</code>çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Runnable <span class="title">getTask</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">boolean</span> timedOut = <span class="keyword">false</span>; <span class="comment">// Did the last poll() time out?</span></span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp; (rs &gt;= STOP || workQueue.isEmpty())) {</span><br><span class="line">            decrementWorkerCount();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">        <span class="comment">// Are workers subject to culling?</span></span><br><span class="line">        <span class="comment">// </span></span><br><span class="line">        <span class="keyword">boolean</span> timed = allowCoreThreadTimeOut || wc &gt; corePoolSize;</span><br><span class="line">        <span class="comment">// å¦‚æœè¿è¡Œçº¿ç¨‹æ•°è¶…è¿‡äº†æœ€å¤§çº¿ç¨‹æ•°ï¼Œä½†æ˜¯ç¼“å­˜é˜Ÿåˆ—å·²ç»ç©ºäº†ï¼Œè¿™æ—¶é€’å‡workeræ•°é‡</span></span><br><span class="line">        <span class="keyword">if</span> ((wc &gt; maximumPoolSize || (timed &amp;&amp; timedOut))</span><br><span class="line">            &amp;&amp; (wc &gt; <span class="number">1</span> || workQueue.isEmpty())) {</span><br><span class="line">            <span class="keyword">if</span> (compareAndDecrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Runnable r = timed ?</span><br><span class="line">                workQueue.poll(keepAliveTime, TimeUnit.NANOSECONDS) :</span><br><span class="line">                workQueue.take();</span><br><span class="line">            <span class="keyword">if</span> (r != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            timedOut = <span class="keyword">true</span>;</span><br><span class="line">        } <span class="keyword">catch</span> (InterruptedException retry) {</span><br><span class="line">            timedOut = <span class="keyword">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>





<h3 id="ä»»åŠ¡çš„æ‹’ç»"><a href="#ä»»åŠ¡çš„æ‹’ç»" class="headerlink" title="ä»»åŠ¡çš„æ‹’ç»"></a>ä»»åŠ¡çš„æ‹’ç»</h3><p>ä»»åŠ¡æ‹’ç»æ¨¡å—æ˜¯çº¿ç¨‹æ± çš„ä¿æŠ¤éƒ¨åˆ†ï¼Œçº¿ç¨‹æ± æœ‰ä¸€ä¸ªæœ€å¤§çš„å®¹é‡ï¼Œå½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼Œå¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeæ—¶ï¼Œå°±éœ€è¦æ‹’ç»æ‰è¯¥ä»»åŠ¡ï¼Œé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œä¿æŠ¤çº¿ç¨‹æ± ã€‚</p>
<p>å†³ç»ç­–ç•¥åœ¨æ„é€ æ–¹æ³•çš„æ—¶å€™ï¼Œå°±å·²ç»è®²è§£äº†ï¼Œå…±å››ç§ï¼š</p>
<ol>
<li><strong>ThreadPoolExecutor.AbortPolicy</strong>ï¼š<strong>é»˜è®¤æ‹’ç»å¤„ç†ç­–ç•¥</strong>ï¼Œä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚</li>
<li><strong>ThreadPoolExecutor.DiscardPolicy</strong>ï¼šä¸¢å¼ƒæ–°æ¥çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><strong>ThreadPoolExecutor.DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨ï¼ˆæœ€æ—§çš„ï¼‰çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œç¨‹åºï¼ˆå¦‚æœå†æ¬¡å¤±è´¥ï¼Œé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚</li>
<li><strong>ThreadPoolExecutor.CallerRunsPolicy</strong>ï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚</li>
</ol>
<h2 id="çº¿ç¨‹çš„ç®¡ç†"><a href="#çº¿ç¨‹çš„ç®¡ç†" class="headerlink" title="çº¿ç¨‹çš„ç®¡ç†"></a>çº¿ç¨‹çš„ç®¡ç†</h2><h3 id="Workerçº¿ç¨‹"><a href="#Workerçº¿ç¨‹" class="headerlink" title="Workerçº¿ç¨‹"></a>Workerçº¿ç¨‹</h3><p>çº¿ç¨‹æ± ä¸ºäº†æŒæ¡çº¿ç¨‹çš„çŠ¶æ€å¹¶ç»´æŠ¤çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè®¾è®¡äº†çº¿ç¨‹æ± å†…çš„å·¥ä½œçº¿ç¨‹Workerã€‚</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Worker</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>{</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>Worker</code>ç»§æ‰¿äº†<code>AbstractQueueSynchronnizer</code>ï¼Œå®ç°äº†<code>Runnable</code>æ¥å£ã€‚</p>
<h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Worker(Runnable firstTask) {</span><br><span class="line">    setState(-<span class="number">1</span>); <span class="comment">// inhibit interrupts until runWorker</span></span><br><span class="line">    <span class="keyword">this</span>.firstTask = firstTask;</span><br><span class="line">    <span class="keyword">this</span>.thread = getThreadFactory().newThread(<span class="keyword">this</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡<code>ThreadFactory</code>æ–¹æ³•åˆ›å»ºçº¿ç¨‹ï¼Œ<code>firstTask</code>å¯ä¸ºç©ºï¼Œä¸ºç©ºçš„æ—¶å€™ï¼Œä¹Ÿå°±å¯¹åº”çº¿ç¨‹å»é˜»å¡é˜Ÿåˆ—ä¸­å»è·å–ä»»åŠ¡ï¼Œè‹¥æ˜¯ä¸ä¸ºç©ºï¼Œå¯¹åº”çš„ä¸ºç›´æ¥æ‰§è¡Œä»»åŠ¡ã€‚</p>
<h4 id="runæ–¹æ³•"><a href="#runæ–¹æ³•" class="headerlink" title="runæ–¹æ³•"></a>runæ–¹æ³•</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">      runWorker(<span class="keyword">this</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="Workerçº¿ç¨‹å¢åŠ -æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨"><a href="#Workerçº¿ç¨‹å¢åŠ -æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨" class="headerlink" title="Workerçº¿ç¨‹å¢åŠ (æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨)"></a>Workerçº¿ç¨‹å¢åŠ (æ¶‰åŠåˆ°çº¿ç¨‹çš„å¤ç”¨)</h3><p><code>Worker</code>çº¿ç¨‹çš„å¢åŠ æ˜¯é€šè¿‡çº¿ç¨‹æ± ä¸­çš„<code>addWorker()</code>æ–¹æ³•</p>
<h4 id="ä¸Šç¯‡"><a href="#ä¸Šç¯‡" class="headerlink" title="ä¸Šç¯‡"></a>ä¸Šç¯‡</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">addWorker</span><span class="params">(Runnable firstTask, <span class="keyword">boolean</span> core)</span> </span>{</span><br><span class="line">    <span class="comment">// æºç ä¸­çš„ä¸ŠåŠéƒ¨åˆ†</span></span><br><span class="line">    retry:</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        <span class="keyword">int</span> c = ctl.get();</span><br><span class="line">        <span class="keyword">int</span> rs = runStateOf(c);</span><br><span class="line">        <span class="comment">// Check if queue empty only if necessary.</span></span><br><span class="line">        <span class="keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;</span><br><span class="line">            ! (rs == SHUTDOWN &amp;&amp;</span><br><span class="line">               firstTask == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">               ! workQueue.isEmpty()))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            <span class="comment">// å½“å‰çº¿ç¨‹çš„æ€»æ•°</span></span><br><span class="line">            <span class="keyword">int</span> wc = workerCountOf(c);</span><br><span class="line">            <span class="keyword">if</span> (wc &gt;= CAPACITY ||</span><br><span class="line">                <span class="comment">// 1.å¦‚æœcoreæ˜¯ture,è¯æ˜éœ€è¦åˆ›å»ºçš„çº¿ç¨‹ä¸ºæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹</span></span><br><span class="line">                <span class="comment">// å¦‚æœcoreæ˜¯false,è¯æ˜éœ€è¦åˆ›å»ºçš„æ˜¯éæ ¸å¿ƒçº¿ç¨‹ï¼Œåˆ™å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºæ€»çº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="comment">// å¦‚æœä¸å°äºï¼Œåˆ™è¿”å›false</span></span><br><span class="line">                wc &gt;= (core ? corePoolSize : maximumPoolSize))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (compareAndIncrementWorkerCount(c))</span><br><span class="line">                <span class="keyword">break</span> retry;</span><br><span class="line">            c = ctl.get();  <span class="comment">// Re-read ctl</span></span><br><span class="line">            <span class="keyword">if</span> (runStateOf(c) != rs)</span><br><span class="line">                <span class="keyword">continue</span> retry;</span><br><span class="line">            <span class="comment">// else CAS failed due to workerCount change; retry inner loop</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>

<p>ä»¥ä¸Šçš„éƒ¨åˆ†ç”¨äºåˆ¤æ–­çº¿ç¨‹æ•°é‡æ˜¯å¦è¶…å‡ºé˜€å€¼ï¼Œè¶…è¿‡äº†å°±è¿”å›ä¸º<code>false</code></p>
<h4 id="ä¸‹ç¯‡"><a href="#ä¸‹ç¯‡" class="headerlink" title="ä¸‹ç¯‡"></a>ä¸‹ç¯‡</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> workerStarted = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">boolean</span> workerAdded = <span class="keyword">false</span>;</span><br><span class="line">Worker w = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// åˆ›å»ºworkerå¯¹è±¡</span></span><br><span class="line">    w = <span class="keyword">new</span> Worker(firstTask);</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–threadå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">final</span> Thread t = w.thread;</span><br><span class="line">    <span class="keyword">if</span> (t != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="comment">// å…¨å±€é”</span></span><br><span class="line">        <span class="keyword">final</span> ReentrantLock mainLock = <span class="keyword">this</span>.mainLock;</span><br><span class="line">        mainLock.lock();</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// Recheck while holding lock.</span></span><br><span class="line">            <span class="comment">// Back out on ThreadFactory failure or if</span></span><br><span class="line">            <span class="comment">// shut down before lock acquired.</span></span><br><span class="line">            <span class="keyword">int</span> rs = runStateOf(ctl.get());</span><br><span class="line">            <span class="keyword">if</span> (rs &lt; SHUTDOWN ||</span><br><span class="line">                (rs == SHUTDOWN &amp;&amp; firstTask == <span class="keyword">null</span>)) {</span><br><span class="line">                <span class="keyword">if</span> (t.isAlive()) <span class="comment">// precheck that t is startable</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line">                <span class="comment">// åŠ å…¥åˆ°workers setä¸­</span></span><br><span class="line">                workers.add(w);</span><br><span class="line">                <span class="keyword">int</span> s = workers.size();</span><br><span class="line">                <span class="keyword">if</span> (s &gt; largestPoolSize)</span><br><span class="line">                    largestPoolSize = s;</span><br><span class="line">                workerAdded = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            mainLock.unlock();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (workerAdded) {</span><br><span class="line">            <span class="comment">// å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">            t.start();</span><br><span class="line">            workerStarted = <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">} <span class="keyword">finally</span> {</span><br><span class="line">    <span class="keyword">if</span> (! workerStarted)</span><br><span class="line">        addWorkerFailed(w);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">return</span> workerStarted;</span><br></pre></td></tr></tbody></table></figure>

<p>åˆ›å»º<code>worker</code>å¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ª<code>Thread</code>å¯¹è±¡ï¼Œç„¶åå¯åŠ¨è¿™ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚<code>t.start()</code>æ–¹æ³•ä¼šè°ƒç”¨Workerä¸­çš„<code>run</code>æ–¹æ³•ï¼Œ<code>run</code>æ–¹æ³•åˆä½¿ç”¨äº†<code>runWorker()</code>æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ</p>
<h3 id="çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ"><a href="#çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ" class="headerlink" title="çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ"></a>çº¿ç¨‹çš„ä»»åŠ¡æ‰§è¡Œ</h3><h4 id="runWorker-æ–¹æ³•"><a href="#runWorker-æ–¹æ³•" class="headerlink" title="runWorker()æ–¹æ³•"></a>runWorker()æ–¹æ³•</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">runWorker</span><span class="params">(Worker w)</span> </span>{</span><br><span class="line">    Thread wt = Thread.currentThread();</span><br><span class="line">    Runnable task = w.firstTask;</span><br><span class="line">    w.firstTask = <span class="keyword">null</span>;</span><br><span class="line">    w.unlock(); </span><br><span class="line">    <span class="keyword">boolean</span> completedAbruptly = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">// Workeræ‰§è¡ŒfirstTaskæˆ–ä»workQueueä¸­è·å–ä»»åŠ¡ï¼Œå¦‚æœgetTaskæ–¹æ³•ä¸è¿”å›null,å¾ªç¯ä¸é€€å‡º</span></span><br><span class="line">        <span class="keyword">while</span> (task != <span class="keyword">null</span> || (task = getTask()) != <span class="keyword">null</span>) {</span><br><span class="line">            w.lock();</span><br><span class="line">            <span class="keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||</span><br><span class="line">                 (Thread.interrupted() &amp;&amp;</span><br><span class="line">                  runStateAtLeast(ctl.get(), STOP))) &amp;&amp;</span><br><span class="line">                !wt.isInterrupted())</span><br><span class="line">                wt.interrupt();</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                beforeExecute(wt, task);</span><br><span class="line">                Throwable thrown = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    task.run();</span><br><span class="line">                } <span class="keyword">catch</span> (RuntimeException x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                } <span class="keyword">catch</span> (Error x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> x;</span><br><span class="line">                } <span class="keyword">catch</span> (Throwable x) {</span><br><span class="line">                    thrown = x; <span class="keyword">throw</span> <span class="keyword">new</span> Error(x);</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    afterExecute(task, thrown);</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">finally</span> {</span><br><span class="line">                task = <span class="keyword">null</span>;</span><br><span class="line">                w.completedTasks++;</span><br><span class="line">                w.unlock();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        completedAbruptly = <span class="keyword">false</span>;</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        processWorkerExit(w, completedAbruptly);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é¦–å…ˆå»æ‰§è¡Œåˆ›å»ºè¿™ä¸ªworkeræ—¶å°±æœ‰çš„ä»»åŠ¡ï¼Œå½“æ‰§è¡Œå®Œè¿™ä¸ªä»»åŠ¡åï¼Œworkerçš„ç”Ÿå‘½å‘¨æœŸå¹¶æ²¡æœ‰ç»“æŸï¼Œåœ¨<code>while</code>å¾ªç¯ä¸­ï¼Œworkerä¼šä¸æ–­åœ°è°ƒç”¨<code>getTask</code>æ–¹æ³•ä»<strong>é˜»å¡é˜Ÿåˆ—</strong>ä¸­è·å–ä»»åŠ¡ç„¶åè°ƒç”¨<code>task.run()</code>æ‰§è¡Œä»»åŠ¡,ä»è€Œè¾¾åˆ°<strong>å¤ç”¨çº¿ç¨‹</strong>çš„ç›®çš„ã€‚åªè¦<code>getTask</code>æ–¹æ³•ä¸è¿”å›<code>null</code>,æ­¤çº¿ç¨‹å°±ä¸ä¼šé€€å‡ºã€‚</p>
<h2 id="å¸¸è§çš„çº¿ç¨‹æ± "><a href="#å¸¸è§çš„çº¿ç¨‹æ± " class="headerlink" title="å¸¸è§çš„çº¿ç¨‹æ± "></a>å¸¸è§çš„çº¿ç¨‹æ± </h2><p><code>Executors</code>ç±»ä¸­æä¾›çš„å‡ ä¸ªé™æ€æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚é€šè¿‡å‰é¢çš„<code>ThreadPoolExecutor</code>çš„æ„é€ æ–¹æ³•ï¼Œå°±å¯ä»¥æ˜ç™½è¿™äº›çº¿ç¨‹æ± å…·ä½“å¹²å•¥çš„ï¼Œå¾ˆå¯æƒœï¼Œé˜»å¡é˜Ÿåˆ—çš„å…·ä½“å®ç°è¿˜æ²¡æœ‰çœ‹ï¼Œè€Œä¸”çº¿ç¨‹æ± çš„demoå†™çš„ä¹Ÿä¸å¤šï¼Œè®¤è¯†ä¸æ·±åˆ»ï¼Œæ‰€ä»¥å°±æš‚æ—¶å…ˆä¸å†™ã€‚</p>
<h4 id="newCachedThreadPool"><a href="#newCachedThreadPool" class="headerlink" title="newCachedThreadPool"></a>newCachedThreadPool</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                  <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="newFixedThreadPool"><a href="#newFixedThreadPool" class="headerlink" title="newFixedThreadPool"></a>newFixedThreadPool</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(nThreads, nThreads,</span><br><span class="line">                                      <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                      <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="newSingleThreadExecutor"><a href="#newSingleThreadExecutor" class="headerlink" title="newSingleThreadExecutor"></a>newSingleThreadExecutor</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="newScheduledThreadPool"><a href="#newScheduledThreadPool" class="headerlink" title="newScheduledThreadPool"></a>newScheduledThreadPool</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//ScheduledThreadPoolExecutor():</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ScheduledThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(corePoolSize, Integer.MAX_VALUE,</span><br><span class="line">          DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,</span><br><span class="line">          <span class="keyword">new</span> DelayedWorkQueue());</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>





<h2 id="Executoræ¡†æ¶"><a href="#Executoræ¡†æ¶" class="headerlink" title="Executoræ¡†æ¶"></a>Executoræ¡†æ¶</h2><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://i.loli.net/2020/04/21/qDyksotYTvRE56m.png" alt="ThreadExecutorUML.png" title="">
                </div>
                <div class="image-caption">ThreadExecutorUML.png</div>
            </figure>



<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="http://concurrent.redspider.group/article/03/12.html" target="_blank" rel="noopener">çº¿ç¨‹æ± åŸç†</a></li>
<li><a href="https://hzy38324.gitbooks.io/java-concurrency-in-practice/content/thread-pool-2.html" target="_blank" rel="noopener">æ·±å…¥ç†è§£çº¿ç¨‹æ±  â€”â€” Javaçº¿ç¨‹æ± æ˜¯å¦‚ä½•è¯ç”Ÿçš„</a></li>
<li><a href="https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html" target="_blank" rel="noopener">Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ</a></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2021-04-25T07:50:26.859Z" itemprop="dateUpdated">2021-04-25 15:50:26</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="https://winniekun.github.io">
            <img src="https://avatars.githubusercontent.com/u/19886738?v=4" alt="weikunkun">
            weikunkun
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">å¹¶å‘</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/&title=ã€Šçº¿ç¨‹æ± ç†è§£ã€‹ â€” Wkkã®ç¬”è®°&pic=https://avatars.githubusercontent.com/u/19886738?v=4" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/&title=ã€Šçº¿ç¨‹æ± ç†è§£ã€‹ â€” Wkkã®ç¬”è®°&source=çº¿ç¨‹æ± çš„æ¦‚è¿°" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šçº¿ç¨‹æ± ç†è§£ã€‹ â€” Wkkã®ç¬”è®°&url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/&via=https://winniekun.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/Java%E5%AE%9E%E7%8E%B0%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Javaå®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Javaå†…å­˜æ¨¡å‹</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        ç«™ç‚¹æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        ç«™ç‚¹æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>åšå®¢å†…å®¹éµå¾ª <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…åè®®</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>weikunkun &copy; 2015 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/&title=ã€Šçº¿ç¨‹æ± ç†è§£ã€‹ â€” Wkkã®ç¬”è®°&pic=https://avatars.githubusercontent.com/u/19886738?v=4" data-title="å¾®åš">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/&title=ã€Šçº¿ç¨‹æ± ç†è§£ã€‹ â€” Wkkã®ç¬”è®°&source=çº¿ç¨‹æ± çš„æ¦‚è¿°" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€Šçº¿ç¨‹æ± ç†è§£ã€‹ â€” Wkkã®ç¬”è®°&url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/&via=https://winniekun.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://winniekun.github.io/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%90%86%E8%A7%A3/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACq0lEQVR42u3aQXKDMAwF0Nz/0uk2nRb4kmxKZ55XTJqAnxdIlfR6xev9sT4/Of/+z98eraNnnX9z2cLDw8MbbP3odvlWks/z696R4eHh4d3DS253HiSqKwk5kyPAw8PDez4v2cQkRcbDw8P7v7w8mU4eX70zHh4e3nN4SeKbFHaTcHKO/LNaCx4eHt6GLtJzrrf09/Dw8PDGXfW8ubUg8R2MHRzuBw8PD28DL3/h5mlr9Th6CXr+dDw8PLx7eL1EdlKemBzWReDBw8PDW8qblFPzEuqkvJuk3YXOHh4eHt4iXoKsptSTRDw/rKgMgYeHh7eUV01ke+2xXqGhV4YoN8bw8PDwWrxC3aJ1cj1GfigXh4WHh4e3gZe/RXul1YSXN8kKrS88PDy8Dbz5uFXOq5YYXvE6/BUeHh7eZl41/a2+9CdhoDdAgIeHh7eblyB7r/5qyOkVl3+5xsPDw9vGqzac8oAxKdrO23J4eHh4O3jnL+7zWyRhoNpCq5YkogPCw8PDW8qrBoZqcSEv+1bHF6Id4uHh4W3g9Uam8sQ32W7C7v0VDw8Pbwcvb0FN2mC9IuyCAQI8PDy8bbxJebdXCK6Gn2YowsPDw9vAqz6yGgzygkV10wuCCh4eHt6Al//DXz2he4a0LvaMh4eHdyOvWsydjExNSskXx42Hh4d3C29tg3/U+D8NJM3AgIeHh7eUV91otZAazTK0Fh4eHt49vHdx5YnyvAjbK2F8u8bDw8PbwBuNNC1tleXDWGtHFvDw8PB6vLzhtGp0IP9ONWyUJxfw8PDwBrxe5ygvs1YLuHkEiwIDHh4e3iN5eQl4nuMXysF4eHh4j+EtaOoXt9srNOPh4eHt4yXFiN5Y1bwl1gs/eHh4ePt41RS2NwRQDQ/JENiop4eHh4fX4X0B5T0r8Na8WAEAAAAASUVORK5CYII=" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç ">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'æ­»é¬¼å»å“ªé‡Œäº†ï¼';
            clearTimeout(titleTime);
        } else {
            document.title = '(ã¤ã‚§âŠ‚)å’¦!åˆå¥½äº†!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
