---
title: æ³›å‹
date: 2019-03-11 07:53:55
tags: javaåŸºç¡€
categories: java
thumbnail: https://i.loli.net/2020/03/11/5WVgAvIP7mD9GoL.png
---

## æ³›å‹

å®¹å™¨æ²¡æœ‰æŒ‡å®šå­˜å‚¨æ•°æ®ç±»å‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å‘ `List` æ·»åŠ ä»»æ„ç±»å‹æ•°æ®ï¼Œç¼–è¯‘å™¨ä¸ä¼šåšç±»å‹æ£€æŸ¥ï¼Œè€Œæ˜¯é»˜é»˜çš„å°†æ‰€æœ‰æ•°æ®éƒ½è½¬ä¸º `Object`ã€‚

<!--more-->

å‡è®¾ï¼Œæœ€åˆæˆ‘ä»¬å¸Œæœ›å‘ `List` å­˜å‚¨çš„æ˜¯æ•´å½¢æ•°æ®ï¼Œå‡è®¾ï¼ŒæŸä¸ªå®¶ä¼™ä¸å°å¿ƒå­˜å…¥äº†å…¶ä»–æ•°æ®ç±»å‹ã€‚å½“ä½ è¯•å›¾ä»å®¹å™¨ä¸­å–æ•´å½¢æ•°æ®æ—¶ï¼Œç”±äº `List` å½“æˆ `Object` ç±»å‹æ¥å­˜å‚¨ï¼Œä½ ä¸å¾—ä¸ä½¿ç”¨ç±»å‹å¼ºåˆ¶è½¬æ¢ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæ‰ä¼šå‘ç°==`List` ä¸­æ•°æ®ä¸å­˜å‚¨ä¸€è‡´çš„é—®é¢˜==ï¼Œè¿™å°±ä¸ºç¨‹åºè¿è¡Œå¸¦æ¥äº†å¾ˆå¤§çš„é£é™©ï¼ˆæ— å½¢ä¼¤å®³æœ€ä¸ºè‡´å‘½ï¼‰ã€‚==è€Œæ³›å‹çš„å‡ºç°ï¼Œè§£å†³äº†ç±»å‹å®‰å…¨é—®é¢˜ã€‚==

### ä¼˜ç‚¹

* é¿å…ç±»å‹è½¬æ¢

  ```java
  // æœªä½¿ç”¨æ³›å‹
  List list = new ArrayList();
  list.add("hello");
  String s = (String) list.get(0);
  // ä½¿ç”¨æ³›å‹
  List<String> list = new ArrayList<String>();
  list.add("hello");
  String s = list.get(0);   // ä¸éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢
  ```

* ç¼–è¯‘æ—¶å¼ºç±»å‹æ£€æµ‹

  æ³›å‹è¦æ±‚åœ¨å£°æ˜æ—¶æŒ‡å®šå®é™…æ•°æ®ç±»å‹ï¼ŒJava ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šå¯¹æ³›å‹ä»£ç åšå¼ºç±»å‹æ£€æŸ¥ï¼Œå¹¶åœ¨ä»£ç è¿åç±»å‹å®‰å…¨æ—¶å‘å‡ºå‘Šè­¦ã€‚æ—©å‘ç°ï¼Œæ—©æ²»ç†ï¼ŒæŠŠéšæ‚£æ‰¼æ€äºæ‘‡ç¯®ï¼Œåœ¨ç¼–è¯‘æ—¶å‘ç°å¹¶ä¿®å¤é”™è¯¯æ‰€ä»˜å‡ºçš„ä»£ä»·è¿œæ¯”åœ¨è¿è¡Œæ—¶å°ã€‚

* æ³›å‹ç¼–ç¨‹å¯å®ç°é€šç”¨ç®—æ³•

  é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œå¯ä»¥å®ç°é€šç”¨ç®—æ³•ï¼Œè¿™äº›ç®—æ³•å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„é›†åˆï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œå¹¶ä¸”ç±»å‹å®‰å…¨ä¸”æ˜“äºé˜…è¯»ã€‚

### æ³›å‹ç±»å‹

**`æ³›å‹ç±»å‹`æ˜¯è¢«å‚æ•°åŒ–çš„ç±»æˆ–æ¥å£**

#### æ³›å‹ç±»

```java
class name<T1, T2, ... Tn>{}
```

ä¸€èˆ¬å°†æ³›å‹ä¸­çš„ç±»åç§°ä¸º**åŸå‹**ï¼Œè€Œå°† `<>` æŒ‡å®šçš„å‚æ•°ç§°ä¸º**ç±»å‹å‚æ•°**ã€‚

#### å•ç±»å‹å‚æ•°ï¼ˆTï¼‰

```java
public class SingleInfo<T> {
    private T value;

    public T getValue() {
        return value;
    }

    public void setValue(T value) {
        this.value = value;
    }

    @Override
    public String toString() {
        return "SingleInfo{" +
                "value=" + value +
                '}';
    }
}
```

#### å¤šç±»å‹å‚æ•°ï¼ˆKï¼ŒVï¼‰

```java
public class MultiInfo<K, V> {
    private K key;
    private V value;

    public MultiInfo(K key, V value) {
        this.key = key;
        this.value = value;
    }

    @Override
    public String toString() {
        return "MultiInfo{" +
                "key=" + key +
                ", value=" + value +
                '}';
    }
```

#### æ³›å‹ç±»çš„åµŒå¥—

```java
MultiInfo<Integer, MultiInfo<Integer, String>> multi = new MultiInfo<>(1, new MultiInfo<>(1,"32"));
System.out.println(multi);
// MultiInfo{key=1, value=MultiInfo{key=1, value=32}}
```

#### æ³›å‹æ¥å£

```java
public interface Content<T> {
    T text();
}
```

#### å®ç°æ¥å£çš„å­ç±»å‹å£°æ˜å…·ä½“çš„ç±»å‹

```java
public class ImplInterface implements MyInterface<Integer> {
    private int a = 100;

    public ImplInterface(int a) {
        this.a = a;
    }

    @Override
    public Integer getT() {
        return a;
    }
}

```

#### å®ç°æ¥å£çš„å­ç±»å‹ä¸å£°æ˜å…·ä½“ç±»å‹

```java
public class NoImplInterface<T> implements MyInterface<T> {
    private T text;

    public NoImplInterface(T text) {
        this.text = text;
    }

    @Override
    public T getT() {
        return text;
    }
}
```

### æ³›å‹æ–¹æ³•

æ³›å‹æ–¹æ³•æ˜¯å¼•å…¥å…¶è‡ªå·±çš„ç±»å‹å‚æ•°çš„æ–¹æ³•ã€‚æ³›å‹æ–¹æ³•å¯ä»¥æ˜¯æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•ä»¥åŠæ„é€ æ–¹æ³•ã€‚

æ³›å‹æ–¹æ³•è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š

```java
public <T> T func(T obj) {}
// ç±»å‹å˜é‡æ”¾åœ¨ä¿®é¥°ç¬¦ (è¿™é‡Œæ˜¯ public static ) çš„åé¢ , è¿”å›ç±»å‹çš„å‰é¢
```

**æ˜¯å¦æ‹¥æœ‰æ³›å‹æ–¹æ³•ï¼Œä¸å…¶æ‰€åœ¨çš„ç±»æ˜¯å¦æ˜¯æ³›å‹æ²¡æœ‰å…³ç³»ã€‚**

```java
public class GenericsMethodDemo01 {
    public static <T> void printClass(T obj) {
        System.out.println(obj.getClass().toString());
    }

    public static void main(String[] args) {
        printClass("abc");
        printClass(10);
    }
}
// Output:
// class java.lang.String
// class java.lang.Integer
```



æ³›å‹æ–¹æ³•ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å¯å˜å‚æ•°åˆ—è¡¨

```java
public class GenericVarargsMethodDemo {
    public static <T> List<T> makeList(T... args) {
        List<T> result = new ArrayList<T>();
        Collections.addAll(result, args);
        return result;
    }

    public static void main(String[] args) {
        List<String> ls = makeList("A");
        System.out.println(ls);
        ls = makeList("A", "B", "C");
        System.out.println(ls);
    }
}
// Output:
// [A]
// [A, B, C]
```



### ç±»å‹æ“¦é™¤

==**Javaä¸­çš„æ³›å‹åŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ç¼–è¯‘å™¨è¿™ä¸ªå±‚æ¬¡æ¥å®ç°çš„ã€‚**==

Java è¯­è¨€å¼•å…¥æ³›å‹æ˜¯ä¸ºäº†åœ¨ç¼–è¯‘æ—¶æä¾›æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œå¹¶æ”¯æŒæ³›å‹ç¼–ç¨‹ã€‚ä¸åŒäº C++ çš„æ¨¡æ¿æœºåˆ¶ï¼Œ**Java æ³›å‹æ˜¯ä½¿ç”¨ç±»å‹æ“¦é™¤æ¥å®ç°çš„ï¼Œä½¿ç”¨æ³›å‹æ—¶ï¼Œä»»ä½•å…·ä½“çš„ç±»å‹ä¿¡æ¯éƒ½è¢«æ“¦é™¤äº†**ã€‚

==Javaç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶å°½å¯èƒ½çš„å‘ç°å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œä½†æ˜¯ä»ç„¶æ— æ³•é¿å…åœ¨è¿è¡Œæ—¶åˆ»å‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸çš„æƒ…å†µ==

ç±»å‹æ“¦é™¤åšäº†ä»¥ä¸‹å·¥ä½œï¼š

- æŠŠæ³›å‹ä¸­çš„æ‰€æœ‰ç±»å‹å‚æ•°æ›¿æ¢ä¸º Objectï¼Œå¦‚æœæŒ‡å®šç±»å‹è¾¹ç•Œï¼Œåˆ™ä½¿ç”¨ç±»å‹è¾¹ç•Œæ¥æ›¿æ¢ã€‚å› æ­¤ï¼Œç”Ÿæˆçš„å­—èŠ‚ç ä»…åŒ…å«æ™®é€šçš„ç±»ï¼Œæ¥å£å’Œæ–¹æ³•ã€‚
- æ“¦é™¤å‡ºç°çš„ç±»å‹å£°æ˜ï¼Œå³å»æ‰ `<>` çš„å†…å®¹ã€‚æ¯”å¦‚ `T get()` æ–¹æ³•å£°æ˜å°±å˜æˆäº† `Object get()` ï¼›`List` å°±å˜æˆäº† `List`ã€‚å¦‚æœ‰å¿…è¦ï¼Œæ’å…¥ç±»å‹è½¬æ¢ä»¥ä¿æŒç±»å‹å®‰å…¨ã€‚
- ç”Ÿæˆæ¡¥æ¥æ–¹æ³•ä»¥ä¿ç•™æ‰©å±•æ³›å‹ç±»å‹ä¸­çš„å¤šæ€æ€§ã€‚ç±»å‹æ“¦é™¤ç¡®ä¿ä¸ä¸ºå‚æ•°åŒ–ç±»å‹åˆ›å»ºæ–°ç±»ï¼›å› æ­¤ï¼Œæ³›å‹ä¸ä¼šäº§ç”Ÿè¿è¡Œæ—¶å¼€é”€ã€‚

ç¤ºä¾‹ï¼š

```java
public class GenericsErasureTypeDemo {
    public static void main(String[] args) {
        List<Object> list1 = new ArrayList<Object>();
        List<String> list2 = new ArrayList<String>();
        System.out.println(list1.getClass());
        System.out.println(list2.getClass());
    }
}
// Output:
// class java.util.ArrayList
// class java.util.ArrayList
```

### æ³›å‹å’Œç»§æ‰¿

**æ³›å‹ä¸èƒ½ç”¨äºæ˜¾å¼åœ°å¼•ç”¨è¿è¡Œæ—¶ç±»å‹çš„æ“ä½œä¹‹ä¸­ï¼Œä¾‹å¦‚ï¼šè½¬å‹ã€instanceof æ“ä½œå’Œ new è¡¨è¾¾å¼ã€‚å› ä¸ºæ‰€æœ‰å…³äºå‚æ•°çš„ç±»å‹ä¿¡æ¯éƒ½ä¸¢å¤±äº†**ã€‚

æ³›å‹æ— æ³•å‘ä¸Šè½¬å‹

> å‘ä¸Šè½¬å‹æ˜¯æŒ‡ç”¨å­ç±»å®ä¾‹å»åˆå§‹åŒ–çˆ¶ç±»ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡ä¸­å¤šæ€çš„é‡è¦è¡¨ç°ã€‚

è¿™æ˜¯å› ä¸ºï¼Œæ³›å‹ç±»å¹¶æ²¡æœ‰è‡ªå·±ç‹¬æœ‰çš„ `Class` ç±»å¯¹è±¡ã€‚æ¯”å¦‚ï¼šå¹¶ä¸å­˜åœ¨ `List.class` æˆ–æ˜¯ `List.class`ï¼ŒJava ç¼–è¯‘å™¨ä¼šå°†äºŒè€…éƒ½è§†ä¸º `List.class`ã€‚

### ç±»å‹è¾¹ç•Œ

æœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶å¯åœ¨å‚æ•°åŒ–ç±»å‹ä¸­ç”¨ä½œç±»å‹å‚æ•°çš„ç±»å‹ã€‚**`ç±»å‹è¾¹ç•Œ`å¯ä»¥å¯¹æ³›å‹çš„ç±»å‹å‚æ•°è®¾ç½®é™åˆ¶æ¡ä»¶**ã€‚ä¾‹å¦‚ï¼Œå¯¹æ•°å­—è¿›è¡Œæ“ä½œçš„æ–¹æ³•å¯èƒ½åªæƒ³æ¥å— `Number` æˆ–å…¶å­ç±»çš„å®ä¾‹ã€‚

è¦å£°æ˜æœ‰ç•Œç±»å‹å‚æ•°ï¼Œè¯·åˆ—å‡ºç±»å‹å‚æ•°çš„åç§°ï¼Œç„¶åæ˜¯ `extends` å…³é”®å­—ï¼Œåè·Ÿå…¶é™åˆ¶ç±»æˆ–æ¥å£ã€‚

ç±»å‹è¾¹ç•Œçš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š

```java
<T extends XXX>
```



### ç±»å‹é€šé…ç¬¦

`ç±»å‹é€šé…ç¬¦`ä¸€èˆ¬æ˜¯ä½¿ç”¨ `?` ä»£æ›¿å…·ä½“çš„ç±»å‹å‚æ•°ã€‚ä¾‹å¦‚ `List` åœ¨é€»è¾‘ä¸Šæ˜¯ `List` ï¼Œ`List` ç­‰æ‰€æœ‰ `List<å…·ä½“ç±»å‹å®å‚>` çš„çˆ¶ç±»

#### ä¸Šç•Œé€šé…ç¬¦

å¯ä»¥ä½¿ç”¨**`ä¸Šç•Œé€šé…ç¬¦`**æ¥ç¼©å°ç±»å‹å‚æ•°çš„ç±»å‹èŒƒå›´ã€‚

å®ƒçš„è¯­æ³•å½¢å¼ä¸ºï¼š`<? extends Number>`

```java
public class GenericsUpperBoundedWildcardDemo {
    public static double sumOfList(List<? extends Number> list) {
        double s = 0.0;
        for (Number n : list) {
            s += n.doubleValue();
        }
        return s;
    }

    public static void main(String[] args) {
        List<Integer> li = Arrays.asList(1, 2, 3);
        System.out.println("sum = " + sumOfList(li));
    }
}
// Output:
// sum = 6.0
```

#### ä¸‹ç•Œé€šé…ç¬¦

**`ä¸‹ç•Œé€šé…ç¬¦`**å°†æœªçŸ¥ç±»å‹é™åˆ¶ä¸ºè¯¥ç±»å‹çš„ç‰¹å®šç±»å‹æˆ–è¶…ç±»ç±»å‹ã€‚

> ğŸ”” æ³¨æ„ï¼š**ä¸Šç•Œé€šé…ç¬¦å’Œä¸‹ç•Œé€šé…ç¬¦ä¸èƒ½åŒæ—¶ä½¿ç”¨**ã€‚

å®ƒçš„è¯­æ³•å½¢å¼ä¸ºï¼š`<? super Number>`

```java
public class GenericsLowerBoundedWildcardDemo {
    public static void addNumbers(List<? super Integer> list) {
        for (int i = 1; i <= 5; i++) {
            list.add(i);
        }
    }

    public static void main(String[] args) {
        List<Integer> list = new ArrayList<>();
        addNumbers(list);
        System.out.println(Arrays.deepToString(list.toArray()));
    }
}
// Output:
// [1, 2, 3, 4, 5]
```

#### æ— ç•Œé€šé…ç¬¦

æ— ç•Œé€šé…ç¬¦æœ‰ä¸¤ç§åº”ç”¨åœºæ™¯ï¼š

- å¯ä»¥ä½¿ç”¨ Object ç±»ä¸­æä¾›çš„åŠŸèƒ½æ¥å®ç°çš„æ–¹æ³•ã€‚
- ä½¿ç”¨ä¸ä¾èµ–äºç±»å‹å‚æ•°çš„æ³›å‹ç±»ä¸­çš„æ–¹æ³•ã€‚

#### é€šé…ç¬¦å’Œå‘ä¸Šè½¬å‹

**æ³›å‹ä¸èƒ½å‘ä¸Šè½¬å‹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é€šé…ç¬¦æ¥å‘ä¸Šè½¬å‹**ã€‚

```java
public class GenericsWildcardDemo {
    public static void main(String[] args) {
        List<Integer> intList = new ArrayList<>();
        List<Number> numList = intList;  // Error

        List<? extends Integer> intList2 = new ArrayList<>();
        List<? extends Number> numList2 = intList2;  // OK
    }
}
```

### æ³›å‹çº¦æŸ

[Restrictions on Generics](https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#instantiate)



### æ³›å‹å®è·µ

#### æ³›å‹å‘½å

æ³›å‹ä¸€äº›çº¦å®šä¿—æˆçš„å‘½åï¼š

- E - Element
- K - Key
- N - Number
- T - Type
- V - Value
- S,U,V etc. - 2nd, 3rd, 4th types

