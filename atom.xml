<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Wkkã®ç¬”è®°</title>
  
  <subtitle>å¥½è®°æ€§ä¸å¦‚çƒ‚é”®ç›˜</subtitle>
  <link href="https://winniekun.github.io/atom.xml" rel="self"/>
  
  <link href="https://winniekun.github.io/"/>
  <updated>2021-05-21T01:27:09.998Z</updated>
  <id>https://winniekun.github.io/</id>
  
  <author>
    <name>weikunkun</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring IoCè§£è¯»</title>
    <link href="https://winniekun.github.io/spring-ioc-analysis/"/>
    <id>https://winniekun.github.io/spring-ioc-analysis/</id>
    <published>2021-05-21T01:24:20.000Z</published>
    <updated>2021-05-21T01:27:09.998Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åº"><a href="#åº" class="headerlink" title="åº"></a>åº</h1><h2 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h2><p>IoCæ§åˆ¶åè½¬ï¼Œæ„æ€å°±æ˜¯å°†åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒä»æˆ‘ä»¬è‡ªå·±ç¡¬ç¼–ç æ¥newä¸€ä¸ªå¯¹è±¡åè½¬åˆ°äº†ç¬¬ä¸‰æ–¹èº«ä¸Šã€‚IoCçš„ä¸»è¦å®ç°æ–¹å¼æ˜¯ä¾èµ–æ³¨å…¥ï¼ŒSpringä¸­çš„ä¾èµ–æ³¨å…¥æ–¹å¼æœ‰ï¼š<code>æ„é€ æ–¹æ³•æ³¨å…¥</code>ã€<code>settteræ³¨å…¥</code>ã€<code>æ¥å£æ³¨å…¥</code>ã€‚</p><ul><li><strong>æ§åˆ¶åè½¬</strong>æ˜¯ä¸€ç§æ€æƒ³</li><li><strong>ä¾èµ–æ³¨å…¥</strong>æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼</li></ul><blockquote><p>IoCæ˜¯ä¸€ç§å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£è€¦å„ä¸šåŠ¡å¯¹è±¡é—´ä¾èµ–å…³ç³»çš„å¯¹è±¡ç»‘å®šæ–¹å¼</p></blockquote><h2 id="IoC-Service-Provider"><a href="#IoC-Service-Provider" class="headerlink" title="IoC Service Provider"></a>IoC Service Provider</h2><p>è™½ç„¶ä¸šåŠ¡å¯¹è±¡å¯ä»¥é€šè¿‡IoCæ–¹å¼å£°æ˜ç›¸åº”çš„ä¾èµ–ï¼Œä½†æ˜¯æœ€ç»ˆä»ç„¶éœ€è¦é€šè¿‡æŸä¸ªè§’è‰²æˆ–è€…æœåŠ¡å°†è¿™äº›ä¾èµ–çš„å¯¹è±¡ç»‘å®šåˆ°ä¸€èµ·ã€‚è€ŒIoC Service Providerå°±å¯¹åº”IoCåœºæ™¯ä¸­çš„è¿™ä¸€è§’è‰²ã€‚IoC Service Provideråœ¨è¿™é‡Œæ˜¯ä¸€ä¸ªæŠ½è±¡å‡ºæ¥çš„æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡ä»£ä»»ä½•å°†IoCåœºæ™¯ä¸­çš„ä¸šåŠ¡å¯¹è±¡ç»‘å®šåˆ°ä¸€èµ·çš„å®ç°æ–¹å¼ã€‚å®ƒå¯ä»¥æ˜¯ä¸€æ®µä»£ç ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„ç›¸å…³çš„ç±»ï¼Œç”šè‡³å¯ä»¥æ˜¯æ¯”è¾ƒé€šç”¨çš„IoCæ¡†æ¶æˆ– è€…IoCå®¹å™¨å®ç°ã€‚</p><h3 id="èŒè´£"><a href="#èŒè´£" class="headerlink" title="èŒè´£"></a>èŒè´£</h3><ol><li><p>ä¸šåŠ¡å¯¹è±¡çš„æ„å»ºç®¡ç†</p><p>IoCä¸­ï¼Œä¸šåŠ¡å¯¹è±¡æ— éœ€å…³å¿ƒæ‰€ä¾èµ–æ³¨å…¥çš„å¯¹è±¡<strong>å¦‚ä½•æ„å»ºå¦‚ä½•å–å¾—</strong>ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†çš„å·¥ä½œè¿˜æ˜¯éœ€è¦æœ‰äººæ¥åšçš„ã€‚æ‰€ä»¥<code>IoC Service Provider</code>éœ€è¦å°†å¯¹è±¡çš„æ„å»ºé€»è¾‘ä»<em>å®¢æˆ·ç«¯</em>å¯¹è±¡é‚£é‡ŒæŠ½ç¦»å‡ºæ¥ï¼Œä¸€é¢è¿™éƒ¨åˆ†é€»è¾‘æ±¡æŸ“ä¸šåŠ¡å¯¹è±¡çš„å®ç°ã€‚</p><blockquote><p><strong>å®¢æˆ·ç«¯</strong>ï¼šä»£ä½¿ç”¨æŸä¸ªå¯¹è±¡æˆ–è€…æŸç§æœåŠ¡çš„å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡Aéœ€è¦å¼•ç”¨å¯¹è±¡Bï¼Œé‚£ä¹ˆAå°±æ˜¯Bçš„å®¢æˆ·ç«¯å¯¹è±¡ï¼Œè€Œä¸ç®¡A å¤„äºServiceå±‚è¿˜æ˜¯æ•°æ®è®¿é—®å±‚ã€‚</p></blockquote></li><li><p>ä¸šåŠ¡å¯¹è±¡ä¹‹é—´çš„ä¾èµ–ç»‘å®š</p><p>æœ€è‰°å·¨ä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œè¿™ æ˜¯å®ƒçš„æœ€ç»ˆä½¿å‘½ä¹‹æ‰€åœ¨ã€‚å¦‚æœä¸èƒ½å®Œæˆè¿™ä¸ªèŒè´£ï¼Œé‚£ä¹ˆï¼Œæ— è®ºä¸šåŠ¡å¯¹è±¡å¦‚ä½•çš„â€œå‘¼å–Šâ€ï¼Œä¹Ÿä¸ ä¼šå¾—åˆ°ä¾èµ–å¯¹è±¡çš„ä»»ä½•å“åº”(æœ€å¸¸è§çš„å€’æ˜¯ä¼šæ”¶åˆ°ä¸€ä¸ªNullPointerException)ã€‚<code>IoC Service Provider</code>é€šè¿‡ç»“åˆä¹‹å‰æ„å»ºå’Œç®¡ç†çš„æ‰€æœ‰ä¸šåŠ¡å¯¹è±¡ï¼Œä»¥åŠå„ä¸ªä¸šåŠ¡å¯¹è±¡é—´å¯ä»¥è¯†åˆ«çš„ä¾èµ–å…³ç³»ï¼Œå°†è¿™äº›å¯¹è±¡æ‰€ä¾èµ–çš„å¯¹è±¡æ³¨å…¥ç»‘å®šï¼Œä»è€Œä¿è¯æ¯ä¸ªä¸šåŠ¡å¯¹è±¡åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å¤„äºå°±ç»ªçŠ¶ æ€ã€‚</p></li></ol><h2 id="Spring-IoCå®¹å™¨"><a href="#Spring-IoCå®¹å™¨" class="headerlink" title="Spring IoCå®¹å™¨"></a>Spring IoCå®¹å™¨</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://cdn.jsdelivr.net/gh/Winniekun/cloudImg@master/uPic/image-20210520140010820.png" alt="image-20210520140010820" title="">                </div>                <div class="image-caption">image-20210520140010820</div>            </figure><p>Springçš„IoCå®¹å™¨å°±æ˜¯ä¸€ä¸ªIoC Providerï¼Œä½†æ˜¯å…¶ç›¸æ¯”äºIoC Providerçš„åŠŸèƒ½æ›´åŠ çš„ä¸°å¯Œï¼Œé™¤äº†ä¸šåŠ¡å¯¹è±¡çš„æ„å»ºã€ä¾èµ–å…³ç³»çš„ç»‘å®šè¿™ç§IoC Providerçš„åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æ–°å¢äº†ä¸šåŠ¡å¯¹è±¡å£°æ˜å‘¨æœŸçš„ç®¡ç†ï¼ŒAOPæ”¯æŒç­‰ã€‚åŒæ—¶Springæä¾›äº†ä¸¤ç§å®¹å™¨ç±»å‹:BeanFactoryå’ŒApplicationContextã€‚</p><ul><li><p>BeanFactory</p><p>åŸºç¡€ç±»å‹IoCå®¹å™¨ï¼Œæä¾›å®Œæ•´çš„IoCæœåŠ¡æ”¯æŒã€‚å¦‚æœæ²¡æœ‰ç‰¹æ®ŠæŒ‡å®šï¼Œ==é»˜è®¤é‡‡ç”¨å»¶è¿Ÿåˆå§‹åŒ–ç­–ç•¥(lazy-load)==ã€‚åªæœ‰å½“å®¢æˆ·ç«¯å¯¹è±¡éœ€è¦è®¿é—®å®¹å™¨ä¸­çš„æŸä¸ªå—ç®¡å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰å¯¹è¯¥å—ç®¡å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–ä»¥åŠä¾èµ–æ³¨å…¥æ“ä½œã€‚æ‰€ä»¥ï¼Œç›¸å¯¹æ¥è¯´ï¼Œå®¹å™¨å¯åŠ¨åˆæœŸé€Ÿåº¦è¾ƒå¿«ï¼Œæ‰€éœ€è¦çš„èµ„æºæœ‰é™ã€‚å¯¹äºèµ„æºæœ‰é™ï¼Œå¹¶ä¸”åŠŸèƒ½è¦æ±‚ä¸æ˜¯å¾ˆä¸¥æ ¼çš„åœºæ™¯ï¼ŒBeanFactoryæ˜¯æ¯”è¾ƒåˆé€‚çš„ IoCå®¹å™¨é€‰æ‹©ã€‚</p></li><li><p>ApplicationContext</p><p>åœ¨BeanFactoryçš„åŸºç¡€ä¸Šæ„å»ºï¼Œæ˜¯ç›¸å¯¹æ¯”è¾ƒé«˜ çº§çš„å®¹å™¨å®ç°ï¼Œé™¤äº†æ‹¥æœ‰BeanFactoryçš„æ‰€æœ‰æ”¯æŒï¼ŒApplicationContextè¿˜æä¾›äº†å…¶ä»–é«˜çº§ç‰¹æ€§ï¼Œæ¯”å¦‚äº‹ä»¶å‘å¸ƒã€å›½é™…åŒ–ä¿¡æ¯æ”¯æŒç­‰ã€‚ApplicationContextæ‰€ç®¡ç† çš„å¯¹è±¡ï¼Œåœ¨è¯¥ç±»å‹å®¹å™¨å¯åŠ¨ä¹‹åï¼Œ==é»˜è®¤å…¨éƒ¨åˆå§‹åŒ–å¹¶ç»‘å®šå®Œæˆ==ã€‚æ‰€ä»¥ï¼Œç›¸å¯¹äºBeanFactoryæ¥ è¯´ï¼ŒApplicationContextè¦æ±‚æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼ŒåŒæ—¶ï¼Œå› ä¸ºåœ¨å¯åŠ¨æ—¶å°±å®Œæˆæ‰€æœ‰åˆå§‹åŒ–ï¼Œå®¹å™¨å¯åŠ¨æ—¶é—´è¾ƒä¹‹BeanFactoryä¹Ÿä¼šé•¿ä¸€äº›ã€‚åœ¨é‚£äº›ç³»ç»Ÿèµ„æºå……è¶³ï¼Œå¹¶ä¸”è¦æ±‚æ›´å¤šåŠŸèƒ½çš„åœºæ™¯ä¸­ï¼Œ ApplicationContextç±»å‹çš„å®¹å™¨æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚</p></li></ul><h3 id="ç®€å•çš„å¼ä¾‹"><a href="#ç®€å•çš„å¼ä¾‹" class="headerlink" title="ç®€å•çš„å¼ä¾‹"></a>ç®€å•çš„å¼ä¾‹</h3><h3 id="Spring-IoCå®¹å™¨çš„ä¸€äº›ç‰¹æ€§ç®€ä»‹"><a href="#Spring-IoCå®¹å™¨çš„ä¸€äº›ç‰¹æ€§ç®€ä»‹" class="headerlink" title="Spring IoCå®¹å™¨çš„ä¸€äº›ç‰¹æ€§ç®€ä»‹"></a>Spring IoCå®¹å™¨çš„ä¸€äº›ç‰¹æ€§ç®€ä»‹</h3><h4 id="autowire"><a href="#autowire" class="headerlink" title="autowire"></a>autowire</h4><p>è‡ªåŠ¨æ³¨å…¥ï¼Œé€šè¿‡autowireï¼Œæˆ‘ä»¬å¯ä»¥ç•¥å»å¾ˆå¤šäººå·¥æ˜¾ç¤ºçš„é…ç½®beançš„æ“ä½œï¼Œè¢«ä¾èµ–çš„å‘ç°å’Œæ³¨å…¥éƒ½äº¤ç»™äº†Springï¼ŒåŒæ—¶å…¶æœ‰å‡ ä¸ªç±»å‹å¯é€‰æ‹©ï¼Œæ¯”å¦‚byNameã€byTypeç­‰ã€‚</p><h4 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h4><p>BeanFactoryå’ŒFactoryBeanå‚»å‚»åˆ†ä¸æ¸…ï¼Ÿè™½ç„¶ä¸¤è€…ç±»ä¼¼ï¼Œä½†æ˜¯åŠŸèƒ½ä¸åŒã€‚FactoryBeanæ˜¯ä¸€ç§å·¥å‚Beanï¼Œå’Œæ™®é€šçš„Beanä¸ä¸€æ ·ï¼ŒFactoryBeanæ˜¯å¯ä»¥ç”Ÿäº§Beançš„Beanã€‚</p><h4 id="depends-on"><a href="#depends-on" class="headerlink" title="depends-on"></a>depends-on</h4><p>å½“ä¸€ä¸ª bean ç›´æ¥ä¾èµ–å¦ä¸€ä¸ª beanï¼Œå¯ä»¥ä½¿ç”¨ <code>&lt;ref/&gt;</code> æ ‡ç­¾è¿›è¡Œé…ç½®ã€‚ä¸è¿‡å¦‚æŸä¸ª bean å¹¶ä¸ç›´æ¥ä¾èµ–äºå…¶ä»– beanï¼Œä½†åˆéœ€è¦å…¶ä»– bean å…ˆå®ä¾‹åŒ–å¥½ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½¿ç”¨ depends-on ç‰¹æ€§äº†ã€‚depends-on ç‰¹æ€§æ¯”è¾ƒç®€å•ï¼Œå°±ä¸æ¼”ç¤ºäº†ã€‚ä»…è´´ä¸€ä¸‹é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹ï¼š</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªç®€å•çš„ç±»ï¼Œå…¶ä¸­ Hello éœ€è¦ World åœ¨å…¶ä¹‹å‰å®Œæˆå®ä¾‹åŒ–ã€‚ç›¸å…³é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"xyz.coolblog.depnedson.Hello"</span> <span class="attr">depends-on</span>=<span class="string">"world"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"world"</span> <span class="attr">class</span>=<span class="string">"xyz.coolblog.depnedson.World"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h4><p>BeanPostProcessor æ˜¯ bean å®ä¾‹åŒ–æ—¶çš„åç½®å¤„ç†å™¨ï¼ŒåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanPostProcessor</span> </span>{</span><br><span class="line">    <span class="comment">// bean åˆå§‹åŒ–å‰çš„å›è°ƒæ–¹æ³•</span></span><br><span class="line">    <span class="function">Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// bean åˆå§‹åŒ–åçš„å›è°ƒæ–¹æ³•    </span></span><br><span class="line">    <span class="function">Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>BeanPostProcessoræ˜¯Springæ¡†æ¶çš„ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå¯ä»¥é€šè¿‡BeanPostProcessoræ¥å£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ’æ‰‹Beançš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ¯”å¦‚AOPå°±æ˜¯åœ¨beanå®ä¾‹å°†åˆ‡é¢é€»è¾‘ç»‡å…¥beanå®ä¾‹ä¸­ï¼ŒAOPä¹Ÿæ˜¯æ­£æ˜¯é€šè¿‡BeanPostProcessorå’ŒIoCå®¹å™¨å»ºç«‹äº†è”ç³»</p><h5 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggerBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"Before  "</span> + beanName + <span class="string">" Initialization"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"After  "</span> + beanName + <span class="string">" Initialization"</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h5 id="é…ç½®å¦‚ä¸‹"><a href="#é…ç½®å¦‚ä¸‹" class="headerlink" title="é…ç½®å¦‚ä¸‹"></a><strong>é…ç½®å¦‚ä¸‹</strong></h5><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.titizz.simulation.toyspring.learninng.LoggerBeanPostProcessor"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"car"</span> <span class="attr">class</span>=<span class="string">"com.titizz.simulation.toyspring.Car"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h5 id="æµ‹è¯•å¦‚ä¸‹"><a href="#æµ‹è¯•å¦‚ä¸‹" class="headerlink" title="æµ‹è¯•å¦‚ä¸‹"></a><strong>æµ‹è¯•å¦‚ä¸‹</strong></h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBeanPostProcessor</span><span class="params">()</span> </span>{</span><br><span class="line">    String xmlPath = <span class="string">"test-spring.xml"</span>;</span><br><span class="line">    ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2021/05/02/iUgIOGvfmPo1ws5.png" alt="image-20210502181644978" title="">                </div>                <div class="image-caption">image-20210502181644978</div>            </figure><h3 id="æ ¸å¿ƒæ¥å£"><a href="#æ ¸å¿ƒæ¥å£" class="headerlink" title="æ ¸å¿ƒæ¥å£"></a>æ ¸å¿ƒæ¥å£</h3><h4 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h4><p>ä»¥ <code>Resource</code> æ¥å£ä¸ºæ ¸å¿ƒå‘æ•£å‡ºçš„å‡ ä¸ªç±»ï¼Œéƒ½æ˜¯ç”¨äºè§£å†³ IoC å®¹å™¨ä¸­çš„å†…å®¹ä»å“ªé‡Œæ¥çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ <strong>é…ç½®æ–‡ä»¶ä»å“ªé‡Œè¯»å–ã€é…ç½®æ–‡ä»¶å¦‚ä½•è¯»å–</strong> çš„é—®é¢˜ã€‚</p><table><thead><tr><th align="left">ç±»å</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>Resource</code></td><td align="left">æ¥å£ï¼Œæ ‡è¯†ä¸€ä¸ªå¤–éƒ¨èµ„æºã€‚é€šè¿‡ <code>getInputStream()</code> æ–¹æ³• <strong>è·å–èµ„æºçš„è¾“å…¥æµ</strong> ã€‚</td></tr><tr><td align="left"><code>UrlResource</code></td><td align="left">å®ç° <code>Resource</code> æ¥å£çš„èµ„æºç±»ï¼Œé€šè¿‡ URL è·å–èµ„æºã€‚</td></tr><tr><td align="left"><code>ResourceLoader</code></td><td align="left">èµ„æºåŠ è½½ç±»ã€‚é€šè¿‡ <code>getResource(String)</code> æ–¹æ³•è·å–ä¸€ä¸ª <code>Resouce</code> å¯¹è±¡ï¼Œæ˜¯ <strong>è·å– <code>Resouce</code> çš„ä¸»è¦é€”å¾„</strong> ã€‚</td></tr></tbody></table><h4 id="BeanDefinition"><a href="#BeanDefinition" class="headerlink" title="BeanDefinition"></a>BeanDefinition</h4><p><strong>åŠŸèƒ½ï¼š</strong>ç”¨äºè§£å†³Beançš„å®šä¹‰é—®é¢˜ï¼ŒåŒ…æ‹¬Beançš„åå­—ï¼Œç±»å‹ä»¥åŠå®ƒçš„å±æ€§èµ‹äºˆäº†ä»€ä¹ˆå€¼æˆ–è€…å¼•ç”¨ã€‚è¯´ç™½äº†ä¹Ÿå°±æ˜¯<strong>è§£å†³äº†åœ¨IoCå®¹å™¨ä¸­å®šä¹‰ä¸€ä¸ªBeanï¼Œä½¿å¾—IoCå®¹å™¨å¯ä»¥æ ¹æ®è¿™ä¸ªå®šä¹‰æ¥ç”Ÿæˆå®ä¾‹ã€‚</strong></p><table><thead><tr><th align="left">ç±»å</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>BeanDefinition</code></td><td align="left">è¯¥ç±»ä¿å­˜äº† <code>Bean</code> å®šä¹‰ã€‚åŒ…æ‹¬ <code>Bean</code> çš„ <strong>åå­—</strong> <code>String beanClassName</code>ã€<strong>ç±»å‹</strong> <code>Class beanClass</code>ã€<strong>å±æ€§</strong> <code>PropertyValues propertyValues</code>ã€‚æ ¹æ®å…¶ <strong>ç±»å‹</strong> å¯ä»¥ç”Ÿæˆä¸€ä¸ªç±»å®ä¾‹ï¼Œç„¶åå¯ä»¥æŠŠ <strong>å±æ€§</strong> æ³¨å…¥è¿›å»ã€‚<code>propertyValues</code> é‡Œé¢åŒ…å«äº†ä¸€ä¸ªä¸ª <code>PropertyValue</code> æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®éƒ½æ˜¯é”®å€¼å¯¹ <code>String</code> - <code>Object</code>ï¼Œåˆ†åˆ«å¯¹åº”è¦ç”Ÿæˆå®ä¾‹çš„å±æ€§çš„åå­—ä¸ç±»å‹ã€‚åœ¨ Spring çš„ XML ä¸­çš„ <code>property</code> ä¸­ï¼Œé”®æ˜¯ <code>key</code> ï¼Œå€¼æ˜¯ <code>value</code> æˆ–è€… <code>ref</code>ã€‚å¯¹äº <code>value</code> åªè¦ç›´æ¥æ³¨å…¥å±æ€§å°±è¡Œäº†ï¼Œä½†æ˜¯ <code>ref</code> è¦å…ˆè¿›è¡Œè§£æã€‚<code>Object</code> å¦‚æœæ˜¯ <code>BeanReference</code> ç±»å‹ï¼Œåˆ™è¯´æ˜å…¶æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå…¶ä¸­ä¿å­˜äº†å¼•ç”¨çš„åå­—ï¼Œéœ€è¦ç”¨å…ˆè¿›è¡Œè§£æï¼Œè½¬åŒ–ä¸ºå¯¹åº”çš„å®é™… <code>Object</code>ã€‚</td></tr><tr><td align="left"><code>BeanDefinitionReader</code></td><td align="left">è§£æ <code>BeanDefinition</code> çš„æ¥å£ã€‚é€šè¿‡ <code>loadBeanDefinitions(String)</code> æ¥ä»ä¸€ä¸ªåœ°å€åŠ è½½ç±»å®šä¹‰ã€‚</td></tr><tr><td align="left"><code>AbstractBeanDefinitionReader</code></td><td align="left">å®ç° <code>BeanDefinitionReader</code> æ¥å£çš„æŠ½è±¡ç±»ï¼ˆæœªå…·ä½“å®ç° <code>loadBeanDefinitions</code>ï¼Œè€Œæ˜¯è§„èŒƒäº† <code>BeanDefinitionReader</code> çš„åŸºæœ¬ç»“æ„ï¼‰ã€‚å†…ç½®ä¸€ä¸ª <code>HashMap rigistry</code>ï¼Œç”¨äºä¿å­˜ <code>String</code> - <code>beanDefinition</code> çš„é”®å€¼å¯¹ã€‚å†…ç½®ä¸€ä¸ª <code>ResourceLoader resourceLoader</code>ï¼Œç”¨äºä¿å­˜ç±»åŠ è½½å™¨ã€‚ç”¨æ„åœ¨äºï¼Œä½¿ç”¨æ—¶ï¼Œåªéœ€è¦å‘å…¶ <code>loadBeanDefinitions()</code> ä¼ å…¥ä¸€ä¸ªèµ„æºåœ°å€ï¼Œå°±å¯ä»¥è‡ªåŠ¨è°ƒç”¨å…¶ç±»åŠ è½½å™¨ï¼Œå¹¶æŠŠè§£æåˆ°çš„ <code>BeanDefinition</code> ä¿å­˜åˆ° <code>registry</code> ä¸­å»ã€‚</td></tr><tr><td align="left"><code>XmlBeanDefinitionReader</code></td><td align="left">å…·ä½“å®ç°äº† <code>loadBeanDefinitions()</code> æ–¹æ³•ï¼Œä» XML æ–‡ä»¶ä¸­è¯»å–ç±»å®šä¹‰ã€‚</td></tr></tbody></table><h4 id="BeanFactory-question"><a href="#BeanFactory-question" class="headerlink" title="BeanFactory :question:"></a>BeanFactory <span class="github-emoji"><span>â“</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2753.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></h4><p>ä»¥ <code>BeanFactory</code> æ¥å£ä¸ºæ ¸å¿ƒå‘æ•£å‡ºçš„å‡ ä¸ªç±»ï¼Œéƒ½æ˜¯ç”¨äºè§£å†³ IoC å®¹å™¨åœ¨ <strong>å·²ç»è·å– <code>Bean</code> çš„å®šä¹‰çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è£…é…ã€è·å– <code>Bean</code> å®ä¾‹</strong> </p><p>çš„é—®é¢˜ã€‚</p><table><thead><tr><th align="left">ç±»å</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>BeanFactory</code></td><td align="left">æ¥å£ï¼Œæ ‡è¯†ä¸€ä¸ª IoC å®¹å™¨ã€‚é€šè¿‡ <code>getBean(String)</code> æ–¹æ³•æ¥ <strong>è·å–ä¸€ä¸ªå¯¹è±¡</strong></td></tr><tr><td align="left"><code>AbstractBeanFactory</code></td><td align="left"><code>BeanFactory</code> çš„ä¸€ç§æŠ½è±¡ç±»å®ç°ï¼Œè§„èŒƒäº† IoC å®¹å™¨çš„åŸºæœ¬ç»“æ„ï¼Œä½†æ˜¯æŠŠç”Ÿæˆ <code>Bean</code> çš„å…·ä½“å®ç°æ–¹å¼ç•™ç»™å­ç±»å®ç°ã€‚IoC å®¹å™¨çš„ç»“æ„ï¼š<code>AbstractBeanFactory</code> ç»´æŠ¤ä¸€ä¸ª <code>beanDefinitionMap</code> å“ˆå¸Œè¡¨ç”¨äºä¿å­˜ç±»çš„å®šä¹‰ä¿¡æ¯ï¼ˆ<code>BeanDefinition</code>ï¼‰ã€‚è·å– <code>Bean</code> æ—¶ï¼Œå¦‚æœ <code>Bean</code> å·²ç»å­˜åœ¨äºå®¹å™¨ä¸­ï¼Œåˆ™è¿”å›ä¹‹ï¼Œå¦åˆ™åˆ™è°ƒç”¨ <code>doCreateBean</code> æ–¹æ³•è£…é…ä¸€ä¸ª <code>Bean</code>ã€‚ï¼ˆæ‰€è°“å­˜åœ¨äºå®¹å™¨ä¸­ï¼Œæ˜¯æŒ‡å®¹å™¨å¯ä»¥é€šè¿‡ <code>beanDefinitionMap</code> è·å– <code>BeanDefinition</code> è¿›è€Œé€šè¿‡å…¶ <code>getBean()</code> æ–¹æ³•è·å– <code>Bean</code>ã€‚ï¼‰</td></tr><tr><td align="left"><code>AutowireCapableBeanFactory</code></td><td align="left">å¯ä»¥å®ç°è‡ªåŠ¨è£…é…çš„ <code>BeanFactory</code>ã€‚åœ¨è¿™ä¸ªå·¥å‚ä¸­ï¼Œå®ç°äº† <code>doCreateBean</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ†ä¸‰æ­¥ï¼š1ï¼Œé€šè¿‡ <code>BeanDefinition</code> ä¸­ä¿å­˜çš„ç±»ä¿¡æ¯å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼›2ï¼ŒæŠŠå¯¹è±¡ä¿å­˜åœ¨ <code>BeanDefinition</code> ä¸­ï¼Œä»¥å¤‡ä¸‹æ¬¡è·å–ï¼›3ï¼Œä¸ºå…¶è£…é…å±æ€§ã€‚è£…é…å±æ€§æ—¶ï¼Œé€šè¿‡ <code>BeanDefinition</code> ä¸­ç»´æŠ¤çš„ <code>PropertyValues</code> é›†åˆç±»ï¼ŒæŠŠ <code>String</code> - <code>Value</code> é”®å€¼å¯¹æ³¨å…¥åˆ° <code>Bean</code> çš„å±æ€§ä¸­å»ã€‚å¦‚æœ <code>Value</code> çš„ç±»å‹æ˜¯ <code>BeanReference</code> åˆ™è¯´æ˜å…¶æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆå¯¹åº”äº XML ä¸­çš„ <code>ref</code>ï¼‰ï¼Œé€šè¿‡ <code>getBean</code> å¯¹å…¶è¿›è¡Œè·å–ï¼Œç„¶åæ³¨å…¥åˆ°å±æ€§ä¸­ã€‚</td></tr></tbody></table><h4 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h4><p>ä»¥ <code>ApplicationContext</code> æ¥å£ä¸ºæ ¸å¿ƒå‘æ•£å‡ºçš„å‡ ä¸ªç±»ï¼Œä¸»è¦æ˜¯å¯¹å‰é¢ <code>Resouce</code> ã€ <code>BeanFactory</code>ã€<code>BeanDefinition</code> è¿›è¡Œäº†åŠŸèƒ½çš„å°è£…ï¼Œè§£å†³ <strong>æ ¹æ®åœ°å€è·å– IoC å®¹å™¨å¹¶ä½¿ç”¨</strong> çš„é—®é¢˜ã€‚</p><table><thead><tr><th align="left">ç±»å</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>ApplicationContext</code></td><td align="left">æ ‡è®°æ¥å£ï¼Œç»§æ‰¿äº† <code>BeanFactory</code>ã€‚é€šå¸¸ï¼Œè¦å®ç°ä¸€ä¸ª IoC å®¹å™¨æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡ <code>ResourceLoader</code> è·å–ä¸€ä¸ª <code>Resource</code>ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å®¹å™¨çš„é…ç½®ã€<code>Bean</code> çš„å®šä¹‰ä¿¡æ¯ã€‚æ¥ç€ï¼Œä½¿ç”¨ <code>BeanDefinitionReader</code> è¯»å–è¯¥ <code>Resource</code> ä¸­çš„ <code>BeanDefinition</code> ä¿¡æ¯ã€‚æœ€åï¼ŒæŠŠ <code>BeanDefinition</code> ä¿å­˜åœ¨ <code>BeanFactory</code> ä¸­ï¼Œå®¹å™¨é…ç½®å®Œæ¯•å¯ä»¥ä½¿ç”¨ã€‚æ³¨æ„åˆ° <code>BeanFactory</code> åªå®ç°äº† <code>Bean</code> çš„ <strong>è£…é…ã€è·å–</strong>ï¼Œå¹¶æœªè¯´æ˜ <code>Bean</code> çš„ <strong>æ¥æº</strong> ä¹Ÿå°±æ˜¯ <code>BeanDefinition</code> æ˜¯å¦‚ä½• <strong>åŠ è½½</strong> çš„ã€‚è¯¥æ¥å£æŠŠ <code>BeanFactory</code> å’Œ <code>BeanDefinitionReader</code> ç»“åˆåœ¨äº†ä¸€èµ·ã€‚</td></tr><tr><td align="left"><code>AbstractApplicationContext</code></td><td align="left"><code>ApplicationContext</code> çš„æŠ½è±¡å®ç°ï¼Œå†…éƒ¨åŒ…å«ä¸€ä¸ª <code>BeanFactory</code> ç±»ã€‚ä¸»è¦æ–¹æ³•æœ‰ <code>getBean()</code> å’Œ <code>refresh()</code> æ–¹æ³•ã€‚<code>getBean()</code> ç›´æ¥è°ƒç”¨äº†å†…ç½® <code>BeanFactory</code> çš„ <code>getBean()</code> æ–¹æ³•ï¼Œ<code>refresh()</code> åˆ™ç”¨äºå®ç° <code>BeanFactory</code> çš„åˆ·æ–°ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰ <code>BeanFactory</code> è¯¥ä½¿ç”¨å“ªä¸ªèµ„æºï¼ˆ<code>Resource</code>ï¼‰åŠ è½½ç±»å®šä¹‰ï¼ˆ<code>BeanDefinition</code>ï¼‰ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•ç•™ç»™å­ç±»å®ç°ï¼Œç”¨ä»¥å®ç° <strong>ä»ä¸åŒæ¥æºçš„ä¸åŒç±»å‹çš„èµ„æºåŠ è½½ç±»å®šä¹‰</strong> çš„æ•ˆæœã€‚</td></tr><tr><td align="left">ClassPathXmlApplicationContext</td><td align="left">ä»ç±»è·¯å¾„åŠ è½½èµ„æºçš„å…·ä½“å®ç°ç±»ã€‚å†…éƒ¨é€šè¿‡ <code>XmlBeanDefinitionReader</code> è§£æ <code>UrlResourceLoader</code> è¯»å–åˆ°çš„ <code>Resource</code>ï¼Œè·å– <code>BeanDefinition</code> ä¿¡æ¯ï¼Œç„¶åå°†å…¶ä¿å­˜åˆ°å†…ç½®çš„ <code>BeanFactory</code> ä¸­ã€‚</td></tr></tbody></table><blockquote><p>å¯¹ <code>ApplicatinoContext</code> çš„åˆ†å±‚æ›´ä¸ºç»†è‡´ã€‚<code>AbstractApplicationContext</code> ä¸­ä¸ºäº†å®ç° <strong>ä¸åŒæ¥æº</strong> çš„ <strong>ä¸åŒç±»å‹</strong> çš„èµ„æºåŠ è½½ç±»å®šä¹‰ï¼ŒæŠŠè¿™ä¸¤æ­¥åˆ†å±‚å®ç°ã€‚ä»¥â€œä»ç±»è·¯å¾„è¯»å– XML å®šä¹‰â€ä¸ºä¾‹ï¼Œé¦–å…ˆä½¿ç”¨ <code>AbstractXmlApplicationContext</code> æ¥å®ç° <strong>ä¸åŒç±»å‹</strong> çš„èµ„æºè§£æï¼Œæ¥ç€ï¼Œé€šè¿‡ <code>ClassPathXmlApplicationContext</code> æ¥å®ç° <strong>ä¸åŒæ¥æº</strong> çš„èµ„æºè§£æã€‚</p></blockquote><h1 id="æˆ˜ç•¥è§‚æœ›"><a href="#æˆ˜ç•¥è§‚æœ›" class="headerlink" title="æˆ˜ç•¥è§‚æœ›"></a>æˆ˜ç•¥è§‚æœ›</h1><img src="https://cdn.jsdelivr.net/gh/Winniekun/cloudImg@master/uPic/image-20210520110056368.png" alt="å®˜ç½‘ç¤ºä¾‹" style="zoom:50%;"><p><img src="https://cdn.jsdelivr.net/gh/Winniekun/cloudImg@master/uPic/image-20210520105808650.png" alt="Springå®¹å™¨åŠŸèƒ½å®ç°çš„å„ä¸ªé˜¶æ®µ"></p><h2 id="å®¹å™¨å¯åŠ¨é˜¶æ®µ"><a href="#å®¹å™¨å¯åŠ¨é˜¶æ®µ" class="headerlink" title="å®¹å™¨å¯åŠ¨é˜¶æ®µ"></a>å®¹å™¨å¯åŠ¨é˜¶æ®µ</h2><p>ä½¿ç”¨Resourceç›¸å…³æ¥å£æ ‡è¯†æˆ‘ä»¬é…ç½®æ–‡ä»¶ä»å“ªé‡Œè·å–ï¼Œç„¶åä½¿ç”¨BeanDefinitionReaderå¯¹æ ‡è¯†çš„æ–‡ä»¶è¿›è¡Œè§£æï¼Œå°†åˆ†æåçš„ä¿¡æ¯ç¼–ç»„ä¸ºç›¸åº”çš„BeanDefinitionã€‚æœ€åå°†ä¿å­˜äº†æ¯ä¸ªBeanå®šä¹‰ä¿¡æ¯çš„BeanDefinitionï¼Œæ³¨å†Œåˆ°ç›¸åº”çš„BeanDefinitionRegistryï¼Œè¿™æ ·å®¹å™¨çš„å¯åŠ¨å°±å®Œæˆäº†ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://cdn.jsdelivr.net/gh/Winniekun/cloudImg@master/uPic/image-20210520110900263.png" alt="å¯åŠ¨é˜¶æ®µä»»åŠ¡" title="">                </div>                <div class="image-caption">å¯åŠ¨é˜¶æ®µä»»åŠ¡</div>            </figure><h2 id="Beanå®ä¾‹åŒ–é˜¶æ®µ"><a href="#Beanå®ä¾‹åŒ–é˜¶æ®µ" class="headerlink" title="Beanå®ä¾‹åŒ–é˜¶æ®µ"></a>Beanå®ä¾‹åŒ–é˜¶æ®µ</h2><p>é€šè¿‡å®¹å™¨çš„å¯åŠ¨é˜¶æ®µï¼Œç°åœ¨æ‰€æœ‰çš„Beanå®šä¹‰çš„ä¿¡æ¯ï¼Œéƒ½é€šè¿‡BeanDefinitonçš„æ–¹å¼æ³¨å†Œåˆ°äº†BeanDefinitionRegistryä¸­ï¼Œå½“æŸä¸ªè¯·æ±‚æ–¹é€šè¿‡å®¹å™¨çš„getBeanæ–¹æ³•æ˜ç¡®çš„è°ƒç”¨æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ–è€…å› ä¸ºä¾èµ–å…³ç³»å®¹å™¨éœ€è¦éšå¼çš„è°ƒç”¨getBeanæ–¹æ³•ï¼Œå°±ä¼šå‡ºå‘ç¬¬äºŒé˜¶æ®µçš„æ´»åŠ¨ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://cdn.jsdelivr.net/gh/Winniekun/cloudImg@master/uPic/image-20210520150106541.png" alt="beançš„å®ä¾‹åŒ–è¿‡ç¨‹" title="">                </div>                <div class="image-caption">beançš„å®ä¾‹åŒ–è¿‡ç¨‹</div>            </figure><p>Springå®¹å™¨å°†å¯¹å…¶æ‰€ç®¡ç†çš„å¯¹è±¡å…¨éƒ¨ç»™äºˆç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œè¿™äº›è¢«ç®¡ç†çš„å¯¹è±¡å®Œå…¨æ‘†è„±äº†åŸ æ¥é‚£ç§â€œnewå®Œåè¢«ä½¿ç”¨ï¼Œè„±ç¦»ä½œç”¨åŸŸåå³è¢«å›æ”¶â€çš„å‘½è¿</p><h1 id="è¯¦ç»†é˜è¿°"><a href="#è¯¦ç»†é˜è¿°" class="headerlink" title="è¯¦ç»†é˜è¿°"></a>è¯¦ç»†é˜è¿°</h1><h2 id="æœ€ç®€å•çš„IoCå®¹å™¨"><a href="#æœ€ç®€å•çš„IoCå®¹å™¨" class="headerlink" title="æœ€ç®€å•çš„IoCå®¹å™¨"></a>æœ€ç®€å•çš„IoCå®¹å™¨</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>{</span><br><span class="line">  <span class="comment">// è¯´ç™½äº†å°±æ˜¯ä¸€ä¸ªmap</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, Object&gt; beanMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBean</span><span class="params">(String name, Object bean)</span> </span>{</span><br><span class="line">beanMap.put(name, bean);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getBean</span><span class="params">(String name)</span> </span>{</span><br><span class="line"><span class="keyword">return</span> beanMap.get(name);</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleBeanContainerTest</span> </span>{</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">    <span class="comment">// éœ€è¦æˆ‘ä»¬å»æ‰‹åŠ¨newä¾èµ–å¯¹è±¡ï¼Œç„¶åæ”¾å…¥</span></span><br><span class="line">BeanFactory beanFactory = <span class="keyword">new</span> BeanFactory();</span><br><span class="line">beanFactory.registerBean(<span class="string">"helloService"</span>, <span class="keyword">new</span> HelloService());</span><br><span class="line">HelloService helloService = (HelloService) beanFactory.getBean(<span class="string">"helloService"</span>);</span><br><span class="line">assertThat(helloService).isNotNull();</span><br><span class="line">assertThat(helloService.sayHello()).isEqualTo(<span class="string">"hello"</span>);</span><br><span class="line">}</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>{</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>{</span><br><span class="line">System.out.println(<span class="string">"hello"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"hello"</span>;</span><br><span class="line">}</span><br><span class="line">}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="BeanFactoryPostProcesså’ŒBeanPostProcessor"><a href="#BeanFactoryPostProcesså’ŒBeanPostProcessor" class="headerlink" title="BeanFactoryPostProcesså’ŒBeanPostProcessor"></a>BeanFactoryPostProcesså’ŒBeanPostProcessor</h2><p>BeanFactoryPostProcesså’ŒBeanPostProcessoræ˜¯springæ¡†æ¶ä¸­å…·æœ‰é‡é‡çº§åœ°ä½çš„ä¸¤ä¸ªæ¥å£ï¼Œç†è§£äº†è¿™ä¸¤ä¸ªæ¥å£çš„ä½œç”¨ï¼ŒåŸºæœ¬å°±ç†è§£springçš„æ ¸å¿ƒåŸç†äº†</p><ol><li>BeanFactoryPostProcessoræ˜¯springæä¾›çš„å®¹å™¨æ‹“å±•æœºåˆ¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨<strong>beanå®ä¾‹åŒ–ä¹‹å‰ä¿®æ”¹beançš„å®šä¹‰ä¿¡æ¯ï¼ˆBeanDedinitionï¼‰</strong>ï¼Œå…¶é‡è¦çš„å®ç°ç±»PropertyPlaceholderConfigurerå’ŒCustomEditorConfigurer<ul><li>PropertyPlaceholderConfigurerçš„ä½œç”¨æ˜¯ç”¨propertiesæ–‡ä»¶çš„é…ç½®å€¼æ›¿æ¢xmlæ–‡ä»¶ä¸­çš„å ä½ç¬¦</li><li>CustomEditorConfigurerçš„ä½œç”¨æ˜¯å®ç°ç±»å‹è½¬æ¢ã€‚</li></ul></li><li>BeanPostProcessorä¹Ÿæ˜¯springæä¾›çš„å®¹å™¨æ‹“å±•æœºåˆ¶ï¼Œä¸åŒäºBeanFactoryPostProcessorï¼ŒBeanPostProcesssoråœ¨<strong>Beanå®ä¾‹åŒ–ä¹‹åä¿®æ”¹Beanæˆ–æ›¿æ¢Bean</strong>ã€‚ä¹Ÿæ˜¯å®ç°AOPçš„å…³é”®ã€‚</li></ol><p>ç­‰ç­‰ç­‰ã€‚ã€‚ã€‚</p><h2 id="æ•´ä½“æµç¨‹å›¾"><a href="#æ•´ä½“æµç¨‹å›¾" class="headerlink" title="æ•´ä½“æµç¨‹å›¾"></a>æ•´ä½“æµç¨‹å›¾</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://cdn.jsdelivr.net/gh/Winniekun/cloudImg@master/uPic/iShot2021-05-21%2000.08.58.png" alt="æ•´ä½“æµç¨‹å›¾" title="">                </div>                <div class="image-caption">æ•´ä½“æµç¨‹å›¾</div>            </figure><ol><li>BeanDefinitionReaderè¯»å–Beançš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼Œå¹¶å°†è¯»å–åˆ°çš„ä¿¡æ¯ä½¿ç”¨BeanDefinitionè¡¨ç¤ºï¼ŒåŒæ—¶æ³¨å†Œåˆ°BeanDefinitionRegistryä¸­ã€‚</li><li>é€šè¿‡å®ç°äº†BeanFactoryPostProcessorçš„ç±»ï¼Œè‡ªå®šä¹‰ä¿®æ”¹BeanDefinitionä¸­çš„ä¿¡æ¯</li><li>Beançš„å®ä¾‹åŒ–<ol><li>é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œç­–ç•¥åŒ–Beançš„å®ä¾‹ï¼Œå…±åŒ…å«ä¸¤ç§æ–¹å¼ï¼šcglibã€åå°„</li><li>è·å–Beançš„å®ä¾‹ä¹‹åï¼Œæ ¹æ®BeanDefinitionä¸­çš„ä¿¡æ¯ï¼Œå¡«å……Beançš„å±æ€§ã€ä¾èµ–</li></ol></li><li>æ£€æµ‹å„ç§æ£€æµ‹å„ç§Awareæ¥å£ï¼Œå¹¶æ”¾å…¥Beanä¸­</li><li>è°ƒç”¨BeanPostProcessoræ¥å£çš„å‰ç½®å¤„ç†æ–¹æ³•ï¼Œå¤„ç†ç¬¦åˆè¦æ±‚çš„Beanå®ä¾‹</li><li>å¦‚æœå®ç°äº†InitializingBeanæ¥å£ï¼Œåˆ™å¤„ç†å¯¹åº”çš„afterPropertiesSet()æ–¹æ³•</li><li>å¦‚æœå®šä¹‰init-methodæ–¹æ³•ï¼Œå¤„ç†å¯¹åº”çš„åˆå§‹åŒ–æ–¹æ³•</li><li>è°ƒç”¨BeanPostProcessoræ¥å£çš„åç½®å¤„ç†æ–¹æ³•ï¼Œå¤„ç†ç¬¦åˆè¦æ±‚çš„Beanå®ä¾‹</li><li>ä½¿ç”¨</li><li>åˆ¤æ–­Beançš„Scopeï¼Œå¦‚æœæ˜¯prototypeï¼Œä¸å†ç®¡ç†</li><li>å¦‚æœæ˜¯å•ä¾‹ï¼Œå¦‚æœå®ç°äº†DisposableBeanæ¥å£ï¼Œåˆ™æ‰§è¡Œå¯¹åº”çš„destroyæ–¹æ³•</li><li>å¦‚æœå®šä¹‰äº†destory-methodï¼Œåˆ™æ‰§è¡Œè‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•</li></ol><h1 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h1><p>æ•´ç†çš„è¿˜æ˜¯å¾ˆä¹±ï¼Œè™½ç„¶çœ‹çš„æ—¶å€™æ˜¯éƒ½çœ‹äº†ã€‚ã€‚ã€‚</p><p>åé¢æ…¢æ…¢ä¼˜åŒ–å§ï¼ˆæ¶‰åŠåˆ°ä»¥å==æ°¸è¿œä¸ä¼šï¼‰<span class="github-emoji"><span>ğŸ˜‘</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f611.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p><h1 id="references"><a href="#references" class="headerlink" title="references"></a>references</h1><ul><li>springæ­ç§˜</li><li><a href="https://github.com/code4craft/tiny-spring" target="_blank" rel="noopener">tiny-spring</a></li><li><a href="https://github.com/DerekYRC/mini-spring/blob/main/changelog.md#Bean%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%AD%96%E7%95%A5InstantiationStrategy" target="_blank" rel="noopener">mini-spring</a></li><li><a href="https://www.zybuluo.com/dugu9sword/note/382745#beanfactory" target="_blank" rel="noopener">tiny-springåˆ†æ</a></li><li><a href="https://javadoop.com/post/spring-ioc" target="_blank" rel="noopener">Spring IoCå®¹å™¨åˆ†æ</a></li><li><a href="http://www.tianxiaobo.com/2018/05/30/Spring-IOC-%E5%AE%B9%E5%99%A8%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0%E5%AF%BC%E8%AF%BB/#451-%E5%AE%9E%E7%8E%B0-applicationcontextaware-%E6%8E%A5%E5%8F%A3" target="_blank" rel="noopener">Spring IOC å®¹å™¨æºç åˆ†æç³»åˆ—</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åº&quot;&gt;&lt;a href=&quot;#åº&quot; class=&quot;headerlink&quot; title=&quot;åº&quot;&gt;&lt;/a&gt;åº&lt;/h1&gt;&lt;h2 id=&quot;IoC&quot;&gt;&lt;a href=&quot;#IoC&quot; class=&quot;headerlink&quot; title=&quot;IoC&quot;&gt;&lt;/a&gt;IoC&lt;/h2&gt;&lt;p&gt;IoC</summary>
      
    
    
    
    <category term="spring" scheme="https://winniekun.github.io/categories/spring/"/>
    
    
    <category term="ioc" scheme="https://winniekun.github.io/tags/ioc/"/>
    
  </entry>
  
  <entry>
    <title>å½’å¹¶æ’åº</title>
    <link href="https://winniekun.github.io/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"/>
    <id>https://winniekun.github.io/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/</id>
    <published>2021-04-30T13:35:01.000Z</published>
    <updated>2021-05-16T16:43:06.331Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>å…ˆé€‰æ‹©åˆ†ç•Œç‚¹</li><li>å…ˆé€’å½’æ’åº</li><li>å½’å¹¶ åˆäºŒä¸ºä¸€</li></ol><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/Users/weikunkun/Library/Application" alt="image-20210419120203122" title="Support/typora-user-images/image-20210419120203122.png">                </div>                <div class="image-caption">Support/typora-user-images/image-20210419120203122.png</div>            </figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>[] array, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (l &gt;= r) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        mergeSort(array, l, mid);</span><br><span class="line">        mergeSort(array, mid+<span class="number">1</span>, r);</span><br><span class="line">        <span class="comment">// æ•´åˆ</span></span><br><span class="line">        <span class="keyword">int</span>[] tmp = <span class="keyword">new</span> <span class="keyword">int</span>[r - l + <span class="number">1</span>]; <span class="comment">// ä¸´æ—¶æ•°ç»„, ç”¨äºä¸´æ—¶å­˜å‚¨ [l,r]åŒºé—´å†…æ’å¥½åºçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">int</span> i = l, j = mid + <span class="number">1</span>, k = <span class="number">0</span>;  <span class="comment">// ä¸¤ä¸ªæŒ‡é’ˆ</span></span><br><span class="line">        <span class="comment">// è¿›è¡Œå½’å¹¶</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r) {</span><br><span class="line">            <span class="keyword">if</span> (array[i] &lt;= array[j]) </span><br><span class="line">                tmp[k++] = array[i++];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                tmp[k++] = array[j++];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid) tmp[k++] = array[i++];</span><br><span class="line">        <span class="keyword">while</span> (j &lt;= r) tmp[k++] = array[j++];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿›è¡Œèµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (i = l, j = <span class="number">0</span>; i &lt;= r; i++, j++)</span><br><span class="line">            array[i] = tmp[j];</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å½’å¹¶æ’åº&quot;&gt;&lt;a href=&quot;#å½’å¹¶æ’åº&quot; class=&quot;headerlink&quot; title=&quot;å½’å¹¶æ’åº&quot;&gt;&lt;/a&gt;å½’å¹¶æ’åº&lt;/h2&gt;&lt;h3 id=&quot;æ­¥éª¤&quot;&gt;&lt;a href=&quot;#æ­¥éª¤&quot; class=&quot;headerlink&quot; title=&quot;æ­¥éª¤&quot;&gt;&lt;/a&gt;æ­¥éª¤&lt;/h</summary>
      
    
    
    
    <category term="æ’åº" scheme="https://winniekun.github.io/categories/%E6%8E%92%E5%BA%8F/"/>
    
    
    <category term="å½’å¹¶æ’åº" scheme="https://winniekun.github.io/tags/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ­»ç£•æ•°å­¦åŸºç¡€</title>
    <link href="https://winniekun.github.io/stick-to-math/"/>
    <id>https://winniekun.github.io/stick-to-math/</id>
    <published>2021-04-20T11:56:11.000Z</published>
    <updated>2021-05-16T16:42:07.999Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>LeetCodeæ­»ç£•ç³»åˆ—åäºŒï¼š æ•°å­¦åŸºç¡€</p><p>è¯´å®è¯ï¼Œå…¶å®éƒ½æ˜¯åˆ·é¢˜éƒ½æ˜¯æ•°å­¦çš„å®ç°ï¼Œä¸è¿‡æ„Ÿè§‰æœ‰äº›é¢˜ç›®æ›´åŠ åå‘æ•°å­¦åº”ç”¨ï¼Œè­¬å¦‚è“„æ°´æ± ï¼Œç­‰æ¦‚ç‡æŠ½æ ·â€¦ã€‚</p><a id="more"></a><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><h3 id="470-ç”¨rand7-å®ç°Rand10"><a href="#470-ç”¨rand7-å®ç°Rand10" class="headerlink" title="470 ç”¨rand7()å®ç°Rand10()"></a>470 ç”¨rand7()å®ç°Rand10()</h3><p><a href="https://leetcode-cn.com/problems/implement-rand10-using-rand7/solution/cong-zui-ji-chu-de-jiang-qi-ru-he-zuo-dao-jun-yun-/" target="_blank" rel="noopener">ä»æœ€åŸºç¡€çš„è®²èµ·å¦‚ä½•åšåˆ°å‡åŒ€çš„ç”Ÿæˆéšæœºæ•°</a></p><p>ä»ä¸Šè¿°çš„æ–‡ç« å¯ä»¥å¾—å‡ºï¼š</p><blockquote><p><strong>å·²çŸ¥:</strong>  <em>$randN()$å¯ä»¥==ç­‰æ¦‚ç‡==ç”Ÿæˆ$[1, N]$èŒƒå›´çš„æ•°å­—</em><br><strong>é‚£ä¹ˆ:</strong>  $(randN()-1) \times Y  + randY()$å¯ä»¥==ç­‰æ¦‚ç‡==ç”Ÿæˆ$[1, Y \times N]$ èŒƒå›´çš„æ•°å­—</p><p><strong>å³ï¼š</strong>å®ç°äº†$randNY()$</p></blockquote><p>ä»¥$[(rand9() - 1) \times 7 + rand7()]$ä¸ºä¾‹å­</p><table><thead><tr><th>rand9()-1\rand7</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th></tr></thead><tbody><tr><td><strong>0</strong></td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><td><strong>1</strong></td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td></tr><tr><td><strong>2</strong></td><td>15</td><td>16</td><td>17</td><td>18</td><td>19</td><td>20</td><td>21</td></tr><tr><td><strong>3</strong></td><td>22</td><td>23</td><td>24</td><td>25</td><td>26</td><td>27</td><td>28</td></tr><tr><td><strong>4</strong></td><td>29</td><td>30</td><td>31</td><td>32</td><td>33</td><td>34</td><td>35</td></tr><tr><td><strong>5</strong></td><td>36</td><td>37</td><td>38</td><td>39</td><td>40</td><td>41</td><td>42</td></tr><tr><td><strong>6</strong></td><td>43</td><td>44</td><td>45</td><td>46</td><td>47</td><td>48</td><td>49</td></tr><tr><td><strong>7</strong></td><td>50</td><td>51</td><td>52</td><td>53</td><td>54</td><td>55</td><td>56</td></tr><tr><td><strong>8</strong></td><td>57</td><td>58</td><td>59</td><td>60</td><td>61</td><td>62</td><td>63</td></tr></tbody></table><p><strong>æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œæ•°å­¦è¯æ˜ä¸ä¼š</strong></p><p>é‚£ä¹ˆæƒ³åˆ°é€šè¿‡rand4()æ¥å®ç°rand2()å‘¢ï¼Ÿè¿™ä¸ªå°±å¾ˆç®€å•äº†ï¼Œå·²çŸ¥rand4()ä¼šå‡åŒ€äº§ç”Ÿ[1,4]çš„éšæœºæ•°ï¼Œé€šè¿‡å–ä½™ï¼Œå†åŠ 1å°±å¯ä»¥äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œç»“æœä¹Ÿæ˜¯ç­‰æ¦‚ç‡çš„ã€‚</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rand4() % 2 + 1 = ?</span><br><span class="line">   1 % 2    + 1 = 2</span><br><span class="line">   2 % 2    + 1 = 1</span><br><span class="line">   3 % 2    + 1 = 2</span><br><span class="line">   4 % 2    + 1 = 1</span><br></pre></td></tr></tbody></table></figure><p>äº‹å®ä¸Šï¼Œåªè¦rand_N()ä¸­Næ˜¯2çš„å€æ•°ï¼Œå°±éƒ½å¯ä»¥ç”¨æ¥å®ç°rand2()ï¼Œåä¹‹ï¼Œè‹¥Nä¸æ˜¯2çš„å€æ•°ï¼Œåˆ™äº§ç”Ÿçš„ç»“æœä¸æ˜¯ç­‰æ¦‚ç‡çš„ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rand6() % 2 + 1 = ?</span><br><span class="line">   1 % 2    + 1 = 2</span><br><span class="line">   2 % 2    + 1 = 1</span><br><span class="line">   3 % 2    + 1 = 2</span><br><span class="line">   4 % 2    + 1 = 1</span><br><span class="line">   5 % 2    + 1 = 2</span><br><span class="line">   6 % 2    + 1 = 1</span><br><span class="line"></span><br><span class="line">rand5() % 2 + 1 = ?</span><br><span class="line">   1 % 2    + 1 = 2</span><br><span class="line">   2 % 2    + 1 = 1</span><br><span class="line">   3 % 2    + 1 = 2</span><br><span class="line">   4 % 2    + 1 = 1</span><br><span class="line">   5 % 2    + 1 = 2</span><br></pre></td></tr></tbody></table></figure><p><strong>é€šç”¨ä¸€äº›çš„</strong></p><blockquote><p>å¦‚æœéœ€è¦å®ç°$randX()$</p><ol><li>å…ˆå®ç°$randN()$<ol><li>$N$ä¸º$X$çš„å€æ•°ï¼ˆ$N&gt;X$ï¼‰</li></ol></li><li>å†é€šè¿‡ $randN() % X + 1$å³å¯</li></ol></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rand10</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// rand 49</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">int</span> num = (rand7() - <span class="number">1</span>) * <span class="number">7</span> + rand7();  <span class="comment">// rand49</span></span><br><span class="line">            <span class="keyword">if</span> (num &lt;= <span class="number">40</span>) { <span class="comment">// ä½¿ç”¨æ‹’ç»é‡‡æ ·ï¼Œå¾—åˆ°rand40</span></span><br><span class="line">                <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>;  <span class="comment">// rand10</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p><strong>ä¼˜åŒ–</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> <span class="keyword">extends</span> <span class="title">SolBase</span> </span>{</span><br><span class="line">  <span class="comment">// ä¸Šè¿°æ‹’ç»äº†9ä¸ªæ•°å­—ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä¼˜åŒ–ä¹‹åï¼Œå‡å°‘ä¸¢å¼ƒå€¼ï¼Œæé«˜å‘½ä¸­ç‡</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rand10</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">true</span>) {</span><br><span class="line">            <span class="keyword">int</span> a = rand7();</span><br><span class="line">            <span class="keyword">int</span> b = rand7();</span><br><span class="line">            <span class="keyword">int</span> num = (a-<span class="number">1</span>)*<span class="number">7</span> + b; <span class="comment">// rand 49</span></span><br><span class="line">            <span class="keyword">if</span>(num &lt;= <span class="number">40</span>) <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>; <span class="comment">// æ‹’ç»é‡‡æ ·</span></span><br><span class="line">            </span><br><span class="line">            a = num - <span class="number">40</span>; <span class="comment">// rand 9</span></span><br><span class="line">            b = rand7();</span><br><span class="line">            num = (a-<span class="number">1</span>)*<span class="number">7</span> + b; <span class="comment">// rand 63</span></span><br><span class="line">            <span class="keyword">if</span>(num &lt;= <span class="number">60</span>) <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line">            </span><br><span class="line">            a = num - <span class="number">60</span>; <span class="comment">// rand 3</span></span><br><span class="line">            b = rand7();</span><br><span class="line">            num = (a-<span class="number">1</span>)*<span class="number">7</span> + b; <span class="comment">// rand 21</span></span><br><span class="line">            <span class="keyword">if</span>(num &lt;= <span class="number">20</span>) <span class="keyword">return</span> num % <span class="number">10</span> + <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;LeetCodeæ­»ç£•ç³»åˆ—åäºŒï¼š æ•°å­¦åŸºç¡€&lt;/p&gt;
&lt;p&gt;è¯´å®è¯ï¼Œå…¶å®éƒ½æ˜¯åˆ·é¢˜éƒ½æ˜¯æ•°å­¦çš„å®ç°ï¼Œä¸è¿‡æ„Ÿè§‰æœ‰äº›é¢˜ç›®æ›´åŠ åå‘æ•°å­¦åº”ç”¨ï¼Œè­¬å¦‚è“„æ°´æ± ï¼Œç­‰æ¦‚ç‡æŠ½æ ·â€¦ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://winniekun.github.io/categories/LeetCode/"/>
    
    
    <category term="æ­»ç£•ç³»åˆ—" scheme="https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"/>
    
    <category term="æ•°å­¦åŸºç¡€" scheme="https://winniekun.github.io/tags/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>æ­»ç£•SQL</title>
    <link href="https://winniekun.github.io/stick-to-sql/"/>
    <id>https://winniekun.github.io/stick-to-sql/</id>
    <published>2021-04-20T11:56:11.000Z</published>
    <updated>2021-05-16T16:39:43.618Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>LeetCodeæ­»ç£•ç³»åˆ—åï¼š SQL</p><a id="more"></a><p>ä½œä¸ºä¸€ä¸ªåç«¯å¼€å‘ç¨‹åºå‘˜ï¼ŒSQLåŠŸåº•è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼ï¼ï¼</p><p>æ‰€ä»¥è¿˜æ˜¯è¦ç»ƒä¹ ã€‚</p><blockquote><p>è¿˜è®°å¾—å»å¹´è¢«å­—èŠ‚é¢è¯•çš„æ—¶å€™ï¼Œè¿SQLéƒ½å†™ä¸å‡ºæ¥ã€‚ã€‚ã€‚</p></blockquote><h2 id="LeetCode-SQLé¢˜ç›®æ•´ç†"><a href="#LeetCode-SQLé¢˜ç›®æ•´ç†" class="headerlink" title="LeetCode SQLé¢˜ç›®æ•´ç†"></a>LeetCode SQLé¢˜ç›®æ•´ç†</h2><p>åˆ·äº†LCä¸Šçš„top70ä¹‹åï¼Œæ„Ÿè§‰è€ƒå¯Ÿæœ€å¤šçš„è¿˜æ˜¯å¤šè¡¨çš„è”åˆæŸ¥æ‰¾ï¼Œæ¯•ç«Ÿå®é™…ä¸­ä¹Ÿä¸ä¼šä»…ä»…æ˜¯å•è¡¨çš„æŸ¥è¯¢ã€‚</p><p><strong>ä¸»è¦é¢˜å‹ï¼š</strong></p><ol><li>TOP N é—®é¢˜</li><li>æ’åé—®é¢˜<ol><li>æ»‘åŠ¨çª—å£</li></ol></li><li>è‡ªé“¾æ¥é—®é¢˜</li></ol><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><h3 id="TOP-Né—®é¢˜"><a href="#TOP-Né—®é¢˜" class="headerlink" title="TOP Né—®é¢˜"></a>TOP Né—®é¢˜</h3><h4 id="176-ç¬¬äºŒé«˜çš„è–ªæ°´"><a href="#176-ç¬¬äºŒé«˜çš„è–ªæ°´" class="headerlink" title="176. ç¬¬äºŒé«˜çš„è–ªæ°´"></a><a href="https://leetcode-cn.com/problems/second-highest-salary/" target="_blank" rel="noopener">176. ç¬¬äºŒé«˜çš„è–ªæ°´</a></h4><p><strong>æ€è·¯ï¼š</strong></p><ol><li><p>ä½¿ç”¨limit</p><p>æ³¨æ„åˆ¤ç©ºã€å»é‡</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"><span class="keyword">ifnull</span> ((<span class="keyword">select</span> </span><br><span class="line">    <span class="keyword">distinct</span> Salary </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    Employee</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> Salary <span class="keyword">desc</span></span><br><span class="line"><span class="keyword">limit</span> <span class="number">1</span>, <span class="number">1</span>) , <span class="literal">null</span>) <span class="keyword">as</span> SecondHighestSalary;</span><br></pre></td></tr></tbody></table></figure></li><li><p>å…ˆä½¿ç”¨maxæŸ¥è¯¢æœ€é«˜çš„è–ªæ°´ maxï¼Œä¹‹åå†é€šè¿‡è‡ªæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å°äºmaxçš„max</p></li></ol><h4 id="184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"><a href="#184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥" class="headerlink" title="184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"></a><a href="https://leetcode-cn.com/problems/department-highest-salary/" target="_blank" rel="noopener">184. éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥</a></h4><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æ€è·¯ï¼š å¯»æ‰¾æœ€å¤§è–ªèµ„çš„æ•°æ®</span></span><br><span class="line"><span class="comment">-- join</span></span><br><span class="line"><span class="comment">-- 1. ç›´æ¥join group by  é€‰å–æœ€å¤§çš„å³å¯ ä½†æ˜¯ æ— æ³•ä¿è¯æœ€å¤§çš„è–ªèµ„ä¸é‡å¤ å¤±è´¥</span></span><br><span class="line"><span class="comment">-- 2. å…ˆé€šè¿‡å‘˜å·¥ä¿¡æ¯ å¯»æ‰¾æœ€å¤§çš„è–ªèµ„+id çš„æ•°æ®Aï¼Œç„¶åå†join ä¸¤å¼ è¡¨ï¼Œå°†Aä¸­å¯¹åº”çš„æ•°æ®è¿”å›</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. </span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    d.Name <span class="keyword">as</span> Department,</span><br><span class="line">    e.Name <span class="keyword">as</span> Employee,</span><br><span class="line">    e.Salary <span class="keyword">as</span> Salary</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    Employee e <span class="keyword">inner</span> <span class="keyword">join</span> Department d <span class="keyword">on</span> e.DepartmentId = d.Id</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    (e.DepartmentId, e.Salary) <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">select</span> </span><br><span class="line">        DepartmentId,</span><br><span class="line">        <span class="keyword">max</span>(Salary)</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">        Employee</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">        DepartmentId);</span><br></pre></td></tr></tbody></table></figure><h4 id="177-ç¬¬Né«˜çš„è–ªæ°´"><a href="#177-ç¬¬Né«˜çš„è–ªæ°´" class="headerlink" title="177. ç¬¬Né«˜çš„è–ªæ°´"></a><a href="https://leetcode-cn.com/problems/nth-highest-salary/" target="_blank" rel="noopener">177. ç¬¬Né«˜çš„è–ªæ°´</a></h4><p>LIMIT PAGE, OFFSET</p><p>è·³è¿‡ PAGE * OFFSETæ¡æ•°æ®ï¼Œæ¥ä¸‹æ¥çš„offsetæ¡æ•°æ®ï¼Œ å› ä¸ºé¢˜ç›®ä¸­æœªè¯´æ˜è–ªèµ„æ˜¯å¦ä¸é‡å¤ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨distinctå»é‡</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getNthHighestSalary(N <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">set</span> N:= N<span class="number">-1</span>;</span><br><span class="line">  RETURN (  </span><br><span class="line">      <span class="comment"># Write your MySQL query statement below.</span></span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="keyword">distinct</span> Salary</span><br><span class="line">    <span class="keyword">from</span> </span><br><span class="line">        Employee</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">        Salary <span class="keyword">desc</span></span><br><span class="line">    <span class="keyword">limit</span> N,<span class="number">1</span></span><br><span class="line">  );</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></tbody></table></figure><h4 id="185-éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥"><a href="#185-éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥" class="headerlink" title="185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥"></a><a href="https://leetcode-cn.com/problems/department-top-three-salaries/" target="_blank" rel="noopener">185. éƒ¨é—¨å·¥èµ„å‰ä¸‰é«˜çš„æ‰€æœ‰å‘˜å·¥</a></h4><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.Name <span class="keyword">as</span> Department, </span><br><span class="line">e2.Name <span class="keyword">as</span> Employee, </span><br><span class="line">e2.Salary <span class="keyword">from</span> </span><br><span class="line">Department d <span class="keyword">inner</span> <span class="keyword">join</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> e.*, </span><br><span class="line">    <span class="keyword">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> DepartmentID </span><br><span class="line">    <span class="keyword">Order</span> <span class="keyword">by</span> Salary <span class="keyword">DESC</span>) <span class="keyword">as</span> <span class="string">'rank'</span></span><br><span class="line">    <span class="keyword">from</span> Employee e </span><br><span class="line">) e2 <span class="keyword">on</span> d.Id= e2.DepartmentID</span><br><span class="line"><span class="keyword">where</span> e2.rank&lt;=<span class="number">3</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> Department <span class="keyword">AND</span> Salary</span><br></pre></td></tr></tbody></table></figure><h3 id="æ’åé—®é¢˜"><a href="#æ’åé—®é¢˜" class="headerlink" title="æ’åé—®é¢˜"></a>æ’åé—®é¢˜</h3><h4 id="178-åˆ†æ•°æ’å"><a href="#178-åˆ†æ•°æ’å" class="headerlink" title="178.åˆ†æ•°æ’å"></a><a href="https://leetcode-cn.com/problems/rank-scores/" target="_blank" rel="noopener">178.åˆ†æ•°æ’å</a></h4><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">Score, <span class="keyword">dense_rank</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> Score <span class="keyword">desc</span>) <span class="keyword">as</span> <span class="string">`Rank`</span></span><br><span class="line"><span class="keyword">from</span> Scores;</span><br></pre></td></tr></tbody></table></figure><h3 id="è‡ªé“¾æ¥é—®é¢˜"><a href="#è‡ªé“¾æ¥é—®é¢˜" class="headerlink" title="è‡ªé“¾æ¥é—®é¢˜"></a>è‡ªé“¾æ¥é—®é¢˜</h3><h4 id="603-è¿ç»­ç©ºä½™åº§ä½"><a href="#603-è¿ç»­ç©ºä½™åº§ä½" class="headerlink" title="603. è¿ç»­ç©ºä½™åº§ä½"></a><a href="https://leetcode-cn.com/problems/consecutive-available-seats/" target="_blank" rel="noopener">603. è¿ç»­ç©ºä½™åº§ä½</a></h4><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡ ä¸ªæœ‹å‹æ¥åˆ°ç”µå½±é™¢çš„å”®ç¥¨å¤„ï¼Œå‡†å¤‡é¢„çº¦è¿ç»­ç©ºä½™åº§ä½ã€‚</span></span><br><span class="line"><span class="comment">-- ä½ èƒ½åˆ©ç”¨è¡¨&nbsp;cinema&nbsp;ï¼Œå¸®ä»–ä»¬å†™ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œè·å–æ‰€æœ‰ç©ºä½™åº§ä½ï¼Œå¹¶å°†å®ƒä»¬æŒ‰ç…§ seat_id æ’åºåè¿”å›å—ï¼Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> a.seat_id</span><br><span class="line"><span class="keyword">from</span> cinema a <span class="keyword">join</span> cinema b</span><br><span class="line">  <span class="keyword">on</span> <span class="keyword">abs</span>(a.seat_id - b.seat_id) = <span class="number">1</span></span><br><span class="line">  <span class="keyword">and</span> a.free = <span class="literal">true</span> <span class="keyword">and</span> b.free = <span class="literal">true</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> a.seat_id</span><br></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;LeetCodeæ­»ç£•ç³»åˆ—åï¼š SQL&lt;/p&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://winniekun.github.io/categories/LeetCode/"/>
    
    
    <category term="æ­»ç£•ç³»åˆ—" scheme="https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"/>
    
    <category term="SQL" scheme="https://winniekun.github.io/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>æ­»ç£•å¤šçº¿ç¨‹</title>
    <link href="https://winniekun.github.io/stick-to-multi-thread/"/>
    <id>https://winniekun.github.io/stick-to-multi-thread/</id>
    <published>2021-04-14T11:56:11.000Z</published>
    <updated>2021-05-16T16:38:48.283Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>LeetCodeæ­»ç£•ç³»åˆ—åä¸€ï¼š å¤šçº¿ç¨‹</p><a id="more"></a><p>çœ‹é‚£ä¹ˆå¤šçš„é¢ç»ï¼Œå‘ç°å·²ç»å¼€å§‹è¯¢é—®å¤šçº¿ç¨‹çš„ç¼–ç¨‹äº†ã€‚ä¸ªäººæ„Ÿè§‰å¤šçº¿ç¨‹ç¼–ç¨‹ä¸»è¦æ˜¯ç†è§£ï¼Œæ€æƒ³ã€‚æ˜¯æœ‰å›ºå®šçš„å¥—è·¯çš„ï¼Œè­¬å¦‚ï¼šäº¤æ›¿è¾“å‡ºï¼Œæœ‰åºçš„è¾“å‡ºå“‡ã€‚æ·±æŒ–ä¸‹å»å°±æ˜¯è€ƒå¯Ÿå¯¹çº¿ç¨‹é€šè®¯çš„ä½¿ç”¨ï¼Œä»¥åŠä¸€äº›é«˜é˜¶ç”¨æ³•ã€‚å’Œå“²å­¦å®¶å°±é¤é—®é¢˜ã€ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ã€è¯»å†™è€…é—®é¢˜å·®ä¸å¤šã€‚</p><h2 id="LeetCode-å¤šçº¿ç¨‹é¢˜ç›®æ•´ç†"><a href="#LeetCode-å¤šçº¿ç¨‹é¢˜ç›®æ•´ç†" class="headerlink" title="LeetCode å¤šçº¿ç¨‹é¢˜ç›®æ•´ç†"></a>LeetCode å¤šçº¿ç¨‹é¢˜ç›®æ•´ç†</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;LeetCodeæ­»ç£•ç³»åˆ—åä¸€ï¼š å¤šçº¿ç¨‹&lt;/p&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://winniekun.github.io/categories/LeetCode/"/>
    
    
    <category term="æ­»ç£•ç³»åˆ—" scheme="https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://winniekun.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€è¡Œä¸€è¡Œæºç åˆ†ææ¸…æ¥šAbstractQueuedSynchronizer</title>
    <link href="https://winniekun.github.io/%E4%B8%80%E8%A1%8C%E4%B8%80%E8%A1%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E6%B8%85%E6%A5%9AAbstractQueuedSynchronizer/"/>
    <id>https://winniekun.github.io/%E4%B8%80%E8%A1%8C%E4%B8%80%E8%A1%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E6%B8%85%E6%A5%9AAbstractQueuedSynchronizer/</id>
    <published>2021-03-30T12:14:20.000Z</published>
    <updated>2021-04-05T12:19:21.814Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨åˆ†æ Java å¹¶å‘åŒ… java.util.concurrent æºç çš„æ—¶å€™ï¼Œå°‘ä¸äº†éœ€è¦äº†è§£ AbstractQueuedSynchronizerï¼ˆä»¥ä¸‹ç®€å†™AQSï¼‰è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå› ä¸ºå®ƒæ˜¯ Java å¹¶å‘åŒ…çš„åŸºç¡€å·¥å…·ç±»ï¼Œæ˜¯å®ç° ReentrantLockã€CountDownLatchã€Semaphoreã€FutureTask ç­‰ç±»çš„åŸºç¡€ã€‚</p><p>Google ä¸€ä¸‹ AbstractQueuedSynchronizerï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¾ˆå¤šå…³äº AQS çš„ä»‹ç»ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ²¡æœ‰ä»‹ç»æ¸…æ¥šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ–‡ç« æ²¡æœ‰æŠŠå…¶ä¸­çš„ä¸€äº›å…³é”®çš„ç»†èŠ‚è¯´æ¸…æ¥šã€‚</p><p>æœ¬æ–‡å°†ä» ReentrantLock çš„å…¬å¹³é”æºç å‡ºå‘ï¼Œåˆ†æä¸‹ AbstractQueuedSynchronizer è¿™ä¸ªç±»æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶æä¾›ä¸€äº›ç®€å•çš„å¸®åŠ©ã€‚</p><a id="more"></a><p>ç”³æ˜ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>æœ¬æ–‡æœ‰ç‚¹é•¿ï¼Œä½†è¿˜æ˜¯æŒºç®€å•ï¼Œä¸»è¦é¢å‘è¯»è€…å¯¹è±¡ä¸ºå¹¶å‘ç¼–ç¨‹çš„åˆå­¦è€…ï¼Œæˆ–è€…æƒ³è¦é˜…è¯» Java å¹¶å‘åŒ…æºç çš„å¼€å‘è€…ã€‚å¯¹äºæ–°æ‰‹æ¥è¯´ï¼Œå¯èƒ½éœ€è¦èŠ±å¥½å‡ ä¸ªå°æ—¶æ‰èƒ½å®Œå…¨çœ‹æ‡‚ï¼Œä½†æ˜¯è¿™æ—¶é—´è‚¯å®šæ˜¯å€¼å¾—çš„ã€‚</li><li>æºç ç¯å¢ƒ JDK1.7ï¼ˆ1.8æ²¡å•¥å˜åŒ–ï¼‰ï¼Œçœ‹åˆ°ä¸æ‡‚æˆ–æœ‰ç–‘æƒ‘çš„éƒ¨åˆ†ï¼Œæœ€å¥½èƒ½è‡ªå·±æ‰“å¼€æºç çœ‹çœ‹ã€‚Doug Lea å¤§ç¥çš„ä»£ç å†™å¾—çœŸå¿ƒä¸é”™ã€‚</li><li>æœ¬æ–‡ä¸åˆ†æå…±äº«æ¨¡å¼ï¼Œè¿™æ ·å¯ä»¥ç»™è¯»è€…å‡å°‘å¾ˆå¤šè´Ÿæ‹…ï¼Œ<a href="/post/AbstractQueuedSynchronizer-3">ç¬¬ä¸‰ç¯‡æ–‡ç« </a>å¯¹å…±äº«æ¨¡å¼è¿›è¡Œäº†åˆ†æã€‚è€Œä¸”ä¹Ÿä¸åˆ†æ condition éƒ¨åˆ†ï¼Œæ‰€ä»¥åº”è¯¥è¯´å¾ˆå®¹æ˜“å°±å¯ä»¥çœ‹æ‡‚äº†ã€‚</li><li>æœ¬æ–‡å¤§é‡ä½¿ç”¨æˆ‘ä»¬å¹³æ—¶ç”¨å¾—æœ€å¤šçš„ ReentrantLock çš„æ¦‚å¿µï¼Œæœ¬è´¨ä¸Šæ¥è¯´æ˜¯ä¸æ­£ç¡®çš„ï¼Œè¯»è€…åº”è¯¥æ¸…æ¥šï¼ŒAQS ä¸ä»…ä»…ç”¨æ¥å®ç°å¯é‡å…¥é”ï¼Œåªæ˜¯å¸Œæœ›è¯»è€…å¯ä»¥ç”¨é”æ¥è”æƒ³ AQS çš„ä½¿ç”¨åœºæ™¯ï¼Œé™ä½é˜…è¯»å‹åŠ›ã€‚</li><li>ReentrantLock çš„å…¬å¹³é”å’Œéå…¬å¹³é”åªæœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œ<a href="/post/AbstractQueuedSynchronizer-2">ç¬¬äºŒç¯‡æ–‡ç« </a>åšäº†ä»‹ç»ã€‚</li><li>è¯„è®ºåŒºæœ‰è¯»è€…åé¦ˆæœ¬æ–‡ç›´æ¥ç”¨ä»£ç è¯´ä¸å‹å¥½ï¼Œåº”è¯¥å¤šé…ç‚¹æµç¨‹å›¾ï¼Œè¿™ç¯‡æ–‡ç« ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ä½œä¸ºè¿‡æ¥äººï¼Œæˆ‘æƒ³å‘Šè¯‰å¤§å®¶ï¼Œå¯¹äº AQS æ¥è¯´ï¼Œå½¢å¼çœŸçš„ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æŠŠç»†èŠ‚è¯´æ¸…æ¥šã€‚</li></ol><h2 id="AQS-ç»“æ„"><a href="#AQS-ç»“æ„" class="headerlink" title="AQS ç»“æ„"></a>AQS ç»“æ„</h2><p>å…ˆæ¥çœ‹çœ‹ AQS æœ‰å“ªäº›å±æ€§ï¼Œææ¸…æ¥šè¿™äº›åŸºæœ¬å°±çŸ¥é“ AQS æ˜¯ä»€ä¹ˆå¥—è·¯äº†ï¼Œæ¯•ç«Ÿå¯ä»¥çŒœå˜›ï¼</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤´ç»“ç‚¹ï¼Œä½ ç›´æ¥æŠŠå®ƒå½“åš å½“å‰æŒæœ‰é”çš„çº¿ç¨‹ å¯èƒ½æ˜¯æœ€å¥½ç†è§£çš„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node head;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜»å¡çš„å°¾èŠ‚ç‚¹ï¼Œæ¯ä¸ªæ–°çš„èŠ‚ç‚¹è¿›æ¥ï¼Œéƒ½æ’å…¥åˆ°æœ€åï¼Œä¹Ÿå°±å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node tail;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ªæ˜¯æœ€é‡è¦çš„ï¼Œä»£è¡¨å½“å‰é”çš„çŠ¶æ€ï¼Œ0ä»£è¡¨æ²¡æœ‰è¢«å ç”¨ï¼Œå¤§äº 0 ä»£è¡¨æœ‰çº¿ç¨‹æŒæœ‰å½“å‰é”</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªå€¼å¯ä»¥å¤§äº 1ï¼Œæ˜¯å› ä¸ºé”å¯ä»¥é‡å…¥ï¼Œæ¯æ¬¡é‡å…¥éƒ½åŠ ä¸Š 1</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»£è¡¨å½“å‰æŒæœ‰ç‹¬å é”çš„çº¿ç¨‹ï¼Œä¸¾ä¸ªæœ€é‡è¦çš„ä½¿ç”¨ä¾‹å­ï¼Œå› ä¸ºé”å¯ä»¥é‡å…¥</span></span><br><span class="line"><span class="comment">// reentrantLock.lock()å¯ä»¥åµŒå¥—è°ƒç”¨å¤šæ¬¡ï¼Œæ‰€ä»¥æ¯æ¬¡ç”¨è¿™ä¸ªæ¥åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»æ‹¥æœ‰äº†é”</span></span><br><span class="line"><span class="comment">// if (currentThread == getExclusiveOwnerThread()) {state++}</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Thread exclusiveOwnerThread; <span class="comment">//ç»§æ‰¿è‡ªAbstractOwnableSynchronizer</span></span><br></pre></td></tr></tbody></table></figure><p>æ€ä¹ˆæ ·ï¼Œçœ‹æ ·å­åº”è¯¥æ˜¯å¾ˆç®€å•çš„å§ï¼Œæ¯•ç«Ÿä¹Ÿå°±å››ä¸ªå±æ€§å•Šã€‚</p><p>AbstractQueuedSynchronizer çš„ç­‰å¾…é˜Ÿåˆ—ç¤ºæ„å¦‚ä¸‹æ‰€ç¤ºï¼Œæ³¨æ„äº†ï¼Œä¹‹ååˆ†æè¿‡ç¨‹ä¸­æ‰€è¯´çš„ queueï¼Œä¹Ÿå°±æ˜¯é˜»å¡é˜Ÿåˆ—<strong>ä¸åŒ…å« headï¼Œä¸åŒ…å« headï¼Œä¸åŒ…å« head</strong>ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.javadoop.com/blogimages/AbstractQueuedSynchronizer/aqs-0.png" alt="aqs-0" title="">                </div>                <div class="image-caption">aqs-0</div>            </figure><p>ç­‰å¾…é˜Ÿåˆ—ä¸­æ¯ä¸ªçº¿ç¨‹è¢«åŒ…è£…æˆä¸€ä¸ª Node å®ä¾‹ï¼Œæ•°æ®ç»“æ„æ˜¯é“¾è¡¨ï¼Œä¸€èµ·çœ‹çœ‹æºç å§ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>{</span><br><span class="line">    <span class="comment">// æ ‡è¯†èŠ‚ç‚¹å½“å‰åœ¨å…±äº«æ¨¡å¼ä¸‹</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Node SHARED = <span class="keyword">new</span> Node();</span><br><span class="line">    <span class="comment">// æ ‡è¯†èŠ‚ç‚¹å½“å‰åœ¨ç‹¬å æ¨¡å¼ä¸‹</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Node EXCLUSIVE = <span class="keyword">null</span>;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ======== ä¸‹é¢çš„å‡ ä¸ªintå¸¸é‡æ˜¯ç»™waitStatusç”¨çš„ ===========</span></span><br><span class="line">    <span class="comment">/** waitStatus value to indicate thread has cancelled */</span></span><br><span class="line">    <span class="comment">// ä»£ç æ­¤çº¿ç¨‹å–æ¶ˆäº†äº‰æŠ¢è¿™ä¸ªé”</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CANCELLED =  <span class="number">1</span>;</span><br><span class="line">    <span class="comment">/** waitStatus value to indicate successor's thread needs unparking */</span></span><br><span class="line">    <span class="comment">// å®˜æ–¹çš„æè¿°æ˜¯ï¼Œå…¶è¡¨ç¤ºå½“å‰nodeçš„åç»§èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SIGNAL    = -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">/** waitStatus value to indicate thread is waiting on condition */</span></span><br><span class="line">    <span class="comment">// æœ¬æ–‡ä¸åˆ†æconditionï¼Œæ‰€ä»¥ç•¥è¿‡å§ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šä»‹ç»è¿™ä¸ª</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONDITION = -<span class="number">2</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * waitStatus value to indicate the next acquireShared should</span></span><br><span class="line"><span class="comment">     * unconditionally propagate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// åŒæ ·çš„ä¸åˆ†æï¼Œç•¥è¿‡å§</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PROPAGATE = -<span class="number">3</span>;</span><br><span class="line">    <span class="comment">// =====================================================</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å–å€¼ä¸ºä¸Šé¢çš„1ã€-1ã€-2ã€-3ï¼Œæˆ–è€…0(ä»¥åä¼šè®²åˆ°)</span></span><br><span class="line">    <span class="comment">// è¿™ä¹ˆç†è§£ï¼Œæš‚æ—¶åªéœ€è¦çŸ¥é“å¦‚æœè¿™ä¸ªå€¼ å¤§äº0 ä»£è¡¨æ­¤çº¿ç¨‹å–æ¶ˆäº†ç­‰å¾…ï¼Œ</span></span><br><span class="line">    <span class="comment">//    ps: åŠå¤©æŠ¢ä¸åˆ°é”ï¼Œä¸æŠ¢äº†ï¼ŒReentrantLockæ˜¯å¯ä»¥æŒ‡å®štimeouotçš„ã€‚ã€‚ã€‚</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> waitStatus;</span><br><span class="line">    <span class="comment">// å‰é©±èŠ‚ç‚¹çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">volatile</span> Node prev;</span><br><span class="line">    <span class="comment">// åç»§èŠ‚ç‚¹çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">volatile</span> Node next;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå°±æ˜¯çº¿ç¨‹æœ¬å°Š</span></span><br><span class="line">    <span class="keyword">volatile</span> Thread thread;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Node çš„æ•°æ®ç»“æ„å…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œå°±æ˜¯ thread + waitStatus + pre + next å››ä¸ªå±æ€§è€Œå·²ï¼Œå¤§å®¶å…ˆè¦æœ‰è¿™ä¸ªæ¦‚å¿µåœ¨å¿ƒé‡Œã€‚</p><p>ä¸Šé¢çš„æ˜¯åŸºç¡€çŸ¥è¯†ï¼Œåé¢ä¼šå¤šæ¬¡ç”¨åˆ°ï¼Œå¿ƒé‡Œè¦æ—¶åˆ»è®°ç€å®ƒä»¬ï¼Œå¿ƒé‡Œæƒ³ç€è¿™ä¸ªç»“æ„å›¾å°±å¯ä»¥äº†ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å¼€å§‹è¯´ ReentrantLock çš„å…¬å¹³é”ã€‚å†æ¬¡å¼ºè°ƒï¼Œæˆ‘è¯´çš„é˜»å¡é˜Ÿåˆ—ä¸åŒ…å« head èŠ‚ç‚¹ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.javadoop.com/blogimages/AbstractQueuedSynchronizer/aqs-0.png" alt="aqs-0" title="">                </div>                <div class="image-caption">aqs-0</div>            </figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹ ReentrantLock çš„ä½¿ç”¨æ–¹å¼ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆ‘ç”¨ä¸ªwebå¼€å‘ä¸­çš„serviceæ¦‚å¿µå§</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderService</span> </span>{</span><br><span class="line">    <span class="comment">// ä½¿ç”¨staticï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„æ˜¯åŒä¸€æŠŠé”ï¼Œå½“ç„¶ï¼Œspring mvcä¸­serviceé»˜è®¤å°±æ˜¯å•ä¾‹ï¼Œåˆ«çº ç»“è¿™ä¸ª</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ReentrantLock reentrantLock = <span class="keyword">new</span> ReentrantLock(<span class="keyword">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createOrder</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// æ¯”å¦‚æˆ‘ä»¬åŒä¸€æ—¶é—´ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºè®¢å•</span></span><br><span class="line">        reentrantLock.lock();</span><br><span class="line">        <span class="comment">// é€šå¸¸ï¼Œlock ä¹‹åç´§è·Ÿç€ try è¯­å¥</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// è¿™å—ä»£ç åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›æ¥(è·å–åˆ°é”çš„çº¿ç¨‹)ï¼Œ</span></span><br><span class="line">            <span class="comment">// å…¶ä»–çš„çº¿ç¨‹åœ¨lock()æ–¹æ³•ä¸Šé˜»å¡ï¼Œç­‰å¾…è·å–åˆ°é”ï¼Œå†è¿›æ¥</span></span><br><span class="line">            <span class="comment">// æ‰§è¡Œä»£ç ...</span></span><br><span class="line">            <span class="comment">// æ‰§è¡Œä»£ç ...</span></span><br><span class="line">            <span class="comment">// æ‰§è¡Œä»£ç ...</span></span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">            reentrantLock.unlock();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ReentrantLock åœ¨å†…éƒ¨ç”¨äº†å†…éƒ¨ç±» Sync æ¥ç®¡ç†é”ï¼Œæ‰€ä»¥çœŸæ­£çš„è·å–é”å’Œé‡Šæ”¾é”æ˜¯ç”± Sync çš„å®ç°ç±»æ¥æ§åˆ¶çš„ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>{</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Sync æœ‰ä¸¤ä¸ªå®ç°ï¼Œåˆ†åˆ«ä¸º NonfairSyncï¼ˆéå…¬å¹³é”ï¼‰å’Œ FairSyncï¼ˆå…¬å¹³é”ï¼‰ï¼Œæˆ‘ä»¬çœ‹ FairSync éƒ¨åˆ†ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>{</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> FairSync() : <span class="keyword">new</span> NonfairSync();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="çº¿ç¨‹æŠ¢é”"><a href="#çº¿ç¨‹æŠ¢é”" class="headerlink" title="çº¿ç¨‹æŠ¢é”"></a>çº¿ç¨‹æŠ¢é”</h2><p>å¾ˆå¤šäººè‚¯å®šå¼€å§‹å«Œå¼ƒä¸Šé¢åºŸè¯å¤ªå¤šäº†ï¼Œä¸‹é¢è·Ÿç€ä»£ç èµ°ï¼Œæˆ‘å°±ä¸åºŸè¯äº†ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">FairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">3000897897090466540L</span>;</span><br><span class="line">  <span class="comment">// äº‰é”</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">        acquire(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">  <span class="comment">// æ¥è‡ªçˆ¶ç±»AQSï¼Œæˆ‘ç›´æ¥è´´è¿‡æ¥è¿™è¾¹ï¼Œä¸‹é¢åˆ†æçš„æ—¶å€™åŒæ ·ä¼šè¿™æ ·åšï¼Œä¸ä¼šç»™è¯»è€…å¸¦æ¥é˜…è¯»å‹åŠ›</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœtryAcquire(arg) è¿”å›true, ä¹Ÿå°±ç»“æŸäº†ã€‚</span></span><br><span class="line">    <span class="comment">// å¦åˆ™ï¼ŒacquireQueuedæ–¹æ³•ä¼šå°†çº¿ç¨‹å‹åˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>{ <span class="comment">// æ­¤æ—¶ arg == 1</span></span><br><span class="line">        <span class="comment">// é¦–å…ˆè°ƒç”¨tryAcquire(1)ä¸€ä¸‹ï¼Œåå­—ä¸Šå°±çŸ¥é“ï¼Œè¿™ä¸ªåªæ˜¯è¯•ä¸€è¯•</span></span><br><span class="line">        <span class="comment">// å› ä¸ºæœ‰å¯èƒ½ç›´æ¥å°±æˆåŠŸäº†å‘¢ï¼Œä¹Ÿå°±ä¸éœ€è¦è¿›é˜Ÿåˆ—æ’äº†ï¼Œ</span></span><br><span class="line">        <span class="comment">// å¯¹äºå…¬å¹³é”çš„è¯­ä¹‰å°±æ˜¯ï¼šæœ¬æ¥å°±æ²¡äººæŒæœ‰é”ï¼Œæ ¹æœ¬æ²¡å¿…è¦è¿›é˜Ÿåˆ—ç­‰å¾…(åˆæ˜¯æŒ‚èµ·ï¼Œåˆæ˜¯ç­‰å¾…è¢«å”¤é†’çš„)</span></span><br><span class="line">        <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">            <span class="comment">// tryAcquire(arg)æ²¡æœ‰æˆåŠŸï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŠŠå½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œæ”¾åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ã€‚</span></span><br><span class="line">            acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) {</span><br><span class="line">              selfInterrupt();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Fair version of tryAcquire.  Don't grant access unless</span></span><br><span class="line"><span class="comment">     * recursive call or no waiters or is first.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// å°è¯•ç›´æ¥è·å–é”ï¼Œè¿”å›å€¼æ˜¯booleanï¼Œä»£è¡¨æ˜¯å¦è·å–åˆ°é”</span></span><br><span class="line">    <span class="comment">// è¿”å›trueï¼š1.æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…é”ï¼›2.é‡å…¥é”ï¼Œçº¿ç¨‹æœ¬æ¥å°±æŒæœ‰é”ï¼Œä¹Ÿå°±å¯ä»¥ç†æ‰€å½“ç„¶å¯ä»¥ç›´æ¥è·å–</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>{</span><br><span class="line">        <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">        <span class="keyword">int</span> c = getState();</span><br><span class="line">        <span class="comment">// state == 0 æ­¤æ—¶æ­¤åˆ»æ²¡æœ‰çº¿ç¨‹æŒæœ‰é”</span></span><br><span class="line">        <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">// è™½ç„¶æ­¤æ—¶æ­¤åˆ»é”æ˜¯å¯ä»¥ç”¨çš„ï¼Œä½†æ˜¯è¿™æ˜¯å…¬å¹³é”ï¼Œæ—¢ç„¶æ˜¯å…¬å¹³ï¼Œå°±å¾—è®²ç©¶å…ˆæ¥ååˆ°ï¼Œ</span></span><br><span class="line">            <span class="comment">// çœ‹çœ‹æœ‰æ²¡æœ‰åˆ«äººåœ¨é˜Ÿåˆ—ä¸­ç­‰äº†åŠå¤©äº†</span></span><br><span class="line">            <span class="keyword">if</span> (!hasQueuedPredecessors() &amp;&amp;</span><br><span class="line">                <span class="comment">// å¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œé‚£å°±ç”¨CASå°è¯•ä¸€ä¸‹ï¼ŒæˆåŠŸäº†å°±è·å–åˆ°é”äº†ï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¸æˆåŠŸçš„è¯ï¼Œåªèƒ½è¯´æ˜ä¸€ä¸ªé—®é¢˜ï¼Œå°±åœ¨åˆšåˆšå‡ ä¹åŒä¸€æ—¶åˆ»æœ‰ä¸ªçº¿ç¨‹æŠ¢å…ˆäº† =_=</span></span><br><span class="line">                <span class="comment">// å› ä¸ºåˆšåˆšè¿˜æ²¡äººçš„ï¼Œæˆ‘åˆ¤æ–­è¿‡äº†</span></span><br><span class="line">                compareAndSetState(<span class="number">0</span>, acquires)) {</span><br><span class="line">              </span><br><span class="line">                <span class="comment">// åˆ°è¿™é‡Œå°±æ˜¯è·å–åˆ°é”äº†ï¼Œæ ‡è®°ä¸€ä¸‹ï¼Œå‘Šè¯‰å¤§å®¶ï¼Œç°åœ¨æ˜¯æˆ‘å ç”¨äº†é”</span></span><br><span class="line">                setExclusiveOwnerThread(current);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">      <span class="comment">// ä¼šè¿›å…¥è¿™ä¸ªelse ifåˆ†æ”¯ï¼Œè¯´æ˜æ˜¯é‡å…¥äº†ï¼Œéœ€è¦æ“ä½œï¼šstate=state+1</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œä¸å­˜åœ¨å¹¶å‘é—®é¢˜</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) {</span><br><span class="line">            <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">            <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">            setState(nextc);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å¦‚æœåˆ°è¿™é‡Œï¼Œè¯´æ˜å‰é¢çš„ifå’Œelse iféƒ½æ²¡æœ‰è¿”å›trueï¼Œè¯´æ˜æ²¡æœ‰è·å–åˆ°é”</span></span><br><span class="line">        <span class="comment">// å›åˆ°ä¸Šé¢ä¸€ä¸ªå¤–å±‚è°ƒç”¨æ–¹æ³•ç»§ç»­çœ‹:</span></span><br><span class="line">        <span class="comment">// if (!tryAcquire(arg) </span></span><br><span class="line">        <span class="comment">//        &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) </span></span><br><span class="line">        <span class="comment">//     selfInterrupt();</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// å‡è®¾tryAcquire(arg) è¿”å›falseï¼Œé‚£ä¹ˆä»£ç å°†æ‰§è¡Œï¼š</span></span><br><span class="line">  <span class="comment">//acquireQueued(addWaiter(Node.EXCLUSIVE), arg)ï¼Œ</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦æ‰§è¡Œï¼šaddWaiter(Node.EXCLUSIVE)</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates and enqueues node for current thread and given mode.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mode Node.EXCLUSIVE for exclusive, Node.SHARED for shared</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the new node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// æ­¤æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠçº¿ç¨‹åŒ…è£…æˆnodeï¼ŒåŒæ—¶è¿›å…¥åˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="comment">// å‚æ•°modeæ­¤æ—¶æ˜¯Node.EXCLUSIVEï¼Œä»£è¡¨ç‹¬å æ¨¡å¼</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>{</span><br><span class="line">        Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">        <span class="comment">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class="line">        <span class="comment">// ä»¥ä¸‹å‡ è¡Œä»£ç æƒ³æŠŠå½“å‰nodeåŠ åˆ°é“¾è¡¨çš„æœ€åé¢å»ï¼Œä¹Ÿå°±æ˜¯è¿›åˆ°é˜»å¡é˜Ÿåˆ—çš„æœ€å</span></span><br><span class="line">        Node pred = tail;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// tail!=null =&gt; é˜Ÿåˆ—ä¸ä¸ºç©º(tail==headçš„æ—¶å€™ï¼Œå…¶å®é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä¸è¿‡ä¸ç®¡è¿™ä¸ªå§)</span></span><br><span class="line">        <span class="keyword">if</span> (pred != <span class="keyword">null</span>) { </span><br><span class="line">            <span class="comment">// å°†å½“å‰çš„é˜Ÿå°¾èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸ºè‡ªå·±çš„å‰é©± </span></span><br><span class="line">            node.prev = pred; </span><br><span class="line">            <span class="comment">// ç”¨CASæŠŠè‡ªå·±è®¾ç½®ä¸ºé˜Ÿå°¾, å¦‚æœæˆåŠŸåï¼Œtail == node äº†ï¼Œè¿™ä¸ªèŠ‚ç‚¹æˆä¸ºé˜»å¡é˜Ÿåˆ—æ–°çš„å°¾å·´</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(pred, node)) { </span><br><span class="line">                <span class="comment">// è¿›åˆ°è¿™é‡Œè¯´æ˜è®¾ç½®æˆåŠŸï¼Œå½“å‰node==tail, å°†è‡ªå·±ä¸ä¹‹å‰çš„é˜Ÿå°¾ç›¸è¿ï¼Œ</span></span><br><span class="line">                <span class="comment">// ä¸Šé¢å·²ç»æœ‰ node.prev = predï¼ŒåŠ ä¸Šä¸‹é¢è¿™å¥ï¼Œä¹Ÿå°±å®ç°äº†å’Œä¹‹å‰çš„å°¾èŠ‚ç‚¹åŒå‘è¿æ¥äº†</span></span><br><span class="line">                pred.next = node;</span><br><span class="line">                <span class="comment">// çº¿ç¨‹å…¥é˜Ÿäº†ï¼Œå¯ä»¥è¿”å›äº†</span></span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// ä»”ç»†çœ‹çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœä¼šåˆ°è¿™é‡Œï¼Œ</span></span><br><span class="line">        <span class="comment">// è¯´æ˜ pred==null(é˜Ÿåˆ—æ˜¯ç©ºçš„) æˆ–è€… CASå¤±è´¥(æœ‰çº¿ç¨‹åœ¨ç«äº‰å…¥é˜Ÿ)</span></span><br><span class="line">        <span class="comment">// è¯»è€…ä¸€å®šè¦è·Ÿä¸Šæ€è·¯ï¼Œå¦‚æœæ²¡æœ‰è·Ÿä¸Šï¼Œå»ºè®®å…ˆä¸è¦å¾€ä¸‹è¯»äº†ï¼Œå¾€å›ä»”ç»†çœ‹ï¼Œå¦åˆ™ä¼šæµªè´¹æ—¶é—´çš„</span></span><br><span class="line">        enq(node);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts node into queue, initializing if necessary. See picture above.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node the node to insert</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> node's predecessor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// é‡‡ç”¨è‡ªæ—‹çš„æ–¹å¼å…¥é˜Ÿ</span></span><br><span class="line">    <span class="comment">// ä¹‹å‰è¯´è¿‡ï¼Œåˆ°è¿™ä¸ªæ–¹æ³•åªæœ‰ä¸¤ç§å¯èƒ½ï¼šç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºï¼Œæˆ–è€…æœ‰çº¿ç¨‹ç«äº‰å…¥é˜Ÿï¼Œ</span></span><br><span class="line">    <span class="comment">// è‡ªæ—‹åœ¨è¿™è¾¹çš„è¯­ä¹‰æ˜¯ï¼šCASè®¾ç½®tailè¿‡ç¨‹ä¸­ï¼Œç«äº‰ä¸€æ¬¡ç«äº‰ä¸åˆ°ï¼Œæˆ‘å°±å¤šæ¬¡ç«äº‰ï¼Œæ€»ä¼šæ’åˆ°çš„</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (;;) {</span><br><span class="line">            Node t = tail;</span><br><span class="line">            <span class="comment">// ä¹‹å‰è¯´è¿‡ï¼Œé˜Ÿåˆ—ä¸ºç©ºä¹Ÿä¼šè¿›æ¥è¿™é‡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (t == <span class="keyword">null</span>) { <span class="comment">// Must initialize</span></span><br><span class="line">                <span class="comment">// åˆå§‹åŒ–headèŠ‚ç‚¹</span></span><br><span class="line">                <span class="comment">// ç»†å¿ƒçš„è¯»è€…ä¼šçŸ¥é“åŸæ¥ head å’Œ tail åˆå§‹åŒ–çš„æ—¶å€™éƒ½æ˜¯ null çš„</span></span><br><span class="line">                <span class="comment">// è¿˜æ˜¯ä¸€æ­¥CASï¼Œä½ æ‡‚çš„ï¼Œç°åœ¨å¯èƒ½æ˜¯å¾ˆå¤šçº¿ç¨‹åŒæ—¶è¿›æ¥å‘¢</span></span><br><span class="line">                <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                    <span class="comment">// ç»™åé¢ç”¨ï¼šè¿™ä¸ªæ—¶å€™headèŠ‚ç‚¹çš„waitStatus==0, çœ‹new Node()æ„é€ æ–¹æ³•å°±çŸ¥é“äº†</span></span><br><span class="line">                  </span><br><span class="line">                    <span class="comment">// è¿™ä¸ªæ—¶å€™æœ‰äº†headï¼Œä½†æ˜¯tailè¿˜æ˜¯nullï¼Œè®¾ç½®ä¸€ä¸‹ï¼Œ</span></span><br><span class="line">                    <span class="comment">// æŠŠtailæŒ‡å‘headï¼Œæ”¾å¿ƒï¼Œé©¬ä¸Šå°±æœ‰çº¿ç¨‹è¦æ¥äº†ï¼Œåˆ°æ—¶å€™tailå°±è¦è¢«æŠ¢äº†</span></span><br><span class="line">                    <span class="comment">// æ³¨æ„ï¼šè¿™é‡Œåªæ˜¯è®¾ç½®äº†tail=headï¼Œè¿™é‡Œå¯æ²¡returnå“¦ï¼Œæ²¡æœ‰returnï¼Œæ²¡æœ‰return</span></span><br><span class="line">                    <span class="comment">// æ‰€ä»¥ï¼Œè®¾ç½®å®Œäº†ä»¥åï¼Œç»§ç»­forå¾ªç¯ï¼Œä¸‹æ¬¡å°±åˆ°ä¸‹é¢çš„elseåˆ†æ”¯äº†</span></span><br><span class="line">                    tail = head;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// ä¸‹é¢å‡ è¡Œï¼Œå’Œä¸Šä¸€ä¸ªæ–¹æ³• addWaiter æ˜¯ä¸€æ ·çš„ï¼Œ</span></span><br><span class="line">                <span class="comment">// åªæ˜¯è¿™ä¸ªå¥—åœ¨æ— é™å¾ªç¯é‡Œï¼Œåæ­£å°±æ˜¯å°†å½“å‰çº¿ç¨‹æ’åˆ°é˜Ÿå°¾ï¼Œæœ‰çº¿ç¨‹ç«äº‰çš„è¯æ’ä¸ä¸Šé‡å¤æ’</span></span><br><span class="line">                node.prev = t;</span><br><span class="line">                <span class="keyword">if</span> (compareAndSetTail(t, node)) {</span><br><span class="line">                    t.next = node;</span><br><span class="line">                    <span class="keyword">return</span> t;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">    <span class="comment">// ç°åœ¨ï¼Œåˆå›åˆ°è¿™æ®µä»£ç äº†</span></span><br><span class="line">    <span class="comment">// if (!tryAcquire(arg) </span></span><br><span class="line">    <span class="comment">//        &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) </span></span><br><span class="line">    <span class="comment">//     selfInterrupt();</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œå‚æ•°nodeï¼Œç»è¿‡addWaiter(Node.EXCLUSIVE)ï¼Œæ­¤æ—¶å·²ç»è¿›å…¥é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ä¸€ä¸‹ï¼šå¦‚æœacquireQueued(addWaiter(Node.EXCLUSIVE), arg))è¿”å›trueçš„è¯ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ„å‘³ç€ä¸Šé¢è¿™æ®µä»£ç å°†è¿›å…¥selfInterrupt()ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸‹é¢åº”è¯¥è¿”å›false</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•éå¸¸é‡è¦ï¼Œåº”è¯¥è¯´çœŸæ­£çš„çº¿ç¨‹æŒ‚èµ·ï¼Œç„¶åè¢«å”¤é†’åå»è·å–é”ï¼Œéƒ½åœ¨è¿™ä¸ªæ–¹æ³•é‡Œäº†</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">acquireQueued</span><span class="params">(<span class="keyword">final</span> Node node, <span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">        <span class="keyword">boolean</span> failed = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">boolean</span> interrupted = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (;;) {</span><br><span class="line">                <span class="keyword">final</span> Node p = node.predecessor();</span><br><span class="line">                <span class="comment">// p == head è¯´æ˜å½“å‰èŠ‚ç‚¹è™½ç„¶è¿›åˆ°äº†é˜»å¡é˜Ÿåˆ—ï¼Œä½†æ˜¯æ˜¯é˜»å¡é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªï¼Œå› ä¸ºå®ƒçš„å‰é©±æ˜¯head</span></span><br><span class="line">                <span class="comment">// æ³¨æ„ï¼Œé˜»å¡é˜Ÿåˆ—ä¸åŒ…å«headèŠ‚ç‚¹ï¼Œheadä¸€èˆ¬æŒ‡çš„æ˜¯å æœ‰é”çš„çº¿ç¨‹ï¼Œheadåé¢çš„æ‰ç§°ä¸ºé˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">                <span class="comment">// æ‰€ä»¥å½“å‰èŠ‚ç‚¹å¯ä»¥å»è¯•æŠ¢ä¸€ä¸‹é”</span></span><br><span class="line">                <span class="comment">// è¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆå¯ä»¥å»è¯•è¯•ï¼š</span></span><br><span class="line">                <span class="comment">// é¦–å…ˆï¼Œå®ƒæ˜¯é˜Ÿå¤´ï¼Œè¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå…¶æ¬¡ï¼Œå½“å‰çš„headæœ‰å¯èƒ½æ˜¯åˆšåˆšåˆå§‹åŒ–çš„nodeï¼Œ</span></span><br><span class="line">                <span class="comment">// enq(node) æ–¹æ³•é‡Œé¢æœ‰æåˆ°ï¼Œheadæ˜¯å»¶æ—¶åˆå§‹åŒ–çš„ï¼Œè€Œä¸”new Node()çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä»»ä½•çº¿ç¨‹</span></span><br><span class="line">                <span class="comment">// ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‰çš„headä¸å±äºä»»ä½•ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ä½œä¸ºé˜Ÿå¤´ï¼Œå¯ä»¥å»è¯•ä¸€è¯•ï¼Œ</span></span><br><span class="line">                <span class="comment">// tryAcquireå·²ç»åˆ†æè¿‡äº†, å¿˜è®°äº†è¯·å¾€å‰çœ‹ä¸€ä¸‹ï¼Œå°±æ˜¯ç®€å•ç”¨CASè¯•æ“ä½œä¸€ä¸‹state</span></span><br><span class="line">                <span class="keyword">if</span> (p == head &amp;&amp; tryAcquire(arg)) {</span><br><span class="line">                    setHead(node);</span><br><span class="line">                    p.next = <span class="keyword">null</span>; <span class="comment">// help GC</span></span><br><span class="line">                    failed = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">return</span> interrupted;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// åˆ°è¿™é‡Œï¼Œè¯´æ˜ä¸Šé¢çš„ifåˆ†æ”¯æ²¡æœ‰æˆåŠŸï¼Œè¦ä¹ˆå½“å‰nodeæœ¬æ¥å°±ä¸æ˜¯é˜Ÿå¤´ï¼Œ</span></span><br><span class="line">                <span class="comment">// è¦ä¹ˆå°±æ˜¯tryAcquire(arg)æ²¡æœ‰æŠ¢èµ¢åˆ«äººï¼Œç»§ç»­å¾€ä¸‹çœ‹</span></span><br><span class="line">                <span class="keyword">if</span> (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span><br><span class="line">                    parkAndCheckInterrupt())</span><br><span class="line">                    interrupted = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">// ä»€ä¹ˆæ—¶å€™ failed ä¼šä¸º true???</span></span><br><span class="line">            <span class="comment">// tryAcquire() æ–¹æ³•æŠ›å¼‚å¸¸çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> (failed)</span><br><span class="line">                cancelAcquire(node);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Checks and updates status for a node that failed to acquire.</span></span><br><span class="line"><span class="comment">     * Returns true if thread should block. This is the main signal</span></span><br><span class="line"><span class="comment">     * control in all acquire loops.  Requires that pred == node.prev</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pred node's predecessor holding status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node the node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> {<span class="doctag">@code</span> true} if thread should block</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// åˆšåˆšè¯´è¿‡ï¼Œä¼šåˆ°è¿™é‡Œå°±æ˜¯æ²¡æœ‰æŠ¢åˆ°é”å‘—ï¼Œè¿™ä¸ªæ–¹æ³•è¯´çš„æ˜¯ï¼š"å½“å‰çº¿ç¨‹æ²¡æœ‰æŠ¢åˆ°é”ï¼Œæ˜¯å¦éœ€è¦æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Ÿ"</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‰é©±èŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰æ˜¯ä»£è¡¨å½“å‰çº¿ç¨‹çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">shouldParkAfterFailedAcquire</span><span class="params">(Node pred, Node node)</span> </span>{</span><br><span class="line">        <span class="keyword">int</span> ws = pred.waitStatus;</span><br><span class="line">        <span class="comment">// å‰é©±èŠ‚ç‚¹çš„ waitStatus == -1 ï¼Œè¯´æ˜å‰é©±èŠ‚ç‚¹çŠ¶æ€æ­£å¸¸ï¼Œå½“å‰çº¿ç¨‹éœ€è¦æŒ‚èµ·ï¼Œç›´æ¥å¯ä»¥è¿”å›true</span></span><br><span class="line">        <span class="keyword">if</span> (ws == Node.SIGNAL)</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * This node has already set status asking a release</span></span><br><span class="line"><span class="comment">             * to signal it, so it can safely park.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‰é©±èŠ‚ç‚¹ waitStatuså¤§äº0 ï¼Œä¹‹å‰è¯´è¿‡ï¼Œå¤§äº0 è¯´æ˜å‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿã€‚</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œéœ€è¦çŸ¥é“è¿™ç‚¹ï¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—æ’é˜Ÿçš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œè€Œå”¤é†’çš„æ“ä½œæ˜¯ç”±å‰é©±èŠ‚ç‚¹å®Œæˆçš„ã€‚</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥ä¸‹é¢è¿™å—ä»£ç è¯´çš„æ˜¯å°†å½“å‰èŠ‚ç‚¹çš„prevæŒ‡å‘waitStatus&lt;=0çš„èŠ‚ç‚¹ï¼Œ</span></span><br><span class="line">        <span class="comment">// ç®€å•è¯´ï¼Œå°±æ˜¯ä¸ºäº†æ‰¾ä¸ªå¥½çˆ¹ï¼Œå› ä¸ºä½ è¿˜å¾—ä¾èµ–å®ƒæ¥å”¤é†’å‘¢ï¼Œå¦‚æœå‰é©±èŠ‚ç‚¹å–æ¶ˆäº†æ’é˜Ÿï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰¾å‰é©±èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹åšçˆ¹ï¼Œå¾€å‰éå†æ€»èƒ½æ‰¾åˆ°ä¸€ä¸ªå¥½çˆ¹çš„</span></span><br><span class="line">        <span class="keyword">if</span> (ws &gt; <span class="number">0</span>) {</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * Predecessor was cancelled. Skip over predecessors and</span></span><br><span class="line"><span class="comment">             * indicate retry.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">do</span> {</span><br><span class="line">                node.prev = pred = pred.prev;</span><br><span class="line">            } <span class="keyword">while</span> (pred.waitStatus &gt; <span class="number">0</span>);</span><br><span class="line">            pred.next = node;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * waitStatus must be 0 or PROPAGATE.  Indicate that we</span></span><br><span class="line"><span class="comment">             * need a signal, but don't park yet.  Caller will need to</span></span><br><span class="line"><span class="comment">             * retry to make sure it cannot acquire before parking.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="comment">// ä»”ç»†æƒ³æƒ³ï¼Œå¦‚æœè¿›å…¥åˆ°è¿™ä¸ªåˆ†æ”¯æ„å‘³ç€ä»€ä¹ˆ</span></span><br><span class="line">            <span class="comment">// å‰é©±èŠ‚ç‚¹çš„waitStatusä¸ç­‰äº-1å’Œ1ï¼Œé‚£ä¹Ÿå°±æ˜¯åªå¯èƒ½æ˜¯0ï¼Œ-2ï¼Œ-3</span></span><br><span class="line">            <span class="comment">// åœ¨æˆ‘ä»¬å‰é¢çš„æºç ä¸­ï¼Œéƒ½æ²¡æœ‰çœ‹åˆ°æœ‰è®¾ç½®waitStatusçš„ï¼Œæ‰€ä»¥æ¯ä¸ªæ–°çš„nodeå…¥é˜Ÿæ—¶ï¼ŒwaitStatuéƒ½æ˜¯0</span></span><br><span class="line">            <span class="comment">// æ­£å¸¸æƒ…å†µä¸‹ï¼Œå‰é©±èŠ‚ç‚¹æ˜¯ä¹‹å‰çš„ tailï¼Œé‚£ä¹ˆå®ƒçš„ waitStatus åº”è¯¥æ˜¯ 0</span></span><br><span class="line">            <span class="comment">// ç”¨CASå°†å‰é©±èŠ‚ç‚¹çš„waitStatusè®¾ç½®ä¸ºNode.SIGNAL(ä¹Ÿå°±æ˜¯-1)</span></span><br><span class="line">            compareAndSetWaitStatus(pred, ws, Node.SIGNAL);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ–¹æ³•è¿”å› falseï¼Œé‚£ä¹ˆä¼šå†èµ°ä¸€æ¬¡ for å¾ªåºï¼Œ</span></span><br><span class="line">        <span class="comment">//     ç„¶åå†æ¬¡è¿›æ¥æ­¤æ–¹æ³•ï¼Œæ­¤æ—¶ä¼šä»ç¬¬ä¸€ä¸ªåˆ†æ”¯è¿”å› true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// private static boolean shouldParkAfterFailedAcquire(Node pred, Node node)</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•ç»“æŸæ ¹æ®è¿”å›å€¼æˆ‘ä»¬ç®€å•åˆ†æä¸‹ï¼š</span></span><br><span class="line">    <span class="comment">// å¦‚æœè¿”å›true, è¯´æ˜å‰é©±èŠ‚ç‚¹çš„waitStatus==-1ï¼Œæ˜¯æ­£å¸¸æƒ…å†µï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹éœ€è¦è¢«æŒ‚èµ·ï¼Œç­‰å¾…ä»¥åè¢«å”¤é†’</span></span><br><span class="line">    <span class="comment">//æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œä»¥åæ˜¯è¢«å‰é©±èŠ‚ç‚¹å”¤é†’ï¼Œå°±ç­‰ç€å‰é©±èŠ‚ç‚¹æ‹¿åˆ°é”ï¼Œç„¶åé‡Šæ”¾é”çš„æ—¶å€™å«ä½ å¥½äº†</span></span><br><span class="line">    <span class="comment">// å¦‚æœè¿”å›false, è¯´æ˜å½“å‰ä¸éœ€è¦è¢«æŒ‚èµ·ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¾€åçœ‹</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è·³å›åˆ°å‰é¢æ˜¯è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="comment">// if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;</span></span><br><span class="line">    <span class="comment">//                parkAndCheckInterrupt())</span></span><br><span class="line">    <span class="comment">//                interrupted = true;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. å¦‚æœshouldParkAfterFailedAcquire(p, node)è¿”å›trueï¼Œ</span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆéœ€è¦æ‰§è¡ŒparkAndCheckInterrupt():</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ–¹æ³•å¾ˆç®€å•ï¼Œå› ä¸ºå‰é¢è¿”å›trueï¼Œæ‰€ä»¥éœ€è¦æŒ‚èµ·çº¿ç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯è´Ÿè´£æŒ‚èµ·çº¿ç¨‹çš„</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œç”¨äº†LockSupport.park(this)æ¥æŒ‚èµ·çº¿ç¨‹ï¼Œç„¶åå°±åœåœ¨è¿™é‡Œäº†ï¼Œç­‰å¾…è¢«å”¤é†’=======</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>{</span><br><span class="line">        LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 2. æ¥ä¸‹æ¥è¯´è¯´å¦‚æœshouldParkAfterFailedAcquire(p, node)è¿”å›falseçš„æƒ…å†µ</span></span><br><span class="line">  </span><br><span class="line">   <span class="comment">// ä»”ç»†çœ‹shouldParkAfterFailedAcquire(p, node)ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå…¶å®ç¬¬ä¸€æ¬¡è¿›æ¥çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¸ä¼šè¿”å›trueçš„ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå‰é©±èŠ‚ç‚¹çš„waitStatus=-1æ˜¯ä¾èµ–äºåç»§èŠ‚ç‚¹è®¾ç½®çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘éƒ½è¿˜æ²¡ç»™å‰é©±è®¾ç½®-1å‘¢ï¼Œæ€ä¹ˆå¯èƒ½æ˜¯trueå‘¢ï¼Œä½†æ˜¯è¦çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¥—åœ¨å¾ªç¯é‡Œçš„ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è¿›æ¥çš„æ—¶å€™çŠ¶æ€å°±æ˜¯-1äº†ã€‚</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// è§£é‡Šä¸‹ä¸ºä»€ä¹ˆshouldParkAfterFailedAcquire(p, node)è¿”å›falseçš„æ—¶å€™ä¸ç›´æ¥æŒ‚èµ·çº¿ç¨‹ï¼š</span></span><br><span class="line">    <span class="comment">// =&gt; æ˜¯ä¸ºäº†åº”å¯¹åœ¨ç»è¿‡è¿™ä¸ªæ–¹æ³•åï¼Œnodeå·²ç»æ˜¯headçš„ç›´æ¥åç»§èŠ‚ç‚¹äº†ã€‚å‰©ä¸‹çš„è¯»è€…è‡ªå·±æƒ³æƒ³å§ã€‚</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¯´åˆ°è¿™é‡Œï¼Œä¹Ÿå°±æ˜ç™½äº†ï¼Œå¤šçœ‹å‡ é <code>final boolean acquireQueued(final Node node, int arg)</code> è¿™ä¸ªæ–¹æ³•å§ã€‚è‡ªå·±æ¨æ¼”ä¸‹å„ä¸ªåˆ†æ”¯æ€ä¹ˆèµ°ï¼Œå“ªç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œèµ°åˆ°å“ªé‡Œã€‚</p><h2 id="è§£é”æ“ä½œ"><a href="#è§£é”æ“ä½œ" class="headerlink" title="è§£é”æ“ä½œ"></a>è§£é”æ“ä½œ</h2><p>æœ€åï¼Œå°±æ˜¯è¿˜éœ€è¦ä»‹ç»ä¸‹å”¤é†’çš„åŠ¨ä½œäº†ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœçº¿ç¨‹æ²¡è·å–åˆ°é”ï¼Œçº¿ç¨‹ä¼šè¢« <code>LockSupport.park(this);</code> æŒ‚èµ·åœæ­¢ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å”¤é†’çš„ä»£ç è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½ å¦‚æœä¸Šé¢åŠ é”çš„éƒ½çœ‹æ‡‚äº†ï¼Œä¸‹é¢éƒ½ä¸éœ€è¦çœ‹å°±çŸ¥é“æ€ä¹ˆå›äº‹äº†</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>{</span><br><span class="line">    sync.release(<span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">release</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>{</span><br><span class="line">    <span class="comment">// å¾€åçœ‹å§</span></span><br><span class="line">    <span class="keyword">if</span> (tryRelease(arg)) {</span><br><span class="line">        Node h = head;</span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h.waitStatus != <span class="number">0</span>)</span><br><span class="line">            unparkSuccessor(h);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›åˆ°ReentrantLockçœ‹tryReleaseæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> c = getState() - releases;</span><br><span class="line">    <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">    <span class="comment">// æ˜¯å¦å®Œå…¨é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// å…¶å®å°±æ˜¯é‡å…¥çš„é—®é¢˜ï¼Œå¦‚æœc==0ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰åµŒå¥—é”äº†ï¼Œå¯ä»¥é‡Šæ”¾äº†ï¼Œå¦åˆ™è¿˜ä¸èƒ½é‡Šæ”¾æ‰</span></span><br><span class="line">    <span class="keyword">if</span> (c == <span class="number">0</span>) {</span><br><span class="line">        free = <span class="keyword">true</span>;</span><br><span class="line">        setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line">    setState(c);</span><br><span class="line">    <span class="keyword">return</span> free;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Wakes up node's successor, if one exists.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> node the node</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// å”¤é†’åç»§èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">// ä»ä¸Šé¢è°ƒç”¨å¤„çŸ¥é“ï¼Œå‚æ•°nodeæ˜¯headå¤´ç»“ç‚¹</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>{</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * If status is negative (i.e., possibly needing signal) try</span></span><br><span class="line"><span class="comment">     * to clear in anticipation of signalling.  It is OK if this</span></span><br><span class="line"><span class="comment">     * fails or if status is changed by waiting thread.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ws = node.waitStatus;</span><br><span class="line">    <span class="comment">// å¦‚æœheadèŠ‚ç‚¹å½“å‰waitStatus&lt;0, å°†å…¶ä¿®æ”¹ä¸º0</span></span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Thread to unpark is held in successor, which is normally</span></span><br><span class="line"><span class="comment">     * just the next node.  But if cancelled or apparently null,</span></span><br><span class="line"><span class="comment">     * traverse backwards from tail to find the actual</span></span><br><span class="line"><span class="comment">     * non-cancelled successor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// ä¸‹é¢çš„ä»£ç å°±æ˜¯å”¤é†’åç»§èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ‰å¯èƒ½åç»§èŠ‚ç‚¹å–æ¶ˆäº†ç­‰å¾…ï¼ˆwaitStatus==1ï¼‰</span></span><br><span class="line">    <span class="comment">// ä»é˜Ÿå°¾å¾€å‰æ‰¾ï¼Œæ‰¾åˆ°waitStatus&lt;=0çš„æ‰€æœ‰èŠ‚ç‚¹ä¸­æ’åœ¨æœ€å‰é¢çš„</span></span><br><span class="line">    Node s = node.next;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus &gt; <span class="number">0</span>) {</span><br><span class="line">        s = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">// ä»åå¾€å‰æ‰¾ï¼Œä»”ç»†çœ‹ä»£ç ï¼Œä¸å¿…æ‹…å¿ƒä¸­é—´æœ‰èŠ‚ç‚¹å–æ¶ˆ(waitStatus==1)çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// å”¤é†’çº¿ç¨‹</span></span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å”¤é†’çº¿ç¨‹ä»¥åï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°†ä»ä»¥ä¸‹ä»£ç ä¸­ç»§ç»­å¾€å‰èµ°ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">parkAndCheckInterrupt</span><span class="params">()</span> </span>{</span><br><span class="line">    LockSupport.park(<span class="keyword">this</span>); <span class="comment">// åˆšåˆšçº¿ç¨‹è¢«æŒ‚èµ·åœ¨è¿™é‡Œäº†</span></span><br><span class="line">    <span class="keyword">return</span> Thread.interrupted();</span><br><span class="line">}</span><br><span class="line"><span class="comment">// åˆå›åˆ°è¿™ä¸ªæ–¹æ³•äº†ï¼šacquireQueued(final Node node, int arg)ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œnodeçš„å‰é©±æ˜¯headäº†</span></span><br></pre></td></tr></tbody></table></figure><p>å¥½äº†ï¼Œåé¢å°±ä¸åˆ†ææºç äº†ï¼Œå‰©ä¸‹çš„è¿˜æœ‰é—®é¢˜è‡ªå·±å»ä»”ç»†çœ‹çœ‹ä»£ç å§ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ç»“ä¸€ä¸‹å§ã€‚</p><p>åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒåŠ é”å’Œè§£é”éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªéƒ¨ä»¶çš„åè°ƒï¼š</p><ol><li>é”çŠ¶æ€ã€‚æˆ‘ä»¬è¦çŸ¥é“é”æ˜¯ä¸æ˜¯è¢«åˆ«çš„çº¿ç¨‹å æœ‰äº†ï¼Œè¿™ä¸ªå°±æ˜¯ state çš„ä½œç”¨ï¼Œå®ƒä¸º 0 çš„æ—¶å€™ä»£è¡¨æ²¡æœ‰çº¿ç¨‹å æœ‰é”ï¼Œå¯ä»¥å»äº‰æŠ¢è¿™ä¸ªé”ï¼Œç”¨ CAS å°† state è®¾ä¸º 1ï¼Œå¦‚æœ CAS æˆåŠŸï¼Œè¯´æ˜æŠ¢åˆ°äº†é”ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±æŠ¢ä¸åˆ°äº†ï¼Œå¦‚æœé”é‡å…¥çš„è¯ï¼Œstateè¿›è¡Œ +1 å°±å¯ä»¥ï¼Œè§£é”å°±æ˜¯å‡ 1ï¼Œç›´åˆ° state åˆå˜ä¸º 0ï¼Œä»£è¡¨é‡Šæ”¾é”ï¼Œæ‰€ä»¥ lock() å’Œ unlock() å¿…é¡»è¦é…å¯¹å•Šã€‚ç„¶åå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè®©å…¶æ¥å æœ‰é”ã€‚</li><li>çº¿ç¨‹çš„é˜»å¡å’Œè§£é™¤é˜»å¡ã€‚AQS ä¸­é‡‡ç”¨äº† LockSupport.park(thread) æ¥æŒ‚èµ·çº¿ç¨‹ï¼Œç”¨ unpark æ¥å”¤é†’çº¿ç¨‹ã€‚</li><li>é˜»å¡é˜Ÿåˆ—ã€‚å› ä¸ºäº‰æŠ¢é”çš„çº¿ç¨‹å¯èƒ½å¾ˆå¤šï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°é”ï¼Œå…¶ä»–çš„çº¿ç¨‹éƒ½å¿…é¡»ç­‰å¾…ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸€ä¸ª queue æ¥ç®¡ç†è¿™äº›çº¿ç¨‹ï¼ŒAQS ç”¨çš„æ˜¯ä¸€ä¸ª FIFO çš„é˜Ÿåˆ—ï¼Œå°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ¯ä¸ª node éƒ½æŒæœ‰åç»§èŠ‚ç‚¹çš„å¼•ç”¨ã€‚AQS é‡‡ç”¨äº† CLH é”çš„å˜ä½“æ¥å®ç°ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="http://coderbee.net/index.php/concurrent/20131115/577" target="_blank" rel="noopener">å…³äºCLHçš„ä»‹ç»</a>ï¼Œå†™å¾—ç®€å•æ˜äº†ã€‚</li></ol><h2 id="ç¤ºä¾‹å›¾è§£æ"><a href="#ç¤ºä¾‹å›¾è§£æ" class="headerlink" title="ç¤ºä¾‹å›¾è§£æ"></a>ç¤ºä¾‹å›¾è§£æ</h2><p>ä¸‹é¢å±äºå›é¡¾ç¯èŠ‚ï¼Œç”¨ç®€å•çš„ç¤ºä¾‹æ¥è¯´ä¸€éï¼Œå¦‚æœä¸Šé¢çš„æœ‰äº›ä¸œè¥¿æ²¡çœ‹æ‡‚ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€æ¬¡å¸®åŠ©ä½ ç†è§£çš„æœºä¼šã€‚</p><p>é¦–å…ˆï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ reentrantLock.lock()ï¼Œç¿»åˆ°æœ€å‰é¢å¯ä»¥å‘ç°ï¼ŒtryAcquire(1) ç›´æ¥å°±è¿”å› true äº†ï¼Œç»“æŸã€‚åªæ˜¯è®¾ç½®äº† state=1ï¼Œè¿ head éƒ½æ²¡æœ‰åˆå§‹åŒ–ï¼Œæ›´è°ˆä¸ä¸Šä»€ä¹ˆé˜»å¡é˜Ÿåˆ—äº†ã€‚è¦æ˜¯çº¿ç¨‹ 1 è°ƒç”¨ unlock() äº†ï¼Œæ‰æœ‰çº¿ç¨‹ 2 æ¥ï¼Œé‚£ä¸–ç•Œå°±å¤ªå¤ªå¤ªå¹³äº†ï¼Œå®Œå…¨æ²¡æœ‰äº¤é›†å˜›ï¼Œé‚£æˆ‘è¿˜è¦ AQS å¹²å˜›ã€‚</p><p>å¦‚æœçº¿ç¨‹ 1 æ²¡æœ‰è°ƒç”¨ unlock() ä¹‹å‰ï¼Œçº¿ç¨‹ 2 è°ƒç”¨äº† lock(), æƒ³æƒ³ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>çº¿ç¨‹ 2 ä¼šåˆå§‹åŒ– headã€new Node()ã€‘ï¼ŒåŒæ—¶çº¿ç¨‹ 2 ä¹Ÿä¼šæ’å…¥åˆ°é˜»å¡é˜Ÿåˆ—å¹¶æŒ‚èµ· (æ³¨æ„çœ‹è¿™é‡Œæ˜¯ä¸€ä¸ª for å¾ªç¯ï¼Œè€Œä¸”è®¾ç½® head å’Œ tail çš„éƒ¨åˆ†æ˜¯ä¸ return çš„ï¼Œåªæœ‰å…¥é˜ŸæˆåŠŸæ‰ä¼šè·³å‡ºå¾ªç¯)</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (;;) {</span><br><span class="line">        Node t = tail;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) { <span class="comment">// Must initialize</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                tail = head;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            node.prev = t;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(t, node)) {</span><br><span class="line">                t.next = node;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>é¦–å…ˆï¼Œæ˜¯çº¿ç¨‹ 2 åˆå§‹åŒ– head èŠ‚ç‚¹ï¼Œæ­¤æ—¶ head==tail, waitStatus==0</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.javadoop.com/blogimages/AbstractQueuedSynchronizer/aqs-1.png" alt="aqs-1" title="">                </div>                <div class="image-caption">aqs-1</div>            </figure><p>ç„¶åçº¿ç¨‹ 2 å…¥é˜Ÿï¼š</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.javadoop.com/blogimages/AbstractQueuedSynchronizer/aqs-2.png" alt="aqs-2" title="">                </div>                <div class="image-caption">aqs-2</div>            </figure><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿè¦çœ‹æ­¤æ—¶èŠ‚ç‚¹çš„ waitStatusï¼Œæˆ‘ä»¬çŸ¥é“ head èŠ‚ç‚¹æ˜¯çº¿ç¨‹ 2 åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶çš„ waitStatus æ²¡æœ‰è®¾ç½®ï¼Œ java é»˜è®¤ä¼šè®¾ç½®ä¸º 0ï¼Œä½†æ˜¯åˆ° shouldParkAfterFailedAcquire è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ 2 ä¼šæŠŠå‰é©±èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ head çš„waitStatusè®¾ç½®ä¸º -1ã€‚</p><p>é‚£çº¿ç¨‹ 2 èŠ‚ç‚¹æ­¤æ—¶çš„ waitStatus æ˜¯å¤šå°‘å‘¢ï¼Œç”±äºæ²¡æœ‰è®¾ç½®ï¼Œæ‰€ä»¥æ˜¯ 0ï¼›</p><p>å¦‚æœçº¿ç¨‹ 3 æ­¤æ—¶å†è¿›æ¥ï¼Œç›´æ¥æ’åˆ°çº¿ç¨‹ 2 çš„åé¢å°±å¯ä»¥äº†ï¼Œæ­¤æ—¶çº¿ç¨‹ 3 çš„ waitStatus æ˜¯ 0ï¼Œåˆ° shouldParkAfterFailedAcquire æ–¹æ³•çš„æ—¶å€™æŠŠå‰é©±èŠ‚ç‚¹çº¿ç¨‹ 2 çš„ waitStatus è®¾ç½®ä¸º -1ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.javadoop.com/blogimages/AbstractQueuedSynchronizer/aqs-3.png" alt="aqs-3" title="">                </div>                <div class="image-caption">aqs-3</div>            </figure><p>è¿™é‡Œå¯ä»¥ç®€å•è¯´ä¸‹ waitStatus ä¸­ SIGNAL(-1) çŠ¶æ€çš„æ„æ€ï¼ŒDoug Lea æ³¨é‡Šçš„æ˜¯ï¼šä»£è¡¨åç»§èŠ‚ç‚¹éœ€è¦è¢«å”¤é†’ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª waitStatus å…¶å®ä»£è¡¨çš„ä¸æ˜¯è‡ªå·±çš„çŠ¶æ€ï¼Œè€Œæ˜¯åç»§èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸ª node åœ¨å…¥é˜Ÿçš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠå‰é©±èŠ‚ç‚¹çš„çŠ¶æ€æ”¹ä¸º SIGNALï¼Œç„¶åé˜»å¡ï¼Œç­‰å¾…è¢«å‰é©±å”¤é†’ã€‚è¿™é‡Œæ¶‰åŠçš„æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼šæœ‰çº¿ç¨‹å–æ¶ˆäº†æ’é˜Ÿã€å”¤é†’æ“ä½œã€‚å…¶å®æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œè¯»è€…ä¹Ÿå¯ä»¥é¡ºç€ â€œwaitStatusä»£è¡¨åç»§èŠ‚ç‚¹çš„çŠ¶æ€â€ è¿™ç§æ€è·¯å»çœ‹ä¸€éæºç ã€‚</p><p>ï¼ˆå…¨æ–‡å®Œï¼‰</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åœ¨åˆ†æ Java å¹¶å‘åŒ… java.util.concurrent æºç çš„æ—¶å€™ï¼Œå°‘ä¸äº†éœ€è¦äº†è§£ AbstractQueuedSynchronizerï¼ˆä»¥ä¸‹ç®€å†™AQSï¼‰è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå› ä¸ºå®ƒæ˜¯ Java å¹¶å‘åŒ…çš„åŸºç¡€å·¥å…·ç±»ï¼Œæ˜¯å®ç° ReentrantLockã€CountDownLatchã€Semaphoreã€FutureTask ç­‰ç±»çš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;Google ä¸€ä¸‹ AbstractQueuedSynchronizerï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å¾ˆå¤šå…³äº AQS çš„ä»‹ç»ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ²¡æœ‰ä»‹ç»æ¸…æ¥šï¼Œå› ä¸ºå¤§éƒ¨åˆ†æ–‡ç« æ²¡æœ‰æŠŠå…¶ä¸­çš„ä¸€äº›å…³é”®çš„ç»†èŠ‚è¯´æ¸…æ¥šã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å°†ä» ReentrantLock çš„å…¬å¹³é”æºç å‡ºå‘ï¼Œåˆ†æä¸‹ AbstractQueuedSynchronizer è¿™ä¸ªç±»æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶æä¾›ä¸€äº›ç®€å•çš„å¸®åŠ©ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="concurrency" scheme="https://winniekun.github.io/categories/concurrency/"/>
    
    
  </entry>
  
  <entry>
    <title>2020å¹´æ€»ç»“</title>
    <link href="https://winniekun.github.io/2020%E5%B9%B4%E6%80%BB%E7%BB%93/"/>
    <id>https://winniekun.github.io/2020%E5%B9%B4%E6%80%BB%E7%BB%93/</id>
    <published>2021-01-02T16:11:11.000Z</published>
    <updated>2021-01-02T16:40:50.580Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å•Š"><a href="#å•Š" class="headerlink" title="å•Š"></a>å•Š</h2><a id="more"></a><p>2020å¹´åˆ°åº•è¿˜æ˜¯ç»“æŸäº†ï¼Œæ„Ÿè§‰ç°åœ¨çš„è‡ªå·±ä¹Ÿä¸å–œæ¬¢åšå„ç§é˜¶æ®µæ€§æ€»ç»“äº†ï¼Œæ€»æ„Ÿè§‰æŠŠè‡ªå·±çš„ç»å†å†™å‡ºæ¥æ˜¯ä¸€ç§ç‰¹åˆ«çŸ«æƒ…çš„äº‹æƒ…ã€‚ç›¸åï¼Œæ›´æƒ³æŠŠè¿™äº›ç»å†ä»…ä¾›è‡ªå·±æ…¢æ…¢å›å‘³å’Œæ„Ÿè§¦ã€‚ä½†æ˜¯ï¼Œæ—¶é—´ä¹…äº†ï¼Œæœ‰äº›ä¸œè¥¿è®°å¾—å°±ä¸å¤Ÿå®¢è§‚äº†ï¼ˆè™½ç„¶ç°åœ¨è®°å¿†çš„ä¹Ÿä¸å¤Ÿè§‚ã€‚ã€‚ã€‚ï¼‰</p><p>æ‰€ä»¥ï¼Œä»¥åçš„æ¯ä¸€å¹´éƒ½è¿˜æ˜¯åšä¸€æ¬¡å¹´ç»ˆå°ç»“å§ã€‚</p><h2 id="ä¸ŠåŠå¹´"><a href="#ä¸ŠåŠå¹´" class="headerlink" title="ä¸ŠåŠå¹´"></a>ä¸ŠåŠå¹´</h2><p>å› ä¸ºç–«æƒ…ï¼Œä¸ŠåŠå¹´ä¸€ç›´åœ¨å®¶é‡Œå‘†ç€ï¼Œæ¯å¤©çš„ç”Ÿæ´»å·®ä¸å¤šå¦‚ä¸‹</p><table><thead><tr><th>æ—¶é—´</th><th>å¹²å•¥</th></tr></thead><tbody><tr><td>ä¸Šåˆ</td><td>ç½‘è¯¾ï¼ˆæŒ‚æœºï¼Œå¹²è‡ªå·±çš„äº‹æƒ…ï¼‰</td></tr><tr><td>ä¸‹åˆ</td><td>ç½‘è¯¾ï¼ˆæŒ‚æœºï¼Œå¹²è‡ªå·±çš„äº‹æƒ…ï¼‰</td></tr><tr><td>æ™šä¸Š</td><td>å’ŒéŸ©è€å¸ˆè¿˜æœ‰æ²ˆæ€»æ‰“æ¸¸æˆ</td></tr></tbody></table><p>åœ¨ä¸Šç½‘è¯¾çš„3ä¸ªæœˆé‡Œï¼Œè‡ªå·±è™½ç„¶è¯¾æ²¡å¥½å¥½ä¸Šè¿‡ï¼Œä¸è¿‡è¿˜æ˜¯åšäº†ä¸€äº›äº‹æƒ…çš„ï¼š</p><ol><li>å‰‘æŒ‡offeråˆ·äº†3é</li><li>LeetCode300å¤§å…³å®Œæˆ</li><li>æ·±å…¥ç†è§£JVMè™šæ‹Ÿæœºç»ˆäºæ˜¯çœ‹æ‡‚äº†</li><li>JDKæºç ï¼ˆcollectionã€jucï¼‰å—‘äº†ä¸€é<ol><li>HashMapçš„è®¾è®¡æ˜¯çœŸçš„ç²¾å¦™</li><li>çº¢é»‘æ ‘çœŸçš„ä¸æ˜¯æ­£å¸¸äººå†™çš„æ¥çš„</li></ol></li><li>æ“ä½œç³»ç»Ÿè¿‡äº†ä¸€é</li></ol><p>ä¸ºå•¥è¦åšè¿™äº›äº‹æƒ…å˜ï¼Œä¸»è¦è¿˜æ˜¯æƒ³æ‰¾å®ä¹ ï¼Œæ„Ÿè§‰åœ¨å­¦æ ¡é‡Œé¢å‘†è…»äº†ï¼Œæƒ³å‡ºæ¥çœ‹çœ‹ï¼ˆä»€ä¹ˆ**æƒ³æ³•ï¼‰â€¦</p><p>ç»ˆäºï¼Œåœ¨æˆ‘çš„è‰°è‹¦å¤ä¹ å’Œå‡†å¤‡ä¹‹ä¸‹ï¼Œæˆ‘å¿ƒä»ªçš„å­—èŠ‚è¿˜æ˜¯æŠŠæˆ‘æ‹’ç»äº†ï¼ˆä»Šå¹´åªé¢äº†å­—èŠ‚ä¸€å®¶å¤§å‚ï¼‰ï¼Œè¢«æ‰“å‡»åˆ°äº†ä¹‹åï¼Œä¹Ÿå°±æ²¡å†ç»§ç»­æŠ•é€’å…¶ä»–å¤§å‚ã€‚åé¢é€šè¿‡ç‰›å®¢ä¸Šçš„å†…æ¨ï¼Œæ¥åˆ°äº†è”šæ¥æ±½è½¦å®ä¹ ã€‚</p><h2 id="ä¸‹åŠå¹´"><a href="#ä¸‹åŠå¹´" class="headerlink" title="ä¸‹åŠå¹´"></a>ä¸‹åŠå¹´</h2><p>ä»9æœˆä¸­æ—¬èµ·ï¼Œå¼€å§‹æˆ‘çš„å®ä¹ ç”Ÿæ´»ï¼Œä»åˆšå¼€å§‹çš„ä¸é€‚åº”ï¼Œåˆ°åé¢çš„ä¸€è„¸æ‡µé€¼ï¼Œå†åˆ°ç°åœ¨çš„å‹‰å¼ºé€‚åº”ã€‚è®©æˆ‘è®¤è¯†åˆ°äº†è‡ªå·±æŠ€æœ¯ä¸Šçš„ä¸è¶³ï¼Œä»¥åŠäº¤æµä¸Šçš„é—®é¢˜ã€‚æ‰€ä»¥åŸºæœ¬æ¯å¤©å›æ¥éƒ½ä¼šä¸»åŠ¨å»çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€è´Ÿè´£çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¶‰åŠå“ªäº›æŠ€æœ¯æ ˆï¼Œè¿™äº›æŠ€æœ¯æ ˆæ˜¯æ€ä¹ˆä½¿ç”¨çš„ï¼Œå’Œæˆ‘ä¹‹å‰è‡ªå·±å†™ç€ç©å„¿çš„æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚è‡ªå·±ä¹Ÿå­¦ä¼šäº†åœ¨åšä»»åŠ¡çš„æ—¶å€™ï¼Œå…ˆå»çœ‹éœ€æ±‚èƒŒæ™¯ï¼Œå†å»çœ‹å®ç°æ–¹æ¡ˆï¼Œç„¶åè„‘å­æ„å»ºå®ç°æ–¹å¼ï¼Œæœ€åå†çœ‹æ˜¯æ’¸ä»£ç ã€‚é‡åˆ°äº†è‡ªå·±è§£å†³ä¸äº†çš„ï¼Œæœ‰ç–‘æƒ‘çš„åœ°æ–¹ï¼Œä¹Ÿæ¸æ¸çš„å­¦ä¼šä¸»åŠ¨å»è¯·æ•™åŒäº‹äº†ã€‚æœ€åï¼Œåœ¨è·ç¦»å®ä¹ ç»“æŸè¿˜æœ‰ä¸¤ä¸ªæœˆä¸åˆ°çš„æ—¶é—´é‡Œï¼Œå¸Œæœ›èƒ½å¤Ÿæ‹“å®½è‡ªå·±çš„æŠ€æœ¯æ ˆï¼Œç²¾è¿›è‡ªå·±çš„æŠ€æœ¯æ·±åº¦ã€‚ä¸»åŠ¨å»å’ŒåŒäº‹äº¤æµï¼Œå­¦ä¹ ç»éªŒã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å•Š&quot;&gt;&lt;a href=&quot;#å•Š&quot; class=&quot;headerlink&quot; title=&quot;å•Š&quot;&gt;&lt;/a&gt;å•Š&lt;/h2&gt;</summary>
    
    
    
    <category term="ç¢ç¢å¿µ" scheme="https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="æ‚è°ˆ" scheme="https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>2021å¹´ä¹¦å•ã€å¹´æ±‡æ€»ã€‘</title>
    <link href="https://winniekun.github.io/2021%E5%B9%B4%E4%B9%A6%E5%8D%95%E3%80%90%E5%B9%B4%E6%B1%87%E6%80%BB%E3%80%91/"/>
    <id>https://winniekun.github.io/2021%E5%B9%B4%E4%B9%A6%E5%8D%95%E3%80%90%E5%B9%B4%E6%B1%87%E6%80%BB%E3%80%91/</id>
    <published>2021-01-01T07:01:10.000Z</published>
    <updated>2021-02-24T12:06:26.477Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ <a href="https://blog.jamespan.me/" target="_blank" rel="noopener">æ‘˜è‡ªé¶¸é“åœº</a></p></blockquote><p>è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚</p><a id="more"></a><h2 id="ä¹¦ç±ç›¸å…³"><a href="#ä¹¦ç±ç›¸å…³" class="headerlink" title="ä¹¦ç±ç›¸å…³"></a>ä¹¦ç±ç›¸å…³</h2><ul><li>ç¨‹åºå‘˜ä»£ç é¢è¯•æŒ‡å—- ITåä¼ç®—æ³•ä¸æ•°æ®ç»“æ„é¢˜ç›®æœ€ä¼˜è§£<ul><li>è®¡åˆ’çš„æ˜¯å»å¹´å¹´åº•å¼€å§‹åˆ·ï¼Œç„¶åè®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–</li><li>å…¬å¸å®‰æ’çš„1230çš„ä»»åŠ¡æŒºå¤æ‚çš„ï¼Œè¿˜æŒºå¤šï¼Œå°±æ²¡æœ‰å¼€å§‹æ</li><li>ä¸è¿‡ç»ˆäºåœ¨31å·ï¼Œä¸‹å®šå†³å¿ƒå…ˆæŠŠä¹¦ä¹°äº†ï¼Œç„¶å1å·æ­£å¼å¼€åˆ·</li></ul></li></ul><h2 id="è®ºæ–‡"><a href="#è®ºæ–‡" class="headerlink" title="è®ºæ–‡"></a>è®ºæ–‡</h2><h2 id="ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡"><a href="#ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡" class="headerlink" title="ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡"></a>ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€çºªå½•ç‰‡</h2><ul><li><p>ä¸€ç‚¹å°±é€š</p><ul><li>åˆä¼™äºº2 ï¼Ÿï¼Ÿï¼Ÿ</li></ul></li><li><p>æ¸©æš–çš„æŠ±æŠ±</p></li><li><p>æ‹†å¼¹ä¸“å®¶2</p></li><li><p>é€ä½ ä¸€æœµå°çº¢èŠ±</p></li><li><p>èµ˜å©¿</p><ul><li>ä¸Šå¤´çœ‹çš„</li></ul></li><li><p>å“ªå’é‡ç”Ÿ</p><ul><li>å¤Ÿæœ‹å…‹</li></ul></li><li><p>ä½ å¥½æç„•è‹±</p><ul><li>å¥½çœ‹çš„</li></ul></li><li><p>å› ä¸ºæ˜¯ç”·é«˜æ‰€ä»¥å¾ˆå¹¸ç¦</p><ul><li>æ†¨æ‰¹ä¸€å®¶äººå“‡</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æˆ‘çš„èƒ½åŠ›å°±è¿™ä¹ˆå¤šï¼Œæˆ‘è‹¥å…¨å¿ƒå·¥ä½œï¼Œåˆ™å¿…ç„¶å¿½ç•¥ç”Ÿæ´»ï¼›æˆ‘è‹¥ç”¨å¿ƒç”Ÿæ´»ï¼Œåˆ™å¿…ç„¶ä¸€äº‹æ— æˆï¼›æˆ‘è‹¥ä¸¤è€…å…¼é¡¾ï¼Œåˆéš¾å…å¹³åº¸ &lt;a href=&quot;https://blog.jamespan.me/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æ‘˜è‡ªé¶¸é“åœº&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¶æˆ‘è¿˜èƒ½å†™å¾—åŠ¨ä»£ç çœ‹è¿›ä¹¦çš„å¹´çºªï¼ŒåŠªåŠ›ä¸€å›ï¼Œçœ‹çœ‹è¿™å¹³åº¸çš„èµ„è´¨èƒ½å‘æŒ¥å‡ åˆ†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¢ç¢å¿µ" scheme="https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="ä¹¦å•" scheme="https://winniekun.github.io/tags/%E4%B9%A6%E5%8D%95/"/>
    
  </entry>
  
  <entry>
    <title>if-elseä»£ç ä¼˜åŒ–çš„å‡ ç§æ–¹æ¡ˆ</title>
    <link href="https://winniekun.github.io/if-else-code-optimization/"/>
    <id>https://winniekun.github.io/if-else-code-optimization/</id>
    <published>2020-11-02T11:46:42.000Z</published>
    <updated>2020-11-02T12:46:17.949Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»£ç ä¸­æ¶‰åŠåˆ°è¾ƒä¸ºå¤æ‚çš„é€»è¾‘æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‡ºç°å¤§é‡çš„<code>if-else</code>ï¼Œè™½ç„¶å®ç°äº†æ•´ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯é˜…è¯»èµ·æ¥æ¯”è¾ƒè€—æ—¶ï¼Œå¹¶ä¸”ç»´æŠ¤çš„æ—¶å€™ä¹Ÿååˆ†çš„å›°éš¾ï¼ŒåŒæ—¶åªè¦æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰è€ƒè™‘æ¸…æ¥šï¼Œä¿®æ”¹èµ·æ¥å°±éš¾å…å‡ºç°<code>bug</code>ã€‚æœ€è¿‘åœ¨åšå…¬å¸æŸä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå°±é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œç„¶ååœ¨<code>review</code>çš„æ—¶å€™ï¼ŒåŒäº‹å’Œæˆ‘è®²äº†ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œä»¥åŠé»˜è®¤çš„è§„èŒƒä¹‹åã€‚è‡ªå·±é‡æ–°ä¿®æ”¹ä¹‹åï¼Œæ„Ÿè§‰å¾ˆèˆ’æœï¼Œåç»­è‡ªå·±é‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œæ‰€ä»¥å°±å†™äº†è¿™ç¯‡åšå®¢ã€‚</p><a id="more"></a><h2 id="ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="ä¼˜åŒ–æ–¹æ¡ˆ"></a>ä¼˜åŒ–æ–¹æ¡ˆ</h2><h3 id="ä¼˜åŒ–ä¸€ï¼šæå‰returnï¼Œå»é™¤ä¸å¿…è¦çš„else"><a href="#ä¼˜åŒ–ä¸€ï¼šæå‰returnï¼Œå»é™¤ä¸å¿…è¦çš„else" class="headerlink" title="ä¼˜åŒ–ä¸€ï¼šæå‰returnï¼Œå»é™¤ä¸å¿…è¦çš„else"></a>ä¼˜åŒ–ä¸€ï¼šæå‰returnï¼Œå»é™¤ä¸å¿…è¦çš„else</h3><p>å¦‚æœ<code>if-else</code>ä»£ç å—åŒ…å«<code>return</code>è¯­å¥ï¼Œå¯ä»¥è€ƒè™‘é€šè¿‡æå‰<code>return</code>ï¼ŒæŠŠå¤šä½™<code>else</code>å¹²æ‰ï¼Œä½¿ä»£ç æ›´åŠ ä¼˜é›…ã€‚</p><h4 id="ä¼˜åŒ–å‰"><a href="#ä¼˜åŒ–å‰" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition){</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  <span class="comment">// do other thing</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å"><a href="#ä¼˜åŒ–å" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!condition) {</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">} </span><br><span class="line"><span class="comment">// do something</span></span><br></pre></td></tr></tbody></table></figure><h3 id="ä¼˜åŒ–äºŒï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—"><a href="#ä¼˜åŒ–äºŒï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—" class="headerlink" title="ä¼˜åŒ–äºŒï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—"></a>ä¼˜åŒ–äºŒï¼šä½¿ç”¨ä¸‰å…ƒè¿ç®—</h3><h4 id="ä¼˜åŒ–å‰-1"><a href="#ä¼˜åŒ–å‰-1" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> price;</span><br><span class="line"><span class="keyword">if</span>(condition){</span><br><span class="line">  price = <span class="number">10</span>;</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">  price = <span class="number">20</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-1"><a href="#ä¼˜åŒ–å-1" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> price = condition ? <span class="number">10</span> : <span class="number">20</span>;</span><br></pre></td></tr></tbody></table></figure><h3 id="ä¼˜åŒ–ä¸‰ï¼šä½¿ç”¨æšä¸¾"><a href="#ä¼˜åŒ–ä¸‰ï¼šä½¿ç”¨æšä¸¾" class="headerlink" title="ä¼˜åŒ–ä¸‰ï¼šä½¿ç”¨æšä¸¾"></a>ä¼˜åŒ–ä¸‰ï¼šä½¿ç”¨æšä¸¾</h3><h4 id="ä¼˜åŒ–å‰-2"><a href="#ä¼˜åŒ–å‰-2" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> orderStatus = getXXX(xxx);</span><br><span class="line">String OrderStatusDes;</span><br><span class="line"><span class="keyword">if</span>(orderStatus == <span class="number">0</span>) {</span><br><span class="line">    OrderStatusDes = <span class="string">"è®¢å•æœªæ”¯ä»˜"</span>;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(OrderStatus == <span class="number">1</span>) {</span><br><span class="line">    OrderStatusDes = <span class="string">"è®¢å•å·²æ”¯ä»˜"</span>;</span><br><span class="line">}<span class="keyword">else</span> <span class="keyword">if</span>(OrderStatus == <span class="number">2</span>) {</span><br><span class="line">   OrderStatusDes = <span class="string">"å·²å‘è´§"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-2"><a href="#ä¼˜åŒ–å-2" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><p><strong>å…ˆå®šä¹‰ä¸€ä¸ªæšä¸¾ç±»å‹</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> OrderStatusEnum {</span><br><span class="line">    UN_PAID(<span class="number">0</span>,<span class="string">"è®¢å•æœªæ”¯ä»˜"</span>),PAIDED(<span class="number">1</span>,<span class="string">"è®¢å•å·²æ”¯ä»˜"</span>),SENDED(<span class="number">2</span>,<span class="string">"å·²å‘è´§"</span>),;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getIndex</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    OrderStatusEnum(<span class="keyword">int</span> index, String desc){</span><br><span class="line">        <span class="keyword">this</span>.index = index;</span><br><span class="line">        <span class="keyword">this</span>.desc =desc;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="function">OrderStatusEnum <span class="title">ofCode</span><span class="params">(<span class="keyword">int</span> orderStatus)</span> </span>{</span><br><span class="line">        <span class="keyword">for</span> (OrderStatusEnum temp : OrderStatusEnum.values()) {</span><br><span class="line">            <span class="keyword">if</span> (temp.getIndex() == orderStatus) {</span><br><span class="line">                <span class="keyword">return</span> temp;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æœ‰äº†æšä¸¾ä¹‹åï¼Œä»¥ä¸Šif-elseé€»è¾‘åˆ†æ”¯ï¼Œå¯ä»¥ä¼˜åŒ–ä¸ºä¸€è¡Œä»£ç </p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String OrderStatusDes = OrderStatusEnum.ofCode(orderStatus).getDesc();</span><br></pre></td></tr></tbody></table></figure><h3 id="ä¼˜åŒ–å››ï¼šåˆå¹¶æ¡ä»¶è¡¨è¾¾å¼"><a href="#ä¼˜åŒ–å››ï¼šåˆå¹¶æ¡ä»¶è¡¨è¾¾å¼" class="headerlink" title="ä¼˜åŒ–å››ï¼šåˆå¹¶æ¡ä»¶è¡¨è¾¾å¼"></a>ä¼˜åŒ–å››ï¼šåˆå¹¶æ¡ä»¶è¡¨è¾¾å¼</h3><p>å¦‚æœæœ‰ä¸€ç³»åˆ—æ¡ä»¶è¿”å›ä¸€æ ·çš„ç»“æœï¼Œå¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œè®©é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚</p><h4 id="ä¼˜åŒ–å‰-3"><a href="#ä¼˜åŒ–å‰-3" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getVipDiscount</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span>(age&lt;<span class="number">18</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.8</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">"æ·±åœ³"</span>.equals(city)){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.8</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(isStudent){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.8</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//do somethig</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-3"><a href="#ä¼˜åŒ–å-3" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getVipDiscount</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(age&lt;<span class="number">18</span>|| <span class="string">"æ·±åœ³"</span>.equals(city)||isStudent){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.8</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//doSomthing</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¦‚æœè¿”å›ç»Ÿä¸€ç»“æœçš„æ¡ä»¶è¿‡å¤šï¼Œå¯ä»¥å†ç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå°è£…èµ·æ¥<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p><h3 id="ä¼˜åŒ–äº”ï¼šä½¿ç”¨Optional"><a href="#ä¼˜åŒ–äº”ï¼šä½¿ç”¨Optional" class="headerlink" title="ä¼˜åŒ–äº”ï¼šä½¿ç”¨Optional"></a>ä¼˜åŒ–äº”ï¼šä½¿ç”¨Optional</h3><p>æœ‰æ—¶å€™<code>if-else</code>æ¯”è¾ƒå¤šï¼Œæ˜¯å› ä¸ºéç©ºåˆ¤æ–­å¯¼è‡´çš„ï¼Œè¿™æ—¶å€™ä½ å¯ä»¥ä½¿ç”¨<code>Java9</code>çš„<code>Optional</code>è¿›è¡Œä¼˜åŒ–ã€‚</p><h4 id="ä¼˜åŒ–å‰-4"><a href="#ä¼˜åŒ–å‰-4" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">"wkk"</span>;</span><br><span class="line"><span class="keyword">if</span> (str != <span class="keyword">null</span>) {</span><br><span class="line">    System.out.println(str);</span><br><span class="line">} <span class="keyword">else</span> {</span><br><span class="line">    System.out.println(<span class="string">"Null"</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-4"><a href="#ä¼˜åŒ–å-4" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; strOptional = Optional.ofNullable(<span class="string">"wkk"</span>);</span><br><span class="line">strOptional.ifPresentOrElse(System.out::println, () -&gt; System.out.println(<span class="string">"Null"</span>));</span><br></pre></td></tr></tbody></table></figure><p><code>Java8</code>çš„<code>Optional</code>è™½ç„¶æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨Optionalæ¥ä¼˜åŒ–éç©ºçš„èµ‹å€¼æ“ä½œ</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><p>ç”µæ± å¹³å°æœå½¹çŠ¶æ€èµ‹å€¼ï¼šå¦‚æœä¸ºnullï¼Œèµ‹å€¼ä¸º0ï¼Œå¦åˆ™ä¸ºåŸæ¥çš„å€¼</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">batteryBasicInfoCollectDto.setFlowControlState(Optional.ofNullable(batteryInfo.getFlowControlState()).orElse(<span class="number">0</span>));</span><br></pre></td></tr></tbody></table></figure><h3 id="ä¼˜åŒ–å…­ï¼šè¡¨é©±åŠ¨æ³•"><a href="#ä¼˜åŒ–å…­ï¼šè¡¨é©±åŠ¨æ³•" class="headerlink" title="ä¼˜åŒ–å…­ï¼šè¡¨é©±åŠ¨æ³•"></a>ä¼˜åŒ–å…­ï¼šè¡¨é©±åŠ¨æ³•</h3><h4 id="ä¼˜åŒ–å‰-5"><a href="#ä¼˜åŒ–å‰-5" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><p><strong>è¡¨é©±åŠ¨æ³•</strong>ï¼Œåˆç§°ä¹‹ä¸ºè¡¨é©±åŠ¨ã€è¡¨é©±åŠ¨æ–¹æ³•ã€‚è¡¨é©±åŠ¨æ–¹æ³•æ˜¯ä¸€ç§ä½¿ä½ å¯ä»¥åœ¨è¡¨ä¸­æŸ¥æ‰¾ä¿¡æ¯ï¼Œè€Œä¸å¿…ç”¨å¾ˆå¤šçš„é€»è¾‘è¯­å¥ï¼ˆifæˆ–Caseï¼‰æ¥æŠŠå®ƒä»¬æ‰¾å‡ºæ¥çš„æ–¹æ³•ã€‚ä»¥ä¸‹çš„demoï¼ŒæŠŠmapæŠ½è±¡æˆè¡¨ï¼Œåœ¨mapä¸­æŸ¥æ‰¾ä¿¡æ¯ï¼Œè€Œçœå»ä¸å¿…è¦çš„é€»è¾‘è¯­å¥ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (param.equals(value1)) {</span><br><span class="line">    doAction1(someParams);</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (param.equals(value2)) {</span><br><span class="line">    doAction2(someParams);</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (param.equals(value3)) {</span><br><span class="line">    doAction3(someParams);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-5"><a href="#ä¼˜åŒ–å-5" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œæ³›å‹æ˜¯ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œå®é™…å¯æ›¿æ¢ä¸ºä½ éœ€è¦çš„ç±»å‹</span></span><br><span class="line">Map&lt;?, Function&lt;?&gt; action&gt; actionMappings = <span class="keyword">new</span> HashMap&lt;&gt;(); </span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">actionMappings.put(value1, (someParams) -&gt; { doAction1(someParams)});</span><br><span class="line">actionMappings.put(value2, (someParams) -&gt; { doAction2(someParams)});</span><br><span class="line">actionMappings.put(value3, (someParams) -&gt; { doAction3(someParams)});</span><br><span class="line"> </span><br><span class="line"><span class="comment">// çœç•¥å¤šä½™é€»è¾‘è¯­å¥</span></span><br><span class="line">actionMappings.get(param).apply(someParams);</span><br></pre></td></tr></tbody></table></figure><h3 id="ä¼˜åŒ–ä¸ƒï¼šä¼˜åŒ–é€»è¾‘ç»“æ„ï¼Œè®©æ­£å¸¸æµç¨‹èµ°ä¸»å¹²"><a href="#ä¼˜åŒ–ä¸ƒï¼šä¼˜åŒ–é€»è¾‘ç»“æ„ï¼Œè®©æ­£å¸¸æµç¨‹èµ°ä¸»å¹²" class="headerlink" title="ä¼˜åŒ–ä¸ƒï¼šä¼˜åŒ–é€»è¾‘ç»“æ„ï¼Œè®©æ­£å¸¸æµç¨‹èµ°ä¸»å¹²"></a>ä¼˜åŒ–ä¸ƒï¼šä¼˜åŒ–é€»è¾‘ç»“æ„ï¼Œè®©æ­£å¸¸æµç¨‹èµ°ä¸»å¹²</h3><h4 id="ä¼˜åŒ–å‰-6"><a href="#ä¼˜åŒ–å‰-6" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAdjustedCapital</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(_capital &lt;= <span class="number">0.0</span> ){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(_intRate &gt; <span class="number">0</span> &amp;&amp; _duration &gt;<span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> (_income / _duration) *ADJ_FACTOR;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-6"><a href="#ä¼˜åŒ–å-6" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAdjustedCapital</span><span class="params">()</span></span>{</span><br><span class="line">    <span class="keyword">if</span>(_capital &lt;= <span class="number">0.0</span> ){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(_intRate &lt;= <span class="number">0</span> || _duration &lt;= <span class="number">0</span>){</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> (_income / _duration) *ADJ_FACTOR;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>å°†æ¡ä»¶åè½¬ä½¿å¼‚å¸¸æƒ…å†µå…ˆé€€å‡ºï¼Œè®©æ­£å¸¸æµç¨‹ç»´æŒåœ¨ä¸»å¹²æµç¨‹ï¼Œå¯ä»¥è®©ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ã€‚</strong></p><h3 id="ä¼˜åŒ–å…«ï¼šç­–ç•¥æ¨¡å¼-å·¥å‚æ–¹æ³•æ¶ˆé™¤if-else"><a href="#ä¼˜åŒ–å…«ï¼šç­–ç•¥æ¨¡å¼-å·¥å‚æ–¹æ³•æ¶ˆé™¤if-else" class="headerlink" title="ä¼˜åŒ–å…«ï¼šç­–ç•¥æ¨¡å¼+å·¥å‚æ–¹æ³•æ¶ˆé™¤if-else"></a>ä¼˜åŒ–å…«ï¼šç­–ç•¥æ¨¡å¼+å·¥å‚æ–¹æ³•æ¶ˆé™¤if-else</h3><p><strong>ç­–ç•¥ç±»å®šä¹‰</strong>ï¼šä¸€ä¸ªç­–ç•¥æ¥å£å’Œä¸€ç»„å®ç°è¿™ä¸ªæ¥å£çš„ç­–ç•¥ç±»ã€‚</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå®¢æˆ·ç«¯ä»£ç åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ï¼Œå¯ä»¥çµæ´»åœ°æ›¿æ¢ä¸åŒçš„ç­–ç•¥ã€‚</p><p><strong>å‡è®¾éœ€æ±‚</strong>ï¼šæ ¹æ®ä¸åŒå‹‹ç« ç±»å‹ï¼Œå¤„ç†ç›¸å¯¹åº”çš„å‹‹ç« æœåŠ¡</p><h4 id="ä¼˜åŒ–å‰-7"><a href="#ä¼˜åŒ–å‰-7" class="headerlink" title="ä¼˜åŒ–å‰"></a>ä¼˜åŒ–å‰</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">String medalType = <span class="string">"guest"</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">"guest"</span>.equals(medalType)) {</span><br><span class="line">    System.out.println(<span class="string">"å˜‰å®¾å‹‹ç« "</span>);</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"vip"</span>.equals(medalType)) {</span><br><span class="line">    System.out.println(<span class="string">"ä¼šå‘˜å‹‹ç« "</span>);</span><br><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"guard"</span>.equals(medalType)) {</span><br><span class="line">    System.out.println(<span class="string">"å±•ç¤ºå®ˆæŠ¤å‹‹ç« "</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="ä¼˜åŒ–å-7"><a href="#ä¼˜åŒ–å-7" class="headerlink" title="ä¼˜åŒ–å"></a>ä¼˜åŒ–å</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ªæ¡ä»¶é€»è¾‘ä»£ç å—ï¼ŒæŠ½è±¡æˆä¸€ä¸ªå…¬å…±çš„æ¥å£ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‹‹ç« æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IMedalService</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">showMedal</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬æ ¹æ®æ¯ä¸ªé€»è¾‘æ¡ä»¶ï¼Œå®šä¹‰ç›¸å¯¹åº”çš„ç­–ç•¥å®ç°ç±»ï¼Œå¯å¾—ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ˆæŠ¤å‹‹ç« ç­–ç•¥å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuardMedalServiceImpl</span> <span class="keyword">implements</span> <span class="title">IMedalService</span> </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMedal</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"å±•ç¤ºå®ˆæŠ¤å‹‹ç« "</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//å˜‰å®¾å‹‹ç« ç­–ç•¥å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuestMedalServiceImpl</span> <span class="keyword">implements</span> <span class="title">IMedalService</span> </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMedal</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"å˜‰å®¾å‹‹ç« "</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="comment">//VIPå‹‹ç« ç­–ç•¥å®ç°ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VipMedalServiceImpl</span> <span class="keyword">implements</span> <span class="title">IMedalService</span> </span>{</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showMedal</span><span class="params">()</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"ä¼šå‘˜å‹‹ç« "</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†å®šä¹‰ç­–ç•¥å·¥å‚ç±»ï¼Œç”¨æ¥ç®¡ç†è¿™äº›å‹‹ç« å®ç°ç­–ç•¥ç±»ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‹‹ç« æœåŠ¡å·¥äº§ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MedalServicesFactory</span> </span>{</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, IMedalService&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        map.put(<span class="string">"guard"</span>, <span class="keyword">new</span> GuardMedalServiceImpl());</span><br><span class="line">        map.put(<span class="string">"vip"</span>, <span class="keyword">new</span> VipMedalServiceImpl());</span><br><span class="line">        map.put(<span class="string">"guest"</span>, <span class="keyword">new</span> GuestMedalServiceImpl());</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IMedalService <span class="title">getMedalService</span><span class="params">(String medalType)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> map.get(medalType);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨äº†ç­–ç•¥+å·¥å‚æ¨¡å¼ä¹‹åï¼Œä»£ç å˜å¾—ç®€æ´å¤šäº†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        String medalType = <span class="string">"guest"</span>;</span><br><span class="line">        IMedalService medalService = MedalServicesFactory.getMedalService(medalType);</span><br><span class="line">        medalService.showMedal();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä»£ç ä¸­æ¶‰åŠåˆ°è¾ƒä¸ºå¤æ‚çš„é€»è¾‘æ˜¯ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¼šå‡ºç°å¤§é‡çš„&lt;code&gt;if-else&lt;/code&gt;ï¼Œè™½ç„¶å®ç°äº†æ•´ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯é˜…è¯»èµ·æ¥æ¯”è¾ƒè€—æ—¶ï¼Œå¹¶ä¸”ç»´æŠ¤çš„æ—¶å€™ä¹Ÿååˆ†çš„å›°éš¾ï¼ŒåŒæ—¶åªè¦æœ‰ä¸€ä¸ªåœ°æ–¹æ²¡æœ‰è€ƒè™‘æ¸…æ¥šï¼Œä¿®æ”¹èµ·æ¥å°±éš¾å…å‡ºç°&lt;code&gt;bug&lt;/code&gt;ã€‚æœ€è¿‘åœ¨åšå…¬å¸æŸä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå°±é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œç„¶ååœ¨&lt;code&gt;review&lt;/code&gt;çš„æ—¶å€™ï¼ŒåŒäº‹å’Œæˆ‘è®²äº†ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œä»¥åŠé»˜è®¤çš„è§„èŒƒä¹‹åã€‚è‡ªå·±é‡æ–°ä¿®æ”¹ä¹‹åï¼Œæ„Ÿè§‰å¾ˆèˆ’æœï¼Œåç»­è‡ªå·±é‡æ–°æ•´ç†ä¸€ä¸‹ï¼Œæ‰€ä»¥å°±å†™äº†è¿™ç¯‡åšå®¢ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ä»£ç è´¨é‡" scheme="https://winniekun.github.io/categories/%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F/"/>
    
    
    <category term="if-elseä¼˜åŒ–" scheme="https://winniekun.github.io/tags/if-else%E4%BC%98%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>lombokä»‹ç»</title>
    <link href="https://winniekun.github.io/lombok-introduce/"/>
    <id>https://winniekun.github.io/lombok-introduce/</id>
    <published>2020-10-02T12:08:21.000Z</published>
    <updated>2020-10-04T14:34:01.269Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Lombokä½¿ç”¨"><a href="#Lombokä½¿ç”¨" class="headerlink" title="Lombokä½¿ç”¨"></a>Lombokä½¿ç”¨</h2><blockquote><p>Lombokæ˜¯ä¸€æ¬¾å¥½ç”¨é¡ºæ‰‹çš„å·¥å…·ï¼Œå€¼å¾—å»å¥½å¥½å»ç†Ÿç»ƒä½¿ç”¨å’Œæ·±ç©¶ã€‚<strong>Lombokæ˜¯ä¸€ç§Javaâ„¢å®ç”¨å·¥å…·ï¼Œå¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜æ¶ˆé™¤Javaçš„å†—é•¿ä»£ç ï¼Œå°¤å…¶æ˜¯å¯¹äºç®€å•çš„Javaå¯¹è±¡ï¼ˆPOJOï¼‰ã€‚å®ƒé€šè¿‡æ³¨é‡Šå®ç°è¿™ä¸€ç›®çš„</strong>ã€‚é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­å®ç°Lombokï¼Œå¼€å‘äººå‘˜å¯ä»¥èŠ‚çœæ„å»ºè¯¸å¦‚hashCode()å’Œequals()è¿™æ ·çš„æ–¹æ³•ä»¥åŠä»¥å¾€ç”¨æ¥åˆ†ç±»å„ç§accessorå’Œmutatorçš„å¤§é‡æ—¶é—´ã€‚</p></blockquote><a id="more"></a><h2 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h2><ol><li><p>å¯¼å…¥Mavenä¾èµ–</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>${lomok.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>åœ¨IDEä¸­å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼ˆ<strong>lombok plugin</strong>ï¼‰</p></li></ol><h2 id="å¸¸ç”¨æ³¨è§£è¯¦è§£"><a href="#å¸¸ç”¨æ³¨è§£è¯¦è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£è¯¦è§£"></a>å¸¸ç”¨æ³¨è§£è¯¦è§£</h2><h3 id="ç®€åŒ–ä»£ç ï¼Œå¢åŠ å¯è¯»æ€§"><a href="#ç®€åŒ–ä»£ç ï¼Œå¢åŠ å¯è¯»æ€§" class="headerlink" title="ç®€åŒ–ä»£ç ï¼Œå¢åŠ å¯è¯»æ€§"></a>ç®€åŒ–ä»£ç ï¼Œå¢åŠ å¯è¯»æ€§</h3><h4 id="Getter-amp-Setter"><a href="#Getter-amp-Setter" class="headerlink" title="@Getter&amp;@Setter"></a>@Getter&amp;@Setter</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>é€šè¿‡<code>@Getterå’Œ@Setter</code>ä¹‹åï¼Œå…¶å°±ç±»ä¼¼äºå¦‚ä¸‹çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Persons</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(String age)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h4><p>å…¶ç­‰åŒäºå¦‚ä¸‹çš„å‡ ä¸ªæ³¨è§£ï¼Œä½¿ç”¨çš„é¢‘ç‡æœ€é«˜</p><ul><li>@Getter/@Setter</li><li>@ToString</li><li>@EqualsAndHashCode</li><li>@RequiredArgsConstructor</li></ul><h4 id="Buider"><a href="#Buider" class="headerlink" title="@Buider"></a>@Buider</h4><p>è‡ªåŠ¨ç”Ÿæˆæµå¼setå†™æ³•ï¼Œèƒ½å¤Ÿå¿«é€Ÿçš„è®¾å®š<code>Object</code>å€¼ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶è¯¥æ–¹æ³•å¾ˆå¥½ï¼Œä½†æ˜¯å› ä¸ºå¤§å¤šæ•°çš„æ¡†æ¶éƒ½ä½¿ç”¨åˆ°äº†<code>set</code>æ–¹æ³•è¿›è¿›è¡Œæ³¨å…¥ï¼Œ<strong>æ‰€ä»¥åœ¨å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å°†<code>@Builder</code>å’Œ<code>@Data</code>ä¸€èµ·ä½¿ç”¨</strong>ã€‚</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹ä¾¿æŸ¥çœ‹è¾“å‡ºå¯¹è±¡</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        Person person = Person.builder().age(<span class="string">"11"</span>).id(<span class="number">1</span>).name(<span class="string">"wkk"</span>).build();</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//Builderçš„ä½¿ç”¨ç­‰åŒäºå¦‚ä¸‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonBuilder</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> Integer id;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">        PersonBuilder() {</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Person.<span class="function">PersonBuilder <span class="title">id</span><span class="params">(Integer id)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Person.<span class="function">PersonBuilder <span class="title">name</span><span class="params">(String name)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Person.<span class="function">PersonBuilder <span class="title">age</span><span class="params">(String age)</span> </span>{</span><br><span class="line">            <span class="keyword">this</span>.age = age;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Person <span class="title">build</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="keyword">this</span>.id, <span class="keyword">this</span>.name, <span class="keyword">this</span>.age);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Person.PersonBuilder(id="</span> + <span class="keyword">this</span>.id + <span class="string">", name="</span> + <span class="keyword">this</span>.name + <span class="string">", age="</span> + <span class="keyword">this</span>.age + <span class="string">")"</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><h3 id="æ—¥å¿—ä½¿ç”¨"><a href="#æ—¥å¿—ä½¿ç”¨" class="headerlink" title="æ—¥å¿—ä½¿ç”¨"></a>æ—¥å¿—ä½¿ç”¨</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åšæ—¥å¿—å¤„ç†ï¼Œéƒ½ä¼šå…ˆç”Ÿæˆä¸€ä¸ªLoggerçš„é™æ€å¸¸é‡ï¼Œä½¿ç”¨<code>@Slf4j</code>ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œå…¨ä¸ç”¨newä¸€ä¸ªè¯¥å¸¸é‡äº†ã€‚</p> <figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(Person<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>{</span><br><span class="line">      logger.info(<span class="string">"logger: {}"</span>, <span class="string">"aaaa"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lombokå®ç°</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"fsda"</span>);</span><br><span class="line">        log.info(<span class="string">"Person: {}"</span>, <span class="string">"fdsa"</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æµå¼å¯¹è±¡çš„å…³é—­"><a href="#æµå¼å¯¹è±¡çš„å…³é—­" class="headerlink" title="æµå¼å¯¹è±¡çš„å…³é—­"></a><del>æµå¼å¯¹è±¡çš„å…³é—­</del></h3>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Lombokä½¿ç”¨&quot;&gt;&lt;a href=&quot;#Lombokä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;Lombokä½¿ç”¨&quot;&gt;&lt;/a&gt;Lombokä½¿ç”¨&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;Lombokæ˜¯ä¸€æ¬¾å¥½ç”¨é¡ºæ‰‹çš„å·¥å…·ï¼Œå€¼å¾—å»å¥½å¥½å»ç†Ÿç»ƒä½¿ç”¨å’Œæ·±ç©¶ã€‚&lt;strong&gt;Lombokæ˜¯ä¸€ç§Javaâ„¢å®ç”¨å·¥å…·ï¼Œå¯ç”¨æ¥å¸®åŠ©å¼€å‘äººå‘˜æ¶ˆé™¤Javaçš„å†—é•¿ä»£ç ï¼Œå°¤å…¶æ˜¯å¯¹äºç®€å•çš„Javaå¯¹è±¡ï¼ˆPOJOï¼‰ã€‚å®ƒé€šè¿‡æ³¨é‡Šå®ç°è¿™ä¸€ç›®çš„&lt;/strong&gt;ã€‚é€šè¿‡åœ¨å¼€å‘ç¯å¢ƒä¸­å®ç°Lombokï¼Œå¼€å‘äººå‘˜å¯ä»¥èŠ‚çœæ„å»ºè¯¸å¦‚hashCode()å’Œequals()è¿™æ ·çš„æ–¹æ³•ä»¥åŠä»¥å¾€ç”¨æ¥åˆ†ç±»å„ç§accessorå’Œmutatorçš„å¤§é‡æ—¶é—´ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="java" scheme="https://winniekun.github.io/categories/java/"/>
    
    
    <category term="åŸºç¡€" scheme="https://winniekun.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>2020å®ä¹ å‰çš„æ€»ç»“</title>
    <link href="https://winniekun.github.io/before-internship/"/>
    <id>https://winniekun.github.io/before-internship/</id>
    <published>2020-09-06T11:11:50.000Z</published>
    <updated>2020-10-01T15:12:36.296Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>2020å¹´2æœˆåº•ï¼Œåœ¨è‡ªå·±ç¡®å®šè¦æ‰¾å®ä¹ çš„æ—¶å€™ï¼Œå¼€å§‹å’Œå¥³æœ‹å‹å“­è¯‰æ‰€å®³æ€•è‡ªå·±æ‰¾ä¸åˆ°å®ä¹ ï¼Œæ²¡æœ‰å…¬å¸è¦æˆ‘ï¼Œæˆ‘å¤ªèœäº†ç­‰ç­‰ç­‰ã€‚ç»è¿‡è€—æ—¶åŠå¹´çš„æ—¶é—´ï¼Œç»ˆäºç¡®å®šä¸‹æ¥çš„äº†å®ä¹ åœ°ç‚¹å’Œå®ä¹ å…¬å¸ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æŒºå¥½ç©å„¿çš„ï¼Œæ‰€ä»¥å°±è®°å½•ä¸‹æ¥å§ã€‚</p><a id="more"></a><h2 id="ç°åœ¨"><a href="#ç°åœ¨" class="headerlink" title="ç°åœ¨"></a>ç°åœ¨</h2><p>æŒºå°´å°¬çš„ï¼Œæœ¬æ¥æƒ³ç€å†å®ä¹ ä¹‹å‰æŠŠæ–‡ç« å†™å¥½ï¼Œä½†æ˜¯åé¢æœ‰åˆ«çš„äº‹æƒ…å°±æ²¡æœ‰æ¥å¾—åŠå†™ï¼Œæœ€åæƒ³å†™çš„æ—¶å€™ï¼Œå‘ç°<code>hexo</code>å‡ºé—®é¢˜äº†ã€‚æ‰€ä»¥å°±ä¸€ç›´æ‹–åˆ°äº†å›½åº†å‡æœŸï¼ŒæŠ½äº†ç‚¹æ—¶é—´æ”¹æ”¹ï¼Œç»ˆäºåˆèƒ½é‡æ–°å†™blogäº†ã€‚</p><p>ç›®å‰å·²ç»åœ¨NIOå®ä¹ ä¸¤å‘¨äº†ï¼Œç¬¬ä¸€å‘¨è¿˜å¥½ï¼Œå°±æ˜¯çœ‹çœ‹å…¬å¸æ–‡æ¡£ï¼Œç„¶åæŒ‰ç…§éœ€æ±‚å®Œå–„äº†ä¸€ä¸ªæ¥å£ï¼Œåé¢è€å¸ˆå®‰æ’æˆ‘çœ‹å‡ ä¸ªèŠ‚ç‚¹çš„ä»£ç ï¼Œç„¶åä¿®å¤<code>sonarQube</code>ä¸Šæ£€æµ‹å‡ºçš„<code>Bug</code>ã€‚ç¬¬äºŒå‘¨å°±å¼€å§‹å¿™ç¢Œäº†ï¼Œåˆšå¥½æ’æœŸï¼Œåˆ†é…äº†æˆ‘è¿˜æŒºå¤šçš„ä»»åŠ¡ï¼Œå¸Œæœ›èƒ½åšçš„åˆå¥½åˆæ£’ã€‚</p><p>æ”¾å¼ æˆ‘æ‰€åœ¨æ¥¼çš„å‰å°ï¼Œæ„Ÿè§‰è¿˜æŒºå¥½çœ‹çš„ï¼ˆå‡æœŸå‰ä¸€å¤©èµ°çš„æ™šï¼Œåˆšå¥½æ²¡æœ‰å¤šå°‘äººï¼Œé¡ºæ‰‹æ‹çš„<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼‰ã€‚</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/10/01/87TWFU4HfEacrxw.jpg" alt="NIO" title="">                </div>                <div class="image-caption">NIO</div>            </figure><p>å›½åº†å‡æœŸäººæ˜¯çœŸçš„å¤šï¼Œè™¹æ¡¥è½¦ç«™çˆ†æ»¡ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè„‘å­é‡Œç«Ÿç„¶æ˜¯é‡œå±±è¡Œçš„ç”»é¢â€¦</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/10/01/aob7WsqUM2pTzxi.jpg" alt="è™¹æ¡¥ç«è½¦ç«™" title="">                </div>                <div class="image-caption">è™¹æ¡¥ç«è½¦ç«™</div>            </figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é¢è¯•çœŸçš„å¹¶ä¸å¯æ€•ï¼Œå¤§ä¸äº†å°±æ˜¯ç»™é¢è¯•å®˜æ„Ÿè§‰ä½ ä¸è¡Œï¼Œåœ¨é¢è¯•å®˜é¢å‰å°¬èŠä¸€ä¸ªå°æ—¶ï¼Œå…¶ä»–çš„çœŸçš„æ²¡ä»€ä¹ˆã€‚é¢å¤šäº†å°±æ„Ÿè§‰è¿˜æŒºå¥½ç©å„¿çš„ï¼ˆå°±æ˜¯æ¯æ¬¡é¢è¯•å‰è¿˜æ˜¯ä¼šç´§å¼ å¥½é•¿æ—¶é—´ï¼‰ã€‚é¢è¯•æœŸé—´ï¼Œæ„Ÿè§‰æœ‰ä¸€äº›é—®é¢˜å¹¶æ²¡æœ‰æ ‡å‡†çš„ç­”æ¡ˆï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å’Œé¢è¯•å®˜è®¨è®ºçš„å½¢å¼é˜è¿°è‡ªå·±çš„è§‚ç‚¹ã€‚æœ€åå°±æ˜¯è®°å¾—é¢è¯•ååšå¥½å¤ç›˜ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å¸®åŠ©è‡ªå·±æŸ¥ç¼ºè¡¥æ¼ï¼Œè¿˜èƒ½è®©è‡ªå·±èƒ½å¤Ÿæ›´å¥½çš„æ¢³ç†çŸ¥è¯†ç‚¹ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;2020å¹´2æœˆåº•ï¼Œåœ¨è‡ªå·±ç¡®å®šè¦æ‰¾å®ä¹ çš„æ—¶å€™ï¼Œå¼€å§‹å’Œå¥³æœ‹å‹å“­è¯‰æ‰€å®³æ€•è‡ªå·±æ‰¾ä¸åˆ°å®ä¹ ï¼Œæ²¡æœ‰å…¬å¸è¦æˆ‘ï¼Œæˆ‘å¤ªèœäº†ç­‰ç­‰ç­‰ã€‚ç»è¿‡è€—æ—¶åŠå¹´çš„æ—¶é—´ï¼Œç»ˆäºç¡®å®šä¸‹æ¥çš„äº†å®ä¹ åœ°ç‚¹å’Œå®ä¹ å…¬å¸ï¼Œæ„Ÿè§‰æ•´ä¸ªè¿‡ç¨‹è¿˜æŒºå¥½ç©å„¿çš„ï¼Œæ‰€ä»¥å°±è®°å½•ä¸‹æ¥å§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ç¢ç¢å¿µ" scheme="https://winniekun.github.io/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="æ‚è°ˆ" scheme="https://winniekun.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>PriorityQueueæºç è§£è¯»</title>
    <link href="https://winniekun.github.io/PriorityQueue-analysis/"/>
    <id>https://winniekun.github.io/PriorityQueue-analysis/</id>
    <published>2020-08-21T12:00:56.000Z</published>
    <updated>2021-02-27T06:27:56.924Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PriorityQueueæºç è§£è¯»"><a href="#PriorityQueueæºç è§£è¯»" class="headerlink" title="PriorityQueueæºç è§£è¯»"></a>PriorityQueueæºç è§£è¯»</h2><a id="more"></a><p>ä¼˜å…ˆé˜Ÿåˆ—, é¡¾åæ€ä¹‰å°±æ˜¯æŒ‰ç…§å…ƒç´ çš„ä¼˜å…ˆçº§è¿›è¡Œå¼¹å‡ºç­‰æ“ä½œ, é‚£ä¹ˆåœ¨JDKä¸­ä½¿ç”¨ä½•ç§æ•°æ®ç»“æ„æ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—å˜, Letâ€™s Go</p><h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/08/21/QOjliBWZwrHo72m.png" alt="PriorityQueue" title="">                </div>                <div class="image-caption">PriorityQueue</div>            </figure><p>emmm, æ„Ÿè§‰ä»ä¾èµ–ä¸Šæ¥çœ‹, å’Œå…¶ä»–çš„é›†åˆç±»ä¸€æ ·, å®ç°å…¶å¯¹åº”çš„æ¥å£(Marker Interfaceçš„ä½œç”¨?)</p><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>åœ¨é˜…è¯»åŸºç¡€çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å †ï¼Œå…¶æ•°æ®ç»“æ„æ˜¯å•¥ï¼Œæœ‰å“ªäº›å­˜å‚¨æ–¹å¼ã€‚</p><ol><li>å †çš„åº•å±‚æ•°æ®ç»“æ„ä¸º<strong>å®Œå…¨äºŒå‰æ ‘</strong></li><li>å­˜å‚¨æ–¹å¼ï¼ˆæ—¢ç„¶æ˜¯äºŒå‰æ ‘ï¼Œé‚£ä¹ˆå…¶å­˜å‚¨æ–¹å¼ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§ï¼‰<ol><li>é¡ºåºå­˜å‚¨ç»“æ„<ol><li>æ ¹èŠ‚ç‚¹ä¸‹æ ‡ä¸º0</li><li>è‹¥èŠ‚ç‚¹pçš„ä¸‹æ ‡ä¸º$i$ï¼Œåˆ™å·¦å­©å­$2\cdot i + 1$ å³å­©å­ä¸º$2\cdoti + 2$ </li><li>è‹¥èŠ‚ç‚¹pçš„ä¸‹æ ‡ä¸º$i$ï¼Œåˆ™çˆ¶èŠ‚ç‚¹çš„ä¸‹æ ‡ä¸º$\lfloor i/2\rfloor$</li></ol></li><li>é“¾å¼å­˜å‚¨ç»“æ„</li></ol></li></ol><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2021/02/26/lrUPGcnu1EvSwy8.png" alt="image-20210226230402719" title="">                </div>                <div class="image-caption">image-20210226230402719</div>            </figure><p>ç”±ä¸Šè¿°çš„é¡ºåºå­˜å‚¨ç»“æ„å¯çŸ¥ï¼Œå †æ˜¯ç”¨<strong>ç‰©ç†ä¸Šçš„çº¿æ€§è¡¨ç¤ºé€»è¾‘ä¸Šçš„éçº¿æ€§çš„æ•°æ®ç»“æ„</strong></p><p>å…·ä½“çš„å…³äºå †çš„æ“ä½œï¼Œå¦‚åˆšå¼€å§‹çš„å»ºå †ï¼Œä»¥åŠæ’å…¥å…ƒç´ ï¼Œåˆ é™¤å †é¡¶å…ƒç´ ï¼Œè¿­ä»£ç­‰æ“ä½œï¼Œå¯è‡ªè¡Œç™¾åº¦ã€‚</p><h2 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤åˆå§‹åŒ–å®¹é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">11</span>;</span><br><span class="line"><span class="comment">// åº•å±‚ä½¿ç”¨Object[]æ•°ç»„å®ç°, å’ŒArrayListè¿™äº›ä¸€æ ·</span></span><br><span class="line"><span class="keyword">transient</span> Object[] queue; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line"><span class="comment">// æ ‡è®°å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// æ¯”è¾ƒå™¨, è¯´æ˜å…¶å®ä¾‹å‡æ˜¯å¯æ¯”è¾ƒçš„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;? <span class="keyword">super</span> E&gt; comparator;</span><br></pre></td></tr></tbody></table></figure><p>å› ä¸ºåº•å±‚ä½¿ç”¨çš„æ˜¯æ•°ç»„ï¼ŒåŒæ—¶å…¶æœ¬èº«æ˜¯æ”¯æŒåŠ¨æ€æ’å…¥å’Œåˆ é™¤çš„ï¼Œæ‰€ä»¥åŒç†ï¼Œå’Œ<strong>ArrayList</strong>åŒç†ï¼Œæ‰©å®¹åº”è¯¥æ˜¯å…¶æ ¸å¿ƒçš„åœ°æ–¹ã€‚åŒæ—¶ä¹Ÿè¦å…³æ³¨å…¶æ˜¯å¦ç”Ÿæˆæ–°çš„æ•°ç»„å¯¹è±¡ã€‚</p><h2 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h2><h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue()"></a>PriorityQueue()</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, <span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="PriorityQueue-int-initialCapacity"><a href="#PriorityQueue-int-initialCapacity" class="headerlink" title="PriorityQueue(int initialCapacity)"></a>PriorityQueue(int initialCapacity)</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>(initialCapacity, <span class="keyword">null</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="PriorityQueue-Comparator-lt-super-E-gt-comparator"><a href="#PriorityQueue-Comparator-lt-super-E-gt-comparator" class="headerlink" title="PriorityQueue(Comparator<? super E> comparator)"></a>PriorityQueue(Comparator&lt;? super E&gt; comparator)</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(Comparator&lt;? <span class="keyword">super</span> E&gt; comparator)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>(DEFAULT_INITIAL_CAPACITY, comparator);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="PriorityQueue-int-initialCapacity-Comparator-lt-super-E-gt-comparator"><a href="#PriorityQueue-int-initialCapacity-Comparator-lt-super-E-gt-comparator" class="headerlink" title="PriorityQueue(int initialCapacity, Comparator<? super E> comparator)"></a>PriorityQueue(int initialCapacity, Comparator&lt;? super E&gt; comparator)</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PriorityQueue</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">                     Comparator&lt;? <span class="keyword">super</span> E&gt; comparator)</span> </span>{</span><br><span class="line">    <span class="comment">// Note: This restriction of at least one is not actually needed,</span></span><br><span class="line">    <span class="comment">// but continues for 1.5 compatibility</span></span><br><span class="line">    <span class="keyword">if</span> (initialCapacity &lt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">this</span>.queue = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">    <span class="keyword">this</span>.comparator = comparator;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿˜æœ‰å‡ ä¸ªæ„é€ å‡½æ•°ä¸»è¦æ˜¯ç”¨äºå°†åŸå„ç§ç±»å‹çš„æ•°æ®æ”¾å…¥<code>PriorityQueue</code>ä¸­</p><h2 id="å¢-å…¥é˜Ÿ"><a href="#å¢-å…¥é˜Ÿ" class="headerlink" title="å¢(å…¥é˜Ÿ)"></a>å¢(å…¥é˜Ÿ)</h2><p>åœ¨é˜…è¯»è¿™äº›æ–¹æ³•çš„æ—¶å€™, æƒ³èµ·æ¥è‡ªå·±æ‰‹æ’•ç®—æ³•çš„æ—¶å€™, ç»å¸¸ä¼šè®°æ··<code>List</code>, <code>Stack</code>, <code>Queue</code>, <code>Map</code>è¿™äº›çš„æ·»åŠ åˆ é™¤æ“ä½œçš„APIâ€¦</p><p>ä¸‹é¢ç½—åˆ—çš„æ˜¯ä¸ªäººè§‰å¾—ä¸é”™çš„ä»£è¡¨æ•°æ®ç»“æ„ç‰¹æ€§çš„æ·»åŠ /åˆ é™¤æ“ä½œçš„API</p><table><thead><tr><th align="left">æ•°æ®ç»“æ„</th><th>æ·»åŠ </th><th>åˆ é™¤</th></tr></thead><tbody><tr><td align="left">List/Set</td><td>add()</td><td>remove()</td></tr><tr><td align="left">Stack</td><td>push()</td><td>pop()</td></tr><tr><td align="left">Queue</td><td>offer()</td><td>poll()</td></tr><tr><td align="left">Map</td><td>put()</td><td>remove()</td></tr></tbody></table><h3 id="offer"><a href="#offer" class="headerlink" title="offer()"></a>offer()</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="keyword">int</span> i = size;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= queue.length)</span><br><span class="line">        grow(i + <span class="number">1</span>);</span><br><span class="line">    size = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        queue[<span class="number">0</span>] = e;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        siftUp(i, e);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å®è§‚ä¸Šæ¥çœ‹, offer()æ–¹æ³•ä¼šå…ˆæ£€æµ‹æ˜¯å¦éœ€è¦æ‰©å®¹, ä¹‹åå†æ’å…¥å…ƒç´ , æœ€åè¿›è¡Œè°ƒæ•´</p><h2 id="åˆ -å‡ºé˜Ÿ"><a href="#åˆ -å‡ºé˜Ÿ" class="headerlink" title="åˆ (å‡ºé˜Ÿ)"></a>åˆ (å‡ºé˜Ÿ)</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> s = --size;</span><br><span class="line">    modCount++;</span><br><span class="line">    E result = (E) queue[<span class="number">0</span>];</span><br><span class="line">    E x = (E) queue[s];</span><br><span class="line">    queue[s] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="number">0</span>)</span><br><span class="line">        siftDown(<span class="number">0</span>, x);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="è·å–é˜Ÿå¤´å…ƒç´ "><a href="#è·å–é˜Ÿå¤´å…ƒç´ " class="headerlink" title="è·å–é˜Ÿå¤´å…ƒç´ "></a>è·å–é˜Ÿå¤´å…ƒç´ </h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">peek</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> (size == <span class="number">0</span>) ? <span class="keyword">null</span> : (E) queue[<span class="number">0</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="siftUpåŸç†"><a href="#siftUpåŸç†" class="headerlink" title="siftUpåŸç†"></a>siftUpåŸç†</h2><p>å‡è®¾åœ¨æ•°ç»„queueçš„kä½ç½®æ’å…¥å…ƒç´ keyï¼ˆå°æ ¹å †ï¼‰</p><ul><li>ä¸æ–­çš„æ¯”è¾ƒkeyå’Œkçš„çˆ¶èŠ‚ç‚¹e ï¼ˆ$queue\lfloor(k-1/2\rfloor)$ï¼‰çš„å…³ç³»<ol><li>è‹¥$key  &lt;  e$ ï¼Œåˆ™$queue[k] = e$, åŒæ—¶$k$å›æº¯è‡³$e$</li><li>è‹¥$key \geq e$ æˆ–è€…  $k$å·²ç»åˆ°è¾¾è·ŸèŠ‚ç‚¹ï¼Œåˆ™ç»“æŸå¾ªç¯</li></ol></li><li>$queue[k]==e$</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰ç…§å¤§æ„å†™çš„ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">siftUp</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">  Comparable&lt;? <span class="keyword">super</span> E&gt; key = (Comparable&lt;? <span class="keyword">super</span> E&gt;) x;</span><br><span class="line">  <span class="keyword">while</span> (k &gt; <span class="number">0</span>) {</span><br><span class="line">    <span class="keyword">int</span> parent = (k-<span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    Object e = queue[parent];</span><br><span class="line">    <span class="comment">// å¯ä½¿ç”¨compareTo</span></span><br><span class="line">    <span class="keyword">if</span> (key &gt; e) {</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">    k = parent;</span><br><span class="line">    queue[k] = e;</span><br><span class="line">  }</span><br><span class="line">queue[k] = key;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="siftDownåŸç†"><a href="#siftDownåŸç†" class="headerlink" title="siftDownåŸç†"></a>siftDownåŸç†</h2><p>è‡ªé¡¶å‘ä¸‹ï¼Œé€‰æ‹©å°çš„èŠ‚ç‚¹ï¼Œä¸æ–­çš„æ¯”è¾ƒã€äº¤æ¢ï¼Œç›´åˆ°ï¼š</p><ol><li>ä¸‹æ ‡è¶Šç•Œ</li><li>èŠ‚ç‚¹çš„å€¼åŒæ—¶å°äºç­‰äºå·¦å­©å­å’Œå³å­©å­</li></ol><p>å‡è®¾æ•°ç»„queueæœ€åä¸€ä¸ªå…ƒç´ çš„å€¼ä¸ºkeyï¼ˆå°æ ¹å †ï¼‰ï¼Œä¸‹æ ‡kä»0å¼€å§‹ï¼Œå½“kå­˜åœ¨å·¦å­©å­æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å¾ªç¯ï¼š</p><ul><li> è‹¥kæœ‰å³å­©å­ï¼Œåˆ™æ¯”è¾ƒå·¦å³å­©å­çš„å€¼ï¼Œç„¶åé€‰å‡ºå°çš„å­©å­child</li><li>æ¯”è¾ƒkeyå’Œc=queue[child]çš„å¤§å°<ol><li>è‹¥$key \leq c$ ç»“æŸå¾ªç¯</li><li>è‹¥$key &gt; c$, åˆ™$queue[k] = c, k = child$ï¼Œ ç»§ç»­å¾ªç¯</li></ol></li><li>$queue[k] = key$</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">siftDown</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>{</span><br><span class="line">  Comparable&lt;? <span class="keyword">super</span> E&gt; key = (Comparable&lt;? <span class="keyword">super</span> E&gt;) x;</span><br><span class="line">  <span class="comment">// å®Œå…¨äºŒå‰æ ‘ æ³¨æ„æ˜¯ </span></span><br><span class="line">  <span class="keyword">int</span> half = size &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (k &lt; half) {</span><br><span class="line">    <span class="keyword">int</span> left = (k &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">    Object c = queue[left];</span><br><span class="line">    <span class="keyword">int</span> right = left + <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">if</span> (right &lt; size &amp;&amp; c &gt; queue[right]) {</span><br><span class="line">      c = queue[child = right];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (key &lt; c) {</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    }</span><br><span class="line">   queue[k] = c;</span><br><span class="line">    k = child;</span><br><span class="line">  }</span><br><span class="line">  queue[k] = key;</span><br><span class="line">  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="æ‰©å®¹ç­–ç•¥"><a href="#æ‰©å®¹ç­–ç•¥" class="headerlink" title="æ‰©å®¹ç­–ç•¥"></a>æ‰©å®¹ç­–ç•¥</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;PriorityQueueæºç è§£è¯»&quot;&gt;&lt;a href=&quot;#PriorityQueueæºç è§£è¯»&quot; class=&quot;headerlink&quot; title=&quot;PriorityQueueæºç è§£è¯»&quot;&gt;&lt;/a&gt;PriorityQueueæºç è§£è¯»&lt;/h2&gt;</summary>
    
    
    
    <category term="æºç " scheme="https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="JDKæºç " scheme="https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"/>
    
    <category term="Queue" scheme="https://winniekun.github.io/tags/Queue/"/>
    
  </entry>
  
  <entry>
    <title>æ­»ç£•å›¾</title>
    <link href="https://winniekun.github.io/stick-to-graph/"/>
    <id>https://winniekun.github.io/stick-to-graph/</id>
    <published>2020-08-20T00:59:56.000Z</published>
    <updated>2020-08-30T04:50:22.250Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>LeetCodeæ­»ç£•ç³»åˆ—ä¹ï¼š å›¾</p><p>è¯´å®è¯å›¾ç›®å‰é‡åˆ°çš„é¢˜ç›®ç±»å‹ä¸å¤š, å†åŠ ä¸Šä»Šå¹´å›¾è®ºè¯¾ç¨‹ä¸Šçš„ä¸€äº›ç®—æ³•, åªèƒ½è¯´ç®—æ˜¯è¦†ç›–äº†å›¾ç›¸å…³çš„ä¸€ä¸¢ä¸¢çš„å†…å®¹<span class="github-emoji"><span>ğŸ˜„</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p><p>æœ€è¿‘LeetCodeæ¯æ—¥ä¸€é¢˜, é‡åˆ°äº†è¾ƒå¤šçš„å›¾éå†(æ·±åº¦éå†, å¹¿åº¦éå†)é—®é¢˜, æ„Ÿè§‰æ˜¯æœ‰è¿¹å¯å¾ªçš„, æ‰€ä»¥åšä¸€ä¸‹æ•´ç†å§.</p><a id="more"></a><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><ol><li><p><a href="https://leetcode-cn.com/problems/surrounded-regions/" target="_blank" rel="noopener">130. è¢«å›´ç»•çš„åŒºåŸŸ</a></p></li><li><p><a href="https://leetcode-cn.com/problems/clone-graph/" target="_blank" rel="noopener">133. å…‹éš†å›¾</a></p></li><li><p><a href="https://leetcode-cn.com/problems/flood-fill/" target="_blank" rel="noopener">733. å›¾åƒæ¸²æŸ“</a></p></li><li><p><a href="https://leetcode-cn.com/problems/minesweeper/" target="_blank" rel="noopener">529. æ‰«é›·æ¸¸æˆ</a></p></li></ol><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;LeetCodeæ­»ç£•ç³»åˆ—ä¹ï¼š å›¾&lt;/p&gt;
&lt;p&gt;è¯´å®è¯å›¾ç›®å‰é‡åˆ°çš„é¢˜ç›®ç±»å‹ä¸å¤š, å†åŠ ä¸Šä»Šå¹´å›¾è®ºè¯¾ç¨‹ä¸Šçš„ä¸€äº›ç®—æ³•, åªèƒ½è¯´ç®—æ˜¯è¦†ç›–äº†å›¾ç›¸å…³çš„ä¸€ä¸¢ä¸¢çš„å†…å®¹&lt;span class=&quot;github-emoji&quot;&gt;&lt;span&gt;ğŸ˜„&lt;/span&gt;&lt;img src=&quot;https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8&quot; aria-hidden=&quot;true&quot; onerror=&quot;this.parent.classList.add(&#39;github-emoji-fallback&#39;)&quot;&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘LeetCodeæ¯æ—¥ä¸€é¢˜, é‡åˆ°äº†è¾ƒå¤šçš„å›¾éå†(æ·±åº¦éå†, å¹¿åº¦éå†)é—®é¢˜, æ„Ÿè§‰æ˜¯æœ‰è¿¹å¯å¾ªçš„, æ‰€ä»¥åšä¸€ä¸‹æ•´ç†å§.&lt;/p&gt;</summary>
    
    
    
    <category term="LeetCode" scheme="https://winniekun.github.io/categories/LeetCode/"/>
    
    
    <category term="æ­»ç£•ç³»åˆ—" scheme="https://winniekun.github.io/tags/%E6%AD%BB%E7%A3%95%E7%B3%BB%E5%88%97/"/>
    
    <category term="dfs" scheme="https://winniekun.github.io/tags/dfs/"/>
    
    <category term="bfs" scheme="https://winniekun.github.io/tags/bfs/"/>
    
  </entry>
  
  <entry>
    <title>ArrayDeque-analysis</title>
    <link href="https://winniekun.github.io/ArrayDeque-analysis/"/>
    <id>https://winniekun.github.io/ArrayDeque-analysis/</id>
    <published>2020-07-08T07:27:56.000Z</published>
    <updated>2020-08-30T04:50:22.257Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h2><a id="more"></a><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/08/3I9zKjOpsNvPdMw.png" alt="ArrayDequeä¾èµ–" title="">                </div>                <div class="image-caption">ArrayDequeä¾èµ–</div>            </figure><p>å®ç°äº†Dequeæ¥å£, Serializableæ¥å£, Cloneableæ¥å£, ç»§æ‰¿äº†AbstractCollectionç±», åŒæ—¶å¯ä»¥çœ‹åˆ°çš„æ˜¯Dequeæ¥å£ç»§æ‰¿è‡ªQueueæ¥å£, å®ƒæ˜¯å¯¹Queueçš„ä¸€ç§å¢å¼º. Deque æ¥å£çš„å®ç°ç±»å¯ä»¥è¢«å½“ä½œ FIFOï¼ˆé˜Ÿåˆ—ï¼‰ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œ LIFOï¼ˆæ ˆï¼‰æ¥ä½¿ç”¨</p><h2 id="Queueå’ŒDeque"><a href="#Queueå’ŒDeque" class="headerlink" title="Queueå’ŒDeque"></a>Queueå’ŒDeque</h2><p>Dequeæ˜¯å¯¹Queueçš„å¢å¼º, æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸‹Queueçš„å…·ä½“è®¾è®¡:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ </span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ·»åŠ  ä¸åŒçš„å®ç°ä½¿ç”¨çš„æ·»åŠ æ–¹å¼ä¸åŒ</span></span><br><span class="line">    <span class="comment">// listä½¿ç”¨add</span></span><br><span class="line">    <span class="comment">// queueä½¿ç”¨offer</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤</span></span><br><span class="line">    <span class="function">E <span class="title">remove</span><span class="params">()</span></span>;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">// å¼¹å‡º</span></span><br><span class="line">    <span class="function">E <span class="title">poll</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">element</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·å–å¤´éƒ¨æ•°æ®</span></span><br><span class="line">    <span class="function">E <span class="title">peek</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Dequeçš„è®¾è®¡</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Deque</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Queue</span>&lt;<span class="title">E</span>&gt; </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offerFirst</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offerLast</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">removeFirst</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">removeLast</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">pollFirst</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">pollLast</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">getFirst</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">getLast</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="function">E <span class="title">peekFirst</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="function">E <span class="title">peekLast</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeFirstOccurrence</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">removeLastOccurrence</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function">E <span class="title">remove</span><span class="params">()</span></span>;</span><br><span class="line">  </span><br><span class="line">    <span class="function">E <span class="title">poll</span><span class="params">()</span></span>;</span><br><span class="line">   </span><br><span class="line">    <span class="function">E <span class="title">element</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">peek</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// *** æ ˆ ***//</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">E <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// *** Collectionä¸­çš„æ–¹æ³• ***</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(Object o)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterator&lt;E&gt; <span class="title">descendingIterator</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>Dequeä¸­æ–°å¢äº†ä»¥ä¸‹å‡ ç±»æ–¹æ³•ï¼š</p><ol><li>*Firstï¼Œè¡¨ç¤ºä»é˜Ÿåˆ—å¤´æ“ä½œå…ƒç´ ï¼›</li><li>*Lastï¼Œè¡¨ç¤ºä»é˜Ÿåˆ—å°¾æ“ä½œå…ƒç´ ï¼›</li><li>*push(e)ï¼Œpop()ï¼Œä»¥æ ˆçš„æ–¹å¼æ“ä½œå…ƒç´ çš„æ–¹æ³•ï¼›</li></ol><p>å…¶æŠ½è±¡çš„æ ·å­</p><h2 id="å­—æ®µ-amp-å±æ€§"><a href="#å­—æ®µ-amp-å±æ€§" class="headerlink" title="å­—æ®µ&amp;å±æ€§"></a>å­—æ®µ&amp;å±æ€§</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åº•å±‚ä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ </span></span><br><span class="line"><span class="keyword">transient</span> Object[] elements; <span class="comment">// non-private to simplify nested class access</span></span><br><span class="line"><span class="comment">// é˜Ÿåˆ—å¤´ä½ç½®</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> head;</span><br><span class="line"><span class="comment">// é˜Ÿåˆ—å°¾ä½ç½®</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> tail;</span><br><span class="line"><span class="comment">// æœ€å°åˆå§‹å®¹é‡</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_INITIAL_CAPACITY = <span class="number">8</span>;</span><br></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨æ•°ç»„å­˜å‚¨å…ƒç´ , é»˜è®¤çš„æœ€å°åˆå§‹åŒ–å®¹é‡ä¸º8, åŒæ—¶æœ‰å¤´å°¾ä¸¤ä¸ªæ ‡è®°ä½</p><h2 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤æ„é€ å‡½æ•°æ•°ç»„å®¹é‡ä¸º16</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">()</span> </span>{</span><br><span class="line">    elements = <span class="keyword">new</span> Object[<span class="number">16</span>];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šåˆå§‹å®¹é‡æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>{</span><br><span class="line">    allocateElements(numElements);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†é›†åˆcä¸­çš„å…ƒç´ åˆå§‹åŒ–åˆ°æ•°ç»„ä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayDeque</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>{</span><br><span class="line">    allocateElements(c.size());</span><br><span class="line">    addAll(c);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ•°ç»„</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">allocateElements</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>{</span><br><span class="line">    elements = <span class="keyword">new</span> Object[calculateSize(numElements)];</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// å’ŒHashMapçš„ç±»ä¼¼, æ±‚å¤§äºä¸”æœ€æ¥è¿‘numelemnetsçš„2çš„å¹‚æ¬¡ä¸”ä¸å°äº8</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">calculateSize</span><span class="params">(<span class="keyword">int</span> numElements)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> initialCapacity = MIN_INITIAL_CAPACITY;</span><br><span class="line">    <span class="keyword">if</span> (numElements &gt;= initialCapacity) {</span><br><span class="line">        initialCapacity = numElements;</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">1</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">2</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">4</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt;  <span class="number">8</span>);</span><br><span class="line">        initialCapacity |= (initialCapacity &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">        initialCapacity++;</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)   <span class="comment">// Too many elements, must back off</span></span><br><span class="line">            initialCapacity &gt;&gt;&gt;= <span class="number">1</span>;<span class="comment">// Good luck allocating 2 ^ 30 elements</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> initialCapacity;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>é€šè¿‡æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬çŸ¥é“é»˜è®¤åˆå§‹å®¹é‡æ˜¯16ï¼Œæœ€å°å®¹é‡æ˜¯8ã€‚</p><h2 id="å…¥é˜Ÿ"><a href="#å…¥é˜Ÿ" class="headerlink" title="å…¥é˜Ÿ"></a>å…¥é˜Ÿ</h2><h3 id="å¤´éƒ¨å…¥é˜Ÿ"><a href="#å¤´éƒ¨å…¥é˜Ÿ" class="headerlink" title="å¤´éƒ¨å…¥é˜Ÿ"></a>å¤´éƒ¨å…¥é˜Ÿ</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">// å°†headæŒ‡é’ˆå‡1å¹¶ä¸æ•°ç»„é•¿åº¦å‡1å–æ¨¡</span></span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ•°ç»„åˆ°å¤´äº†è¾¹ç•Œæº¢å‡º</span></span><br><span class="line">    <span class="comment">// å¦‚æœåˆ°å¤´äº†å°±ä»å°¾å†å‘å‰</span></span><br><span class="line">    <span class="comment">// ç›¸å½“äºå¾ªç¯åˆ©ç”¨æ•°ç»„</span></span><br><span class="line">    elements[head = (head - <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>)] = e;</span><br><span class="line">    <span class="comment">// å¦‚æœå¤´å°¾æŒ¨åœ¨ä¸€èµ·äº†ï¼Œå°±æ‰©å®¹</span></span><br><span class="line">    <span class="comment">// æ‰©å®¹è§„åˆ™ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä¸¤å€</span></span><br><span class="line">    <span class="keyword">if</span> (head == tail)</span><br><span class="line">        doubleCapacity();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰©å®¹ä¸ºä¸¤å€</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doubleCapacity</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">assert</span> head == tail;</span><br><span class="line">    <span class="keyword">int</span> p = head;</span><br><span class="line">    <span class="keyword">int</span> n = elements.length;</span><br><span class="line">    <span class="keyword">int</span> r = n - p; <span class="comment">// number of elements to the right of p</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = n &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Sorry, deque too big"</span>);</span><br><span class="line">    Object[] a = <span class="keyword">new</span> Object[newCapacity];</span><br><span class="line">    <span class="comment">// å°†æ—§æ•°ç»„headä¹‹åçš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­</span></span><br><span class="line">    System.arraycopy(elements, p, a, <span class="number">0</span>, r);</span><br><span class="line">    <span class="comment">// å°†æ—§æ•°ç»„ä¸‹æ ‡0åˆ°headä¹‹é—´çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­</span></span><br><span class="line">    System.arraycopy(elements, <span class="number">0</span>, a, r, p);</span><br><span class="line">    <span class="comment">// èµ‹å€¼ä¸ºæ–°æ•°ç»„</span></span><br><span class="line">    elements = a;</span><br><span class="line">    <span class="comment">// headæŒ‡å‘0ï¼ŒtailæŒ‡å‘æ—§æ•°ç»„é•¿åº¦è¡¨ç¤ºçš„ä½ç½®</span></span><br><span class="line">    head = <span class="number">0</span>;</span><br><span class="line">    tail = n;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/08/lzG7NoCmk6ZJjpB.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><h3 id="å°¾éƒ¨å…¥é˜Ÿ"><a href="#å°¾éƒ¨å…¥é˜Ÿ" class="headerlink" title="å°¾éƒ¨å…¥é˜Ÿ"></a>å°¾éƒ¨å…¥é˜Ÿ</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLast</span><span class="params">(E e)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="comment">// åœ¨å°¾æŒ‡é’ˆçš„ä½ç½®æ”¾å…¥å…ƒç´ </span></span><br><span class="line">    <span class="comment">// å¯ä»¥çœ‹åˆ°tailæŒ‡é’ˆæŒ‡å‘çš„æ˜¯é˜Ÿåˆ—æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">    elements[tail] = e;</span><br><span class="line">    <span class="comment">// tailæŒ‡é’ˆåŠ 1ï¼Œå¦‚æœåˆ°æ•°ç»„å°¾äº†å°±ä»å¤´å¼€å§‹</span></span><br><span class="line">    <span class="keyword">if</span> ( (tail = (tail + <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>)) == head)</span><br><span class="line">        doubleCapacity();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ol><li>å…¥é˜Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼Œä»é˜Ÿåˆ—å¤´æˆ–è€…ä»é˜Ÿåˆ—å°¾ï¼›</li><li>å¦‚æœå®¹é‡ä¸å¤Ÿäº†ï¼Œç›´æ¥æ‰©å¤§ä¸ºä¸¤å€ï¼›</li><li>é€šè¿‡å–æ¨¡çš„æ–¹å¼è®©å¤´å°¾æŒ‡é’ˆåœ¨æ•°ç»„èŒƒå›´å†…å¾ªç¯ï¼›</li><li>x &amp; (len - 1) = x % lenï¼Œä½¿ç”¨&amp;çš„æ–¹å¼æ›´å¿«(<strong>len=2çš„å¹‚æ¬¡ç­‰å¼æˆç«‹</strong>)ï¼›</li></ol><h2 id="å‡ºé˜Ÿ"><a href="#å‡ºé˜Ÿ" class="headerlink" title="å‡ºé˜Ÿ"></a>å‡ºé˜Ÿ</h2><h3 id="å¤´éƒ¨å‡ºé˜Ÿ"><a href="#å¤´éƒ¨å‡ºé˜Ÿ" class="headerlink" title="å¤´éƒ¨å‡ºé˜Ÿ"></a>å¤´éƒ¨å‡ºé˜Ÿ</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">pollFirst</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> h = head;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="comment">// å–é˜Ÿåˆ—å¤´å…ƒç´ </span></span><br><span class="line">    E result = (E) elements[h];</span><br><span class="line">    <span class="comment">// Element is null if deque empty</span></span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// é˜Ÿå¤´å…ƒç´ ä¸ºç©º</span></span><br><span class="line">    elements[h] = <span class="keyword">null</span>;     <span class="comment">// Must null out slot</span></span><br><span class="line">    <span class="comment">// é˜Ÿå¤´å³ç§»</span></span><br><span class="line">    head = (h + <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="å°¾éƒ¨å‡ºé˜Ÿ"><a href="#å°¾éƒ¨å‡ºé˜Ÿ" class="headerlink" title="å°¾éƒ¨å‡ºé˜Ÿ"></a>å°¾éƒ¨å‡ºé˜Ÿ</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">pollLast</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// å› ä¸ºé˜Ÿå°¾æ ‡è®°çš„æ˜¯æœ€åä¸€ä¸ªä¸ºä¸ä¸ºç©ºçš„å…ƒç´ çš„åä¸€ä½</span></span><br><span class="line">    <span class="keyword">int</span> t = (tail - <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>);</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="comment">// è·å–é˜Ÿå°¾å…ƒç´ </span></span><br><span class="line">    E result = (E) elements[t];</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// é˜Ÿå°¾è®¾ç½®ä¸ºç©º</span></span><br><span class="line">    elements[t] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// é‡æ–°è®¾ç½®tail</span></span><br><span class="line">    tail = t;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä»¥ä¸‹æ˜¯ä¸€æ¬¡ArrayDequeçš„å¤´éƒ¨å…¥é˜Ÿ, å°¾éƒ¨å‡ºé˜Ÿçš„å¯è§†åŒ–æ“ä½œ</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayDeque&lt;Integer&gt; arrayDeque = <span class="keyword">new</span> ArrayDeque&lt;&gt;(<span class="number">6</span>);</span><br><span class="line">ArrayDequeUtil.getField(arrayDeque);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) {</span><br><span class="line">    arrayDeque.addFirst(i);</span><br><span class="line">    ArrayDequeUtil.getField(arrayDeque);</span><br><span class="line">}</span><br><span class="line">arrayDeque.pollLast();</span><br><span class="line">ArrayDequeUtil.getField(arrayDeque);</span><br></pre></td></tr></tbody></table></figure><p><img src="https://i.loli.net/2020/07/08/4uyjsf9nVXdGZTm.png" alt="æ¨¡æ‹Ÿå¯è§†åŒ–æ“ä½œ"></p><h2 id="æ ˆçš„å®ç°"><a href="#æ ˆçš„å®ç°" class="headerlink" title="æ ˆçš„å®ç°"></a>æ ˆçš„å®ç°</h2><h3 id="å…¥æ ˆ"><a href="#å…¥æ ˆ" class="headerlink" title="å…¥æ ˆ"></a>å…¥æ ˆ</h3><p>ä»¥ä¸‹æ˜¯Dequeå®ç°å…¥æ ˆçš„æ“ä½œ</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(E e)</span> </span>{</span><br><span class="line">    addFirst(e);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFirst</span><span class="params">(E e)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    elements[head = (head - <span class="number">1</span>) &amp; (elements.length - <span class="number">1</span>)] = e;</span><br><span class="line">    <span class="keyword">if</span> (head == tail)</span><br><span class="line">        doubleCapacity();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æœ€å, å…¶ä¾èµ–çš„è¿˜æ˜¯<code>addFirst()</code>, ä¹Ÿå°±æ˜¯ä»å¤´éƒ¨æ·»åŠ å…ƒç´ </p><h3 id="å‡ºæ ˆ"><a href="#å‡ºæ ˆ" class="headerlink" title="å‡ºæ ˆ"></a>å‡ºæ ˆ</h3><p>ä»¥ä¸‹æ˜¯Dequeå®ç°å‡ºæ ˆçš„æ“ä½œ</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">pop</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> removeFirst();</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">removeFirst</span><span class="params">()</span> </span>{</span><br><span class="line">    E x = pollFirst();</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>æœ€å, å…¶ä¾èµ–çš„è¿˜æ˜¯<code>pollFirst()</code>, ä¹Ÿå°±æ˜¯ä»å¤´éƒ¨åˆ é™¤å…ƒç´ ,  ä¹Ÿå°±æ˜¯åå…¥çš„å…ƒç´ å…ˆå‡º</p><p>è¯´ç™½äº†<strong>å®ç°æ ˆçš„æ–¹å¼å°±æ˜¯ä»…ä»…åªæ“ä½œé˜Ÿåˆ—å¤´å³å¯</strong></p><h2 id="æ€»ç»“-amp-é¢è¯•å°é—®é¢˜"><a href="#æ€»ç»“-amp-é¢è¯•å°é—®é¢˜" class="headerlink" title="æ€»ç»“&amp;é¢è¯•å°é—®é¢˜"></a>æ€»ç»“&amp;é¢è¯•å°é—®é¢˜</h2><ol><li>ä»€ä¹ˆæ˜¯åŒç«¯é˜Ÿåˆ—ï¼Ÿ<ul><li>åŒç«¯é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼Œå®ƒçš„ä¸¤ç«¯éƒ½å¯ä»¥è¿›å‡ºå…ƒç´ ï¼Œæ•…è€Œå¾—ååŒç«¯é˜Ÿåˆ—</li></ul></li><li>ArrayDequeæ˜¯æ€ä¹ˆå®ç°åŒç«¯é˜Ÿåˆ—çš„ï¼Ÿ<ul><li>åº•å±‚ä¸ºæ•°ç»„, ç„¶åé€šè¿‡å–æ¨¡çš„æ–¹å¼æ„é€ ä¸€ä¸ªå¾ªç¯æ•°ç»„, å‡ºé˜Ÿå…¥é˜Ÿæ˜¯é€šè¿‡å¤´å°¾æŒ‡é’ˆå¾ªç¯åˆ©ç”¨æ•°ç»„å®ç°çš„. </li></ul></li><li>ArrayDequeæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ<ul><li>ä¸æ˜¯çº¿ç¨‹å®‰å…¨</li></ul></li><li>ArrayDequeçš„æ‰©å®¹æœºåˆ¶ï¼Ÿ<ul><li>ArrayDequeåœ¨å®¹é‡ä¸è¶³æ—¶(head == tail)ä¼šå‡ºå‘æ‰©å®¹, æ‰©å®¹ä¸ºåŸå…ˆçš„ä¸¤å€, å…·ä½“çš„æ‰©å®¹æœºåˆ¶, å¯ä»¥çœ‹ä¸Šè¿°å¯è§†åŒ–è¿‡ç¨‹</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ä¾èµ–&quot;&gt;&lt;a href=&quot;#ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;ä¾èµ–&quot;&gt;&lt;/a&gt;ä¾èµ–&lt;/h2&gt;</summary>
    
    
    
    <category term="æºç " scheme="https://winniekun.github.io/categories/%E6%BA%90%E7%A0%81/"/>
    
    
    <category term="JDKæºç " scheme="https://winniekun.github.io/tags/JDK%E6%BA%90%E7%A0%81/"/>
    
    <category term="Queue" scheme="https://winniekun.github.io/tags/Queue/"/>
    
  </entry>
  
  <entry>
    <title>trie</title>
    <link href="https://winniekun.github.io/trie/"/>
    <id>https://winniekun.github.io/trie/</id>
    <published>2020-07-07T11:58:58.000Z</published>
    <updated>2020-08-30T04:50:22.259Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰ç¼€æ ‘åŸç†"><a href="#å‰ç¼€æ ‘åŸç†" class="headerlink" title="å‰ç¼€æ ‘åŸç†"></a>å‰ç¼€æ ‘åŸç†</h2><a id="more"></a><p>Trie, ç”±<code>Edward Fredkin</code>æå‡º, æ¥è‡ªè‹±æ–‡å•è¯<code>retrieval</code>, Trieä¹Ÿç§°ä¸ºå‰ç¼€æ ‘, ç”¨äºä¿å­˜<a href="https://zh.wikipedia.org/wiki/%E5%85%B3%E8%81%94%E6%95%B0%E7%BB%84" target="_blank" rel="noopener">å…³è”æ•°ç»„</a>ï¼Œå…¶ä¸­çš„é”®é€šå¸¸æ˜¯<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AC%A6%E4%B8%B2" target="_blank" rel="noopener">å­—ç¬¦ä¸²</a>ã€‚ä¸<a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91" target="_blank" rel="noopener">äºŒå‰æŸ¥æ‰¾æ ‘</a>ä¸åŒï¼Œé”®ä¸æ˜¯ç›´æ¥ä¿å­˜åœ¨èŠ‚ç‚¹ä¸­ï¼Œè€Œæ˜¯ç”±èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å†³å®šã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­å­™éƒ½æœ‰ç›¸åŒçš„<a href="https://zh.wikipedia.org/wiki/%E5%89%8D%E7%BC%80" target="_blank" rel="noopener">å‰ç¼€</a>ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè€Œæ ¹èŠ‚ç‚¹å¯¹åº”<a href="https://zh.wikipedia.org/wiki/%E7%A9%BA%E5%AD%97%E7%AC%A6%E4%B8%B2" target="_blank" rel="noopener">ç©ºå­—ç¬¦ä¸²</a>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æœ‰å¯¹åº”çš„å€¼ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹å’Œéƒ¨åˆ†å†…éƒ¨èŠ‚ç‚¹æ‰€å¯¹åº”çš„é”®æ‰æœ‰ç›¸å…³çš„å€¼ã€‚ </p><p>å¯¹äºå­—ç¬¦Trieè€Œè¨€, å¦‚æœä½¿ç”¨äºŒå‰æ ‘é‚£æ ·çš„ä¸¤ä¸ªåˆ†æ”¯æ˜æ˜¾æ˜¯ä¸å¤Ÿçš„. ä¸¾ä¸ªä¾‹å­, è‹±è¯­ä¸­ä¸€å…±æœ‰26ä¸ªå­—æ¯, æ¯ä¸ªå­—æ¯è¿˜åŒºåˆ†å¤§å°å†™, å¦‚æœå¿½ç•¥å¤§å°å†™çš„è¯, é‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç®€å•çš„é™å®šåˆ†æ”¯(å­æ ‘)ä¸ªæ•°ä¸º26. å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ªå­—ç¬¦ä¸²Trie</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/07/eMrDF8pubcj5kth.png" alt="Trie" title="">                </div>                <div class="image-caption">Trie</div>            </figure><blockquote><p>ä¸€ä¸ªä¿å­˜äº†8ä¸ªé”®çš„trieç»“æ„ï¼Œâ€Aâ€, â€œtoâ€, â€œteaâ€, â€œtedâ€, â€œtenâ€, â€œiâ€, â€œinâ€, â€œinn</p></blockquote><p> è¿™åªæ˜¯é’ˆå¯¹äºä¸åŒºåˆ†å¤§å°å†™çš„è‹±è¯­å­—æ¯, è‹¥æ˜¯åŒºåˆ†å¤§å°å†™, åŒæ—¶è¿˜æœ‰æ ‡ç‚¹ç­‰, é‚£ä¹ˆåˆ†ä¹‹çš„æ•°é‡ä¼šæ›´åŠ çš„åºå¤§ä¸”ä¸ç¡®å®š, è¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ•£åˆ—è¡¨æ¥è§£å†³åŠ¨æ€æ•°é‡çš„åˆ†æ”¯.</p><p>Trieçš„å‡ºç°, è§£å†³äº†æ•£åˆ—è¡¨æ— æ³•è§£å†³çš„å­—ç¬¦ä¸²æ•°é›†é—®é¢˜:</p><ul><li>æ‰¾åˆ°å…·æœ‰åŒä¸€å‰ç¼€çš„å…¨éƒ¨é”®å€¼ã€‚</li><li>æŒ‰è¯å…¸åºæšä¸¾å­—ç¬¦ä¸²çš„æ•°æ®é›†ã€‚</li></ul><p>åŒæ—¶Trieç”±æ•£åˆ—è¡¨çš„å¦ä¸€æ–¹é¢æ˜¯: éšç€æ•°æ®é‡çš„å¢å¤§, æ•£åˆ—è¡¨çš„æŸ¥æ‰¾æ•ˆç‡å¯èƒ½ä¼šé™ä½åˆ°$O(n)$, ä¸å“ˆå¸Œè¡¨ç›¸æ¯”, Trie æ ‘åœ¨å­˜å‚¨å¤šä¸ªå…·æœ‰ç›¸åŒå‰ç¼€çš„é”®æ—¶å¯ä»¥ä½¿ç”¨è¾ƒå°‘çš„ç©ºé—´. æ­¤æ—¶Trieåªéœ€è¦$O(m)$çš„æ—¶é—´å¤æ‚åº¦ï¼Œå…¶ä¸­$m$ä¸ºé”®é•¿ã€‚</p><h2 id="å‰ç¼€æ ‘çš„å®ç°"><a href="#å‰ç¼€æ ‘çš„å®ç°" class="headerlink" title="å‰ç¼€æ ‘çš„å®ç°"></a>å‰ç¼€æ ‘çš„å®ç°</h2><p>Trie æ ‘æ˜¯ä¸€ä¸ªæœ‰æ ¹çš„æ ‘ï¼Œå…¶ç»“ç‚¹å…·æœ‰ä»¥ä¸‹å­—æ®µï¼šã€‚</p><ul><li>æœ€å¤š$R$ä¸ªæŒ‡å‘å­ç»“ç‚¹çš„é“¾æ¥ï¼Œå…¶ä¸­æ¯ä¸ªé“¾æ¥å¯¹åº”å­—æ¯è¡¨æ•°æ®é›†ä¸­çš„ä¸€ä¸ªå­—æ¯, ç®€å•èµ·è§, å‡å®š$R$ä¸º 26, å°å†™è‹±è¯­å­—æ¯æ•°é‡</li><li>å¸ƒå°”å­—æ®µ, ä»¥æŒ‡å®šèŠ‚ç‚¹æ˜¯å¯¹åº”é”®çš„ç»“å°¾è¿˜æ˜¯åªæ˜¯é”®å‰ç¼€.</li></ul><h3 id="èŠ‚ç‚¹æ„é€ "><a href="#èŠ‚ç‚¹æ„é€ " class="headerlink" title="èŠ‚ç‚¹æ„é€ "></a>èŠ‚ç‚¹æ„é€ </h3><p>åœ¨æ„é€ ä¹‹å‰, å…ˆå±•ç¤ºåŒ…å«ä¸‰ä¸ªå•è¯â€seaâ€,â€sellsâ€,â€sheâ€çš„ Trieçš„æ ·å­, åŠ æ·±ç†è§£</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/07/A16vF79kB23HYKl.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> TrieNode[] links;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isEnd;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> R = <span class="number">26</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">()</span> </span>{</span><br><span class="line">        links = <span class="keyword">new</span> TrieNode[R];</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsKey</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> links[ch - <span class="string">'a'</span>] != <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">char</span> ch, TrieNode node)</span> </span>{</span><br><span class="line">        links[ch - <span class="string">'a'</span>] = node;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> TrieNode <span class="title">get</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> links[ch - <span class="string">'a'</span>];</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span><span class="params">()</span> </span>{</span><br><span class="line">        isEnd = <span class="keyword">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnd</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> isEnd;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>{</span><br><span class="line">    <span class="comment">// ä»æ ¹èŠ‚ç‚¹å¼€å§‹, æ ¹èŠ‚ç‚¹ä¸ºç©º</span></span><br><span class="line">    TrieNode node = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) {</span><br><span class="line">        <span class="keyword">char</span> current = word.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (!node.containsKey(current)) {</span><br><span class="line">            node.put(current, <span class="keyword">new</span> TrieNode());</span><br><span class="line">        }</span><br><span class="line">        node = node.get(current);</span><br><span class="line">    }</span><br><span class="line">    node.setEnd();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><p>æ¯ä¸ªé”®åœ¨ trie ä¸­è¡¨ç¤ºä¸ºä»æ ¹åˆ°å†…éƒ¨èŠ‚ç‚¹æˆ–å¶çš„è·¯å¾„ã€‚æˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªé”®å­—ç¬¦ä»æ ¹å¼€å§‹ï¼Œã€‚æ£€æŸ¥å½“å‰èŠ‚ç‚¹ä¸­ä¸é”®å­—ç¬¦å¯¹åº”çš„é“¾æ¥ã€‚æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ol><li>å­˜åœ¨é“¾æ¥ã€‚æˆ‘ä»¬ç§»åŠ¨åˆ°è¯¥é“¾æ¥åé¢è·¯å¾„ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ç»§ç»­æœç´¢ä¸‹ä¸€ä¸ªé”®å­—ç¬¦ã€‚</li><li>ä¸å­˜åœ¨é“¾æ¥ã€‚è‹¥å·²æ— é”®å­—ç¬¦ï¼Œä¸”å½“å‰ç»“ç‚¹æ ‡è®°ä¸º isEndï¼Œåˆ™è¿”å› trueã€‚å¦åˆ™æœ‰ä¸¤ç§å¯èƒ½ï¼Œå‡è¿”å› false :<ol><li>è¿˜æœ‰é”®å­—ç¬¦å‰©ä½™ï¼Œä½†æ— æ³•è·Ÿéš Trie æ ‘çš„é”®è·¯å¾„ï¼Œæ‰¾ä¸åˆ°é”®ã€‚</li><li>æ²¡æœ‰é”®å­—ç¬¦å‰©ä½™ï¼Œä½†å½“å‰ç»“ç‚¹æ²¡æœ‰æ ‡è®°ä¸º isEndã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¾…æŸ¥æ‰¾é”®åªæ˜¯Trieæ ‘ä¸­å¦ä¸€ä¸ªé”®çš„å‰ç¼€ã€‚</li></ol></li></ol><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> TrieNode <span class="title">searchPrefix</span><span class="params">(String word)</span> </span>{</span><br><span class="line">    TrieNode node = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) {</span><br><span class="line">        <span class="keyword">char</span> current = word.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> (node.containsKey(current)) {</span><br><span class="line">            node = node.get(current);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>{</span><br><span class="line">    TrieNode node = searchPrefix(word);</span><br><span class="line">    <span class="keyword">return</span> node != <span class="keyword">null</span> &amp;&amp; node.isEnd();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ˜¯å¦å­˜åœ¨è¾“å…¥å‰ç¼€çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix)</span> </span>{</span><br><span class="line">    TrieNode node = searchPrefix(prefix);</span><br><span class="line">    <span class="keyword">return</span> node != <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="æ•´ä½“"><a href="#æ•´ä½“" class="headerlink" title="æ•´ä½“"></a>æ•´ä½“</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TrieNode root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>{</span><br><span class="line">        root = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’å…¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>{</span><br><span class="line">        TrieNode node = root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) {</span><br><span class="line">            <span class="keyword">char</span> current = word.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (!node.containsKey(current)) {</span><br><span class="line">                node.put(current, <span class="keyword">new</span> TrieNode());</span><br><span class="line">            }</span><br><span class="line">            node = node.get(current);</span><br><span class="line">        }</span><br><span class="line">        node.setEnd();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ é™¤</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>{</span><br><span class="line">        TrieNode node = searchPrefix(word);</span><br><span class="line">        <span class="keyword">return</span> node != <span class="keyword">null</span> &amp;&amp; node.isEnd();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> TrieNode <span class="title">searchPrefix</span><span class="params">(String word)</span> </span>{</span><br><span class="line">        TrieNode node = root;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; word.length(); i++) {</span><br><span class="line">            <span class="keyword">char</span> current = word.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (node.containsKey(current)) {</span><br><span class="line">                node = node.get(current);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å­˜åœ¨è¾“å…¥å‰ç¼€çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix)</span> </span>{</span><br><span class="line">        TrieNode node = searchPrefix(prefix);</span><br><span class="line">        <span class="keyword">return</span> node != <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>{</span><br><span class="line">        <span class="keyword">private</span> TrieNode[] links;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isEnd;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> R = <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TrieNode</span><span class="params">()</span> </span>{</span><br><span class="line">            links = <span class="keyword">new</span> TrieNode[R];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsKey</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> links[ch - <span class="string">'a'</span>] != <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">char</span> ch, TrieNode node)</span> </span>{</span><br><span class="line">            links[ch - <span class="string">'a'</span>] = node;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">get</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> links[ch - <span class="string">'a'</span>];</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span><span class="params">()</span> </span>{</span><br><span class="line">            isEnd = <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnd</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> isEnd;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="æ•æ„Ÿè¯è¿‡æ»¤çš„å‰ç¼€æ ‘å®ç°"><a href="#æ•æ„Ÿè¯è¿‡æ»¤çš„å‰ç¼€æ ‘å®ç°" class="headerlink" title="æ•æ„Ÿè¯è¿‡æ»¤çš„å‰ç¼€æ ‘å®ç°"></a>æ•æ„Ÿè¯è¿‡æ»¤çš„å‰ç¼€æ ‘å®ç°</h2><p>å› ä¸ºæ•æ„Ÿè¯é™¤äº†è‹±æ–‡å­—æ¯ä¹‹å¤–, è¿˜æœ‰å…¶ä»–çš„å­—ç¬¦, æ‰€ä»¥ä½¿ç”¨æ•£åˆ—è¡¨æ¥å®ç°, </p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span></span>{</span><br><span class="line">    <span class="comment">// æ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">private</span> TrieNode rootNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†ä¸€ä¸ªæ•æ„Ÿè¯æ·»åŠ åˆ°å‰ç¼€æ ‘ä¸­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addKeyword</span><span class="params">(String keyword)</span> </span>{</span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; keyword.length(); i++) {</span><br><span class="line">            <span class="keyword">char</span> c = keyword.charAt(i);</span><br><span class="line">            TrieNode subNode = tempNode.getSubNode(c);</span><br><span class="line">            <span class="keyword">if</span>(!tempNode.containsKey(c)){</span><br><span class="line">                tempNode.addSubNode(c, <span class="keyword">new</span> TrieNode());</span><br><span class="line">            }</span><br><span class="line">            tempNode = tempNode.getSubNode(c);</span><br><span class="line">        }</span><br><span class="line">        tempNode.setKeywordEnd(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰ç¼€æ ‘</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>{</span><br><span class="line">        <span class="comment">// å…³é”®è¯ç»“æŸæ ‡è¯†</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isKeywordEnd = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// å­èŠ‚ç‚¹(keyæ˜¯ä¸‹çº§å­—ç¬¦,valueæ˜¯ä¸‹çº§èŠ‚ç‚¹)</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;Character, TrieNode&gt; subNodes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isKeywordEnd</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> isKeywordEnd;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKeywordEnd</span><span class="params">(<span class="keyword">boolean</span> keywordEnd)</span> </span>{</span><br><span class="line">            isKeywordEnd = keywordEnd;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubNode</span><span class="params">(Character c, TrieNode node)</span> </span>{</span><br><span class="line">            subNodes.put(c, node);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è·å–å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">getSubNode</span><span class="params">(Character c)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> subNodes.get(c);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="å®ä¾‹è®²è§£"><a href="#å®ä¾‹è®²è§£" class="headerlink" title="å®ä¾‹è®²è§£"></a>å®ä¾‹è®²è§£</h3><h3 id="æœ€ç»ˆå®ç°"><a href="#æœ€ç»ˆå®ç°" class="headerlink" title="æœ€ç»ˆå®ç°"></a>æœ€ç»ˆå®ç°</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›¿æ¢ç¬¦</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String REPLACEMENT = <span class="string">"***"</span>;</span><br><span class="line">    <span class="comment">// æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> TrieNode rootNode = <span class="keyword">new</span> TrieNode();</span><br><span class="line">    <span class="comment">// åŠ è½½æ•æ„Ÿå­—ç¬¦, åªåŠ è½½ä¸€æ¬¡</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> (</span><br><span class="line">                InputStream is = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">"sensitive-word.txt"</span>);</span><br><span class="line">                BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(is));</span><br><span class="line">        ) {</span><br><span class="line">            String keyword;</span><br><span class="line">            <span class="keyword">while</span> ((keyword = reader.readLine()) != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">// æ·»åŠ åˆ°å‰ç¼€æ ‘</span></span><br><span class="line">                <span class="keyword">this</span>.addKeyword(keyword);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            logger.error(<span class="string">"åŠ è½½æ•æ„Ÿè¯æ–‡ä»¶å¤±è´¥: "</span> + e.getMessage());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å°†ä¸€ä¸ªæ•æ„Ÿè¯æ·»åŠ åˆ°å‰ç¼€æ ‘ä¸­</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addKeyword</span><span class="params">(String keyword)</span> </span>{</span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; keyword.length(); i++) {</span><br><span class="line">            <span class="keyword">char</span> c = keyword.charAt(i);</span><br><span class="line">            TrieNode subNode = tempNode.getSubNode(c);</span><br><span class="line">            <span class="keyword">if</span>(!tempNode.containsKey(c)){</span><br><span class="line">                tempNode.addSubNode(c, <span class="keyword">new</span> TrieNode());</span><br><span class="line">            }</span><br><span class="line">            tempNode = tempNode.getSubNode(c);</span><br><span class="line">        }</span><br><span class="line">        tempNode.setKeywordEnd(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤æ•æ„Ÿè¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text å¾…è¿‡æ»¤çš„æ–‡æœ¬</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿‡æ»¤åçš„æ–‡æœ¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filter</span><span class="params">(String text)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æŒ‡é’ˆ1</span></span><br><span class="line">        TrieNode tempNode = rootNode;</span><br><span class="line">        <span class="comment">// æŒ‡é’ˆ2</span></span><br><span class="line">        <span class="keyword">int</span> begin = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æŒ‡é’ˆ3</span></span><br><span class="line">        <span class="keyword">int</span> position = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç»“æœ</span></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">while</span> (position &lt; text.length()) {</span><br><span class="line">            <span class="keyword">char</span> c = text.charAt(position);</span><br><span class="line">            <span class="comment">// è·³è¿‡ç¬¦å·</span></span><br><span class="line">            <span class="keyword">if</span> (isSymbol(c)) {</span><br><span class="line">                <span class="comment">// è‹¥æŒ‡é’ˆ1å¤„äºæ ¹èŠ‚ç‚¹,å°†æ­¤ç¬¦å·è®¡å…¥ç»“æœ,è®©æŒ‡é’ˆ2å‘ä¸‹èµ°ä¸€æ­¥</span></span><br><span class="line">                <span class="keyword">if</span> (tempNode == rootNode) {</span><br><span class="line">                    sb.append(c);</span><br><span class="line">                    begin++;</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// æ— è®ºç¬¦å·åœ¨å¼€å¤´æˆ–ä¸­é—´,æŒ‡é’ˆ3éƒ½å‘ä¸‹èµ°ä¸€æ­¥</span></span><br><span class="line">                position++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// æ£€æŸ¥ä¸‹çº§èŠ‚ç‚¹</span></span><br><span class="line">            tempNode = tempNode.getSubNode(c);</span><br><span class="line">            <span class="keyword">if</span> (tempNode == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="comment">// ä»¥beginå¼€å¤´çš„å­—ç¬¦ä¸²ä¸æ˜¯æ•æ„Ÿè¯</span></span><br><span class="line">                sb.append(text.charAt(begin));</span><br><span class="line">                <span class="comment">// è¿›å…¥ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">                position = ++begin;</span><br><span class="line">                <span class="comment">// é‡æ–°æŒ‡å‘æ ¹èŠ‚ç‚¹</span></span><br><span class="line">                tempNode = rootNode;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (tempNode.isKeywordEnd()) {</span><br><span class="line">                <span class="comment">// å‘ç°æ•æ„Ÿè¯,å°†begin~positionå­—ç¬¦ä¸²æ›¿æ¢æ‰</span></span><br><span class="line">                sb.append(REPLACEMENT);</span><br><span class="line">                <span class="comment">// è¿›å…¥ä¸‹ä¸€ä¸ªä½ç½®</span></span><br><span class="line">                begin = ++position;</span><br><span class="line">                <span class="comment">// é‡æ–°æŒ‡å‘æ ¹èŠ‚ç‚¹</span></span><br><span class="line">                tempNode = rootNode;</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">                position++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// å°†æœ€åä¸€æ‰¹å­—ç¬¦è®¡å…¥ç»“æœ</span></span><br><span class="line">        sb.append(text.substring(begin));</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç¬¦å·</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isSymbol</span><span class="params">(Character c)</span> </span>{</span><br><span class="line">        <span class="comment">// 0x2E80~0x9FFF æ˜¯ä¸œäºšæ–‡å­—èŒƒå›´</span></span><br><span class="line">        <span class="keyword">return</span> !CharUtils.isAsciiAlphanumeric(c) &amp;&amp; (c &lt; <span class="number">0x2E80</span> || c &gt; <span class="number">0x9FFF</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// å‰ç¼€æ ‘</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">TrieNode</span> </span>{</span><br><span class="line">        <span class="comment">// å…³é”®è¯ç»“æŸæ ‡è¯†</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isKeywordEnd = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// å­èŠ‚ç‚¹(keyæ˜¯ä¸‹çº§å­—ç¬¦,valueæ˜¯ä¸‹çº§èŠ‚ç‚¹)</span></span><br><span class="line">        <span class="keyword">private</span> Map&lt;Character, TrieNode&gt; subNodes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isKeywordEnd</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> isKeywordEnd;</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKeywordEnd</span><span class="params">(<span class="keyword">boolean</span> keywordEnd)</span> </span>{</span><br><span class="line">            isKeywordEnd = keywordEnd;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// æ·»åŠ å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSubNode</span><span class="params">(Character c, TrieNode node)</span> </span>{</span><br><span class="line">            subNodes.put(c, node);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// è·å–å­èŠ‚ç‚¹</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TrieNode <span class="title">getSubNode</span><span class="params">(Character c)</span> </span>{</span><br><span class="line">            <span class="keyword">return</span> subNodes.get(c);</span><br><span class="line">        }</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsKey</span><span class="params">(Character c)</span></span>{</span><br><span class="line">            <span class="keyword">return</span> subNodes.containsKey(c);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><p>ç®—æ³•æ–°è§£</p></li><li><p><a href="https://leetcode-cn.com/problems/implement-trie-prefix-tree/solution/shi-xian-trie-qian-zhui-shu-by-leetcode/" target="_blank" rel="noopener">å®ç° Trie (å‰ç¼€æ ‘)</a></p></li><li><p><a href="https://blog.nowcoder.net/n/543c682c844f4fcaab6be5d22b0530d4" target="_blank" rel="noopener">é—®ç­”ç¤¾åŒº-æ•æ„Ÿè¯è¿‡æ»¤</a></p></li><li><p><a href="https://490.github.io/%E5%9F%BA%E4%BA%8E%E5%89%8D%E7%BC%80%E6%A0%91%E5%9B%BE%E6%96%87%E8%AF%A6%E8%A7%A3%E6%95%8F%E6%84%9F%E8%AF%8D%E8%BF%87%E6%BB%A4/" target="_blank" rel="noopener">åŸºäºå‰ç¼€æ ‘å›¾æ–‡è¯¦è§£æ•æ„Ÿè¯è¿‡æ»¤</a></p></li><li><p><a href="https://leetcode-cn.com/problems/implement-trie-prefix-tree/solution/trie-tree-de-shi-xian-gua-he-chu-xue-zhe-by-huwt/" target="_blank" rel="noopener">Trie Tree çš„å®ç° (é€‚åˆåˆå­¦è€…)</a>   </p></li><li><p> <a href="https://www.cnblogs.com/kubidemanong/p/10834993.html" target="_blank" rel="noopener">é¢è¯•è¢«è™ è¯´è¯´æ¸¸æˆä¸­çš„æ•æ„Ÿè¯è¿‡æ»¤æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</a></p></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰ç¼€æ ‘åŸç†&quot;&gt;&lt;a href=&quot;#å‰ç¼€æ ‘åŸç†&quot; class=&quot;headerlink&quot; title=&quot;å‰ç¼€æ ‘åŸç†&quot;&gt;&lt;/a&gt;å‰ç¼€æ ‘åŸç†&lt;/h2&gt;</summary>
    
    
    
    <category term="ç®—æ³•" scheme="https://winniekun.github.io/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="trie" scheme="https://winniekun.github.io/tags/trie/"/>
    
  </entry>
  
  <entry>
    <title>Cookieå’ŒSession</title>
    <link href="https://winniekun.github.io/Cookie-Session/"/>
    <id>https://winniekun.github.io/Cookie-Session/</id>
    <published>2020-07-06T01:36:34.000Z</published>
    <updated>2020-08-30T04:50:22.262Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><a id="more"></a><p>Sessionå’ŒCookieçš„ä½œç”¨æ˜¯ä¸ºäº†ä¿æŒè®¿é—®ç”¨æˆ·ä¸åç«¯æœåŠ¡å™¨çš„äº¤äº’çŠ¶æ€</p><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>Cookieçš„ä½œç”¨é€šä¿—æ¥è®²å°±æ˜¯å½“ä¸€ä¸ªç”¨æˆ·é€šè¿‡HTTPè¯·æ±‚è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™, æœåŠ¡å™¨å°†<strong>ä¸€äº›Key/Valueçš„é”®å€¼å¯¹</strong>è¿”å›ç»™å®¢æˆ·ç«¯, å¹¶ä¸”è¿˜å¯ä»¥ç»™è¿™äº›æ•°æ®æ·»åŠ ä¸€äº›é™åˆ¶æ¡ä»¶: å­˜æ´»æ—¶é—´, ç”Ÿæ•ˆèŒƒå›´ç­‰, åœ¨ç¬¦åˆé™åˆ¶æ¡ä»¶çš„æƒ…å†µä¸‹, è¯¥ç”¨æˆ·å†æ¬¡å‘èµ·è¯·æ±‚, æ•°æ®å°†ä¼šè¢«å®Œæ•´çš„è¿”å›ç»™æœåŠ¡å™¨.</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/cookie/set"</span>, method = RequestMethod.GET)</span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">setCookie</span><span class="params">(HttpServletResponse response)</span></span>{</span><br><span class="line">    <span class="comment">// ç”Ÿæˆcookie</span></span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"wkk"</span>, CommunityUtil.generateUUID());</span><br><span class="line">    <span class="comment">// è®¾ç½®ç”Ÿæ•ˆèŒƒå›´</span></span><br><span class="line">    cookie.setPath(<span class="string">"/community/alpha"</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®cookieçš„ç”Ÿæ•ˆæ—¶é—´ï¼ˆé»˜è®¤å­˜åœ¨å†…å­˜ä¸­ï¼Œ è®¾ç½®æ—¶é—´ä¹‹åä¼šå­˜åœ¨ç¡¬ç›˜ä¸­ï¼‰</span></span><br><span class="line">    cookie.setMaxAge(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// å‘é€ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">    response.addCookie(cookie);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"set cookie"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/06/wKDn9qhSYXgevE2.png" alt="Cookie" title="">                </div>                <div class="image-caption">Cookie</div>            </figure><p>W3Cåœ¨è®¾è®¡Cookieçš„æ—¶å€™, å®é™…ä¸Šè€ƒè™‘çš„æ˜¯ä¸ºäº†<strong>è®°å½•ç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´çš„webåº”ç”¨çš„è¡Œä¸ºè·¯å¾„.</strong> å› ä¸ºHTTPæ˜¯æ— çŠ¶æ€åè®®, å½“ç”¨æˆ·è®¿é—®å®Œä¸€æ¬¡è¯·æ±‚ç»“æŸä¹‹å, åç«¯æœåŠ¡å™¨æ— æ³•çŸ¥é“ä¸‹ä¸€æ¬¡æ¥è®¿çš„æ˜¯å¦è¿˜æ˜¯ä¸Šæ¬¡è®¿é—®çš„ç”¨æˆ·.   </p><p>ä½¿ç”¨Cookieså¸¦æ¥çš„ä¼˜åŠ¿:</p><ol><li>çŸ­æ—¶é—´å†…, å¦‚æœä¸ç”¨æˆ·ç›¸å…³çš„æ•°æ®é¢‘ç¹è¢«è®¿é—®, å¯ä»¥ä¸ºè¯¥æ•°æ®æ·»åŠ ç¼“å­˜, æé«˜æ•°æ®çš„è®¿é—®æ€§èƒ½</li></ol><p>è‹¥æ˜¯åŒä¸€å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚, æ¯æ¬¡å‘å‡ºçš„è¯·æ±‚éƒ½ä¼šåŒ…å«ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨ä¹‹å, æœåŠ¡å™¨è®¾ç½®çš„ä¿¡æ¯, è¿™æ ·æœåŠ¡å™¨å°±å¯ä»¥æ ¹æ®Cookieæ¥åˆ’åˆ†ç”¨æˆ·.</p><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>è™½ç„¶Cookieçš„å‡ºç°å¯ä»¥è®©æœåŠ¡å™¨è¯†åˆ«æ¯ä¸ªå®¢æˆ·çš„è¯·æ±‚, ä½†æ˜¯æ¯æ¬¡å®¢æˆ·çš„è®¿é—®éƒ½å¿…é¡»è¿”å›è¿™äº›Cookie, å¦‚æœCookieå¾ˆå¤š, æ— ç–‘æ˜¯å¢åŠ äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´æ•°æ®çš„ä¼ è¾“é‡, è€ŒSessionçš„å­˜åœ¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜.</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/06/WLICDZ4cBMKu6k7.png" alt="Session" title="">                </div>                <div class="image-caption">Session</div>            </figure><p>åŒä¸€ä¸ªå®¢æˆ·ç«¯æ¯æ¬¡å’ŒæœåŠ¡ç«¯äº¤äº’çš„æ—¶å€™, ä¸éœ€è¦æ¯æ¬¡éƒ½ä¼ å›æ‰€æœ‰çš„Cookieå€¼, è€Œåªè¦ä¼ å›ä¸€ä¸ªID, è¿™ä¸ªIDæ˜¯å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ç”Ÿæˆçš„, è€Œä¸”æ¯ä¸ªå®¢æˆ·ç«¯æ˜¯å”¯ä¸€çš„, è¿™æ ·æ¯ä¸ªå®¢æˆ·ç«¯å°±æœ‰äº†å”¯ä¸€çš„ID, å®¢æˆ·ç«¯åªè¦è¿”å›IDå³å¯, è¿™ä¸ªIDå°±æ˜¯åä¸º<strong>JSSIONID</strong>çš„ä¸€ä¸ªCookie</p><h2 id="å®‰å…¨é—®é¢˜"><a href="#å®‰å…¨é—®é¢˜" class="headerlink" title="å®‰å…¨é—®é¢˜"></a>å®‰å…¨é—®é¢˜</h2><p>è™½ç„¶Cookieå’ŒSessionéƒ½å¯ä»¥è·Ÿè¸ªå®¢æˆ·ç«¯çš„è®¿é—®è®°å½•,  ä½†æ˜¯å·¥ä½œæ–¹å¼ä¸åŒ, Cookieæ˜¯é€šè¿‡æŠŠæ‰€æœ‰è¦ä¿å­˜çš„æ•°æ®é€šè¿‡HTTPçš„å¤´éƒ¨ä»å®¢æˆ·ç«¯ä¼ é€’åˆ°æœåŠ¡åº¦ç«¯, ç„¶ååˆä»æœåŠ¡ç«¯ä¼ åˆ°å®¢æˆ·ç«¯, æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åˆ°å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸­, è¿™äº›Cookieæ•°æ®å¯ä»¥ç›´æ¥è®¿é—®åˆ°, è®¾ç½®å¯ä»¥ä¿®æ”¹, æ‰€ä»¥å®‰å…¨æ€§å—åˆ°å¾ˆå¤§çš„æŒ‘æˆ˜</p><p>ç›¸æ¯”è€Œè¨€, Sessionçš„å®‰å…¨æ€§é«˜å¾ˆå¤š, å› ä¸ºSessionçš„æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨é‡Œ, åªæ˜¯é€šè¿‡Cookieä¼ é€’ä¸€ä¸ªSessionIDè€Œå·², æ‰€ä»¥Sessionæ›´é€‚åˆå­˜å‚¨ç”¨æˆ·éšç§å’Œé‡è¦çš„æ•°æ®</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;</summary>
    
    
    
    <category term="ç½‘ç»œ" scheme="https://winniekun.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="http" scheme="https://winniekun.github.io/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>å•ä¾‹æ¨¡å¼</title>
    <link href="https://winniekun.github.io/SingletonPattern/"/>
    <id>https://winniekun.github.io/SingletonPattern/</id>
    <published>2020-07-02T13:35:20.000Z</published>
    <updated>2021-03-31T11:22:40.128Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><a id="more"></a><blockquote><p>â€œä½ çŸ¥é“èŒ´é¦™è±†çš„â€˜èŒ´â€™å­—æœ‰å‡ ç§å†™æ³•å—ï¼Ÿâ€</p></blockquote><p>çº ç»“å•ä¾‹æ¨¡å¼æœ‰å‡ ç§å†™æ³•æœ‰ç”¨å—? æœ‰ç‚¹ç”¨, é¢è¯•ä¸­ç»å¸¸é€‰æ‹©å…¶ä¸­ä¸€ç§æˆ–å‡ ç§å†™æ³•ä½œä¸ºè¯å¤´, ä»¥æ­¤å±•å¼€è€ƒå¯Ÿé¢è¯•è€…çš„code style ä»¥åŠå…¶ä»–ç›¸å…³çš„çŸ¥è¯†ç‚¹. ä½†æ˜¯è¿‡äºçº ç»“è¿™äº›å†™æ³•, åè€Œç±»ä¼¼äºâ€èŒ´â€å­—æœ‰å‡ ä¸ªå†™æ³•â€¦</p><p>æ€æƒ³, æ€æƒ³, æ€æƒ³. é‡è¦äº‹æƒ…è¯´ä¸‰é</p><h3 id="ç±»åŠ è½½é¡ºåº"><a href="#ç±»åŠ è½½é¡ºåº" class="headerlink" title="ç±»åŠ è½½é¡ºåº"></a>ç±»åŠ è½½é¡ºåº</h3><p>ç±»åŠ è½½(classLoader)æœºåˆ¶ä¸€èˆ¬éµä»ä¸‹é¢çš„åŠ è½½é¡ºåº</p><p>å¦‚æœç±»è¿˜æ²¡æœ‰è¢«åŠ è½½ï¼š</p><ul><li>å…ˆæ‰§è¡Œçˆ¶ç±»çš„é™æ€ä»£ç å—å’Œé™æ€å˜é‡åˆå§‹åŒ–ï¼Œé™æ€ä»£ç å—å’Œé™æ€å˜é‡çš„æ‰§è¡Œé¡ºåºè·Ÿä»£ç ä¸­å‡ºç°çš„é¡ºåºæœ‰å…³ã€‚</li><li>æ‰§è¡Œå­ç±»çš„é™æ€ä»£ç å—å’Œé™æ€å˜é‡åˆå§‹åŒ–ã€‚</li><li>æ‰§è¡Œçˆ¶ç±»çš„å®ä¾‹å˜é‡åˆå§‹åŒ–</li><li>æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°</li><li>æ‰§è¡Œå­ç±»çš„å®ä¾‹å˜é‡åˆå§‹åŒ–</li><li>æ‰§è¡Œå­ç±»çš„æ„é€ å‡½æ•°</li></ul><p>åŒæ—¶ï¼ŒåŠ è½½ç±»çš„è¿‡ç¨‹æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œåˆ«çš„çº¿ç¨‹æ— æ³•è¿›å…¥ã€‚</p><p>å¦‚æœç±»å·²ç»è¢«åŠ è½½ï¼š</p><p>é™æ€ä»£ç å—å’Œé™æ€å˜é‡ä¸åœ¨é‡å¤æ‰§è¡Œï¼Œå†åˆ›å»ºç±»å¯¹è±¡æ—¶ï¼Œåªæ‰§è¡Œä¸å®ä¾‹ç›¸å…³çš„å˜é‡åˆå§‹åŒ–å’Œæ„é€ æ–¹æ³•ã€‚</p><h3 id="staticå…³é”®å­—"><a href="#staticå…³é”®å­—" class="headerlink" title="staticå…³é”®å­—"></a>staticå…³é”®å­—</h3><p>ä¸€ä¸ªç±»ä¸­å¦‚æœæœ‰æˆå‘˜å˜é‡æˆ–è€…æ–¹æ³•è¢«staticå…³é”®å­—ä¿®é¥°ï¼Œé‚£ä¹ˆè¯¥æˆå‘˜å˜é‡æˆ–æ–¹æ³•å°†ç‹¬ç«‹äºè¯¥ç±»çš„ä»»ä½•å¯¹è±¡ã€‚å®ƒä¸ä¾èµ–ç±»ç‰¹å®šçš„å®ä¾‹ï¼Œè¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ï¼Œåªè¦è¿™ä¸ªç±»è¢«åŠ è½½ï¼Œè¯¥æˆå‘˜å˜é‡æˆ–æ–¹æ³•å°±å¯ä»¥é€šè¿‡ç±»åå»è¿›è¡Œè®¿é—®ï¼Œå®ƒçš„ä½œç”¨ç”¨ä¸€å¥è¯æ¥æè¿°å°±æ˜¯ï¼Œä¸ç”¨åˆ›å»ºå¯¹è±¡å°±å¯ä»¥è°ƒç”¨æ–¹æ³•æˆ–è€…å˜é‡ï¼Œè¿™ç®€ç›´å°±æ˜¯ä¸ºå•ä¾‹æ¨¡å¼çš„ä»£ç å®ç°é‡èº«æ‰“é€ çš„ã€‚</p><h2 id="é¥¿æ±‰æ¨¡å¼"><a href="#é¥¿æ±‰æ¨¡å¼" class="headerlink" title="é¥¿æ±‰æ¨¡å¼"></a>é¥¿æ±‰æ¨¡å¼</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†å®ä¾‹åŒ–, é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜. å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„, å› ä¸ºç±»åŠ è½½æ—¶å°±å®ä¾‹åŒ–äº†, æ²¡æœ‰è¾¾åˆ°Lazy Loading (æ‡’åŠ è½½) çš„æ•ˆæœ, å¦‚æœè¯¥å®ä¾‹æ²¡è¢«ä½¿ç”¨, å†…å­˜å°±æµªè´¹äº†. </p><h2 id="æ‡’æ±‰æ¨¡å¼"><a href="#æ‡’æ±‰æ¨¡å¼" class="headerlink" title="æ‡’æ±‰æ¨¡å¼"></a>æ‡’æ±‰æ¨¡å¼</h2><p>é¡¾åæ€ä¹‰,  å°±æ˜¯åˆå§‹åŒ–çš„æ—¶å€™, ä¸ä¼šä¸»åŠ¨çš„å»åˆ›å»ºå®ä¾‹, è€Œæ˜¯åœ¨è°ƒç”¨**getInstance()**çš„æ—¶å€™, æ‰ä¼šè¢«åŠ¨çš„å»åˆ›å»º. </p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>){</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>åœ¨å•çº¿ç¨‹çš„æƒ…å†µä¸‹, æ²¡æœ‰ä»»ä½•é—®é¢˜, ä½†æ˜¯å› ä¸ºå…¶ä¸ºçº¿ç¨‹ä¸å®‰å…¨çš„,  åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹, è­¬å¦‚ä¸¤ä¸ªçº¿ç¨‹A,  Béƒ½æ‰§è¡Œäº†**getInstance()**æ–¹æ³•, å¹¶ä¸”éƒ½æ‰§è¡Œåˆ°äº†ç¬¬9è¡Œä»£ç , ç„¶åAå› ä¸ºå…¶ä»–åŸå› , ä¼‘çœ äº†ä¸€ä¼šå„¿, å¾…Båˆ›å»ºäº†å®ä¾‹å¯¹è±¡ä¹‹å, Aæœ‰åˆ›å»ºäº†ä¸€ä¸ª, æ˜¾ç„¶, è¿™æ˜¯ä¸ç¬¦åˆå•åˆ©æ¨¡å¼çš„</p><h3 id="è§£å†³1"><a href="#è§£å†³1" class="headerlink" title="è§£å†³1"></a>è§£å†³1</h3><p>åœ¨**getInstance()**æ–¹æ³•å†…éƒ¨æ·»åŠ åŒæ­¥ä»£ç å—, æˆ–è€…ç›´æ¥å°†è¯¥æ–¹æ³•æ”¹ä¸ºåŒæ­¥æ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LazySingleton</span><span class="params">()</span></span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>){</span><br><span class="line">            instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¥½å¤„æ˜¯å†™èµ·æ¥ç®€å•, ä¸”ç»å¯¹çº¿ç¨‹å®‰å…¨; åå¤„æ˜¯å¹¶å‘æ€§èƒ½æå·®, äº‹å®ä¸Šå®Œå…¨é€€åŒ–åˆ°äº†ä¸²è¡Œ. å•ä¾‹åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡, ä½†å°±ç®—åˆå§‹åŒ–ä»¥å, synchronizedçš„é”ä¹Ÿæ— æ³•é¿å¼€, ä»è€Œ**getInstance()**å®Œå…¨å˜æˆäº†ä¸²è¡Œæ“ä½œ. <strong>æ€§èƒ½ä¸æ•æ„Ÿçš„åœºæ™¯å»ºè®®ä½¿ç”¨</strong>ã€‚</p><h3 id="è§£å†³2"><a href="#è§£å†³2" class="headerlink" title="è§£å†³2"></a>è§£å†³2</h3><p>ä¹Ÿå°±æ˜¯è‡­åæ˜­è‘—çš„åŒé‡æ£€éªŒæ–¹æ³•</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒé‡é”æ£€éªŒ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) { <span class="comment">// ç¬¬7è¡Œ</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) {</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton(); <span class="comment">// ç¬¬10è¡Œ</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ç”±äºæŒ‡ä»¤é‡æ’åºçš„é—®é¢˜, å¯èƒ½ä¼šè¢«é‡æ’åºä¸ºå¦‚ä¸‹:</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">instance = <span class="keyword">new</span> Singleton(); <span class="comment">// ç¬¬10è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤</span></span><br><span class="line"><span class="number">1</span> memory=allocate();<span class="comment">// åˆ†é…å†…å­˜ ç›¸å½“äºcçš„malloc</span></span><br><span class="line"><span class="number">2</span> ctorInstanc(memory) <span class="comment">//åˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="number">3</span> s=memory <span class="comment">//è®¾ç½®sæŒ‡å‘åˆšåˆ†é…çš„åœ°å€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤å¯èƒ½ä¼šè¢«é‡æ’åºä¸º 1-3-2ï¼Œä¹Ÿå°±æ˜¯ï¼š</span></span><br><span class="line"><span class="number">1</span> memory=allocate();<span class="comment">// åˆ†é…å†…å­˜ ç›¸å½“äºcçš„malloc</span></span><br><span class="line"><span class="number">3</span> s=memory <span class="comment">//è®¾ç½®sæŒ‡å‘åˆšåˆ†é…çš„åœ°å€</span></span><br><span class="line"><span class="number">2</span> ctorInstanc(memory) <span class="comment">//åˆå§‹åŒ–å¯¹è±¡</span></span><br></pre></td></tr></tbody></table></figure><p><strong>è€Œä¸€æ—¦å‡è®¾å‘ç”Ÿäº†è¿™æ ·çš„é‡æ’åºï¼Œæ¯”å¦‚çº¿ç¨‹Aåœ¨ç¬¬10è¡Œæ‰§è¡Œäº†æ­¥éª¤1å’Œæ­¥éª¤3ï¼Œä½†æ˜¯æ­¥éª¤2è¿˜æ²¡æœ‰æ‰§è¡Œå®Œã€‚è¿™ä¸ªæ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹Bæ‰§è¡Œåˆ°äº†ç¬¬7è¡Œï¼Œå®ƒä¼šåˆ¤å®šinstanceä¸ä¸ºç©ºï¼Œç„¶åç›´æ¥è¿”å›äº†ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæˆçš„instanceï¼</strong></p><h3 id="è§£å†³3"><a href="#è§£å†³3" class="headerlink" title="è§£å†³3"></a>è§£å†³3</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒé‡é”æ£€éªŒ</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) { <span class="comment">// ç¬¬7è¡Œ</span></span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton<span class="class">.<span class="keyword">class</span>) </span>{</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) {</span><br><span class="line">                    instance = <span class="keyword">new</span> Singleton(); <span class="comment">// ç¬¬10è¡Œ</span></span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>è¿™æ ·å°±ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨</p><h2 id="æšä¸¾æ¨¡å¼"><a href="#æšä¸¾æ¨¡å¼" class="headerlink" title="æšä¸¾æ¨¡å¼"></a>æšä¸¾æ¨¡å¼</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æšä¸¾</span></span><br><span class="line"><span class="comment">// ThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Singleton4 {</span><br><span class="line">  SINGLETON;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>ä½¿ç”¨javapè¿›è¡Œåç¼–è¯‘å¾—åˆ°å¦‚ä¸‹ç»“æœ</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æšä¸¾</span></span><br><span class="line"><span class="comment">// ThreadSafe</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton4</span> <span class="keyword">extends</span> <span class="title">Enum</span>&lt;<span class="title">Singleton4</span>&gt; </span>{</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton4 SINGLETON = <span class="keyword">new</span> Singleton4();</span><br><span class="line">  ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹åˆ°, å…¶æœ¬è´¨ä¹Ÿè¿˜æ˜¯é¥¿æ±‰æ¨¡å¼</p><h2 id="é™æ€å†…éƒ¨ç±»å®ç°"><a href="#é™æ€å†…éƒ¨ç±»å®ç°" class="headerlink" title="é™æ€å†…éƒ¨ç±»å®ç°"></a>é™æ€å†…éƒ¨ç±»å®ç°</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JVMåœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼ˆclassè¢«åŠ åœ¨åï¼Œä¸”è¢«çº¿ç¨‹ä½¿ç”¨ä¹‹å‰ï¼‰ä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * æ‰§è¡Œç±»çš„åˆå§‹åŒ–æœŸé—´ï¼ŒJVMä¼šå»è·å–ä¸€ä¸ªé”ï¼Œé”ä¼šåŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> weikunkun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021/3/20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceFactory</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceHolder</span> </span>{</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Object object = <span class="keyword">new</span> Object();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> InstanceHolder.object;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;</summary>
    
    
    
    <category term="è®¾è®¡æ¨¡å¼" scheme="https://winniekun.github.io/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
    <category term="åˆ›å»ºå‹æ¨¡å¼" scheme="https://winniekun.github.io/tags/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>Exceptionå’ŒErrorçš„åŒºåˆ«</title>
    <link href="https://winniekun.github.io/Throwable/"/>
    <id>https://winniekun.github.io/Throwable/</id>
    <published>2020-07-02T11:57:04.000Z</published>
    <updated>2020-08-30T04:50:22.244Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è§£ç­”"><a href="#è§£ç­”" class="headerlink" title="è§£ç­”"></a>è§£ç­”</h2><a id="more"></a><p><strong>Exception</strong>å’Œ<strong>Error</strong>å‡ç»§æ‰¿è‡ª<strong>Trowable</strong>, å¦‚ä¸‹å›¾æ‰€ç¤º:</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://i.loli.net/2020/07/02/aIOqAKGJe8yZ9cX.png" alt="ä¾èµ–å›¾" title="">                </div>                <div class="image-caption">ä¾èµ–å›¾</div>            </figure><p>åœ¨ Java ä¸­åªæœ‰ <strong>Throwable</strong> ç±»å‹çš„å®ä¾‹æ‰å¯ä»¥è¢«æŠ›å‡ºï¼ˆthrowï¼‰æˆ–è€…æ•è·ï¼ˆcatchï¼‰ï¼Œå®ƒæ˜¯å¼‚å¸¸å¤„ç†æœºåˆ¶çš„åŸºæœ¬ç»„æˆç±»å‹, <em>Exceptionå’ŒErrorä»£è¡¨äº†å¯¹ä¸åŒå¼‚å¸¸æƒ…å†µçš„åˆ†ç±»</em></p><ol><li><p>Exception:</p><ul><li>ç¨‹åºæ­£å¸¸è¿è¡Œçš„æƒ…å†µä¸‹, å¯ä»¥é¢„æ–™çš„æ„å¤–æƒ…å†µ, å¯ä»¥å¹¶ä¸”åº”è¯¥è¢«æ•è·, ä¹‹åè¿›è¡Œå¤„ç†, æœ€åä»èƒ½ç¨‹åºç»§ç»­æ­£å¸¸è¿è¡Œ</li></ul><p>åˆå¯ä»¥è¢«ç»†åˆ†ä¸º<strong>å¯æ£€æŸ¥å¼‚å¸¸</strong>å’Œ<strong>ä¸å¯æ£€æŸ¥å¼‚å¸¸</strong></p><ol><li>å¯æ£€æŸ¥å¼‚å¸¸:<ul><li>ç¼–è¯‘æœŸé—´å‡ºç°çš„å¼‚å¸¸, å¿…é¡»è¿›è¡Œæ•è·å¤„ç†</li></ul></li><li>ä¸å¯æ£€æŸ¥å¼‚å¸¸:<ul><li>è¿è¡ŒæœŸé—´å‡ºç°çš„å¼‚å¸¸, è­¬å¦‚ArrayIndexOutOfBoundsException, NullPointerExceptionä¹‹ç±»</li></ul></li></ol></li><li><p>Error:</p><ul><li>æ­£å¸¸æƒ…å†µä¸‹, ä¸å¤§å¯èƒ½å‡ºç°çš„å¼‚å¸¸,  ç»å¤§å¤šæ•°Errorçš„å‡ºç°ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ, ä¸ä¾¿äºä¹Ÿä¸éœ€è¦æ•è·, è­¬å¦‚OutOfMemoryErrorä¹‹ç±», éƒ½æ˜¯Errorçš„å­ç±»</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;è§£ç­”&quot;&gt;&lt;a href=&quot;#è§£ç­”&quot; class=&quot;headerlink&quot; title=&quot;è§£ç­”&quot;&gt;&lt;/a&gt;è§£ç­”&lt;/h2&gt;</summary>
    
    
    
    <category term="java" scheme="https://winniekun.github.io/categories/java/"/>
    
    
    <category term="javaåŸºç¡€" scheme="https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"/>
    
    <category term="é¢è¯•36è®²" scheme="https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"/>
    
  </entry>
  
  <entry>
    <title>Spring Beançš„ç”Ÿå‘½å‘¨æœŸå’Œä½œç”¨åŸŸ</title>
    <link href="https://winniekun.github.io/spring-bean-knowledge-point/"/>
    <id>https://winniekun.github.io/spring-bean-knowledge-point/</id>
    <published>2020-07-01T12:38:31.000Z</published>
    <updated>2021-04-05T15:26:25.201Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring Beançš„ç”Ÿå‘½å‘¨æœŸ"></a>Spring Beançš„ç”Ÿå‘½å‘¨æœŸ</h2><a id="more"></a><p>Springçš„ç”Ÿå‘½å‘¨æœŸä»æ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸º<em>åˆ›å»º</em>å’Œ<em>é”€æ¯</em>ä¸¤ä¸ªéƒ¨åˆ†. </p><p><img src="https://i.loli.net/2021/04/05/mnZHsqRzJoFYxAW.png" alt="image-20210405232540275"></p><ol><li>å®ä¾‹åŒ–Beanå¯¹è±¡</li><li>è®¾ç½®Beanå±æ€§</li><li>è‹¥æ˜¯é€šè¿‡å„ç§<strong>Aware</strong>æ¥å£å£°æ˜äº†ä¾èµ–å…³ç³»,åˆ™ä¼šæ³¨å…¥ Bean å¯¹å®¹å™¨åŸºç¡€è®¾æ–½å±‚é¢çš„ä¾èµ–<ol><li>å¦‚æœbeanå®ç°äº†BeanNameAwareæ¥å£,  åˆ™å°†BeanIdé€šè¿‡setBeanNameæ³¨å…¥Springä¸­. </li><li>å¦‚æœbeanå®ç°äº†BeanFactoryAwareæ¥å£, åˆ™å°†BeanFactoryå®¹å™¨å®ä¾‹é€šè¿‡setBeanFactoryæ³¨å…¥Springä¸­</li><li>å¦‚æœbeanå®ç°äº†ApplicationContextAwareæ¥å£, åˆ™å°†beanæ‰€åœ¨çš„åº”ç”¨çš„ä¸Šä¸‹æ–‡é€šè¿‡setApplicationContextæ³¨å…¥Springä¸­</li></ol></li><li>å¦‚æœbeanå®ç°äº†BeanPostProcessoræ¥å£, åˆ™è°ƒç”¨å‰ç½®åˆå§‹åŒ–æ–¹æ³•, postProcessorBeforeInitialization()</li><li>å¦‚æœbeanå®ç°äº†InitializingBeanæ¥å£, åˆ™è°ƒç”¨afterPropertiesSet()æ–¹æ³•, </li><li>è°ƒç”¨è‡ªèº«çš„åˆå§‹åŒ–æ–¹æ³•</li><li>å¦‚æœbeanå®ç°äº†BeanPostProcessoræ¥å£, åˆ™è°ƒç”¨åç½®åˆå§‹åŒ–æ–¹æ³•, postProcessorAfterInitialization()</li><li>beanå·²ç»å‡†å¤‡å°±ç»ª, å¯ä»¥ä½¿ç”¨, ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­, ç›´åˆ°åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯</li><li>å¦‚æœbeanå®ç°äº†DisposableBeanæ¥å£, åˆ™è°ƒç”¨destroy()æ–¹æ³•</li><li>è°ƒç”¨è‡ªèº«çš„destroyæ–¹æ³•</li></ol><h2 id="Spring-Bean-çš„ä½œç”¨åŸŸ"><a href="#Spring-Bean-çš„ä½œç”¨åŸŸ" class="headerlink" title="Spring Bean çš„ä½œç”¨åŸŸ"></a>Spring Bean çš„ä½œç”¨åŸŸ</h2><p>Spring Bean æœ‰äº”ä¸ªä½œç”¨åŸŸï¼Œå…¶ä¸­æœ€åŸºç¡€çš„ä¸ºåŠ ç²—çš„ä¸¤ç§</p><ol><li><strong>singleton</strong><ol><li>Springçš„é»˜è®¤ä½œç”¨äº, ä¸ºæ¯ä¸ªIOCå®¹å™¨åˆ›å»ºå”¯ä¸€çš„Beanå®ä¾‹</li></ol></li><li><strong>prototype</strong><ol><li>é’ˆå¯¹æ¯ä¸ªgetBeanè¯·æ±‚, éƒ½ä¼šåˆ›å»ºä¸€ä¸ªBeanå®ä¾‹</li></ol></li><li>request<ol><li>æ¯æ¬¡Httpè¯·æ±‚éƒ½ä¼šåˆ›å»ºæ–°çš„Bean, ä»…é€‚ç”¨äºWebApplicationContext</li></ol></li><li>session<ol><li>ä¸€ä¸ªHttpSessionå®šä¹‰ä¸€ä¸ªBean. è¯¥ä½œç”¨äºä»…é€‚ç”¨äºWebApplicationContext</li></ol></li><li>globalSession<ol><li>åŒä¸€ä¸ªå…¨å±€Http Session å®šä¹‰ä¸€ä¸ªBean. è¯¥ä½œç”¨åŸŸåŒæ ·ä»…é€‚ç”¨äºWebApplicationContext</li></ol></li></ol>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;a href=&quot;#Spring-Beançš„ç”Ÿå‘½å‘¨æœŸ&quot; class=&quot;headerlink&quot; title=&quot;Spring Beançš„ç”Ÿå‘½å‘¨æœŸ&quot;&gt;&lt;/a&gt;Spring Beançš„ç”Ÿå‘½å‘¨æœŸ&lt;/h2&gt;</summary>
    
    
    
    <category term="java" scheme="https://winniekun.github.io/categories/java/"/>
    
    
    <category term="javaåŸºç¡€" scheme="https://winniekun.github.io/tags/java%E5%9F%BA%E7%A1%80/"/>
    
    <category term="é¢è¯•36è®²" scheme="https://winniekun.github.io/tags/%E9%9D%A2%E8%AF%9536%E8%AE%B2/"/>
    
  </entry>
  
  <entry>
    <title>WeakHashMapæºç è§£è¯»</title>
    <link href="https://winniekun.github.io/weakhashmap-analysis/"/>
    <id>https://winniekun.github.io/weakhashmap-analysis/</id>
    <published>2020-06-20T10:42:30.000Z</published>
    <updated>2020-08-30T04:50:22.256Z</updated>
    
    
    
    
    
  </entry>
  
</feed>
